"use strict";(self.webpackChunkVitesseVent=self.webpackChunkVitesseVent||[]).push([[179],{646:(Oa,Ml,Fa)=>{var cs={};function bt(n){return"function"==typeof n}function _r(n){const t=n(i=>{Error.call(i),i.stack=(new Error).stack});return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}Fa.r(cs),Fa.d(cs,{ACESFilmicToneMapping:()=>R_,AddEquation:()=>na,AddOperation:()=>yD,AdditiveAnimationBlendMode:()=>nv,AdditiveBlending:()=>S_,AlphaFormat:()=>DD,AlwaysDepth:()=>uD,AlwaysStencilFunc:()=>WD,AmbientLight:()=>VA,AmbientLightProbe:()=>_5,AnimationClip:()=>vl,AnimationLoader:()=>a5,AnimationMixer:()=>k5,AnimationObjectGroup:()=>N5,AnimationUtils:()=>i5,ArcCurve:()=>oA,ArrayCamera:()=>kC,ArrowHelper:()=>rW,Audio:()=>JA,AudioAnalyser:()=>S5,AudioContext:()=>b0,AudioListener:()=>b5,AudioLoader:()=>g5,AxesHelper:()=>sW,BackSide:()=>ir,BasicDepthPacking:()=>zD,BasicShadowMap:()=>fU,Bone:()=>Tp,BooleanKeyframeTrack:()=>ba,Box2:()=>W5,Box3:()=>So,Box3Helper:()=>nW,BoxBufferGeometry:()=>dW,BoxGeometry:()=>Io,BoxHelper:()=>tW,BufferAttribute:()=>an,BufferGeometry:()=>Pt,BufferGeometryLoader:()=>WA,ByteType:()=>wD,Cache:()=>Ma,Camera:()=>dp,CameraHelper:()=>eW,CanvasTexture:()=>D4,CapsuleBufferGeometry:()=>fW,CapsuleGeometry:()=>fd,CatmullRomCurve3:()=>aA,CineonToneMapping:()=>xD,CircleBufferGeometry:()=>hW,CircleGeometry:()=>hd,ClampToEdgeWrapping:()=>Ei,Clock:()=>w0,Color:()=>De,ColorKeyframeTrack:()=>h0,ColorManagement:()=>ei,CompressedArrayTexture:()=>T4,CompressedTexture:()=>Xv,CompressedTextureLoader:()=>c5,ConeBufferGeometry:()=>pW,ConeGeometry:()=>pd,CubeCamera:()=>cC,CubeReflectionMapping:()=>yo,CubeRefractionMapping:()=>_o,CubeTexture:()=>td,CubeTextureLoader:()=>l5,CubeUVReflectionMapping:()=>Nc,CubicBezierCurve:()=>e0,CubicBezierCurve3:()=>lA,CubicInterpolant:()=>RA,CullFaceBack:()=>b_,CullFaceFront:()=>YT,CullFaceFrontBack:()=>dU,CullFaceNone:()=>XT,Curve:()=>rs,CurvePath:()=>dA,CustomBlending:()=>KT,CustomToneMapping:()=>bD,CylinderBufferGeometry:()=>mW,CylinderGeometry:()=>ya,Cylindrical:()=>G5,Data3DTexture:()=>hv,DataArrayTexture:()=>Kh,DataTexture:()=>ul,DataTextureLoader:()=>u5,DataUtils:()=>uW,DecrementStencilOp:()=>wU,DecrementWrapStencilOp:()=>SU,DefaultLoadingManager:()=>NA,DepthFormat:()=>wo,DepthStencilFormat:()=>ra,DepthTexture:()=>BC,DirectionalLight:()=>x0,DirectionalLightHelper:()=>Q5,DiscreteInterpolant:()=>PA,DodecahedronBufferGeometry:()=>gW,DodecahedronGeometry:()=>md,DoubleSide:()=>ws,DstAlphaFactor:()=>rD,DstColorFactor:()=>oD,DynamicCopyUsage:()=>UU,DynamicDrawUsage:()=>LU,DynamicReadUsage:()=>FU,EdgesGeometry:()=>fA,EllipseCurve:()=>Pp,EqualDepth:()=>fD,EqualStencilFunc:()=>CU,EquirectangularReflectionMapping:()=>Uu,EquirectangularRefractionMapping:()=>Vu,Euler:()=>JD,EventDispatcher:()=>qs,ExtrudeBufferGeometry:()=>yW,ExtrudeGeometry:()=>vd,FileLoader:()=>os,Float16BufferAttribute:()=>vV,Float32BufferAttribute:()=>Ve,Float64BufferAttribute:()=>xV,FloatType:()=>js,Fog:()=>xp,FogExp2:()=>vp,FramebufferTexture:()=>E4,FrontSide:()=>bs,Frustum:()=>hp,GLBufferAttribute:()=>z5,GLSL1:()=>zU,GLSL3:()=>rv,GreaterDepth:()=>pD,GreaterEqualDepth:()=>hD,GreaterEqualStencilFunc:()=>PU,GreaterStencilFunc:()=>IU,GridHelper:()=>K5,Group:()=>eo,HalfFloatType:()=>kc,HemisphereLight:()=>FA,HemisphereLightHelper:()=>Y5,HemisphereLightProbe:()=>y5,IcosahedronBufferGeometry:()=>_W,IcosahedronGeometry:()=>xd,ImageBitmapLoader:()=>qA,ImageLoader:()=>Cd,ImageUtils:()=>dv,IncrementStencilOp:()=>bU,IncrementWrapStencilOp:()=>MU,InstancedBufferAttribute:()=>dl,InstancedBufferGeometry:()=>GA,InstancedInterleavedBuffer:()=>V5,InstancedMesh:()=>Wv,Int16BufferAttribute:()=>yV,Int32BufferAttribute:()=>_V,Int8BufferAttribute:()=>pV,IntType:()=>SD,InterleavedBuffer:()=>id,InterleavedBufferAttribute:()=>Po,Interpolant:()=>gl,InterpolateDiscrete:()=>Bc,InterpolateLinear:()=>sa,InterpolateSmooth:()=>Hh,InvertStencilOp:()=>EU,KeepStencilOp:()=>jh,KeyframeTrack:()=>ss,LOD:()=>jC,LatheBufferGeometry:()=>vW,LatheGeometry:()=>fl,Layers:()=>pa,LessDepth:()=>dD,LessEqualDepth:()=>Nh,LessEqualStencilFunc:()=>AU,LessStencilFunc:()=>DU,Light:()=>No,LightProbe:()=>zp,Line:()=>to,Line3:()=>j5,LineBasicMaterial:()=>Ni,LineCurve:()=>Np,LineCurve3:()=>uA,LineDashedMaterial:()=>AA,LineLoop:()=>$v,LineSegments:()=>is,LinearEncoding:()=>$s,LinearFilter:()=>Fn,LinearInterpolant:()=>f0,LinearMipMapLinearFilter:()=>yU,LinearMipMapNearestFilter:()=>gU,LinearMipmapLinearFilter:()=>Ms,LinearMipmapNearestFilter:()=>Fh,LinearSRGBColorSpace:()=>Uc,LinearToneMapping:()=>_D,Loader:()=>rr,LoaderUtils:()=>xl,LoadingManager:()=>p0,LoopOnce:()=>kD,LoopPingPong:()=>UD,LoopRepeat:()=>BD,LuminanceAlphaFormat:()=>AD,LuminanceFormat:()=>CD,MOUSE:()=>lU,Material:()=>ui,MaterialLoader:()=>Hp,MathUtils:()=>av,Matrix3:()=>ji,Matrix4:()=>pt,MaxEquation:()=>C_,Mesh:()=>yi,MeshBasicMaterial:()=>pr,MeshDepthMaterial:()=>Bv,MeshDistanceMaterial:()=>Uv,MeshLambertMaterial:()=>DA,MeshMatcapMaterial:()=>CA,MeshNormalMaterial:()=>TA,MeshPhongMaterial:()=>SA,MeshPhysicalMaterial:()=>io,MeshStandardMaterial:()=>Dd,MeshToonMaterial:()=>EA,MinEquation:()=>D_,MirroredRepeatWrapping:()=>Oc,MixOperation:()=>gD,MultiplyBlending:()=>T_,MultiplyOperation:()=>Bu,NearestFilter:()=>Hn,NearestMipMapLinearFilter:()=>mU,NearestMipMapNearestFilter:()=>pU,NearestMipmapLinearFilter:()=>Fc,NearestMipmapNearestFilter:()=>zu,NeverDepth:()=>lD,NeverStencilFunc:()=>TU,NoBlending:()=>Ws,NoColorSpace:()=>_U,NoToneMapping:()=>Yr,NormalAnimationBlendMode:()=>Gh,NormalBlending:()=>ta,NotEqualDepth:()=>mD,NotEqualStencilFunc:()=>RU,NumberKeyframeTrack:()=>yl,Object3D:()=>_n,ObjectLoader:()=>p5,ObjectSpaceNormalMap:()=>GD,OctahedronBufferGeometry:()=>xW,OctahedronGeometry:()=>pl,OneFactor:()=>tD,OneMinusDstAlphaFactor:()=>sD,OneMinusDstColorFactor:()=>aD,OneMinusSrcAlphaFactor:()=>I_,OneMinusSrcColorFactor:()=>iD,OrthographicCamera:()=>nl,PCFShadowMap:()=>w_,PCFSoftShadowMap:()=>M_,PMREMGenerator:()=>Nv,Path:()=>dd,PerspectiveCamera:()=>di,Plane:()=>Ro,PlaneBufferGeometry:()=>bW,PlaneGeometry:()=>tl,PlaneHelper:()=>iW,PointLight:()=>v0,PointLightHelper:()=>Z5,Points:()=>Zv,PointsMaterial:()=>Ap,PolarGridHelper:()=>J5,PolyhedronBufferGeometry:()=>wW,PolyhedronGeometry:()=>no,PositionalAudio:()=>M5,PropertyBinding:()=>vn,PropertyMixer:()=>e1,QuadraticBezierCurve:()=>t0,QuadraticBezierCurve3:()=>n0,Quaternion:()=>Li,QuaternionKeyframeTrack:()=>Lo,QuaternionLinearInterpolant:()=>LA,RED_GREEN_RGTC2_Format:()=>ev,RED_RGTC1_Format:()=>FD,REVISION:()=>Lh,RGBADepthPacking:()=>HD,RGBAFormat:()=>dr,RGBAIntegerFormat:()=>ND,RGBA_ASTC_10x10_Format:()=>Y_,RGBA_ASTC_10x5_Format:()=>q_,RGBA_ASTC_10x6_Format:()=>Z_,RGBA_ASTC_10x8_Format:()=>X_,RGBA_ASTC_12x10_Format:()=>K_,RGBA_ASTC_12x12_Format:()=>J_,RGBA_ASTC_4x4_Format:()=>U_,RGBA_ASTC_5x4_Format:()=>V_,RGBA_ASTC_5x5_Format:()=>z_,RGBA_ASTC_6x5_Format:()=>H_,RGBA_ASTC_6x6_Format:()=>G_,RGBA_ASTC_8x5_Format:()=>W_,RGBA_ASTC_8x6_Format:()=>j_,RGBA_ASTC_8x8_Format:()=>$_,RGBA_BPTC_Format:()=>zh,RGBA_ETC2_EAC_Format:()=>B_,RGBA_PVRTC_2BPPV1_Format:()=>F_,RGBA_PVRTC_4BPPV1_Format:()=>O_,RGBA_S3TC_DXT1_Format:()=>Bh,RGBA_S3TC_DXT3_Format:()=>Uh,RGBA_S3TC_DXT5_Format:()=>Vh,RGB_ETC1_Format:()=>OD,RGB_ETC2_Format:()=>k_,RGB_PVRTC_2BPPV1_Format:()=>N_,RGB_PVRTC_4BPPV1_Format:()=>L_,RGB_S3TC_DXT1_Format:()=>kh,RGFormat:()=>PD,RGIntegerFormat:()=>LD,RawShaderMaterial:()=>MA,Ray:()=>Xu,Raycaster:()=>T0,RectAreaLight:()=>zA,RedFormat:()=>ID,RedIntegerFormat:()=>RD,ReinhardToneMapping:()=>vD,RepeatWrapping:()=>vo,ReplaceStencilOp:()=>xU,ReverseSubtractEquation:()=>QT,RingBufferGeometry:()=>MW,RingGeometry:()=>bd,SIGNED_RED_GREEN_RGTC2_Format:()=>tv,SIGNED_RED_RGTC1_Format:()=>Q_,SRGBColorSpace:()=>Kr,Scene:()=>bp,ShaderChunk:()=>Lt,ShaderLib:()=>ns,ShaderMaterial:()=>Ss,ShadowMaterial:()=>wA,Shape:()=>_a,ShapeBufferGeometry:()=>SW,ShapeGeometry:()=>wd,ShapePath:()=>oW,ShapeUtils:()=>Es,ShortType:()=>MD,Skeleton:()=>ad,SkeletonHelper:()=>q5,SkinnedMesh:()=>Gv,Source:()=>ua,Sphere:()=>Do,SphereBufferGeometry:()=>EW,SphereGeometry:()=>ml,Spherical:()=>H5,SphericalHarmonics3:()=>HA,SplineCurve:()=>r0,SpotLight:()=>y0,SpotLightHelper:()=>$5,Sprite:()=>GC,SpriteMaterial:()=>zv,SrcAlphaFactor:()=>A_,SrcAlphaSaturateFactor:()=>cD,SrcColorFactor:()=>nD,StaticCopyUsage:()=>BU,StaticDrawUsage:()=>Gu,StaticReadUsage:()=>OU,StereoCamera:()=>v5,StreamCopyUsage:()=>VU,StreamDrawUsage:()=>NU,StreamReadUsage:()=>kU,StringKeyframeTrack:()=>wa,SubtractEquation:()=>JT,SubtractiveBlending:()=>E_,TOUCH:()=>uU,TangentSpaceNormalMap:()=>Mo,TetrahedronBufferGeometry:()=>TW,TetrahedronGeometry:()=>Md,Texture:()=>Ti,TextureLoader:()=>OA,TorusBufferGeometry:()=>DW,TorusGeometry:()=>Sd,TorusKnotBufferGeometry:()=>CW,TorusKnotGeometry:()=>Ed,Triangle:()=>Ir,TriangleFanDrawMode:()=>Wh,TriangleStripDrawMode:()=>iv,TrianglesDrawMode:()=>VD,TubeBufferGeometry:()=>AW,TubeGeometry:()=>Td,TwoPassDoubleSide:()=>hU,UVMapping:()=>Oh,Uint16BufferAttribute:()=>Ev,Uint32BufferAttribute:()=>Tv,Uint8BufferAttribute:()=>mV,Uint8ClampedBufferAttribute:()=>gV,Uniform:()=>E0,UniformsGroup:()=>U5,UniformsLib:()=>Ee,UniformsUtils:()=>aC,UnsignedByteType:()=>xo,UnsignedInt248Type:()=>ia,UnsignedIntType:()=>bo,UnsignedShort4444Type:()=>ED,UnsignedShort5551Type:()=>TD,UnsignedShortType:()=>P_,VSMShadowMap:()=>Lc,Vector2:()=>ce,Vector3:()=>T,Vector4:()=>dn,VectorKeyframeTrack:()=>_l,VideoTexture:()=>S4,WebGL1Renderer:()=>UC,WebGL3DRenderTarget:()=>rV,WebGLArrayRenderTarget:()=>iV,WebGLCubeRenderTarget:()=>lC,WebGLMultipleRenderTargets:()=>sV,WebGLRenderTarget:()=>Qr,WebGLRenderer:()=>_p,WebGLUtils:()=>FC,WireframeGeometry:()=>vA,WrapAroundEnding:()=>Hu,ZeroCurvatureEnding:()=>oa,ZeroFactor:()=>eD,ZeroSlopeEnding:()=>aa,ZeroStencilOp:()=>vU,_SRGBAFormat:()=>$h,sRGBEncoding:()=>Qt}),Fa(609);const sr=_r(n=>function(t){n(this),this.message=t?`${t.length} errors occurred during unsubscription:\n${t.map((i,r)=>`${r+1}) ${i.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=t});function ls(n,e){if(n){const t=n.indexOf(e);0<=t&&n.splice(t,1)}}class Rn{constructor(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let e;if(!this.closed){this.closed=!0;const{_parentage:t}=this;if(t)if(this._parentage=null,Array.isArray(t))for(const s of t)s.remove(this);else t.remove(this);const{initialTeardown:i}=this;if(bt(i))try{i()}catch(s){e=s instanceof sr?s.errors:[s]}const{_finalizers:r}=this;if(r){this._finalizers=null;for(const s of r)try{Ba(s)}catch(o){e=e??[],o instanceof sr?e=[...e,...o.errors]:e.push(o)}}if(e)throw new sr(e)}}add(e){var t;if(e&&e!==this)if(this.closed)Ba(e);else{if(e instanceof Rn){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=null!==(t=this._finalizers)&&void 0!==t?t:[]).push(e)}}_hasParent(e){const{_parentage:t}=this;return t===e||Array.isArray(t)&&t.includes(e)}_addParent(e){const{_parentage:t}=this;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e}_removeParent(e){const{_parentage:t}=this;t===e?this._parentage=null:Array.isArray(t)&&ls(t,e)}remove(e){const{_finalizers:t}=this;t&&ls(t,e),e instanceof Rn&&e._removeParent(this)}}Rn.EMPTY=(()=>{const n=new Rn;return n.closed=!0,n})();const ka=Rn.EMPTY;function vr(n){return n instanceof Rn||n&&"closed"in n&&bt(n.remove)&&bt(n.add)&&bt(n.unsubscribe)}function Ba(n){bt(n)?n():n.unsubscribe()}const Or={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},co={setTimeout(n,e,...t){const{delegate:i}=co;return i?.setTimeout?i.setTimeout(n,e,...t):setTimeout(n,e,...t)},clearTimeout(n){const{delegate:e}=co;return(e?.clearTimeout||clearTimeout)(n)},delegate:void 0};function xr(n){co.setTimeout(()=>{const{onUnhandledError:e}=Or;if(!e)throw n;e(n)})}function Fi(){}const Bo=Kt("C",void 0,void 0);function Kt(n,e,t){return{kind:n,value:e,error:t}}let br=null;function Fr(n){if(Or.useDeprecatedSynchronousErrorHandling){const e=!br;if(e&&(br={errorThrown:!1,error:null}),n(),e){const{errorThrown:t,error:i}=br;if(br=null,t)throw i}}else n()}class Tl extends Rn{constructor(e){super(),this.isStopped=!1,e?(this.destination=e,vr(e)&&e.add(this)):this.destination=Va}static create(e,t,i){return new lo(e,t,i)}next(e){this.isStopped?Ua(function El(n){return Kt("N",n,void 0)}(e),this):this._next(e)}error(e){this.isStopped?Ua(function Sl(n){return Kt("E",void 0,n)}(e),this):(this.isStopped=!0,this._error(e))}complete(){this.isStopped?Ua(Bo,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(e){this.destination.next(e)}_error(e){try{this.destination.error(e)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const Dl=Function.prototype.bind;function Cl(n,e){return Dl.call(n,e)}class Hd{constructor(e){this.partialObserver=e}next(e){const{partialObserver:t}=this;if(t.next)try{t.next(e)}catch(i){Ts(i)}}error(e){const{partialObserver:t}=this;if(t.error)try{t.error(e)}catch(i){Ts(i)}else Ts(e)}complete(){const{partialObserver:e}=this;if(e.complete)try{e.complete()}catch(t){Ts(t)}}}class lo extends Tl{constructor(e,t,i){let r;if(super(),bt(e)||!e)r={next:e??void 0,error:t??void 0,complete:i??void 0};else{let s;this&&Or.useDeprecatedNextContext?(s=Object.create(e),s.unsubscribe=()=>this.unsubscribe(),r={next:e.next&&Cl(e.next,s),error:e.error&&Cl(e.error,s),complete:e.complete&&Cl(e.complete,s)}):r=e}this.destination=new Hd(r)}}function Ts(n){Or.useDeprecatedSynchronousErrorHandling?function Yn(n){Or.useDeprecatedSynchronousErrorHandling&&br&&(br.errorThrown=!0,br.error=n)}(n):xr(n)}function Ua(n,e){const{onStoppedNotification:t}=Or;t&&co.setTimeout(()=>t(n,e))}const Va={closed:!0,next:Fi,error:function Al(n){throw n},complete:Fi},za="function"==typeof Symbol&&Symbol.observable||"@@observable";function kr(n){return n}function Xi(n){return 0===n.length?kr:1===n.length?n[0]:function(t){return n.reduce((i,r)=>r(i),t)}}let hn=(()=>{class n{constructor(t){t&&(this._subscribe=t)}lift(t){const i=new n;return i.source=this,i.operator=t,i}subscribe(t,i,r){const s=function Br(n){return n&&n instanceof Tl||function tm(n){return n&&bt(n.next)&&bt(n.error)&&bt(n.complete)}(n)&&vr(n)}(t)?t:new lo(t,i,r);return Fr(()=>{const{operator:o,source:a}=this;s.add(o?o.call(s,a):a?this._subscribe(s):this._trySubscribe(s))}),s}_trySubscribe(t){try{return this._subscribe(t)}catch(i){t.error(i)}}forEach(t,i){return new(i=wr(i))((r,s)=>{const o=new lo({next:a=>{try{t(a)}catch(c){s(c),o.unsubscribe()}},error:s,complete:r});this.subscribe(o)})}_subscribe(t){var i;return null===(i=this.source)||void 0===i?void 0:i.subscribe(t)}[za](){return this}pipe(...t){return Xi(t)(this)}toPromise(t){return new(t=wr(t))((i,r)=>{let s;this.subscribe(o=>s=o,o=>r(o),()=>i(s))})}}return n.create=e=>new n(e),n})();function wr(n){var e;return null!==(e=n??Or.Promise)&&void 0!==e?e:Promise}const Wd=_r(n=>function(){n(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let Yi=(()=>{class n extends hn{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(t){const i=new jd(this,this);return i.operator=t,i}_throwIfClosed(){if(this.closed)throw new Wd}next(t){Fr(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const i of this.currentObservers)i.next(t)}})}error(t){Fr(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=t;const{observers:i}=this;for(;i.length;)i.shift().error(t)}})}complete(){Fr(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:t}=this;for(;t.length;)t.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var t;return(null===(t=this.observers)||void 0===t?void 0:t.length)>0}_trySubscribe(t){return this._throwIfClosed(),super._trySubscribe(t)}_subscribe(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)}_innerSubscribe(t){const{hasError:i,isStopped:r,observers:s}=this;return i||r?ka:(this.currentObservers=null,s.push(t),new Rn(()=>{this.currentObservers=null,ls(s,t)}))}_checkFinalizedStatuses(t){const{hasError:i,thrownError:r,isStopped:s}=this;i?t.error(r):s&&t.complete()}asObservable(){const t=new hn;return t.source=this,t}}return n.create=(e,t)=>new jd(e,t),n})();class jd extends Yi{constructor(e,t){super(),this.destination=e,this.source=t}next(e){var t,i;null===(i=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===i||i.call(t,e)}error(e){var t,i;null===(i=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===i||i.call(t,e)}complete(){var e,t;null===(t=null===(e=this.destination)||void 0===e?void 0:e.complete)||void 0===t||t.call(e)}_subscribe(e){var t,i;return null!==(i=null===(t=this.source)||void 0===t?void 0:t.subscribe(e))&&void 0!==i?i:ka}}function $d(n){return bt(n?.lift)}function xn(n){return e=>{if($d(e))return e.lift(function(t){try{return n(t,this)}catch(i){this.error(i)}});throw new TypeError("Unable to lift unknown Observable type")}}function mn(n,e,t,i,r){return new nm(n,e,t,i,r)}class nm extends Tl{constructor(e,t,i,r,s,o){super(e),this.onFinalize=s,this.shouldUnsubscribe=o,this._next=t?function(a){try{t(a)}catch(c){e.error(c)}}:super._next,this._error=r?function(a){try{r(a)}catch(c){e.error(c)}finally{this.unsubscribe()}}:super._error,this._complete=i?function(){try{i()}catch(a){e.error(a)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var e;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:t}=this;super.unsubscribe(),!t&&(null===(e=this.onFinalize)||void 0===e||e.call(this))}}}function bn(n,e){return xn((t,i)=>{let r=0;t.subscribe(mn(i,s=>{i.next(n.call(e,s,r++))}))})}function Ur(n){return this instanceof Ur?(this.v=n,this):new Ur(n)}function dm(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,e=n[Symbol.asyncIterator];return e?e.call(n):(n=function Pl(n){var e="function"==typeof Symbol&&Symbol.iterator,t=e&&n[e],i=0;if(t)return t.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(n),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(s){t[s]=n[s]&&function(o){return new Promise(function(a,c){!function r(s,o,a,c){Promise.resolve(c).then(function(l){s({value:l,done:a})},o)}(a,c,(o=n[s](o)).done,o.value)})}}}function Xd(n,e,t,i){if("a"===t&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?n!==e||!i:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===t?i:"a"===t?i.call(n):i?i.value:e.get(n)}const Ll=n=>n&&"number"==typeof n.length&&"function"!=typeof n;function Yd(n){return bt(n?.then)}function Kd(n){return bt(n[za])}function Nl(n){return Symbol.asyncIterator&&bt(n?.[Symbol.asyncIterator])}function Jd(n){return new TypeError(`You provided ${null!==n&&"object"==typeof n?"an invalid object":`'${n}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const Vo=function hm(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function Cs(n){return bt(n?.[Vo])}function Qd(n){return function Zd(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=t.apply(n,e||[]),s=[];return r={},o("next"),o("throw"),o("return"),r[Symbol.asyncIterator]=function(){return this},r;function o(f){i[f]&&(r[f]=function(h){return new Promise(function(m,p){s.push([f,h,m,p])>1||a(f,h)})})}function a(f,h){try{!function c(f){f.value instanceof Ur?Promise.resolve(f.value.v).then(l,u):d(s[0][2],f)}(i[f](h))}catch(m){d(s[0][3],m)}}function l(f){a("next",f)}function u(f){a("throw",f)}function d(f,h){f(h),s.shift(),s.length&&a(s[0][0],s[0][1])}}(this,arguments,function*(){const t=n.getReader();try{for(;;){const{value:i,done:r}=yield Ur(t.read());if(r)return yield Ur(void 0);yield yield Ur(i)}}finally{t.releaseLock()}})}function ef(n){return bt(n?.getReader)}function pi(n){if(n instanceof hn)return n;if(null!=n){if(Kd(n))return function D(n){return new hn(e=>{const t=n[za]();if(bt(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(n);if(Ll(n))return function P(n){return new hn(e=>{for(let t=0;t<n.length&&!e.closed;t++)e.next(n[t]);e.complete()})}(n);if(Yd(n))return function O(n){return new hn(e=>{n.then(t=>{e.closed||(e.next(t),e.complete())},t=>e.error(t)).then(null,xr)})}(n);if(Nl(n))return Y(n);if(Cs(n))return function V(n){return new hn(e=>{for(const t of n)if(e.next(t),e.closed)return;e.complete()})}(n);if(ef(n))return function J(n){return Y(Qd(n))}(n)}throw Jd(n)}function Y(n){return new hn(e=>{(function fe(n,e){var t,i,r,s;return function cm(n,e,t,i){return new(t||(t=Promise))(function(s,o){function a(u){try{l(i.next(u))}catch(d){o(d)}}function c(u){try{l(i.throw(u))}catch(d){o(d)}}function l(u){u.done?s(u.value):function r(s){return s instanceof t?s:new t(function(o){o(s)})}(u.value).then(a,c)}l((i=i.apply(n,e||[])).next())})}(this,void 0,void 0,function*(){try{for(t=dm(n);!(i=yield t.next()).done;)if(e.next(i.value),e.closed)return}catch(o){r={error:o}}finally{try{i&&!i.done&&(s=t.return)&&(yield s.call(t))}finally{if(r)throw r.error}}e.complete()})})(n,e).catch(t=>e.error(t))})}function ye(n,e,t,i=0,r=!1){const s=e.schedule(function(){t(),r?n.add(this.schedule(null,i)):this.unsubscribe()},i);if(n.add(s),!r)return s}function Be(n,e,t=1/0){return bt(e)?Be((i,r)=>bn((s,o)=>e(i,s,r,o))(pi(n(i,r))),t):("number"==typeof e&&(t=e),xn((i,r)=>function Ie(n,e,t,i,r,s,o,a){const c=[];let l=0,u=0,d=!1;const f=()=>{d&&!c.length&&!l&&e.complete()},h=p=>l<i?m(p):c.push(p),m=p=>{s&&e.next(p),l++;let g=!1;pi(t(p,u++)).subscribe(mn(e,_=>{r?.(_),s?h(_):e.next(_)},()=>{g=!0},void 0,()=>{if(g)try{for(l--;c.length&&l<i;){const _=c.shift();o?ye(e,o,()=>m(_)):m(_)}f()}catch(_){e.error(_)}}))};return n.subscribe(mn(e,h,()=>{d=!0,f()})),()=>{a?.()}}(i,r,n,t)))}function Te(n=1/0){return Be(kr,n)}const Ue=new hn(n=>n.complete());function mt(n){return n&&bt(n.schedule)}function Ot(n){return n[n.length-1]}function Dn(n){return bt(Ot(n))?n.pop():void 0}function zt(n){return mt(Ot(n))?n.pop():void 0}function wt(n,e=0){return xn((t,i)=>{t.subscribe(mn(i,r=>ye(i,n,()=>i.next(r),e),()=>ye(i,n,()=>i.complete(),e),r=>ye(i,n,()=>i.error(r),e)))})}function ze(n,e=0){return xn((t,i)=>{i.add(n.schedule(()=>t.subscribe(i),e))})}function Ze(n,e){if(!n)throw new Error("Iterable cannot be null");return new hn(t=>{ye(t,e,()=>{const i=n[Symbol.asyncIterator]();ye(t,e,()=>{i.next().then(r=>{r.done?t.complete():t.next(r.value)})},0,!0)})})}function Xe(n,e){return e?function Tt(n,e){if(null!=n){if(Kd(n))return function pn(n,e){return pi(n).pipe(ze(e),wt(e))}(n,e);if(Ll(n))return function Ht(n,e){return new hn(t=>{let i=0;return e.schedule(function(){i===n.length?t.complete():(t.next(n[i++]),t.closed||this.schedule())})})}(n,e);if(Yd(n))return function Bt(n,e){return pi(n).pipe(ze(e),wt(e))}(n,e);if(Nl(n))return Ze(n,e);if(Cs(n))return function Gt(n,e){return new hn(t=>{let i;return ye(t,e,()=>{i=n[Vo](),ye(t,e,()=>{let r,s;try{({value:r,done:s}=i.next())}catch(o){return void t.error(o)}s?t.complete():t.next(r)},0,!0)}),()=>bt(i?.return)&&i.return()})}(n,e);if(ef(n))return function gn(n,e){return Ze(Qd(n),e)}(n,e)}throw Jd(n)}(n,e):pi(n)}function Dt(...n){const e=zt(n),t=function wn(n,e){return"number"==typeof Ot(n)?n.pop():e}(n,1/0),i=n;return i.length?1===i.length?pi(i[0]):Te(t)(Xe(i,e)):Ue}function nt(n={}){const{connector:e=(()=>new Yi),resetOnError:t=!0,resetOnComplete:i=!0,resetOnRefCountZero:r=!0}=n;return s=>{let o,a,c,l=0,u=!1,d=!1;const f=()=>{a?.unsubscribe(),a=void 0},h=()=>{f(),o=c=void 0,u=d=!1},m=()=>{const p=o;h(),p?.unsubscribe()};return xn((p,g)=>{l++,!d&&!u&&f();const _=c=c??e();g.add(()=>{l--,0===l&&!d&&!u&&(a=ln(m,r))}),_.subscribe(g),!o&&l>0&&(o=new lo({next:v=>_.next(v),error:v=>{d=!0,f(),a=ln(h,t,v),_.error(v)},complete:()=>{u=!0,f(),a=ln(h,i),_.complete()}}),pi(p).subscribe(o))})(s)}}function ln(n,e,...t){if(!0===e)return void n();if(!1===e)return;const i=new lo({next:()=>{i.unsubscribe(),n()}});return pi(e(...t)).subscribe(i)}function Ye(n){for(let e in n)if(n[e]===Ye)return e;throw Error("Could not find renamed property on target object.")}function mi(n,e){for(const t in e)e.hasOwnProperty(t)&&!n.hasOwnProperty(t)&&(n[t]=e[t])}function it(n){if("string"==typeof n)return n;if(Array.isArray(n))return"["+n.map(it).join(", ")+"]";if(null==n)return""+n;if(n.overriddenName)return`${n.overriddenName}`;if(n.name)return`${n.name}`;const e=n.toString();if(null==e)return""+e;const t=e.indexOf("\n");return-1===t?e:e.substring(0,t)}function un(n,e){return null==n||""===n?null===e?"":e:null==e||""===e?n:n+" "+e}const ve=Ye({__forward_ref__:Ye});function U(n){return n.__forward_ref__=U,n.toString=function(){return it(this())},n}function L(n){return Z(n)?n():n}function Z(n){return"function"==typeof n&&n.hasOwnProperty(ve)&&n.__forward_ref__===U}function Ke(n){return n&&!!n.\u0275providers}class z extends Error{constructor(e,t){super(Me(e,t)),this.code=e}}function Me(n,e){return`NG0${Math.abs(n)}${e?": "+e.trim():""}`}function Q(n){return"string"==typeof n?n:null==n?"":String(n)}function X(n){return"function"==typeof n?n.name||n.toString():"object"==typeof n&&null!=n&&"function"==typeof n.type?n.type.name||n.type.toString():Q(n)}function gt(n,e){throw new z(-201,!1)}function si(n,e){null==n&&function Jt(n,e,t,i){throw new Error(`ASSERTION ERROR: ${n}`+(null==i?"":` [Expected=> ${t} ${i} ${e} <=Actual]`))}(e,n,null,"!=")}function Wt(n){return{token:n.token,providedIn:n.providedIn||null,factory:n.factory,value:void 0}}function tf(n){return fx(n,nf)||fx(n,px)}function fx(n,e){return n.hasOwnProperty(e)?n[e]:null}function hx(n){return n&&(n.hasOwnProperty(_m)||n.hasOwnProperty(J1))?n[_m]:null}const nf=Ye({\u0275prov:Ye}),_m=Ye({\u0275inj:Ye}),px=Ye({ngInjectableDef:Ye}),J1=Ye({ngInjectorDef:Ye});var ht=(()=>((ht=ht||{})[ht.Default=0]="Default",ht[ht.Host=1]="Host",ht[ht.Self=2]="Self",ht[ht.SkipSelf=4]="SkipSelf",ht[ht.Optional=8]="Optional",ht))();let vm;function Mr(n){const e=vm;return vm=n,e}function mx(n,e,t){const i=tf(n);return i&&"root"==i.providedIn?void 0===i.value?i.value=i.factory():i.value:t&ht.Optional?null:void 0!==e?e:void gt(it(n))}const Cn=(()=>typeof globalThis<"u"&&globalThis||typeof global<"u"&&global||typeof window<"u"&&window||typeof self<"u"&&typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&self)(),kl={},xm="__NG_DI_FLAG__",rf="ngTempTokenPath",eI="ngTokenPath",tI=/\n/gm,nI="\u0275",gx="__source";let Bl;function Ga(n){const e=Bl;return Bl=n,e}function iI(n,e=ht.Default){if(void 0===Bl)throw new z(-203,!1);return null===Bl?mx(n,void 0,e):Bl.get(n,e&ht.Optional?null:void 0,e)}function sn(n,e=ht.Default){return(function Q1(){return vm}()||iI)(L(n),e)}function Un(n,e=ht.Default){return sn(n,sf(e))}function sf(n){return typeof n>"u"||"number"==typeof n?n:0|(n.optional&&8)|(n.host&&1)|(n.self&&2)|(n.skipSelf&&4)}function bm(n){const e=[];for(let t=0;t<n.length;t++){const i=L(n[t]);if(Array.isArray(i)){if(0===i.length)throw new z(900,!1);let r,s=ht.Default;for(let o=0;o<i.length;o++){const a=i[o],c=rI(a);"number"==typeof c?-1===c?r=a.token:s|=c:r=a}e.push(sn(r,s))}else e.push(sn(i))}return e}function rI(n){return n[xm]}function Is(n){return{toString:n}.toString()}var ds=(()=>((ds=ds||{})[ds.OnPush=0]="OnPush",ds[ds.Default=1]="Default",ds))(),fs=(()=>{return(n=fs||(fs={}))[n.Emulated=0]="Emulated",n[n.None=2]="None",n[n.ShadowDom=3]="ShadowDom",fs;var n})();const Rs={},rn=[],of=Ye({\u0275cmp:Ye}),wm=Ye({\u0275dir:Ye}),Mm=Ye({\u0275pipe:Ye}),Ps=Ye({\u0275fac:Ye}),Vl=Ye({__NG_ELEMENT_ID__:Ye});let aI=0;function zl(n){return Is(()=>{const e=bx(n),t={...e,decls:n.decls,vars:n.vars,template:n.template,consts:n.consts||null,ngContentSelectors:n.ngContentSelectors,onPush:n.changeDetection===ds.OnPush,directiveDefs:null,pipeDefs:null,dependencies:e.standalone&&n.dependencies||null,getStandaloneInjector:null,data:n.data||{},encapsulation:n.encapsulation||fs.Emulated,id:"c"+aI++,styles:n.styles||rn,_:null,schemas:n.schemas||null,tView:null};wx(t);const i=n.dependencies;return t.directiveDefs=af(i,!1),t.pipeDefs=af(i,!0),t})}function lI(n){return on(n)||Di(n)}function uI(n){return null!==n}function xx(n,e){if(null==n)return Rs;const t={};for(const i in n)if(n.hasOwnProperty(i)){let r=n[i],s=r;Array.isArray(r)&&(s=r[1],r=r[0]),t[r]=i,e&&(e[r]=s)}return t}function bi(n){return Is(()=>{const e=bx(n);return wx(e),e})}function ki(n){return{type:n.type,name:n.name,factory:null,pure:!1!==n.pure,standalone:!0===n.standalone,onDestroy:n.type.prototype.ngOnDestroy||null}}function on(n){return n[of]||null}function Di(n){return n[wm]||null}function Ji(n){return n[Mm]||null}function bx(n){const e={};return{type:n.type,providersResolver:null,factory:null,hostBindings:n.hostBindings||null,hostVars:n.hostVars||0,hostAttrs:n.hostAttrs||null,contentQueries:n.contentQueries||null,declaredInputs:e,exportAs:n.exportAs||null,standalone:!0===n.standalone,selectors:n.selectors||rn,viewQuery:n.viewQuery||null,features:n.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:xx(n.inputs,e),outputs:xx(n.outputs)}}function wx(n){n.features?.forEach(e=>e(n))}function af(n,e){if(!n)return null;const t=e?Ji:lI;return()=>("function"==typeof n?n():n).map(i=>t(i)).filter(uI)}const Ls=0,Le=1,Ct=2,Vn=3,Vr=4,zo=5,Ci=6,Wa=7,jn=8,cf=9,lf=10,Rt=11,Sm=12,Gl=13,Mx=14,ja=15,Ai=16,Wl=17,$a=18,hs=19,jl=20,Sx=21,An=22,Em=1,Ex=2,uf=7,df=8,qa=9,Bi=10;function ar(n){return Array.isArray(n)&&"object"==typeof n[Em]}function zr(n){return Array.isArray(n)&&!0===n[Em]}function Tm(n){return 0!=(4&n.flags)}function $l(n){return n.componentOffset>-1}function ff(n){return 1==(1&n.flags)}function Hr(n){return!!n.template}function fI(n){return 0!=(256&n[Ct])}function Ho(n,e){return n.hasOwnProperty(Ps)?n[Ps]:null}class mI{constructor(e,t,i){this.previousValue=e,this.currentValue=t,this.firstChange=i}isFirstChange(){return this.firstChange}}function ql(){return Cx}function Cx(n){return n.type.prototype.ngOnChanges&&(n.setInput=yI),gI}function gI(){const n=Ix(this),e=n?.current;if(e){const t=n.previous;if(t===Rs)n.previous=e;else for(let i in e)t[i]=e[i];n.current=null,this.ngOnChanges(e)}}function yI(n,e,t,i){const r=this.declaredInputs[t],s=Ix(n)||function _I(n,e){return n[Ax]=e}(n,{previous:Rs,current:null}),o=s.current||(s.current={}),a=s.previous,c=a[r];o[r]=new mI(c&&c.currentValue,e,a===Rs),n[i]=e}ql.ngInherit=!0;const Ax="__ngSimpleChanges__";function Ix(n){return n[Ax]||null}const Sr=function(n,e,t){};function wi(n){for(;Array.isArray(n);)n=n[Ls];return n}function cr(n,e){return wi(e[n.index])}function Lx(n,e){return n.data[e]}function Qi(n,e){const t=e[n];return ar(t)?t:t[Ls]}function pf(n){return 64==(64&n[Ct])}function fo(n,e){return null==e?null:n[e]}function Nx(n){n[$a]=0}function Cm(n,e){n[zo]+=e;let t=n,i=n[Vn];for(;null!==i&&(1===e&&1===t[zo]||-1===e&&0===t[zo]);)i[zo]+=e,t=i,i=i[Vn]}const vt={lFrame:Wx(null),bindingsEnabled:!0};function Fx(){return vt.bindingsEnabled}function le(){return vt.lFrame.lView}function jt(){return vt.lFrame.tView}function Am(n){return vt.lFrame.contextLView=n,n[jn]}function Im(n){return vt.lFrame.contextLView=null,n}function Mi(){let n=kx();for(;null!==n&&64===n.type;)n=n.parent;return n}function kx(){return vt.lFrame.currentTNode}function ps(n,e){const t=vt.lFrame;t.currentTNode=n,t.isParent=e}function Rm(){return vt.lFrame.isParent}function Pm(){vt.lFrame.isParent=!1}function Ui(){const n=vt.lFrame;let e=n.bindingRootIndex;return-1===e&&(e=n.bindingRootIndex=n.tView.bindingStartIndex),e}function RI(n,e){const t=vt.lFrame;t.bindingIndex=t.bindingRootIndex=n,Lm(e)}function Lm(n){vt.lFrame.currentDirectiveIndex=n}function zx(){return vt.lFrame.currentQueryIndex}function Om(n){vt.lFrame.currentQueryIndex=n}function LI(n){const e=n[Le];return 2===e.type?e.declTNode:1===e.type?n[Ci]:null}function Hx(n,e,t){if(t&ht.SkipSelf){let r=e,s=n;for(;!(r=r.parent,null!==r||t&ht.Host||(r=LI(s),null===r||(s=s[ja],10&r.type))););if(null===r)return!1;e=r,n=s}const i=vt.lFrame=Gx();return i.currentTNode=e,i.lView=n,!0}function Fm(n){const e=Gx(),t=n[Le];vt.lFrame=e,e.currentTNode=t.firstChild,e.lView=n,e.tView=t,e.contextLView=n,e.bindingIndex=t.bindingStartIndex,e.inI18n=!1}function Gx(){const n=vt.lFrame,e=null===n?null:n.child;return null===e?Wx(n):e}function Wx(n){const e={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:n,child:null,inI18n:!1};return null!==n&&(n.child=e),e}function jx(){const n=vt.lFrame;return vt.lFrame=n.parent,n.currentTNode=null,n.lView=null,n}const $x=jx;function km(){const n=jx();n.isParent=!0,n.tView=null,n.selectedIndex=-1,n.contextLView=null,n.elementDepthCount=0,n.currentDirectiveIndex=-1,n.currentNamespace=null,n.bindingRootIndex=-1,n.bindingIndex=-1,n.currentQueryIndex=0}function Vi(){return vt.lFrame.selectedIndex}function Go(n){vt.lFrame.selectedIndex=n}function mf(n,e){for(let t=e.directiveStart,i=e.directiveEnd;t<i;t++){const s=n.data[t].type.prototype,{ngAfterContentInit:o,ngAfterContentChecked:a,ngAfterViewInit:c,ngAfterViewChecked:l,ngOnDestroy:u}=s;o&&(n.contentHooks??(n.contentHooks=[])).push(-t,o),a&&((n.contentHooks??(n.contentHooks=[])).push(t,a),(n.contentCheckHooks??(n.contentCheckHooks=[])).push(t,a)),c&&(n.viewHooks??(n.viewHooks=[])).push(-t,c),l&&((n.viewHooks??(n.viewHooks=[])).push(t,l),(n.viewCheckHooks??(n.viewCheckHooks=[])).push(t,l)),null!=u&&(n.destroyHooks??(n.destroyHooks=[])).push(t,u)}}function gf(n,e,t){qx(n,e,3,t)}function yf(n,e,t,i){(3&n[Ct])===t&&qx(n,e,t,i)}function Bm(n,e){let t=n[Ct];(3&t)===e&&(t&=2047,t+=1,n[Ct]=t)}function qx(n,e,t,i){const s=i??-1,o=e.length-1;let a=0;for(let c=void 0!==i?65535&n[$a]:0;c<o;c++)if("number"==typeof e[c+1]){if(a=e[c],null!=i&&a>=i)break}else e[c]<0&&(n[$a]+=65536),(a<s||-1==s)&&(HI(n,t,e,c),n[$a]=(4294901760&n[$a])+c+2),c++}function HI(n,e,t,i){const r=t[i]<0,s=t[i+1],a=n[r?-t[i]:t[i]];if(r){if(n[Ct]>>11<n[$a]>>16&&(3&n[Ct])===e){n[Ct]+=2048,Sr(4,a,s);try{s.call(a)}finally{Sr(5,a,s)}}}else{Sr(4,a,s);try{s.call(a)}finally{Sr(5,a,s)}}}const Ya=-1;class Xl{constructor(e,t,i){this.factory=e,this.resolving=!1,this.canSeeViewProviders=t,this.injectImpl=i}}function Vm(n,e,t){let i=0;for(;i<t.length;){const r=t[i];if("number"==typeof r){if(0!==r)break;i++;const s=t[i++],o=t[i++],a=t[i++];n.setAttribute(e,o,a,s)}else{const s=r,o=t[++i];Xx(s)?n.setProperty(e,s,o):n.setAttribute(e,s,o),i++}}return i}function Zx(n){return 3===n||4===n||6===n}function Xx(n){return 64===n.charCodeAt(0)}function Yl(n,e){if(null!==e&&0!==e.length)if(null===n||0===n.length)n=e.slice();else{let t=-1;for(let i=0;i<e.length;i++){const r=e[i];"number"==typeof r?t=r:0===t||Yx(n,t,r,null,-1===t||2===t?e[++i]:null)}}return n}function Yx(n,e,t,i,r){let s=0,o=n.length;if(-1===e)o=-1;else for(;s<n.length;){const a=n[s++];if("number"==typeof a){if(a===e){o=-1;break}if(a>e){o=s-1;break}}}for(;s<n.length;){const a=n[s];if("number"==typeof a)break;if(a===t){if(null===i)return void(null!==r&&(n[s+1]=r));if(i===n[s+1])return void(n[s+2]=r)}s++,null!==i&&s++,null!==r&&s++}-1!==o&&(n.splice(o,0,e),s=o+1),n.splice(s++,0,t),null!==i&&n.splice(s++,0,i),null!==r&&n.splice(s++,0,r)}function Kx(n){return n!==Ya}function _f(n){return 32767&n}function vf(n,e){let t=function $I(n){return n>>16}(n),i=e;for(;t>0;)i=i[ja],t--;return i}let zm=!0;function xf(n){const e=zm;return zm=n,e}const Jx=255,Qx=5;let qI=0;const ms={};function bf(n,e){const t=eb(n,e);if(-1!==t)return t;const i=e[Le];i.firstCreatePass&&(n.injectorIndex=e.length,Hm(i.data,n),Hm(e,null),Hm(i.blueprint,null));const r=Gm(n,e),s=n.injectorIndex;if(Kx(r)){const o=_f(r),a=vf(r,e),c=a[Le].data;for(let l=0;l<8;l++)e[s+l]=a[o+l]|c[o+l]}return e[s+8]=r,s}function Hm(n,e){n.push(0,0,0,0,0,0,0,0,e)}function eb(n,e){return-1===n.injectorIndex||n.parent&&n.parent.injectorIndex===n.injectorIndex||null===e[n.injectorIndex+8]?-1:n.injectorIndex}function Gm(n,e){if(n.parent&&-1!==n.parent.injectorIndex)return n.parent.injectorIndex;let t=0,i=null,r=e;for(;null!==r;){if(i=ab(r),null===i)return Ya;if(t++,r=r[ja],-1!==i.injectorIndex)return i.injectorIndex|t<<16}return Ya}function Wm(n,e,t){!function ZI(n,e,t){let i;"string"==typeof t?i=t.charCodeAt(0)||0:t.hasOwnProperty(Vl)&&(i=t[Vl]),null==i&&(i=t[Vl]=qI++);const r=i&Jx;e.data[n+(r>>Qx)]|=1<<r}(n,e,t)}function tb(n,e,t){if(t&ht.Optional||void 0!==n)return n;gt()}function nb(n,e,t,i){if(t&ht.Optional&&void 0===i&&(i=null),!(t&(ht.Self|ht.Host))){const r=n[cf],s=Mr(void 0);try{return r?r.get(e,i,t&ht.Optional):mx(e,i,t&ht.Optional)}finally{Mr(s)}}return tb(i,0,t)}function ib(n,e,t,i=ht.Default,r){if(null!==n){if(1024&e[Ct]){const o=function QI(n,e,t,i,r){let s=n,o=e;for(;null!==s&&null!==o&&1024&o[Ct]&&!(256&o[Ct]);){const a=rb(s,o,t,i|ht.Self,ms);if(a!==ms)return a;let c=s.parent;if(!c){const l=o[Sx];if(l){const u=l.get(t,ms,i);if(u!==ms)return u}c=ab(o),o=o[ja]}s=c}return r}(n,e,t,i,ms);if(o!==ms)return o}const s=rb(n,e,t,i,ms);if(s!==ms)return s}return nb(e,t,i,r)}function rb(n,e,t,i,r){const s=function KI(n){if("string"==typeof n)return n.charCodeAt(0)||0;const e=n.hasOwnProperty(Vl)?n[Vl]:void 0;return"number"==typeof e?e>=0?e&Jx:JI:e}(t);if("function"==typeof s){if(!Hx(e,n,i))return i&ht.Host?tb(r,0,i):nb(e,t,i,r);try{const o=s(i);if(null!=o||i&ht.Optional)return o;gt()}finally{$x()}}else if("number"==typeof s){let o=null,a=eb(n,e),c=Ya,l=i&ht.Host?e[Ai][Ci]:null;for((-1===a||i&ht.SkipSelf)&&(c=-1===a?Gm(n,e):e[a+8],c!==Ya&&ob(i,!1)?(o=e[Le],a=_f(c),e=vf(c,e)):a=-1);-1!==a;){const u=e[Le];if(sb(s,a,u.data)){const d=YI(a,e,t,o,i,l);if(d!==ms)return d}c=e[a+8],c!==Ya&&ob(i,e[Le].data[a+8]===l)&&sb(s,a,e)?(o=u,a=_f(c),e=vf(c,e)):a=-1}}return r}function YI(n,e,t,i,r,s){const o=e[Le],a=o.data[n+8],u=wf(a,o,t,null==i?$l(a)&&zm:i!=o&&0!=(3&a.type),r&ht.Host&&s===a);return null!==u?Wo(e,o,u,a):ms}function wf(n,e,t,i,r){const s=n.providerIndexes,o=e.data,a=1048575&s,c=n.directiveStart,u=s>>20,f=r?a+u:n.directiveEnd;for(let h=i?a:a+u;h<f;h++){const m=o[h];if(h<c&&t===m||h>=c&&m.type===t)return h}if(r){const h=o[c];if(h&&Hr(h)&&h.type===t)return c}return null}function Wo(n,e,t,i){let r=n[t];const s=e.data;if(function GI(n){return n instanceof Xl}(r)){const o=r;o.resolving&&function Fe(n,e){const t=e?`. Dependency path: ${e.join(" > ")} > ${n}`:"";throw new z(-200,`Circular dependency in DI detected for ${n}${t}`)}(X(s[t]));const a=xf(o.canSeeViewProviders);o.resolving=!0;const c=o.injectImpl?Mr(o.injectImpl):null;Hx(n,i,ht.Default);try{r=n[t]=o.factory(void 0,s,n,i),e.firstCreatePass&&t>=i.directiveStart&&function zI(n,e,t){const{ngOnChanges:i,ngOnInit:r,ngDoCheck:s}=e.type.prototype;if(i){const o=Cx(e);(t.preOrderHooks??(t.preOrderHooks=[])).push(n,o),(t.preOrderCheckHooks??(t.preOrderCheckHooks=[])).push(n,o)}r&&(t.preOrderHooks??(t.preOrderHooks=[])).push(0-n,r),s&&((t.preOrderHooks??(t.preOrderHooks=[])).push(n,s),(t.preOrderCheckHooks??(t.preOrderCheckHooks=[])).push(n,s))}(t,s[t],e)}finally{null!==c&&Mr(c),xf(a),o.resolving=!1,$x()}}return r}function sb(n,e,t){return!!(t[e+(n>>Qx)]&1<<n)}function ob(n,e){return!(n&ht.Self||n&ht.Host&&e)}class Ka{constructor(e,t){this._tNode=e,this._lView=t}get(e,t,i){return ib(this._tNode,this._lView,e,sf(i),t)}}function JI(){return new Ka(Mi(),le())}function Kl(n){return Is(()=>{const e=n.prototype.constructor,t=e[Ps]||jm(e),i=Object.prototype;let r=Object.getPrototypeOf(n.prototype).constructor;for(;r&&r!==i;){const s=r[Ps]||jm(r);if(s&&s!==t)return s;r=Object.getPrototypeOf(r)}return s=>new s})}function jm(n){return Z(n)?()=>{const e=jm(L(n));return e&&e()}:Ho(n)}function ab(n){const e=n[Le],t=e.type;return 2===t?e.declTNode:1===t?n[Ci]:null}class Mt{constructor(e,t){this._desc=e,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof t?this.__NG_ELEMENT_ID__=t:void 0!==t&&(this.\u0275prov=Wt({token:this,providedIn:t.providedIn||"root",factory:t.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}function jo(n,e){n.forEach(t=>Array.isArray(t)?jo(t,e):e(t))}function lb(n,e,t){e>=n.length?n.push(t):n.splice(e,0,t)}function Mf(n,e){return e>=n.length-1?n.pop():n.splice(e,1)[0]}function lr(n,e,t){let i=nc(n,e);return i>=0?n[1|i]=t:(i=~i,function iR(n,e,t,i){let r=n.length;if(r==e)n.push(t,i);else if(1===r)n.push(i,n[0]),n[0]=t;else{for(r--,n.push(n[r-1],n[r]);r>e;)n[r]=n[r-2],r--;n[e]=t,n[e+1]=i}}(n,i,e,t)),i}function Xm(n,e){const t=nc(n,e);if(t>=0)return n[1|t]}function nc(n,e){return function ub(n,e,t){let i=0,r=n.length>>t;for(;r!==i;){const s=i+(r-i>>1),o=n[s<<t];if(e===o)return s<<t;o>e?r=s:i=s+1}return~(r<<t)}(n,e,1)}var er=(()=>((er=er||{})[er.Important=1]="Important",er[er.DashCase=2]="DashCase",er))();const tg=new Map;let ER=0;function Mb(n){return tg.get(n)||null}class AR{get lView(){return Mb(this.lViewId)}constructor(e,t,i){this.lViewId=e,this.nodeIndex=t,this.native=i}}function tr(n){let e=iu(n);if(e){if(ar(e)){const t=e;let i,r,s;if(Tb(n)){if(i=function Cb(n,e){const t=n[Le].components;if(t)for(let i=0;i<t.length;i++){const r=t[i];if(Qi(r,n)[jn]===e)return r}else if(Qi(An,n)[jn]===e)return An;return-1}(t,n),-1==i)throw new Error("The provided component was not found in the application");r=n}else if(function IR(n){return n&&n.constructor&&n.constructor.\u0275dir}(n)){if(i=function PR(n,e){let t=n[Le].firstChild;for(;t;){const r=t.directiveEnd;for(let s=t.directiveStart;s<r;s++)if(n[s]===e)return t.index;t=RR(t)}return-1}(t,n),-1==i)throw new Error("The provided directive was not found in the application");s=function Ab(n,e){const t=e[Le].data[n];if(0===t.directiveStart)return rn;const i=[];for(let r=t.directiveStart;r<t.directiveEnd;r++){const s=e[r];Tb(s)||i.push(s)}return i}(i,t)}else if(i=Db(t,n),-1==i)return null;const o=wi(t[i]),a=iu(o),c=a&&!Array.isArray(a)?a:ng(t,i,o);if(r&&void 0===c.component&&(c.component=r,Ii(c.component,c)),s&&void 0===c.directives){c.directives=s;for(let l=0;l<s.length;l++)Ii(s[l],c)}Ii(c.native,c),e=c}}else{const t=n;let i=t;for(;i=i.parentNode;){const r=iu(i);if(r){const s=Array.isArray(r)?r:r.lView;if(!s)return null;const o=Db(s,t);if(o>=0){const a=wi(s[o]),c=ng(s,o,a);Ii(a,c),e=c;break}}}}return e||null}function ng(n,e,t){return new AR(n[jl],e,t)}const ig="__ngContext__";function Ii(n,e){ar(e)?(n[ig]=e[jl],function DR(n){tg.set(n[jl],n)}(e)):n[ig]=e}function iu(n){const e=n[ig];return"number"==typeof e?Mb(e):e||null}function Tb(n){return n&&n.constructor&&n.constructor.\u0275cmp}function Db(n,e){const t=n[Le];for(let i=An;i<t.bindingStartIndex;i++)if(wi(n[i])===e)return i;return-1}function RR(n){if(n.child)return n.child;if(n.next)return n.next;for(;n.parent&&!n.parent.next;)n=n.parent;return n.parent&&n.parent.next}let rg;function sg(n,e){return rg(n,e)}function ru(n){const e=n[Vn];return zr(e)?e[Vn]:e}function og(n){return Ib(n[Gl])}function ag(n){return Ib(n[Vr])}function Ib(n){for(;null!==n&&!zr(n);)n=n[Vr];return n}function rc(n,e,t,i,r){if(null!=i){let s,o=!1;zr(i)?s=i:ar(i)&&(o=!0,i=i[Ls]);const a=wi(i);0===n&&null!==t?null==r?Fb(e,t,a):$o(e,t,a,r||null,!0):1===n&&null!==t?$o(e,t,a,r||null,!0):2===n?function pg(n,e,t){const i=Af(n,e);i&&function qR(n,e,t,i){n.removeChild(e,t,i)}(n,i,e,t)}(e,a,o):3===n&&e.destroyNode(a),null!=s&&function YR(n,e,t,i,r){const s=t[uf];s!==wi(t)&&rc(e,n,i,s,r);for(let a=Bi;a<t.length;a++){const c=t[a];su(c[Le],c,n,e,i,s)}}(e,n,s,t,r)}}function lg(n,e,t){return n.createElement(e,t)}function Pb(n,e){const t=n[qa],i=t.indexOf(e),r=e[Vn];512&e[Ct]&&(e[Ct]&=-513,Cm(r,-1)),t.splice(i,1)}function ug(n,e){if(n.length<=Bi)return;const t=Bi+e,i=n[t];if(i){const r=i[Wl];null!==r&&r!==n&&Pb(r,i),e>0&&(n[t-1][Vr]=i[Vr]);const s=Mf(n,Bi+e);!function UR(n,e){su(n,e,e[Rt],2,null,null),e[Ls]=null,e[Ci]=null}(i[Le],i);const o=s[hs];null!==o&&o.detachView(s[Le]),i[Vn]=null,i[Vr]=null,i[Ct]&=-65}return i}function Lb(n,e){if(!(128&e[Ct])){const t=e[Rt];t.destroyNode&&su(n,e,t,3,null,null),function HR(n){let e=n[Gl];if(!e)return dg(n[Le],n);for(;e;){let t=null;if(ar(e))t=e[Gl];else{const i=e[Bi];i&&(t=i)}if(!t){for(;e&&!e[Vr]&&e!==n;)ar(e)&&dg(e[Le],e),e=e[Vn];null===e&&(e=n),ar(e)&&dg(e[Le],e),t=e&&e[Vr]}e=t}}(e)}}function dg(n,e){if(!(128&e[Ct])){e[Ct]&=-65,e[Ct]|=128,function $R(n,e){let t;if(null!=n&&null!=(t=n.destroyHooks))for(let i=0;i<t.length;i+=2){const r=e[t[i]];if(!(r instanceof Xl)){const s=t[i+1];if(Array.isArray(s))for(let o=0;o<s.length;o+=2){const a=r[s[o]],c=s[o+1];Sr(4,a,c);try{c.call(a)}finally{Sr(5,a,c)}}else{Sr(4,r,s);try{s.call(r)}finally{Sr(5,r,s)}}}}}(n,e),function jR(n,e){const t=n.cleanup,i=e[Wa];let r=-1;if(null!==t)for(let s=0;s<t.length-1;s+=2)if("string"==typeof t[s]){const o=t[s+3];o>=0?i[r=o]():i[r=-o].unsubscribe(),s+=2}else{const o=i[r=t[s+1]];t[s].call(o)}if(null!==i){for(let s=r+1;s<i.length;s++)(0,i[s])();e[Wa]=null}}(n,e),1===e[Le].type&&e[Rt].destroy();const t=e[Wl];if(null!==t&&zr(e[Vn])){t!==e[Vn]&&Pb(t,e);const i=e[hs];null!==i&&i.detachView(n)}!function CR(n){tg.delete(n[jl])}(e)}}function Nb(n,e,t){return function Ob(n,e,t){let i=e;for(;null!==i&&40&i.type;)i=(e=i).parent;if(null===i)return t[Ls];{const{componentOffset:r}=i;if(r>-1){const{encapsulation:s}=n.data[i.directiveStart+r];if(s===fs.None||s===fs.Emulated)return null}return cr(i,t)}}(n,e.parent,t)}function $o(n,e,t,i,r){n.insertBefore(e,t,i,r)}function Fb(n,e,t){n.appendChild(e,t)}function kb(n,e,t,i,r){null!==i?$o(n,e,t,i,r):Fb(n,e,t)}function Af(n,e){return n.parentNode(e)}let fg,yg,Vb=function Ub(n,e,t){return 40&n.type?cr(n,t):null};function If(n,e,t,i){const r=Nb(n,i,e),s=e[Rt],a=function Bb(n,e,t){return Vb(n,e,t)}(i.parent||e[Ci],i,e);if(null!=r)if(Array.isArray(t))for(let c=0;c<t.length;c++)kb(s,r,t[c],a,!1);else kb(s,r,t,a,!1);void 0!==fg&&fg(s,i,e,t,r)}function Rf(n,e){if(null!==e){const t=e.type;if(3&t)return cr(e,n);if(4&t)return hg(-1,n[e.index]);if(8&t){const i=e.child;if(null!==i)return Rf(n,i);{const r=n[e.index];return zr(r)?hg(-1,r):wi(r)}}if(32&t)return sg(e,n)()||wi(n[e.index]);{const i=Hb(n,e);return null!==i?Array.isArray(i)?i[0]:Rf(ru(n[Ai]),i):Rf(n,e.next)}}return null}function Hb(n,e){return null!==e?n[Ai][Ci].projection[e.projection]:null}function hg(n,e){const t=Bi+n+1;if(t<e.length){const i=e[t],r=i[Le].firstChild;if(null!==r)return Rf(i,r)}return e[uf]}function mg(n,e,t,i,r,s,o){for(;null!=t;){const a=i[t.index],c=t.type;if(o&&0===e&&(a&&Ii(wi(a),i),t.flags|=2),32!=(32&t.flags))if(8&c)mg(n,e,t.child,i,r,s,!1),rc(e,n,r,a,s);else if(32&c){const l=sg(t,i);let u;for(;u=l();)rc(e,n,r,u,s);rc(e,n,r,a,s)}else 16&c?Gb(n,e,i,t,r,s):rc(e,n,r,a,s);t=o?t.projectionNext:t.next}}function su(n,e,t,i,r,s){mg(t,i,n.firstChild,e,r,s,!1)}function Gb(n,e,t,i,r,s){const o=t[Ai],c=o[Ci].projection[i.projection];if(Array.isArray(c))for(let l=0;l<c.length;l++)rc(e,n,r,c[l],s);else mg(n,e,c,o[Vn],r,s,!0)}function Wb(n,e,t){""===t?n.removeAttribute(e,"class"):n.setAttribute(e,"class",t)}function jb(n,e,t){const{mergedAttrs:i,classes:r,styles:s}=t;null!==i&&Vm(n,e,i),null!==r&&Wb(n,e,r),null!==s&&function JR(n,e,t){n.setAttribute(e,"style",t)}(n,e,s)}class Yb{constructor(e){this.changingThisBreaksApplicationSecurity=e}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}const sw=new Mt("ENVIRONMENT_INITIALIZER"),ow=new Mt("INJECTOR",-1),aw=new Mt("INJECTOR_DEF_TYPES");class cw{get(e,t=kl){if(t===kl){const i=new Error(`NullInjectorError: No provider for ${it(e)}!`);throw i.name="NullInjectorError",i}return t}}function DP(...n){return{\u0275providers:lw(0,n),\u0275fromNgModule:!0}}function lw(n,...e){const t=[],i=new Set;let r;return jo(e,s=>{const o=s;Mg(o,t,[],i)&&(r||(r=[]),r.push(o))}),void 0!==r&&uw(r,t),t}function uw(n,e){for(let t=0;t<n.length;t++){const{providers:r}=n[t];Sg(r,s=>{e.push(s)})}}function Mg(n,e,t,i){if(!(n=L(n)))return!1;let r=null,s=hx(n);const o=!s&&on(n);if(s||o){if(o&&!o.standalone)return!1;r=n}else{const c=n.ngModule;if(s=hx(c),!s)return!1;r=c}const a=i.has(r);if(o){if(a)return!1;if(i.add(r),o.dependencies){const c="function"==typeof o.dependencies?o.dependencies():o.dependencies;for(const l of c)Mg(l,e,t,i)}}else{if(!s)return!1;{if(null!=s.imports&&!a){let l;i.add(r);try{jo(s.imports,u=>{Mg(u,e,t,i)&&(l||(l=[]),l.push(u))})}finally{}void 0!==l&&uw(l,e)}if(!a){const l=Ho(r)||(()=>new r);e.push({provide:r,useFactory:l,deps:rn},{provide:aw,useValue:r,multi:!0},{provide:sw,useValue:()=>sn(r),multi:!0})}const c=s.providers;null==c||a||Sg(c,u=>{e.push(u)})}}return r!==n&&void 0!==n.providers}function Sg(n,e){for(let t of n)Ke(t)&&(t=t.\u0275providers),Array.isArray(t)?Sg(t,e):e(t)}const CP=Ye({provide:String,useValue:Ye});function Eg(n){return null!==n&&"object"==typeof n&&CP in n}function qo(n){return"function"==typeof n}const Tg=new Mt("Set Injector scope."),Of={},IP={};let Dg;function Ff(){return void 0===Dg&&(Dg=new cw),Dg}class Zo{}class hw extends Zo{get destroyed(){return this._destroyed}constructor(e,t,i,r){super(),this.parent=t,this.source=i,this.scopes=r,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,Ag(e,o=>this.processProvider(o)),this.records.set(ow,oc(void 0,this)),r.has("environment")&&this.records.set(Zo,oc(void 0,this));const s=this.records.get(Tg);null!=s&&"string"==typeof s.value&&this.scopes.add(s.value),this.injectorDefTypes=new Set(this.get(aw.multi,rn,ht.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const e of this._ngOnDestroyHooks)e.ngOnDestroy();for(const e of this._onDestroyHooks)e()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),this._onDestroyHooks.length=0}}onDestroy(e){this._onDestroyHooks.push(e)}runInContext(e){this.assertNotDestroyed();const t=Ga(this),i=Mr(void 0);try{return e()}finally{Ga(t),Mr(i)}}get(e,t=kl,i=ht.Default){this.assertNotDestroyed(),i=sf(i);const r=Ga(this),s=Mr(void 0);try{if(!(i&ht.SkipSelf)){let a=this.records.get(e);if(void 0===a){const c=function OP(n){return"function"==typeof n||"object"==typeof n&&n instanceof Mt}(e)&&tf(e);a=c&&this.injectableDefInScope(c)?oc(Cg(e),Of):null,this.records.set(e,a)}if(null!=a)return this.hydrate(e,a)}return(i&ht.Self?Ff():this.parent).get(e,t=i&ht.Optional&&t===kl?null:t)}catch(o){if("NullInjectorError"===o.name){if((o[rf]=o[rf]||[]).unshift(it(e)),r)throw o;return function sI(n,e,t,i){const r=n[rf];throw e[gx]&&r.unshift(e[gx]),n.message=function oI(n,e,t,i=null){n=n&&"\n"===n.charAt(0)&&n.charAt(1)==nI?n.slice(2):n;let r=it(e);if(Array.isArray(e))r=e.map(it).join(" -> ");else if("object"==typeof e){let s=[];for(let o in e)if(e.hasOwnProperty(o)){let a=e[o];s.push(o+":"+("string"==typeof a?JSON.stringify(a):it(a)))}r=`{${s.join(", ")}}`}return`${t}${i?"("+i+")":""}[${r}]: ${n.replace(tI,"\n  ")}`}("\n"+n.message,r,t,i),n[eI]=r,n[rf]=null,n}(o,e,"R3InjectorError",this.source)}throw o}finally{Mr(s),Ga(r)}}resolveInjectorInitializers(){const e=Ga(this),t=Mr(void 0);try{const i=this.get(sw.multi,rn,ht.Self);for(const r of i)r()}finally{Ga(e),Mr(t)}}toString(){const e=[],t=this.records;for(const i of t.keys())e.push(it(i));return`R3Injector[${e.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new z(205,!1)}processProvider(e){let t=qo(e=L(e))?e:L(e&&e.provide);const i=function PP(n){return Eg(n)?oc(void 0,n.useValue):oc(pw(n),Of)}(e);if(qo(e)||!0!==e.multi)this.records.get(t);else{let r=this.records.get(t);r||(r=oc(void 0,Of,!0),r.factory=()=>bm(r.multi),this.records.set(t,r)),t=e,r.multi.push(e)}this.records.set(t,i)}hydrate(e,t){return t.value===Of&&(t.value=IP,t.value=t.factory()),"object"==typeof t.value&&t.value&&function NP(n){return null!==n&&"object"==typeof n&&"function"==typeof n.ngOnDestroy}(t.value)&&this._ngOnDestroyHooks.add(t.value),t.value}injectableDefInScope(e){if(!e.providedIn)return!1;const t=L(e.providedIn);return"string"==typeof t?"any"===t||this.scopes.has(t):this.injectorDefTypes.has(t)}}function Cg(n){const e=tf(n),t=null!==e?e.factory:Ho(n);if(null!==t)return t;if(n instanceof Mt)throw new z(204,!1);if(n instanceof Function)return function RP(n){const e=n.length;if(e>0)throw function eu(n,e){const t=[];for(let i=0;i<n;i++)t.push(e);return t}(e,"?"),new z(204,!1);const t=function Y1(n){const e=n&&(n[nf]||n[px]);return e?(function K1(n){if(n.hasOwnProperty("name"))return n.name;(""+n).match(/^function\s*([^\s(]+)/)}(n),e):null}(n);return null!==t?()=>t.factory(n):()=>new n}(n);throw new z(204,!1)}function pw(n,e,t){let i;if(qo(n)){const r=L(n);return Ho(r)||Cg(r)}if(Eg(n))i=()=>L(n.useValue);else if(function fw(n){return!(!n||!n.useFactory)}(n))i=()=>n.useFactory(...bm(n.deps||[]));else if(function dw(n){return!(!n||!n.useExisting)}(n))i=()=>sn(L(n.useExisting));else{const r=L(n&&(n.useClass||n.provide));if(!function LP(n){return!!n.deps}(n))return Ho(r)||Cg(r);i=()=>new r(...bm(n.deps))}return i}function oc(n,e,t=!1){return{factory:n,value:e,multi:t?[]:void 0}}function Ag(n,e){for(const t of n)Array.isArray(t)?Ag(t,e):t&&Ke(t)?Ag(t.\u0275providers,e):e(t)}class FP{}class mw{}class BP{resolveComponentFactory(e){throw function kP(n){const e=Error(`No component factory found for ${it(n)}. Did you add it to @NgModule.entryComponents?`);return e.ngComponent=n,e}(e)}}let kf=(()=>{class n{}return n.NULL=new BP,n})();function UP(){return ac(Mi(),le())}function ac(n,e){return new gs(cr(n,e))}let gs=(()=>{class n{constructor(t){this.nativeElement=t}}return n.__NG_ELEMENT_ID__=UP,n})();function VP(n){return n instanceof gs?n.nativeElement:n}class Bf{}let HP=(()=>{class n{}return n.\u0275prov=Wt({token:n,providedIn:"root",factory:()=>null}),n})();class Ig{constructor(e){this.full=e,this.major=e.split(".")[0],this.minor=e.split(".")[1],this.patch=e.split(".").slice(2).join(".")}}const GP=new Ig("15.2.7"),Rg={},Pg="ngOriginalError";function Lg(n){return n[Pg]}class cc{constructor(){this._console=console}handleError(e){const t=this._findOriginalError(e);this._console.error("ERROR",e),t&&this._console.error("ORIGINAL ERROR",t)}_findOriginalError(e){let t=e&&Lg(e);for(;t&&Lg(t);)t=Lg(t);return t||null}}function vw(n,e,t){let i=n.length;for(;;){const r=n.indexOf(e,t);if(-1===r)return r;if(0===r||n.charCodeAt(r-1)<=32){const s=e.length;if(r+s===i||n.charCodeAt(r+s)<=32)return r}t=r+1}}const xw="ng-template";function eL(n,e,t){let i=0,r=!0;for(;i<n.length;){let s=n[i++];if("string"==typeof s&&r){const o=n[i++];if(t&&"class"===s&&-1!==vw(o.toLowerCase(),e,0))return!0}else{if(1===s){for(;i<n.length&&"string"==typeof(s=n[i++]);)if(s.toLowerCase()===e)return!0;return!1}"number"==typeof s&&(r=!1)}}return!1}function bw(n){return 4===n.type&&n.value!==xw}function tL(n,e,t){return e===(4!==n.type||t?n.value:xw)}function nL(n,e,t){let i=4;const r=n.attrs||[],s=function sL(n){for(let e=0;e<n.length;e++)if(Zx(n[e]))return e;return n.length}(r);let o=!1;for(let a=0;a<e.length;a++){const c=e[a];if("number"!=typeof c){if(!o)if(4&i){if(i=2|1&i,""!==c&&!tL(n,c,t)||""===c&&1===e.length){if(Gr(i))return!1;o=!0}}else{const l=8&i?c:e[++a];if(8&i&&null!==n.attrs){if(!eL(n.attrs,l,t)){if(Gr(i))return!1;o=!0}continue}const d=iL(8&i?"class":c,r,bw(n),t);if(-1===d){if(Gr(i))return!1;o=!0;continue}if(""!==l){let f;f=d>s?"":r[d+1].toLowerCase();const h=8&i?f:null;if(h&&-1!==vw(h,l,0)||2&i&&l!==f){if(Gr(i))return!1;o=!0}}}}else{if(!o&&!Gr(i)&&!Gr(c))return!1;if(o&&Gr(c))continue;o=!1,i=c|1&i}}return Gr(i)||o}function Gr(n){return 0==(1&n)}function iL(n,e,t,i){if(null===e)return-1;let r=0;if(i||!t){let s=!1;for(;r<e.length;){const o=e[r];if(o===n)return r;if(3===o||6===o)s=!0;else{if(1===o||2===o){let a=e[++r];for(;"string"==typeof a;)a=e[++r];continue}if(4===o)break;if(0===o){r+=4;continue}}r+=s?1:2}return-1}return function oL(n,e){let t=n.indexOf(4);if(t>-1)for(t++;t<n.length;){const i=n[t];if("number"==typeof i)return-1;if(i===e)return t;t++}return-1}(e,n)}function ww(n,e,t=!1){for(let i=0;i<e.length;i++)if(nL(n,e[i],t))return!0;return!1}function Mw(n,e){return n?":not("+e.trim()+")":e}function cL(n){let e=n[0],t=1,i=2,r="",s=!1;for(;t<n.length;){let o=n[t];if("string"==typeof o)if(2&i){const a=n[++t];r+="["+o+(a.length>0?'="'+a+'"':"")+"]"}else 8&i?r+="."+o:4&i&&(r+=" "+o);else""!==r&&!Gr(o)&&(e+=Mw(s,r),r=""),i=o,s=s||!Gr(i);t++}return""!==r&&(e+=Mw(s,r)),e}const xt={};function Uf(n){Sw(jt(),le(),Vi()+n,!1)}function Sw(n,e,t,i){if(!i)if(3==(3&e[Ct])){const s=n.preOrderCheckHooks;null!==s&&gf(e,s,t)}else{const s=n.preOrderHooks;null!==s&&yf(e,s,0,t)}Go(t)}function Cw(n,e=null,t=null,i){const r=function Aw(n,e=null,t=null,i,r=new Set){const s=[t||rn,DP(n)];return i=i||("object"==typeof n?void 0:it(n)),new hw(s,e||Ff(),i||null,r)}(n,e,t,i);return r.resolveInjectorInitializers(),r}let Xo=(()=>{class n{static create(t,i){if(Array.isArray(t))return Cw({name:""},i,t,"");{const r=t.name??"";return Cw({name:r},t.parent,t.providers,r)}}}return n.THROW_IF_NOT_FOUND=kl,n.NULL=new cw,n.\u0275prov=Wt({token:n,providedIn:"any",factory:()=>sn(ow)}),n.__NG_ELEMENT_ID__=-1,n})();function yt(n,e=ht.Default){const t=le();return null===t?sn(n,e):ib(Mi(),t,L(n),e)}function Fw(n,e){const t=n.contentQueries;if(null!==t)for(let i=0;i<t.length;i+=2){const s=t[i+1];if(-1!==s){const o=n.data[s];Om(t[i]),o.contentQueries(2,e[s],s)}}}function zf(n,e,t,i,r,s,o,a,c,l,u){const d=e.blueprint.slice();return d[Ls]=r,d[Ct]=76|i,(null!==u||n&&1024&n[Ct])&&(d[Ct]|=1024),Nx(d),d[Vn]=d[ja]=n,d[jn]=t,d[lf]=o||n&&n[lf],d[Rt]=a||n&&n[Rt],d[Sm]=c||n&&n[Sm]||null,d[cf]=l||n&&n[cf]||null,d[Ci]=s,d[jl]=function TR(){return ER++}(),d[Sx]=u,d[Ai]=2==e.type?n[Ai]:d,d}function dc(n,e,t,i,r){let s=n.data[e];if(null===s)s=function Bg(n,e,t,i,r){const s=kx(),o=Rm(),c=n.data[e]=function OL(n,e,t,i,r,s){return{type:t,index:i,insertBeforeIndex:null,injectorIndex:e?e.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:0,providerIndexes:0,value:r,attrs:s,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:e,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,o?s:s&&s.parent,t,e,i,r);return null===n.firstChild&&(n.firstChild=c),null!==s&&(o?null==s.child&&null!==c.parent&&(s.child=c):null===s.next&&(s.next=c,c.prev=s)),c}(n,e,t,i,r),function II(){return vt.lFrame.inI18n}()&&(s.flags|=32);else if(64&s.type){s.type=t,s.value=i,s.attrs=r;const o=function Zl(){const n=vt.lFrame,e=n.currentTNode;return n.isParent?e:e.parent}();s.injectorIndex=null===o?-1:o.injectorIndex}return ps(s,!0),s}function lu(n,e,t,i){if(0===t)return-1;const r=e.length;for(let s=0;s<t;s++)e.push(i),n.blueprint.push(i),n.data.push(null);return r}function Ug(n,e,t){Fm(e);try{const i=n.viewQuery;null!==i&&Zg(1,i,t);const r=n.template;null!==r&&kw(n,e,r,1,t),n.firstCreatePass&&(n.firstCreatePass=!1),n.staticContentQueries&&Fw(n,e),n.staticViewQueries&&Zg(2,n.viewQuery,t);const s=n.components;null!==s&&function PL(n,e){for(let t=0;t<e.length;t++)tN(n,e[t])}(e,s)}catch(i){throw n.firstCreatePass&&(n.incompleteFirstPass=!0,n.firstCreatePass=!1),i}finally{e[Ct]&=-5,km()}}function Hf(n,e,t,i){const r=e[Ct];if(128!=(128&r)){Fm(e);try{Nx(e),function Ux(n){return vt.lFrame.bindingIndex=n}(n.bindingStartIndex),null!==t&&kw(n,e,t,2,i);const o=3==(3&r);if(o){const l=n.preOrderCheckHooks;null!==l&&gf(e,l,null)}else{const l=n.preOrderHooks;null!==l&&yf(e,l,0,null),Bm(e,0)}if(function QL(n){for(let e=og(n);null!==e;e=ag(e)){if(!e[Ex])continue;const t=e[qa];for(let i=0;i<t.length;i++){const r=t[i];512&r[Ct]||Cm(r[Vn],1),r[Ct]|=512}}}(e),function JL(n){for(let e=og(n);null!==e;e=ag(e))for(let t=Bi;t<e.length;t++){const i=e[t],r=i[Le];pf(i)&&Hf(r,i,r.template,i[jn])}}(e),null!==n.contentQueries&&Fw(n,e),o){const l=n.contentCheckHooks;null!==l&&gf(e,l)}else{const l=n.contentHooks;null!==l&&yf(e,l,1),Bm(e,1)}!function IL(n,e){const t=n.hostBindingOpCodes;if(null!==t)try{for(let i=0;i<t.length;i++){const r=t[i];if(r<0)Go(~r);else{const s=r,o=t[++i],a=t[++i];RI(o,s),a(2,e[s])}}}finally{Go(-1)}}(n,e);const a=n.components;null!==a&&function RL(n,e){for(let t=0;t<e.length;t++)eN(n,e[t])}(e,a);const c=n.viewQuery;if(null!==c&&Zg(2,c,i),o){const l=n.viewCheckHooks;null!==l&&gf(e,l)}else{const l=n.viewHooks;null!==l&&yf(e,l,2),Bm(e,2)}!0===n.firstUpdatePass&&(n.firstUpdatePass=!1),e[Ct]&=-41,512&e[Ct]&&(e[Ct]&=-513,Cm(e[Vn],-1))}finally{km()}}}function kw(n,e,t,i,r){const s=Vi(),o=2&i;try{Go(-1),o&&e.length>An&&Sw(n,e,An,!1),Sr(o?2:0,r),t(i,r)}finally{Go(s),Sr(o?3:1,r)}}function Vg(n,e,t){if(Tm(e)){const r=e.directiveEnd;for(let s=e.directiveStart;s<r;s++){const o=n.data[s];o.contentQueries&&o.contentQueries(1,t[s],s)}}}function zg(n,e,t){Fx()&&(function HL(n,e,t,i){const r=t.directiveStart,s=t.directiveEnd;$l(t)&&function XL(n,e,t){const i=cr(e,n),r=Bw(t),s=n[lf],o=Gf(n,zf(n,r,null,t.onPush?32:16,i,e,s,s.createRenderer(i,t),null,null,null));n[e.index]=o}(e,t,n.data[r+t.componentOffset]),n.firstCreatePass||bf(t,e),Ii(i,e);const o=t.initialInputs;for(let a=r;a<s;a++){const c=n.data[a],l=Wo(e,n,a,t);Ii(l,e),null!==o&&YL(0,a-r,l,c,0,o),Hr(c)&&(Qi(t.index,e)[jn]=Wo(e,n,a,t))}}(n,e,t,cr(t,e)),64==(64&t.flags)&&Gw(n,e,t))}function Hg(n,e,t=cr){const i=e.localNames;if(null!==i){let r=e.index+1;for(let s=0;s<i.length;s+=2){const o=i[s+1],a=-1===o?t(e,n):n[o];n[r++]=a}}}function Bw(n){const e=n.tView;return null===e||e.incompleteFirstPass?n.tView=Gg(1,null,n.template,n.decls,n.vars,n.directiveDefs,n.pipeDefs,n.viewQuery,n.schemas,n.consts):e}function Gg(n,e,t,i,r,s,o,a,c,l){const u=An+i,d=u+r,f=function LL(n,e){const t=[];for(let i=0;i<e;i++)t.push(i<n?null:xt);return t}(u,d),h="function"==typeof l?l():l;return f[Le]={type:n,blueprint:f,template:t,queries:null,viewQuery:a,declTNode:e,data:f.slice().fill(null,u),bindingStartIndex:u,expandoStartIndex:d,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof s?s():s,pipeRegistry:"function"==typeof o?o():o,firstChild:null,schemas:c,consts:h,incompleteFirstPass:!1}}function Uw(n,e,t,i){const r=jw(e);null===t?r.push(i):(r.push(t),n.firstCreatePass&&$w(n).push(i,r.length-1))}function Vw(n,e,t,i){for(let r in n)if(n.hasOwnProperty(r)){t=null===t?{}:t;const s=n[r];null===i?zw(t,e,r,s):i.hasOwnProperty(r)&&zw(t,e,i[r],s)}return t}function zw(n,e,t,i){n.hasOwnProperty(t)?n[t].push(e,i):n[t]=[e,i]}function Wg(n,e,t,i){if(Fx()){const r=null===i?null:{"":-1},s=function WL(n,e){const t=n.directiveRegistry;let i=null,r=null;if(t)for(let s=0;s<t.length;s++){const o=t[s];if(ww(e,o.selectors,!1))if(i||(i=[]),Hr(o))if(null!==o.findHostDirectiveDefs){const a=[];r=r||new Map,o.findHostDirectiveDefs(o,a,r),i.unshift(...a,o),jg(n,e,a.length)}else i.unshift(o),jg(n,e,0);else r=r||new Map,o.findHostDirectiveDefs?.(o,i,r),i.push(o)}return null===i?null:[i,r]}(n,t);let o,a;null===s?o=a=null:[o,a]=s,null!==o&&Hw(n,e,t,o,r,a),r&&function jL(n,e,t){if(e){const i=n.localNames=[];for(let r=0;r<e.length;r+=2){const s=t[e[r+1]];if(null==s)throw new z(-301,!1);i.push(e[r],s)}}}(t,i,r)}t.mergedAttrs=Yl(t.mergedAttrs,t.attrs)}function Hw(n,e,t,i,r,s){for(let l=0;l<i.length;l++)Wm(bf(t,e),n,i[l].type);!function qL(n,e,t){n.flags|=1,n.directiveStart=e,n.directiveEnd=e+t,n.providerIndexes=e}(t,n.data.length,i.length);for(let l=0;l<i.length;l++){const u=i[l];u.providersResolver&&u.providersResolver(u)}let o=!1,a=!1,c=lu(n,e,i.length,null);for(let l=0;l<i.length;l++){const u=i[l];t.mergedAttrs=Yl(t.mergedAttrs,u.hostAttrs),ZL(n,t,e,c,u),$L(c,u,r),null!==u.contentQueries&&(t.flags|=4),(null!==u.hostBindings||null!==u.hostAttrs||0!==u.hostVars)&&(t.flags|=64);const d=u.type.prototype;!o&&(d.ngOnChanges||d.ngOnInit||d.ngDoCheck)&&((n.preOrderHooks??(n.preOrderHooks=[])).push(t.index),o=!0),!a&&(d.ngOnChanges||d.ngDoCheck)&&((n.preOrderCheckHooks??(n.preOrderCheckHooks=[])).push(t.index),a=!0),c++}!function FL(n,e,t){const r=e.directiveEnd,s=n.data,o=e.attrs,a=[];let c=null,l=null;for(let u=e.directiveStart;u<r;u++){const d=s[u],f=t?t.get(d):null,m=f?f.outputs:null;c=Vw(d.inputs,u,c,f?f.inputs:null),l=Vw(d.outputs,u,l,m);const p=null===c||null===o||bw(e)?null:KL(c,u,o);a.push(p)}null!==c&&(c.hasOwnProperty("class")&&(e.flags|=8),c.hasOwnProperty("style")&&(e.flags|=16)),e.initialInputs=a,e.inputs=c,e.outputs=l}(n,t,s)}function Gw(n,e,t){const i=t.directiveStart,r=t.directiveEnd,s=t.index,o=function PI(){return vt.lFrame.currentDirectiveIndex}();try{Go(s);for(let a=i;a<r;a++){const c=n.data[a],l=e[a];Lm(a),(null!==c.hostBindings||0!==c.hostVars||null!==c.hostAttrs)&&GL(c,l)}}finally{Go(-1),Lm(o)}}function GL(n,e){null!==n.hostBindings&&n.hostBindings(1,e)}function jg(n,e,t){e.componentOffset=t,(n.components??(n.components=[])).push(e.index)}function $L(n,e,t){if(t){if(e.exportAs)for(let i=0;i<e.exportAs.length;i++)t[e.exportAs[i]]=n;Hr(e)&&(t[""]=n)}}function ZL(n,e,t,i,r){n.data[i]=r;const s=r.factory||(r.factory=Ho(r.type)),o=new Xl(s,Hr(r),yt);n.blueprint[i]=o,t[i]=o,function VL(n,e,t,i,r){const s=r.hostBindings;if(s){let o=n.hostBindingOpCodes;null===o&&(o=n.hostBindingOpCodes=[]);const a=~e.index;(function zL(n){let e=n.length;for(;e>0;){const t=n[--e];if("number"==typeof t&&t<0)return t}return 0})(o)!=a&&o.push(a),o.push(t,i,s)}}(n,e,i,lu(n,t,r.hostVars,xt),r)}function YL(n,e,t,i,r,s){const o=s[e];if(null!==o){const a=i.setInput;for(let c=0;c<o.length;){const l=o[c++],u=o[c++],d=o[c++];null!==a?i.setInput(t,d,l,u):t[u]=d}}}function KL(n,e,t){let i=null,r=0;for(;r<t.length;){const s=t[r];if(0!==s)if(5!==s){if("number"==typeof s)break;if(n.hasOwnProperty(s)){null===i&&(i=[]);const o=n[s];for(let a=0;a<o.length;a+=2)if(o[a]===e){i.push(s,o[a+1],t[r+1]);break}}r+=2}else r+=2;else r+=4}return i}function Ww(n,e,t,i){return[n,!0,!1,e,null,0,i,t,null,null]}function eN(n,e){const t=Qi(e,n);if(pf(t)){const i=t[Le];48&t[Ct]?Hf(i,t,i.template,t[jn]):t[zo]>0&&qg(t)}}function qg(n){for(let i=og(n);null!==i;i=ag(i))for(let r=Bi;r<i.length;r++){const s=i[r];if(pf(s))if(512&s[Ct]){const o=s[Le];Hf(o,s,o.template,s[jn])}else s[zo]>0&&qg(s)}const t=n[Le].components;if(null!==t)for(let i=0;i<t.length;i++){const r=Qi(t[i],n);pf(r)&&r[zo]>0&&qg(r)}}function tN(n,e){const t=Qi(e,n),i=t[Le];(function nN(n,e){for(let t=e.length;t<n.blueprint.length;t++)e.push(n.blueprint[t])})(i,t),Ug(i,t,t[jn])}function Gf(n,e){return n[Gl]?n[Mx][Vr]=e:n[Gl]=e,n[Mx]=e,e}function Wf(n){for(;n;){n[Ct]|=32;const e=ru(n);if(fI(n)&&!e)return n;n=e}return null}function jf(n,e,t,i=!0){const r=e[lf];r.begin&&r.begin();try{Hf(n,e,n.template,t)}catch(o){throw i&&Zw(e,o),o}finally{r.end&&r.end()}}function Zg(n,e,t){Om(0),e(n,t)}function jw(n){return n[Wa]||(n[Wa]=[])}function $w(n){return n.cleanup||(n.cleanup=[])}function Zw(n,e){const t=n[cf],i=t?t.get(cc,null):null;i&&i.handleError(e)}function Xg(n,e,t,i,r){for(let s=0;s<t.length;){const o=t[s++],a=t[s++],c=e[o],l=n.data[o];null!==l.setInput?l.setInput(c,r,i,a):c[a]=r}}function $f(n,e,t){let i=t?n.styles:null,r=t?n.classes:null,s=0;if(null!==e)for(let o=0;o<e.length;o++){const a=e[o];"number"==typeof a?s=a:1==s?r=un(r,a):2==s&&(i=un(i,a+": "+e[++o]+";"))}t?n.styles=i:n.stylesWithoutHost=i,t?n.classes=r:n.classesWithoutHost=r}function qf(n,e,t,i,r=!1){for(;null!==t;){const s=e[t.index];if(null!==s&&i.push(wi(s)),zr(s))for(let a=Bi;a<s.length;a++){const c=s[a],l=c[Le].firstChild;null!==l&&qf(c[Le],c,l,i)}const o=t.type;if(8&o)qf(n,e,t.child,i);else if(32&o){const a=sg(t,e);let c;for(;c=a();)i.push(c)}else if(16&o){const a=Hb(e,t);if(Array.isArray(a))i.push(...a);else{const c=ru(e[Ai]);qf(c[Le],c,a,i,!0)}}t=r?t.projectionNext:t.next}return i}class uu{get rootNodes(){const e=this._lView,t=e[Le];return qf(t,e,t.firstChild,[])}constructor(e,t){this._lView=e,this._cdRefInjectingView=t,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[jn]}set context(e){this._lView[jn]=e}get destroyed(){return 128==(128&this._lView[Ct])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const e=this._lView[Vn];if(zr(e)){const t=e[df],i=t?t.indexOf(this):-1;i>-1&&(ug(e,i),Mf(t,i))}this._attachedToViewContainer=!1}Lb(this._lView[Le],this._lView)}onDestroy(e){Uw(this._lView[Le],this._lView,null,e)}markForCheck(){Wf(this._cdRefInjectingView||this._lView)}detach(){this._lView[Ct]&=-65}reattach(){this._lView[Ct]|=64}detectChanges(){jf(this._lView[Le],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new z(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function zR(n,e){su(n,e,e[Rt],2,null,null)}(this._lView[Le],this._lView)}attachToAppRef(e){if(this._attachedToViewContainer)throw new z(902,!1);this._appRef=e}}class iN extends uu{constructor(e){super(e),this._view=e}detectChanges(){const e=this._view;jf(e[Le],e,e[jn],!1)}checkNoChanges(){}get context(){return null}}class Xw extends kf{constructor(e){super(),this.ngModule=e}resolveComponentFactory(e){const t=on(e);return new du(t,this.ngModule)}}function Yw(n){const e=[];for(let t in n)n.hasOwnProperty(t)&&e.push({propName:n[t],templateName:t});return e}class sN{constructor(e,t){this.injector=e,this.parentInjector=t}get(e,t,i){i=sf(i);const r=this.injector.get(e,Rg,i);return r!==Rg||t===Rg?r:this.parentInjector.get(e,t,i)}}class du extends mw{get inputs(){return Yw(this.componentDef.inputs)}get outputs(){return Yw(this.componentDef.outputs)}constructor(e,t){super(),this.componentDef=e,this.ngModule=t,this.componentType=e.type,this.selector=function lL(n){return n.map(cL).join(",")}(e.selectors),this.ngContentSelectors=e.ngContentSelectors?e.ngContentSelectors:[],this.isBoundToModule=!!t}create(e,t,i,r){let s=(r=r||this.ngModule)instanceof Zo?r:r?.injector;s&&null!==this.componentDef.getStandaloneInjector&&(s=this.componentDef.getStandaloneInjector(s)||s);const o=s?new sN(e,s):e,a=o.get(Bf,null);if(null===a)throw new z(407,!1);const c=o.get(HP,null),l=a.createRenderer(null,this.componentDef),u=this.componentDef.selectors[0][0]||"div",d=i?function NL(n,e,t){return n.selectRootElement(e,t===fs.ShadowDom)}(l,i,this.componentDef.encapsulation):lg(l,u,function rN(n){const e=n.toLowerCase();return"svg"===e?"svg":"math"===e?"math":null}(u)),f=this.componentDef.onPush?288:272,h=Gg(0,null,null,1,0,null,null,null,null,null),m=zf(null,h,null,f,null,null,a,l,c,o,null);let p,g;Fm(m);try{const _=this.componentDef;let v,y=null;_.findHostDirectiveDefs?(v=[],y=new Map,_.findHostDirectiveDefs(_,v,y),v.push(_)):v=[_];const x=function aN(n,e){const t=n[Le],i=An;return n[i]=e,dc(t,i,2,"#host",null)}(m,d),w=function cN(n,e,t,i,r,s,o,a){const c=r[Le];!function lN(n,e,t,i){for(const r of n)e.mergedAttrs=Yl(e.mergedAttrs,r.hostAttrs);null!==e.mergedAttrs&&($f(e,e.mergedAttrs,!0),null!==t&&jb(i,t,e))}(i,n,e,o);const l=s.createRenderer(e,t),u=zf(r,Bw(t),null,t.onPush?32:16,r[n.index],n,s,l,a||null,null,null);return c.firstCreatePass&&jg(c,n,i.length-1),Gf(r,u),r[n.index]=u}(x,d,_,v,m,a,l);g=Lx(h,An),d&&function dN(n,e,t,i){if(i)Vm(n,t,["ng-version",GP.full]);else{const{attrs:r,classes:s}=function uL(n){const e=[],t=[];let i=1,r=2;for(;i<n.length;){let s=n[i];if("string"==typeof s)2===r?""!==s&&e.push(s,n[++i]):8===r&&t.push(s);else{if(!Gr(r))break;r=s}i++}return{attrs:e,classes:t}}(e.selectors[0]);r&&Vm(n,t,r),s&&s.length>0&&Wb(n,t,s.join(" "))}}(l,_,d,i),void 0!==t&&function fN(n,e,t){const i=n.projection=[];for(let r=0;r<e.length;r++){const s=t[r];i.push(null!=s?Array.from(s):null)}}(g,this.ngContentSelectors,t),p=function uN(n,e,t,i,r,s){const o=Mi(),a=r[Le],c=cr(o,r);Hw(a,r,o,t,null,i);for(let u=0;u<t.length;u++)Ii(Wo(r,a,o.directiveStart+u,o),r);Gw(a,r,o),c&&Ii(c,r);const l=Wo(r,a,o.directiveStart+o.componentOffset,o);if(n[jn]=r[jn]=l,null!==s)for(const u of s)u(l,e);return Vg(a,o,n),l}(w,_,v,y,m,[hN]),Ug(h,m,null)}finally{km()}return new oN(this.componentType,p,ac(g,m),m,g)}}class oN extends FP{constructor(e,t,i,r,s){super(),this.location=i,this._rootLView=r,this._tNode=s,this.instance=t,this.hostView=this.changeDetectorRef=new iN(r),this.componentType=e}setInput(e,t){const i=this._tNode.inputs;let r;if(null!==i&&(r=i[e])){const s=this._rootLView;Xg(s[Le],s,r,e,t),Wf(Qi(this._tNode.index,s))}}get injector(){return new Ka(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(e){this.hostView.onDestroy(e)}}function hN(){const n=Mi();mf(le()[Le],n)}function fu(n){let e=function Kw(n){return Object.getPrototypeOf(n.prototype).constructor}(n.type),t=!0;const i=[n];for(;e;){let r;if(Hr(n))r=e.\u0275cmp||e.\u0275dir;else{if(e.\u0275cmp)throw new z(903,!1);r=e.\u0275dir}if(r){if(t){i.push(r);const o=n;o.inputs=Yg(n.inputs),o.declaredInputs=Yg(n.declaredInputs),o.outputs=Yg(n.outputs);const a=r.hostBindings;a&&yN(n,a);const c=r.viewQuery,l=r.contentQueries;if(c&&mN(n,c),l&&gN(n,l),mi(n.inputs,r.inputs),mi(n.declaredInputs,r.declaredInputs),mi(n.outputs,r.outputs),Hr(r)&&r.data.animation){const u=n.data;u.animation=(u.animation||[]).concat(r.data.animation)}}const s=r.features;if(s)for(let o=0;o<s.length;o++){const a=s[o];a&&a.ngInherit&&a(n),a===fu&&(t=!1)}}e=Object.getPrototypeOf(e)}!function pN(n){let e=0,t=null;for(let i=n.length-1;i>=0;i--){const r=n[i];r.hostVars=e+=r.hostVars,r.hostAttrs=Yl(r.hostAttrs,t=Yl(t,r.hostAttrs))}}(i)}function Yg(n){return n===Rs?{}:n===rn?[]:n}function mN(n,e){const t=n.viewQuery;n.viewQuery=t?(i,r)=>{e(i,r),t(i,r)}:e}function gN(n,e){const t=n.contentQueries;n.contentQueries=t?(i,r,s)=>{e(i,r,s),t(i,r,s)}:e}function yN(n,e){const t=n.hostBindings;n.hostBindings=t?(i,r)=>{e(i,r),t(i,r)}:e}function Ri(n,e,t){return!Object.is(n[e],t)&&(n[e]=t,!0)}function Jg(n,e,t,i,r,s,o,a){const c=le(),l=jt(),u=n+An,d=l.firstCreatePass?function DN(n,e,t,i,r,s,o,a,c){const l=e.consts,u=dc(e,n,4,o||null,fo(l,a));Wg(e,t,u,fo(l,c)),mf(e,u);const d=u.tView=Gg(2,u,i,r,s,e.directiveRegistry,e.pipeRegistry,null,e.schemas,l);return null!==e.queries&&(e.queries.template(e,u),d.queries=e.queries.embeddedTView(u)),u}(u,l,c,e,t,i,r,s,o):l.data[u];ps(d,!1);const f=c[Rt].createComment("");If(l,c,f,d),Ii(f,c),Gf(c,c[u]=Ww(f,c,f,d)),ff(d)&&zg(l,c,d),null!=o&&Hg(c,d,a)}function Us(n,e,t){const i=le();return Ri(i,function Xa(){return vt.lFrame.bindingIndex++}(),e)&&function ur(n,e,t,i,r,s,o,a){const c=cr(e,t);let u,l=e.inputs;!a&&null!=l&&(u=l[i])?(Xg(n,t,u,i,r),$l(e)&&function BL(n,e){const t=Qi(e,n);16&t[Ct]||(t[Ct]|=32)}(t,e.index)):3&e.type&&(i=function kL(n){return"class"===n?"className":"for"===n?"htmlFor":"formaction"===n?"formAction":"innerHtml"===n?"innerHTML":"readonly"===n?"readOnly":"tabindex"===n?"tabIndex":n}(i),r=null!=o?o(r,e.value||"",i):r,s.setProperty(c,i,r))}(jt(),function Nn(){const n=vt.lFrame;return Lx(n.tView,n.selectedIndex)}(),i,n,e,i[Rt],t,!1),Us}function Qg(n,e,t,i,r){const o=r?"class":"style";Xg(n,t,e.inputs[o],o,i)}function bc(n,e,t,i){const r=le(),s=jt(),o=An+n,a=r[Rt],c=s.firstCreatePass?function IN(n,e,t,i,r,s){const o=e.consts,c=dc(e,n,2,i,fo(o,r));return Wg(e,t,c,fo(o,s)),null!==c.attrs&&$f(c,c.attrs,!1),null!==c.mergedAttrs&&$f(c,c.mergedAttrs,!0),null!==e.queries&&e.queries.elementStart(e,c),c}(o,s,r,e,t,i):s.data[o],l=r[o]=lg(a,e,function VI(){return vt.lFrame.currentNamespace}()),u=ff(c);return ps(c,!0),jb(a,l,c),32!=(32&c.flags)&&If(s,r,l,c),0===function SI(){return vt.lFrame.elementDepthCount}()&&Ii(l,r),function EI(){vt.lFrame.elementDepthCount++}(),u&&(zg(s,r,c),Vg(s,c,r)),null!==i&&Hg(r,c),bc}function wc(){let n=Mi();Rm()?Pm():(n=n.parent,ps(n,!1));const e=n;!function TI(){vt.lFrame.elementDepthCount--}();const t=jt();return t.firstCreatePass&&(mf(t,n),Tm(n)&&t.queries.elementEnd(n)),null!=e.classesWithoutHost&&function WI(n){return 0!=(8&n.flags)}(e)&&Qg(t,e,le(),e.classesWithoutHost,!0),null!=e.stylesWithoutHost&&function jI(n){return 0!=(16&n.flags)}(e)&&Qg(t,e,le(),e.stylesWithoutHost,!1),wc}function pu(n,e,t,i){return bc(n,e,t,i),wc(),pu}function Yf(n,e,t){const i=le(),r=jt(),s=n+An,o=r.firstCreatePass?function RN(n,e,t,i,r){const s=e.consts,o=fo(s,i),a=dc(e,n,8,"ng-container",o);return null!==o&&$f(a,o,!0),Wg(e,t,a,fo(s,r)),null!==e.queries&&e.queries.elementStart(e,a),a}(s,r,i,e,t):r.data[s];ps(o,!0);const a=i[s]=i[Rt].createComment("");return If(r,i,a,o),Ii(a,i),ff(o)&&(zg(r,i,o),Vg(r,o,i)),null!=t&&Hg(i,o),Yf}function Kf(){let n=Mi();const e=jt();return Rm()?Pm():(n=n.parent,ps(n,!1)),e.firstCreatePass&&(mf(e,n),Tm(n)&&e.queries.elementEnd(n)),Kf}function ey(){return le()}function ty(n){return!!n&&"function"==typeof n.then}const PN=function fM(n){return!!n&&"function"==typeof n.subscribe};function mu(n,e,t,i){const r=le(),s=jt(),o=Mi();return function pM(n,e,t,i,r,s,o){const a=ff(i),l=n.firstCreatePass&&$w(n),u=e[jn],d=jw(e);let f=!0;if(3&i.type||o){const p=cr(i,e),g=o?o(p):p,_=d.length,v=o?x=>o(wi(x[i.index])):i.index;let y=null;if(!o&&a&&(y=function LN(n,e,t,i){const r=n.cleanup;if(null!=r)for(let s=0;s<r.length-1;s+=2){const o=r[s];if(o===t&&r[s+1]===i){const a=e[Wa],c=r[s+2];return a.length>c?a[c]:null}"string"==typeof o&&(s+=2)}return null}(n,e,r,i.index)),null!==y)(y.__ngLastListenerFn__||y).__ngNextListenerFn__=s,y.__ngLastListenerFn__=s,f=!1;else{s=gM(i,e,u,s,!1);const x=t.listen(g,r,s);d.push(s,x),l&&l.push(r,v,_,_+1)}}else s=gM(i,e,u,s,!1);const h=i.outputs;let m;if(f&&null!==h&&(m=h[r])){const p=m.length;if(p)for(let g=0;g<p;g+=2){const w=e[m[g]][m[g+1]].subscribe(s),M=d.length;d.push(s,w),l&&l.push(r,i.index,M,-(M+1))}}}(s,r,r[Rt],o,n,e,i),mu}function mM(n,e,t,i){try{return Sr(6,e,t),!1!==t(i)}catch(r){return Zw(n,r),!1}finally{Sr(7,e,t)}}function gM(n,e,t,i,r){return function s(o){if(o===Function)return i;Wf(n.componentOffset>-1?Qi(n.index,e):e);let c=mM(e,t,i,o),l=s.__ngNextListenerFn__;for(;l;)c=mM(e,t,l,o)&&c,l=l.__ngNextListenerFn__;return r&&!1===c&&(o.preventDefault(),o.returnValue=!1),c}}function Jf(n=1){return function NI(n){return(vt.lFrame.contextLView=function OI(n,e){for(;n>0;)e=e[ja],n--;return e}(n,vt.lFrame.contextLView))[jn]}(n)}function Qf(n,e){return n<<17|e<<2}function po(n){return n>>17&32767}function iy(n){return 2|n}function Ko(n){return(131068&n)>>2}function ry(n,e){return-131069&n|e<<2}function sy(n){return 1|n}function TM(n,e,t,i,r){const s=n[t+1],o=null===e;let a=i?po(s):Ko(s),c=!1;for(;0!==a&&(!1===c||o);){const u=n[a+1];HN(n[a],e)&&(c=!0,n[a+1]=i?sy(u):iy(u)),a=i?po(u):Ko(u)}c&&(n[t+1]=i?iy(s):sy(s))}function HN(n,e){return null===n||null==e||(Array.isArray(n)?n[1]:n)===e||!(!Array.isArray(n)||"string"!=typeof e)&&nc(n,e)>=0}function oy(n,e,t){return Wr(n,e,t,!1),oy}function ay(n,e){return Wr(n,e,null,!0),ay}function Wr(n,e,t,i){const r=le(),s=jt(),o=function Os(n){const e=vt.lFrame,t=e.bindingIndex;return e.bindingIndex=e.bindingIndex+n,t}(2);s.firstUpdatePass&&function NM(n,e,t,i){const r=n.data;if(null===r[t+1]){const s=r[Vi()],o=function LM(n,e){return e>=n.expandoStartIndex}(n,t);(function BM(n,e){return 0!=(n.flags&(e?8:16))})(s,i)&&null===e&&!o&&(e=!1),e=function KN(n,e,t,i){const r=function Nm(n){const e=vt.lFrame.currentDirectiveIndex;return-1===e?null:n[e]}(n);let s=i?e.residualClasses:e.residualStyles;if(null===r)0===(i?e.classBindings:e.styleBindings)&&(t=gu(t=cy(null,n,e,t,i),e.attrs,i),s=null);else{const o=e.directiveStylingLast;if(-1===o||n[o]!==r)if(t=cy(r,n,e,t,i),null===s){let c=function JN(n,e,t){const i=t?e.classBindings:e.styleBindings;if(0!==Ko(i))return n[po(i)]}(n,e,i);void 0!==c&&Array.isArray(c)&&(c=cy(null,n,e,c[1],i),c=gu(c,e.attrs,i),function QN(n,e,t,i){n[po(t?e.classBindings:e.styleBindings)]=i}(n,e,i,c))}else s=function eO(n,e,t){let i;const r=e.directiveEnd;for(let s=1+e.directiveStylingLast;s<r;s++)i=gu(i,n[s].hostAttrs,t);return gu(i,e.attrs,t)}(n,e,i)}return void 0!==s&&(i?e.residualClasses=s:e.residualStyles=s),t}(r,s,e,i),function VN(n,e,t,i,r,s){let o=s?e.classBindings:e.styleBindings,a=po(o),c=Ko(o);n[i]=t;let u,l=!1;if(Array.isArray(t)?(u=t[1],(null===u||nc(t,u)>0)&&(l=!0)):u=t,r)if(0!==c){const f=po(n[a+1]);n[i+1]=Qf(f,a),0!==f&&(n[f+1]=ry(n[f+1],i)),n[a+1]=function BN(n,e){return 131071&n|e<<17}(n[a+1],i)}else n[i+1]=Qf(a,0),0!==a&&(n[a+1]=ry(n[a+1],i)),a=i;else n[i+1]=Qf(c,0),0===a?a=i:n[c+1]=ry(n[c+1],i),c=i;l&&(n[i+1]=iy(n[i+1])),TM(n,u,i,!0),TM(n,u,i,!1),function zN(n,e,t,i,r){const s=r?n.residualClasses:n.residualStyles;null!=s&&"string"==typeof e&&nc(s,e)>=0&&(t[i+1]=sy(t[i+1]))}(e,u,n,i,s),o=Qf(a,c),s?e.classBindings=o:e.styleBindings=o}(r,s,e,t,o,i)}}(s,n,o,i),e!==xt&&Ri(r,o,e)&&function FM(n,e,t,i,r,s,o,a){if(!(3&e.type))return;const c=n.data,l=c[a+1],u=function UN(n){return 1==(1&n)}(l)?kM(c,e,t,r,Ko(l),o):void 0;eh(u)||(eh(s)||function kN(n){return 2==(2&n)}(l)&&(s=kM(c,null,t,r,a,o)),function KR(n,e,t,i,r){if(e)r?n.addClass(t,i):n.removeClass(t,i);else{let s=-1===i.indexOf("-")?void 0:er.DashCase;null==r?n.removeStyle(t,i,s):("string"==typeof r&&r.endsWith("!important")&&(r=r.slice(0,-10),s|=er.Important),n.setStyle(t,i,r,s))}}(i,o,function hf(n,e){return wi(e[n])}(Vi(),t),r,s))}(s,s.data[Vi()],r,r[Rt],n,r[o+1]=function iO(n,e){return null==n||""===n||("string"==typeof e?n+=e:"object"==typeof n&&(n=it(function ho(n){return n instanceof Yb?n.changingThisBreaksApplicationSecurity:n}(n)))),n}(e,t),i,o)}function cy(n,e,t,i,r){let s=null;const o=t.directiveEnd;let a=t.directiveStylingLast;for(-1===a?a=t.directiveStart:a++;a<o&&(s=e[a],i=gu(i,s.hostAttrs,r),s!==n);)a++;return null!==n&&(t.directiveStylingLast=a),i}function gu(n,e,t){const i=t?1:2;let r=-1;if(null!==e)for(let s=0;s<e.length;s++){const o=e[s];"number"==typeof o?r=o:r===i&&(Array.isArray(n)||(n=void 0===n?[]:["",n]),lr(n,o,!!t||e[++s]))}return void 0===n?null:n}function kM(n,e,t,i,r,s){const o=null===e;let a;for(;r>0;){const c=n[r],l=Array.isArray(c),u=l?c[1]:c,d=null===u;let f=t[r+1];f===xt&&(f=d?rn:void 0);let h=d?Xm(f,i):u===i?f:void 0;if(l&&!eh(h)&&(h=Xm(c,i)),eh(h)&&(a=h,o))return a;const m=n[r+1];r=o?po(m):Ko(m)}if(null!==e){let c=s?e.residualClasses:e.residualStyles;null!=c&&(a=Xm(c,i))}return a}function eh(n){return void 0!==n}const Ec="en-US";let aS=Ec;function fy(n,e,t,i,r){if(n=L(n),Array.isArray(n))for(let s=0;s<n.length;s++)fy(n[s],e,t,i,r);else{const s=jt(),o=le();let a=qo(n)?n:L(n.provide),c=pw(n);const l=Mi(),u=1048575&l.providerIndexes,d=l.directiveStart,f=l.providerIndexes>>20;if(qo(n)||!n.multi){const h=new Xl(c,r,yt),m=py(a,e,r?u:u+f,d);-1===m?(Wm(bf(l,o),s,a),hy(s,n,e.length),e.push(a),l.directiveStart++,l.directiveEnd++,r&&(l.providerIndexes+=1048576),t.push(h),o.push(h)):(t[m]=h,o[m]=h)}else{const h=py(a,e,u+f,d),m=py(a,e,u,u+f),g=m>=0&&t[m];if(r&&!g||!r&&!(h>=0&&t[h])){Wm(bf(l,o),s,a);const _=function w2(n,e,t,i,r){const s=new Xl(n,t,yt);return s.multi=[],s.index=e,s.componentProviders=0,PS(s,r,i&&!t),s}(r?b2:x2,t.length,r,i,c);!r&&g&&(t[m].providerFactory=_),hy(s,n,e.length,0),e.push(a),l.directiveStart++,l.directiveEnd++,r&&(l.providerIndexes+=1048576),t.push(_),o.push(_)}else hy(s,n,h>-1?h:m,PS(t[r?m:h],c,!r&&i));!r&&i&&g&&t[m].componentProviders++}}}function hy(n,e,t,i){const r=qo(e),s=function AP(n){return!!n.useClass}(e);if(r||s){const c=(s?L(e.useClass):e).prototype.ngOnDestroy;if(c){const l=n.destroyHooks||(n.destroyHooks=[]);if(!r&&e.multi){const u=l.indexOf(t);-1===u?l.push(t,[i,c]):l[u+1].push(i,c)}else l.push(t,c)}}}function PS(n,e,t){return t&&n.componentProviders++,n.multi.push(e)-1}function py(n,e,t,i){for(let r=t;r<i;r++)if(e[r]===n)return r;return-1}function x2(n,e,t,i){return my(this.multi,[])}function b2(n,e,t,i){const r=this.multi;let s;if(this.providerFactory){const o=this.providerFactory.componentProviders,a=Wo(t,t[Le],this.providerFactory.index,i);s=a.slice(0,o),my(r,s);for(let c=o;c<a.length;c++)s.push(a[c])}else s=[],my(r,s);return s}function my(n,e){for(let t=0;t<n.length;t++)e.push((0,n[t])());return e}function gy(n,e=[]){return t=>{t.providersResolver=(i,r)=>function v2(n,e,t){const i=jt();if(i.firstCreatePass){const r=Hr(n);fy(t,i.data,i.blueprint,r,!0),fy(e,i.data,i.blueprint,r,!1)}}(i,r?r(n):n,e)}}class Tc{}class E2 extends Tc{constructor(e,t,i){super(),this.componentFactoryResolver=new Xw(this),this.instance=null;const r=new hw([...e,{provide:Tc,useValue:this},{provide:kf,useValue:this.componentFactoryResolver}],t||Ff(),i,new Set(["environment"]));this.injector=r,r.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(e){this.injector.onDestroy(e)}}function _y(n,e,t=null){return new E2(n,e,t).injector}let T2=(()=>{class n{constructor(t){this._injector=t,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(t){if(!t.standalone)return null;if(!this.cachedInjectors.has(t.id)){const i=lw(0,t.type),r=i.length>0?_y([i],this._injector,`Standalone[${t.type.name}]`):null;this.cachedInjectors.set(t.id,r)}return this.cachedInjectors.get(t.id)}ngOnDestroy(){try{for(const t of this.cachedInjectors.values())null!==t&&t.destroy()}finally{this.cachedInjectors.clear()}}}return n.\u0275prov=Wt({token:n,providedIn:"environment",factory:()=>new n(sn(Zo))}),n})();function wu(n){n.getStandaloneInjector=e=>e.get(T2).getOrCreateStandaloneInjector(n)}function vy(n){const e=tr(n);if(null===e)return null;if(void 0===e.component){const t=e.lView;if(null===t)return null;e.component=function LR(n,e){const t=e[Le].data[n],{directiveStart:i,componentOffset:r}=t;return r>-1?e[i+r]:null}(e.nodeIndex,t)}return e.component}function R2(n,e){return n.name==e.name?0:n.name<e.name?-1:1}function P2(n){return void 0!==n.type&&void 0!==n.declaredInputs&&void 0!==n.findHostDirectiveDefs}function zS(n,e,t,i,r,s){const o=e+t;return Ri(n,o,r)?function _s(n,e,t){return n[e]=t}(n,o+1,s?i.call(s,r):i(r)):function Mu(n,e){const t=n[e];return t===xt?void 0:t}(n,o+1)}function qS(n,e,t){const i=n+An,r=le(),s=function Za(n,e){return n[e]}(r,i);return function Su(n,e){return n[Le].data[e].pure}(r,i)?zS(r,Ui(),e,s.transform,t,s):s.transform(t)}function xy(n){return e=>{setTimeout(n,void 0,e)}}const Hi=class X2 extends Yi{constructor(e=!1){super(),this.__isAsync=e}emit(e){super.next(e)}subscribe(e,t,i){let r=e,s=t||(()=>null),o=i;if(e&&"object"==typeof e){const c=e;r=c.next?.bind(c),s=c.error?.bind(c),o=c.complete?.bind(c)}this.__isAsync&&(s=xy(s),r&&(r=xy(r)),o&&(o=xy(o)));const a=super.subscribe({next:r,error:s,complete:o});return e instanceof Rn&&e.add(a),a}};function Y2(){return this._results[Symbol.iterator]()}class by{get changes(){return this._changes||(this._changes=new Hi)}constructor(e=!1){this._emitDistinctChangesOnly=e,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const t=by.prototype;t[Symbol.iterator]||(t[Symbol.iterator]=Y2)}get(e){return this._results[e]}map(e){return this._results.map(e)}filter(e){return this._results.filter(e)}find(e){return this._results.find(e)}reduce(e,t){return this._results.reduce(e,t)}forEach(e){this._results.forEach(e)}some(e){return this._results.some(e)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(e,t){const i=this;i.dirty=!1;const r=function Er(n){return n.flat(Number.POSITIVE_INFINITY)}(e);(this._changesDetected=!function tR(n,e,t){if(n.length!==e.length)return!1;for(let i=0;i<n.length;i++){let r=n[i],s=e[i];if(t&&(r=t(r),s=t(s)),s!==r)return!1}return!0}(i._results,r,t))&&(i._results=r,i.length=r.length,i.last=r[this.length-1],i.first=r[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}let $r=(()=>{class n{}return n.__NG_ELEMENT_ID__=Q2,n})();const K2=$r,J2=class extends K2{constructor(e,t,i){super(),this._declarationLView=e,this._declarationTContainer=t,this.elementRef=i}createEmbeddedView(e,t){const i=this._declarationTContainer.tView,r=zf(this._declarationLView,i,e,16,null,i.declTNode,null,null,null,null,t||null);r[Wl]=this._declarationLView[this._declarationTContainer.index];const o=this._declarationLView[hs];return null!==o&&(r[hs]=o.createEmbeddedView(i)),Ug(i,r,e),new uu(r)}};function Q2(){return sh(Mi(),le())}function sh(n,e){return 4&n.type?new J2(e,n,ac(n,e)):null}let Gi=(()=>{class n{}return n.__NG_ELEMENT_ID__=eF,n})();function eF(){return YS(Mi(),le())}const tF=Gi,ZS=class extends tF{constructor(e,t,i){super(),this._lContainer=e,this._hostTNode=t,this._hostLView=i}get element(){return ac(this._hostTNode,this._hostLView)}get injector(){return new Ka(this._hostTNode,this._hostLView)}get parentInjector(){const e=Gm(this._hostTNode,this._hostLView);if(Kx(e)){const t=vf(e,this._hostLView),i=_f(e);return new Ka(t[Le].data[i+8],t)}return new Ka(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(e){const t=XS(this._lContainer);return null!==t&&t[e]||null}get length(){return this._lContainer.length-Bi}createEmbeddedView(e,t,i){let r,s;"number"==typeof i?r=i:null!=i&&(r=i.index,s=i.injector);const o=e.createEmbeddedView(t||{},s);return this.insert(o,r),o}createComponent(e,t,i,r,s){const o=e&&!function Ql(n){return"function"==typeof n}(e);let a;if(o)a=t;else{const d=t||{};a=d.index,i=d.injector,r=d.projectableNodes,s=d.environmentInjector||d.ngModuleRef}const c=o?e:new du(on(e)),l=i||this.parentInjector;if(!s&&null==c.ngModule){const f=(o?l:this.parentInjector).get(Zo,null);f&&(s=f)}const u=c.create(l,r,void 0,s);return this.insert(u.hostView,a),u}insert(e,t){const i=e._lView,r=i[Le];if(function MI(n){return zr(n[Vn])}(i)){const u=this.indexOf(e);if(-1!==u)this.detach(u);else{const d=i[Vn],f=new ZS(d,d[Ci],d[Vn]);f.detach(f.indexOf(e))}}const s=this._adjustIndex(t),o=this._lContainer;!function GR(n,e,t,i){const r=Bi+i,s=t.length;i>0&&(t[r-1][Vr]=e),i<s-Bi?(e[Vr]=t[r],lb(t,Bi+i,e)):(t.push(e),e[Vr]=null),e[Vn]=t;const o=e[Wl];null!==o&&t!==o&&function WR(n,e){const t=n[qa];e[Ai]!==e[Vn][Vn][Ai]&&(n[Ex]=!0),null===t?n[qa]=[e]:t.push(e)}(o,e);const a=e[hs];null!==a&&a.insertView(n),e[Ct]|=64}(r,i,o,s);const a=hg(s,o),c=i[Rt],l=Af(c,o[uf]);return null!==l&&function VR(n,e,t,i,r,s){i[Ls]=r,i[Ci]=e,su(n,i,t,1,r,s)}(r,o[Ci],c,i,l,a),e.attachToViewContainerRef(),lb(wy(o),s,e),e}move(e,t){return this.insert(e,t)}indexOf(e){const t=XS(this._lContainer);return null!==t?t.indexOf(e):-1}remove(e){const t=this._adjustIndex(e,-1),i=ug(this._lContainer,t);i&&(Mf(wy(this._lContainer),t),Lb(i[Le],i))}detach(e){const t=this._adjustIndex(e,-1),i=ug(this._lContainer,t);return i&&null!=Mf(wy(this._lContainer),t)?new uu(i):null}_adjustIndex(e,t=0){return e??this.length+t}};function XS(n){return n[df]}function wy(n){return n[df]||(n[df]=[])}function YS(n,e){let t;const i=e[n.index];if(zr(i))t=i;else{let r;if(8&n.type)r=wi(i);else{const s=e[Rt];r=s.createComment("");const o=cr(n,e);$o(s,Af(s,o),r,function ZR(n,e){return n.nextSibling(e)}(s,o),!1)}e[n.index]=t=Ww(i,e,r,n),Gf(e,t)}return new ZS(t,n,e)}class My{constructor(e){this.queryList=e,this.matches=null}clone(){return new My(this.queryList)}setDirty(){this.queryList.setDirty()}}class Sy{constructor(e=[]){this.queries=e}createEmbeddedView(e){const t=e.queries;if(null!==t){const i=null!==e.contentQueries?e.contentQueries[0]:t.length,r=[];for(let s=0;s<i;s++){const o=t.getByIndex(s);r.push(this.queries[o.indexInDeclarationView].clone())}return new Sy(r)}return null}insertView(e){this.dirtyQueriesWithMatches(e)}detachView(e){this.dirtyQueriesWithMatches(e)}dirtyQueriesWithMatches(e){for(let t=0;t<this.queries.length;t++)null!==nE(e,t).matches&&this.queries[t].setDirty()}}class KS{constructor(e,t,i=null){this.predicate=e,this.flags=t,this.read=i}}class Ey{constructor(e=[]){this.queries=e}elementStart(e,t){for(let i=0;i<this.queries.length;i++)this.queries[i].elementStart(e,t)}elementEnd(e){for(let t=0;t<this.queries.length;t++)this.queries[t].elementEnd(e)}embeddedTView(e){let t=null;for(let i=0;i<this.length;i++){const r=null!==t?t.length:0,s=this.getByIndex(i).embeddedTView(e,r);s&&(s.indexInDeclarationView=i,null!==t?t.push(s):t=[s])}return null!==t?new Ey(t):null}template(e,t){for(let i=0;i<this.queries.length;i++)this.queries[i].template(e,t)}getByIndex(e){return this.queries[e]}get length(){return this.queries.length}track(e){this.queries.push(e)}}class Ty{constructor(e,t=-1){this.metadata=e,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=t}elementStart(e,t){this.isApplyingToNode(t)&&this.matchTNode(e,t)}elementEnd(e){this._declarationNodeIndex===e.index&&(this._appliesToNextNode=!1)}template(e,t){this.elementStart(e,t)}embeddedTView(e,t){return this.isApplyingToNode(e)?(this.crossesNgTemplate=!0,this.addMatch(-e.index,t),new Ty(this.metadata)):null}isApplyingToNode(e){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const t=this._declarationNodeIndex;let i=e.parent;for(;null!==i&&8&i.type&&i.index!==t;)i=i.parent;return t===(null!==i?i.index:-1)}return this._appliesToNextNode}matchTNode(e,t){const i=this.metadata.predicate;if(Array.isArray(i))for(let r=0;r<i.length;r++){const s=i[r];this.matchTNodeWithReadOption(e,t,nF(t,s)),this.matchTNodeWithReadOption(e,t,wf(t,e,s,!1,!1))}else i===$r?4&t.type&&this.matchTNodeWithReadOption(e,t,-1):this.matchTNodeWithReadOption(e,t,wf(t,e,i,!1,!1))}matchTNodeWithReadOption(e,t,i){if(null!==i){const r=this.metadata.read;if(null!==r)if(r===gs||r===Gi||r===$r&&4&t.type)this.addMatch(t.index,-2);else{const s=wf(t,e,r,!1,!1);null!==s&&this.addMatch(t.index,s)}else this.addMatch(t.index,i)}}addMatch(e,t){null===this.matches?this.matches=[e,t]:this.matches.push(e,t)}}function nF(n,e){const t=n.localNames;if(null!==t)for(let i=0;i<t.length;i+=2)if(t[i]===e)return t[i+1];return null}function rF(n,e,t,i){return-1===t?function iF(n,e){return 11&n.type?ac(n,e):4&n.type?sh(n,e):null}(e,n):-2===t?function sF(n,e,t){return t===gs?ac(e,n):t===$r?sh(e,n):t===Gi?YS(e,n):void 0}(n,e,i):Wo(n,n[Le],t,e)}function JS(n,e,t,i){const r=e[hs].queries[i];if(null===r.matches){const s=n.data,o=t.matches,a=[];for(let c=0;c<o.length;c+=2){const l=o[c];a.push(l<0?null:rF(e,s[l],o[c+1],t.metadata.read))}r.matches=a}return r.matches}function Dy(n,e,t,i){const r=n.queries.getByIndex(t),s=r.matches;if(null!==s){const o=JS(n,e,r,t);for(let a=0;a<s.length;a+=2){const c=s[a];if(c>0)i.push(o[a/2]);else{const l=s[a+1],u=e[-c];for(let d=Bi;d<u.length;d++){const f=u[d];f[Wl]===f[Vn]&&Dy(f[Le],f,l,i)}if(null!==u[qa]){const d=u[qa];for(let f=0;f<d.length;f++){const h=d[f];Dy(h[Le],h,l,i)}}}}}return i}function Eu(n){const e=le(),t=jt(),i=zx();Om(i+1);const r=nE(t,i);if(n.dirty&&function wI(n){return 4==(4&n[Ct])}(e)===(2==(2&r.metadata.flags))){if(null===r.matches)n.reset([]);else{const s=r.crossesNgTemplate?Dy(t,e,i,[]):JS(t,e,r,i);n.reset(s,VP),n.notifyOnChanges()}return!0}return!1}function oh(n,e,t){const i=jt();i.firstCreatePass&&(tE(i,new KS(n,e,t),-1),2==(2&e)&&(i.staticViewQueries=!0)),eE(i,le(),e)}function Tu(){return function oF(n,e){return n[hs].queries[e].queryList}(le(),zx())}function eE(n,e,t){const i=new by(4==(4&t));Uw(n,e,i,i.destroy),null===e[hs]&&(e[hs]=new Sy),e[hs].queries.push(new My(i))}function tE(n,e,t){null===n.queries&&(n.queries=new Ey),n.queries.track(new Ty(e,t))}function nE(n,e){return n.queries.getByIndex(e)}function ch(...n){}const bE=new Mt("Application Initializer");let lh=(()=>{class n{constructor(t){this.appInits=t,this.resolve=ch,this.reject=ch,this.initialized=!1,this.done=!1,this.donePromise=new Promise((i,r)=>{this.resolve=i,this.reject=r})}runInitializers(){if(this.initialized)return;const t=[],i=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let r=0;r<this.appInits.length;r++){const s=this.appInits[r]();if(ty(s))t.push(s);else if(PN(s)){const o=new Promise((a,c)=>{s.subscribe({complete:a,error:c})});t.push(o)}}Promise.all(t).then(()=>{i()}).catch(r=>{this.reject(r)}),0===t.length&&i(),this.initialized=!0}}return n.\u0275fac=function(t){return new(t||n)(sn(bE,8))},n.\u0275prov=Wt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const Py=new Mt("AppId",{providedIn:"root",factory:function wE(){return`${Ly()}${Ly()}${Ly()}`}});function Ly(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const ME=new Mt("Platform Initializer"),SE=new Mt("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),Vs=new Mt("LocaleId",{providedIn:"root",factory:()=>Un(Vs,ht.Optional|ht.SkipSelf)||function CF(){return typeof $localize<"u"&&$localize.locale||Ec}()}),LF=(()=>Promise.resolve(0))();class Si{constructor({enableLongStackTrace:e=!1,shouldCoalesceEventChangeDetection:t=!1,shouldCoalesceRunChangeDetection:i=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new Hi(!1),this.onMicrotaskEmpty=new Hi(!1),this.onStable=new Hi(!1),this.onError=new Hi(!1),typeof Zone>"u")throw new z(908,!1);Zone.assertZonePatched();const r=this;r._nesting=0,r._outer=r._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(r._inner=r._inner.fork(new Zone.TaskTrackingZoneSpec)),e&&Zone.longStackTraceZoneSpec&&(r._inner=r._inner.fork(Zone.longStackTraceZoneSpec)),r.shouldCoalesceEventChangeDetection=!i&&t,r.shouldCoalesceRunChangeDetection=i,r.lastRequestAnimationFrameId=-1,r.nativeRequestAnimationFrame=function NF(){let n=Cn.requestAnimationFrame,e=Cn.cancelAnimationFrame;if(typeof Zone<"u"&&n&&e){const t=n[Zone.__symbol__("OriginalDelegate")];t&&(n=t);const i=e[Zone.__symbol__("OriginalDelegate")];i&&(e=i)}return{nativeRequestAnimationFrame:n,nativeCancelAnimationFrame:e}}().nativeRequestAnimationFrame,function kF(n){const e=()=>{!function FF(n){n.isCheckStableRunning||-1!==n.lastRequestAnimationFrameId||(n.lastRequestAnimationFrameId=n.nativeRequestAnimationFrame.call(Cn,()=>{n.fakeTopEventTask||(n.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{n.lastRequestAnimationFrameId=-1,Fy(n),n.isCheckStableRunning=!0,Oy(n),n.isCheckStableRunning=!1},void 0,()=>{},()=>{})),n.fakeTopEventTask.invoke()}),Fy(n))}(n)};n._inner=n._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(t,i,r,s,o,a)=>{try{return DE(n),t.invokeTask(r,s,o,a)}finally{(n.shouldCoalesceEventChangeDetection&&"eventTask"===s.type||n.shouldCoalesceRunChangeDetection)&&e(),CE(n)}},onInvoke:(t,i,r,s,o,a,c)=>{try{return DE(n),t.invoke(r,s,o,a,c)}finally{n.shouldCoalesceRunChangeDetection&&e(),CE(n)}},onHasTask:(t,i,r,s)=>{t.hasTask(r,s),i===r&&("microTask"==s.change?(n._hasPendingMicrotasks=s.microTask,Fy(n),Oy(n)):"macroTask"==s.change&&(n.hasPendingMacrotasks=s.macroTask))},onHandleError:(t,i,r,s)=>(t.handleError(r,s),n.runOutsideAngular(()=>n.onError.emit(s)),!1)})}(r)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!Si.isInAngularZone())throw new z(909,!1)}static assertNotInAngularZone(){if(Si.isInAngularZone())throw new z(909,!1)}run(e,t,i){return this._inner.run(e,t,i)}runTask(e,t,i,r){const s=this._inner,o=s.scheduleEventTask("NgZoneEvent: "+r,e,OF,ch,ch);try{return s.runTask(o,t,i)}finally{s.cancelTask(o)}}runGuarded(e,t,i){return this._inner.runGuarded(e,t,i)}runOutsideAngular(e){return this._outer.run(e)}}const OF={};function Oy(n){if(0==n._nesting&&!n.hasPendingMicrotasks&&!n.isStable)try{n._nesting++,n.onMicrotaskEmpty.emit(null)}finally{if(n._nesting--,!n.hasPendingMicrotasks)try{n.runOutsideAngular(()=>n.onStable.emit(null))}finally{n.isStable=!0}}}function Fy(n){n.hasPendingMicrotasks=!!(n._hasPendingMicrotasks||(n.shouldCoalesceEventChangeDetection||n.shouldCoalesceRunChangeDetection)&&-1!==n.lastRequestAnimationFrameId)}function DE(n){n._nesting++,n.isStable&&(n.isStable=!1,n.onUnstable.emit(null))}function CE(n){n._nesting--,Oy(n)}class BF{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Hi,this.onMicrotaskEmpty=new Hi,this.onStable=new Hi,this.onError=new Hi}run(e,t,i){return e.apply(t,i)}runGuarded(e,t,i){return e.apply(t,i)}runOutsideAngular(e){return e()}runTask(e,t,i,r){return e.apply(t,i)}}const AE=new Mt(""),zs=!1;let mo=null;const Vy=new Mt("PlatformDestroyListeners"),VF=new Mt("appBootstrapListener");function jF(n){const{rootComponent:e,appProviders:t,platformProviders:i}=n;zs&&void 0!==e&&function JP(n){if(function QP(n){if(!on(n))throw new z(906,`The ${X(n)} is not an Angular component, make sure it has the \`@Component\` decorator.`)}(n),!on(n).standalone)throw new z(907,`The ${X(n)} component is not marked as standalone, but Angular expects to have a standalone component here. Please make sure the ${X(n)} component has the \`standalone: true\` flag in the decorator.`)}(e);const r=function WF(n=[]){if(mo)return mo;const e=function PE(n=[],e){return Xo.create({name:e,providers:[{provide:Tg,useValue:"platform"},{provide:Vy,useValue:new Set([()=>mo=null])},...n]})}(n);return mo=e,function RE(n){const e=n.get(ME,null);e&&e.forEach(t=>t())}(e),e}(i),s=function OE(n,e){let t;return t="noop"===n?new BF:("zone.js"===n?void 0:n)||new Si(e),t}("zone.js",function NE(n){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:!(!n||!n.ngZoneEventCoalescing)||!1,shouldCoalesceRunChangeDetection:!(!n||!n.ngZoneRunCoalescing)||!1}}());return s.run(()=>{const a=_y([{provide:Si,useValue:s},...t||[]],r,"Environment Injector"),c=a.get(cc,null);if(zs&&!c)throw new z(402,"No `ErrorHandler` found in the Dependency Injection tree.");let l;s.runOutsideAngular(()=>{l=s.onError.subscribe({next:f=>{c.handleError(f)}})});const u=()=>a.destroy(),d=r.get(Vy);return d.add(u),a.onDestroy(()=>{l.unsubscribe(),d.delete(u)}),function FE(n,e,t){try{const i=t();return ty(i)?i.catch(r=>{throw e.runOutsideAngular(()=>n.handleError(r)),r}):i}catch(i){throw e.runOutsideAngular(()=>n.handleError(i)),i}}(c,s,()=>{const f=a.get(lh);return f.runInitializers(),f.donePromise.then(()=>{!function cS(n){si(n,"Expected localeId to be defined"),"string"==typeof n&&(aS=n.toLowerCase().replace(/_/g,"-"))}(a.get(Vs,Ec)||Ec);const m=a.get(Hy);return void 0!==e&&m.bootstrap(e),m})})})}let Hy=(()=>{class n{get destroyed(){return this._destroyed}get injector(){return this._injector}constructor(t,i,r){this._zone=t,this._injector=i,this._exceptionHandler=r,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this._destroyed=!1,this._destroyListeners=[],this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const s=new hn(a=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{a.next(this._stable),a.complete()})}),o=new hn(a=>{let c;this._zone.runOutsideAngular(()=>{c=this._zone.onStable.subscribe(()=>{Si.assertNotInAngularZone(),function Ny(n){typeof Zone>"u"?LF.then(()=>{n&&n.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",n)}(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,a.next(!0))})})});const l=this._zone.onUnstable.subscribe(()=>{Si.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{a.next(!1)}))});return()=>{c.unsubscribe(),l.unsubscribe()}});this.isStable=Dt(s,o.pipe(nt()))}bootstrap(t,i){zs&&this.warnIfDestroyed();const r=t instanceof mw;if(!this._injector.get(lh).done){const h="Cannot bootstrap as there are still asynchronous initializers running."+(!r&&function Hl(n){const e=on(n)||Di(n)||Ji(n);return null!==e&&e.standalone}(t)?"":" Bootstrap components in the `ngDoBootstrap` method of the root module.");throw new z(405,zs&&h)}let o;o=r?t:this._injector.get(kf).resolveComponentFactory(t),this.componentTypes.push(o.componentType);const a=function HF(n){return n.isBoundToModule}(o)?void 0:this._injector.get(Tc),l=o.create(Xo.NULL,[],i||o.selector,a),u=l.location.nativeElement,d=l.injector.get(AE,null);return d?.registerApplication(u),l.onDestroy(()=>{this.detachView(l.hostView),dh(this.components,l),d?.unregisterApplication(u)}),this._loadComponent(l),l}tick(){if(zs&&this.warnIfDestroyed(),this._runningTick)throw new z(101,!1);try{this._runningTick=!0;for(let t of this._views)t.detectChanges()}catch(t){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(t))}finally{this._runningTick=!1}}attachView(t){zs&&this.warnIfDestroyed();const i=t;this._views.push(i),i.attachToAppRef(this)}detachView(t){zs&&this.warnIfDestroyed();const i=t;dh(this._views,i),i.detachFromAppRef()}_loadComponent(t){this.attachView(t.hostView),this.tick(),this.components.push(t);const i=this._injector.get(VF,[]);i.push(...this._bootstrapListeners),i.forEach(r=>r(t))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(t=>t()),this._views.slice().forEach(t=>t.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(t){return zs&&this.warnIfDestroyed(),this._destroyListeners.push(t),()=>dh(this._destroyListeners,t)}destroy(){if(this._destroyed)throw new z(406,!1);const t=this._injector;t.destroy&&!t.destroyed&&t.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){zs&&this._destroyed&&console.warn(Me(406,"This instance of the `ApplicationRef` has already been destroyed."))}}return n.\u0275fac=function(t){return new(t||n)(sn(Si),sn(Zo),sn(cc))},n.\u0275prov=Wt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function dh(n,e){const t=n.indexOf(e);t>-1&&n.splice(t,1)}let Hs=(()=>{class n{}return n.__NG_ELEMENT_ID__=ZF,n})();function ZF(n){return function XF(n,e,t){if($l(n)&&!t){const i=Qi(n.index,e);return new uu(i,i)}return 47&n.type?new uu(e[Ai],e):null}(Mi(),le(),16==(16&n))}class VE{constructor(e){this.nativeNode=e}get parent(){const e=this.nativeNode.parentNode;return e?new fh(e):null}get injector(){return function kS(n){const e=tr(n),t=e?e.lView:null;return null===t?Xo.NULL:new Ka(t[Le].data[e.nodeIndex],t)}(this.nativeNode)}get componentInstance(){const e=this.nativeNode;return e&&(vy(e)||function OS(n){const e=tr(n);let i,t=e?e.lView:null;if(null===t)return null;for(;2===t[Le].type&&(i=ru(t));)t=i;return 256&t[Ct]?null:t[jn]}(e))}get context(){return vy(this.nativeNode)||function NS(n){!function L2(n){if(typeof Element<"u"&&!(n instanceof Element))throw new Error("Expecting instance of DOM Element")}(n);const e=tr(n),t=e?e.lView:null;return null===t?null:t[jn]}(this.nativeNode)}get listeners(){return function US(n){const e=tr(n),t=null===e?null:e.lView;if(null===t)return[];const r=t[Wa],s=t[Le].cleanup,o=[];if(s&&r)for(let a=0;a<s.length;){const c=s[a++],l=s[a++];if("string"==typeof c){const u=c,d=wi(t[l]),f=r[s[a++]],h=s[a++];n==d&&o.push({element:n,name:u,callback:f,useCapture:"boolean"==typeof h&&h,type:"boolean"==typeof h||h>=0?"dom":"output"})}}return o.sort(R2),o}(this.nativeNode).filter(e=>"dom"===e.type)}get references(){return function I2(n){const e=tr(n);if(null===e)return{};if(void 0===e.localRefs){const t=e.lView;if(null===t)return{};e.localRefs=function NR(n,e){const t=n[Le].data[e];if(t&&t.localNames){const i={};let r=t.index+1;for(let s=0;s<t.localNames.length;s+=2)i[t.localNames[s]]=n[r],r++;return i}return null}(t,e.nodeIndex)}return e.localRefs||{}}(this.nativeNode)}get providerTokens(){return function D2(n){const e=tr(n),t=e?e.lView:null;if(null===t)return[];const i=t[Le],r=i.data[e.nodeIndex],s=[],a=r.directiveEnd;for(let c=1048575&r.providerIndexes;c<a;c++){let l=i.data[c];P2(l)&&(l=l.type),s.push(l)}return s}(this.nativeNode)}}class fh extends VE{constructor(e){super(e)}get nativeElement(){return this.nativeNode.nodeType==Node.ELEMENT_NODE?this.nativeNode:null}get name(){const e=tr(this.nativeNode),t=e?e.lView:null;return null!==t?t[Le].data[e.nodeIndex].value:this.nativeNode.nodeName}get properties(){const e=tr(this.nativeNode),t=e?e.lView:null;if(null===t)return{};const i=t[Le].data,r=i[e.nodeIndex],s={};return function YF(n,e){if(n){let t=Object.getPrototypeOf(n);const i=Node.prototype;for(;null!==t&&t!==i;){const r=Object.getOwnPropertyDescriptors(t);for(let s in r)if(!s.startsWith("__")&&!s.startsWith("on")){const o=n[s];KF(o)&&(e[s]=o)}t=Object.getPrototypeOf(t)}}}(this.nativeElement,s),function JF(n,e,t,i){let r=e.propertyBindings;if(null!==r)for(let s=0;s<r.length;s++){const o=r[s],c=i[o].split("\ufffd"),l=c[0];if(c.length>1){let u=c[1];for(let d=1;d<c.length-1;d++)u+=Q(t[o+d-1])+c[d+1];n[l]=u}else n[l]=t[o]}}(s,r,t,i),s}get attributes(){const e={},t=this.nativeElement;if(!t)return e;const i=tr(t),r=i?i.lView:null;if(null===r)return{};const s=r[Le].data[i.nodeIndex].attrs,o=[];if(s){let c=0;for(;c<s.length;){const l=s[c];if("string"!=typeof l)break;e[l]=s[c+1],o.push(l.toLowerCase()),c+=2}}const a=t.attributes;for(let c=0;c<a.length;c++){const l=a[c],u=l.name.toLowerCase();-1===o.indexOf(u)&&(e[u]=l.value)}return e}get styles(){return this.nativeElement&&this.nativeElement.style?this.nativeElement.style:{}}get classes(){const e={},i=this.nativeElement.className;return("string"!=typeof i?i.baseVal.split(" "):i.split(" ")).forEach(s=>e[s]=!0),e}get childNodes(){const e=this.nativeNode.childNodes,t=[];for(let i=0;i<e.length;i++)t.push(Ac(e[i]));return t}get children(){const e=this.nativeElement;if(!e)return[];const t=e.children,i=[];for(let r=0;r<t.length;r++)i.push(Ac(t[r]));return i}query(e){return this.queryAll(e)[0]||null}queryAll(e){const t=[];return zE(this,e,t,!0),t}queryAllNodes(e){const t=[];return zE(this,e,t,!1),t}triggerEventHandler(e,t){const i=this.nativeNode,r=[];this.listeners.forEach(s=>{if(s.name===e){const o=s.callback;o.call(i,t),r.push(o)}}),"function"==typeof i.eventListeners&&i.eventListeners(e).forEach(s=>{if(-1!==s.toString().indexOf("__ngUnwrap__")){const o=s("__ngUnwrap__");return-1===r.indexOf(o)&&o.call(i,t)}})}}function KF(n){return"string"==typeof n||"boolean"==typeof n||"number"==typeof n||null===n}function zE(n,e,t,i){const r=tr(n.nativeNode),s=r?r.lView:null;null!==s?Qo(s[Le].data[r.nodeIndex],s,e,t,i,n.nativeNode):Wy(n.nativeNode,e,t,i)}function Qo(n,e,t,i,r,s){const o=function bI(n,e){const t=null===n?-1:n.index;return-1!==t?wi(e[t]):null}(n,e);if(11&n.type){if(Gy(o,t,i,r,s),$l(n)){const c=Qi(n.index,e);c&&c[Le].firstChild&&Qo(c[Le].firstChild,c,t,i,r,s)}else n.child&&Qo(n.child,e,t,i,r,s),o&&Wy(o,t,i,r);const a=e[n.index];zr(a)&&HE(a,t,i,r,s)}else if(4&n.type){const a=e[n.index];Gy(a[uf],t,i,r,s),HE(a,t,i,r,s)}else if(16&n.type){const a=e[Ai],l=a[Ci].projection[n.projection];if(Array.isArray(l))for(let u of l)Gy(u,t,i,r,s);else if(l){const u=a[Vn];Qo(u[Le].data[l.index],u,t,i,r,s)}}else n.child&&Qo(n.child,e,t,i,r,s);if(s!==o){const a=2&n.flags?n.projectionNext:n.next;a&&Qo(a,e,t,i,r,s)}}function HE(n,e,t,i,r){for(let s=Bi;s<n.length;s++){const o=n[s],a=o[Le].firstChild;a&&Qo(a,o,e,t,i,r)}}function Gy(n,e,t,i,r){if(r!==n){const s=Ac(n);if(!s)return;(i&&s instanceof fh&&e(s)&&-1===t.indexOf(s)||!i&&e(s)&&-1===t.indexOf(s))&&t.push(s)}}function Wy(n,e,t,i){const r=n.childNodes,s=r.length;for(let o=0;o<s;o++){const a=r[o],c=Ac(a);c&&((i&&c instanceof fh&&e(c)&&-1===t.indexOf(c)||!i&&e(c)&&-1===t.indexOf(c))&&t.push(c),Wy(a,e,t,i))}}const $y="__ng_debug__";function Ac(n){return n instanceof Node?(n.hasOwnProperty($y)||(n[$y]=n.nodeType==Node.ELEMENT_NODE?new fh(n):new VE(n)),n[$y]):null}let qy=null;function ph(){return qy}class l3{}const Dr=new Mt("DocumentToken");let cT=(()=>{class n{constructor(t,i){this._viewContainer=t,this._context=new ek,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=i}set ngIf(t){this._context.$implicit=this._context.ngIf=t,this._updateView()}set ngIfThen(t){lT("ngIfThen",t),this._thenTemplateRef=t,this._thenViewRef=null,this._updateView()}set ngIfElse(t){lT("ngIfElse",t),this._elseTemplateRef=t,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(t,i){return!0}}return n.\u0275fac=function(t){return new(t||n)(yt(Gi),yt($r))},n.\u0275dir=bi({type:n,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0}),n})();class ek{constructor(){this.$implicit=null,this.ngIf=null}}function lT(n,e){if(e&&!e.createEmbeddedView)throw new Error(`${n} must be a TemplateRef, but received '${it(e)}'.`)}class nB extends l3{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class u_ extends nB{static makeCurrent(){!function c3(n){qy||(qy=n)}(new u_)}onAndCancel(e,t,i){return e.addEventListener(t,i,!1),()=>{e.removeEventListener(t,i,!1)}}dispatchEvent(e,t){e.dispatchEvent(t)}remove(e){e.parentNode&&e.parentNode.removeChild(e)}createElement(e,t){return(t=t||this.getDefaultDocument()).createElement(e)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}isShadowRoot(e){return e instanceof DocumentFragment}getGlobalEventTarget(e,t){return"window"===t?window:"document"===t?e:"body"===t?e.body:null}getBaseHref(e){const t=function iB(){return Pu=Pu||document.querySelector("base"),Pu?Pu.getAttribute("href"):null}();return null==t?null:function rB(n){Th=Th||document.createElement("a"),Th.setAttribute("href",n);const e=Th.pathname;return"/"===e.charAt(0)?e:`/${e}`}(t)}resetBaseElement(){Pu=null}getUserAgent(){return window.navigator.userAgent}getCookie(e){return function Z3(n,e){e=encodeURIComponent(e);for(const t of n.split(";")){const i=t.indexOf("="),[r,s]=-1==i?[t,""]:[t.slice(0,i),t.slice(i+1)];if(r.trim()===e)return decodeURIComponent(s)}return null}(document.cookie,e)}}let Th,Pu=null,cB=(()=>{class n{build(){return new XMLHttpRequest}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Wt({token:n,factory:n.\u0275fac}),n})();const Dh=new Mt("EventManagerPlugins");let Ch=(()=>{class n{constructor(t,i){this._zone=i,this._eventNameToPlugin=new Map,t.forEach(r=>{r.manager=this}),this._plugins=t.slice().reverse()}addEventListener(t,i,r){return this._findPluginFor(i).addEventListener(t,i,r)}addGlobalEventListener(t,i,r){return this._findPluginFor(i).addGlobalEventListener(t,i,r)}getZone(){return this._zone}_findPluginFor(t){const i=this._eventNameToPlugin.get(t);if(i)return i;const r=this._plugins;for(let s=0;s<r.length;s++){const o=r[s];if(o.supports(t))return this._eventNameToPlugin.set(t,o),o}throw new Error(`No event manager plugin found for event ${t}`)}}return n.\u0275fac=function(t){return new(t||n)(sn(Dh),sn(Si))},n.\u0275prov=Wt({token:n,factory:n.\u0275fac}),n})();class _T{constructor(e){this._doc=e}addGlobalEventListener(e,t,i){const r=ph().getGlobalEventTarget(this._doc,e);if(!r)throw new Error(`Unsupported event target ${r} for event ${t}`);return this.addEventListener(r,t,i)}}let vT=(()=>{class n{constructor(){this.usageCount=new Map}addStyles(t){for(const i of t)1===this.changeUsageCount(i,1)&&this.onStyleAdded(i)}removeStyles(t){for(const i of t)0===this.changeUsageCount(i,-1)&&this.onStyleRemoved(i)}onStyleRemoved(t){}onStyleAdded(t){}getAllStyles(){return this.usageCount.keys()}changeUsageCount(t,i){const r=this.usageCount;let s=r.get(t)??0;return s+=i,s>0?r.set(t,s):r.delete(t),s}ngOnDestroy(){for(const t of this.getAllStyles())this.onStyleRemoved(t);this.usageCount.clear()}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Wt({token:n,factory:n.\u0275fac}),n})(),Lu=(()=>{class n extends vT{constructor(t){super(),this.doc=t,this.styleRef=new Map,this.hostNodes=new Set,this.resetHostNodes()}onStyleAdded(t){for(const i of this.hostNodes)this.addStyleToHost(i,t)}onStyleRemoved(t){const i=this.styleRef;i.get(t)?.forEach(s=>s.remove()),i.delete(t)}ngOnDestroy(){super.ngOnDestroy(),this.styleRef.clear(),this.resetHostNodes()}addHost(t){this.hostNodes.add(t);for(const i of this.getAllStyles())this.addStyleToHost(t,i)}removeHost(t){this.hostNodes.delete(t)}addStyleToHost(t,i){const r=this.doc.createElement("style");r.textContent=i,t.appendChild(r);const s=this.styleRef.get(i);s?s.push(r):this.styleRef.set(i,[r])}resetHostNodes(){const t=this.hostNodes;t.clear(),t.add(this.doc.head)}}return n.\u0275fac=function(t){return new(t||n)(sn(Dr))},n.\u0275prov=Wt({token:n,factory:n.\u0275fac}),n})();const d_={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},f_=/%COMP%/g,wT=new Mt("RemoveStylesOnCompDestory",{providedIn:"root",factory:()=>!1});function MT(n,e){return e.flat(100).map(t=>t.replace(f_,n))}function ST(n){return e=>{if("__ngUnwrap__"===e)return n;!1===n(e)&&(e.preventDefault(),e.returnValue=!1)}}let h_=(()=>{class n{constructor(t,i,r,s){this.eventManager=t,this.sharedStylesHost=i,this.appId=r,this.removeStylesOnCompDestory=s,this.rendererByCompId=new Map,this.defaultRenderer=new p_(t)}createRenderer(t,i){if(!t||!i)return this.defaultRenderer;const r=this.getOrCreateRenderer(t,i);return r instanceof DT?r.applyToHost(t):r instanceof m_&&r.applyStyles(),r}getOrCreateRenderer(t,i){const r=this.rendererByCompId;let s=r.get(i.id);if(!s){const o=this.eventManager,a=this.sharedStylesHost,c=this.removeStylesOnCompDestory;switch(i.encapsulation){case fs.Emulated:s=new DT(o,a,i,this.appId,c);break;case fs.ShadowDom:return new mB(o,a,t,i);default:s=new m_(o,a,i,c)}s.onDestroy=()=>r.delete(i.id),r.set(i.id,s)}return s}ngOnDestroy(){this.rendererByCompId.clear()}begin(){}end(){}}return n.\u0275fac=function(t){return new(t||n)(sn(Ch),sn(Lu),sn(Py),sn(wT))},n.\u0275prov=Wt({token:n,factory:n.\u0275fac}),n})();class p_{constructor(e){this.eventManager=e,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(e,t){return t?document.createElementNS(d_[t]||t,e):document.createElement(e)}createComment(e){return document.createComment(e)}createText(e){return document.createTextNode(e)}appendChild(e,t){(TT(e)?e.content:e).appendChild(t)}insertBefore(e,t,i){e&&(TT(e)?e.content:e).insertBefore(t,i)}removeChild(e,t){e&&e.removeChild(t)}selectRootElement(e,t){let i="string"==typeof e?document.querySelector(e):e;if(!i)throw new Error(`The selector "${e}" did not match any elements`);return t||(i.textContent=""),i}parentNode(e){return e.parentNode}nextSibling(e){return e.nextSibling}setAttribute(e,t,i,r){if(r){t=r+":"+t;const s=d_[r];s?e.setAttributeNS(s,t,i):e.setAttribute(t,i)}else e.setAttribute(t,i)}removeAttribute(e,t,i){if(i){const r=d_[i];r?e.removeAttributeNS(r,t):e.removeAttribute(`${i}:${t}`)}else e.removeAttribute(t)}addClass(e,t){e.classList.add(t)}removeClass(e,t){e.classList.remove(t)}setStyle(e,t,i,r){r&(er.DashCase|er.Important)?e.style.setProperty(t,i,r&er.Important?"important":""):e.style[t]=i}removeStyle(e,t,i){i&er.DashCase?e.style.removeProperty(t):e.style[t]=""}setProperty(e,t,i){e[t]=i}setValue(e,t){e.nodeValue=t}listen(e,t,i){return"string"==typeof e?this.eventManager.addGlobalEventListener(e,t,ST(i)):this.eventManager.addEventListener(e,t,ST(i))}}function TT(n){return"TEMPLATE"===n.tagName&&void 0!==n.content}class mB extends p_{constructor(e,t,i,r){super(e),this.sharedStylesHost=t,this.hostEl=i,this.shadowRoot=i.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const s=MT(r.id,r.styles);for(const o of s){const a=document.createElement("style");a.textContent=o,this.shadowRoot.appendChild(a)}}nodeOrShadowRoot(e){return e===this.hostEl?this.shadowRoot:e}appendChild(e,t){return super.appendChild(this.nodeOrShadowRoot(e),t)}insertBefore(e,t,i){return super.insertBefore(this.nodeOrShadowRoot(e),t,i)}removeChild(e,t){return super.removeChild(this.nodeOrShadowRoot(e),t)}parentNode(e){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(e)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}}class m_ extends p_{constructor(e,t,i,r,s=i.id){super(e),this.sharedStylesHost=t,this.removeStylesOnCompDestory=r,this.rendererUsageCount=0,this.styles=MT(s,i.styles)}applyStyles(){this.sharedStylesHost.addStyles(this.styles),this.rendererUsageCount++}destroy(){this.removeStylesOnCompDestory&&(this.sharedStylesHost.removeStyles(this.styles),this.rendererUsageCount--,0===this.rendererUsageCount&&this.onDestroy?.())}}class DT extends m_{constructor(e,t,i,r,s){const o=r+"-"+i.id;super(e,t,i,s,o),this.contentAttr=function fB(n){return"_ngcontent-%COMP%".replace(f_,n)}(o),this.hostAttr=function hB(n){return"_nghost-%COMP%".replace(f_,n)}(o)}applyToHost(e){this.applyStyles(),this.setAttribute(e,this.hostAttr,"")}createElement(e,t){const i=super.createElement(e,t);return super.setAttribute(i,this.contentAttr,""),i}}const CT=["alt","control","meta","shift"],yB={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},_B={alt:n=>n.altKey,control:n=>n.ctrlKey,meta:n=>n.metaKey,shift:n=>n.shiftKey};function IT(n){return{appProviders:[...DB,...n?.providers??[]],platformProviders:SB}}const SB=[{provide:SE,useValue:"browser"},{provide:ME,useValue:function bB(){u_.makeCurrent()},multi:!0},{provide:Dr,useFactory:function MB(){return function nP(n){yg=n}(document),document},deps:[]}],DB=[{provide:Tg,useValue:"root"},{provide:cc,useFactory:function wB(){return new cc},deps:[]},{provide:Dh,useClass:(()=>{class n extends _T{constructor(t){super(t)}supports(t){return!0}addEventListener(t,i,r){return t.addEventListener(i,r,!1),()=>this.removeEventListener(t,i,r)}removeEventListener(t,i,r){return t.removeEventListener(i,r)}}return n.\u0275fac=function(t){return new(t||n)(sn(Dr))},n.\u0275prov=Wt({token:n,factory:n.\u0275fac}),n})(),multi:!0,deps:[Dr,Si,SE]},{provide:Dh,useClass:(()=>{class n extends _T{constructor(t){super(t)}supports(t){return null!=n.parseEventName(t)}addEventListener(t,i,r){const s=n.parseEventName(i),o=n.eventCallback(s.fullKey,r,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>ph().onAndCancel(t,s.domEventName,o))}static parseEventName(t){const i=t.toLowerCase().split("."),r=i.shift();if(0===i.length||"keydown"!==r&&"keyup"!==r)return null;const s=n._normalizeKey(i.pop());let o="",a=i.indexOf("code");if(a>-1&&(i.splice(a,1),o="code."),CT.forEach(l=>{const u=i.indexOf(l);u>-1&&(i.splice(u,1),o+=l+".")}),o+=s,0!=i.length||0===s.length)return null;const c={};return c.domEventName=r,c.fullKey=o,c}static matchEventFullKeyCode(t,i){let r=yB[t.key]||t.key,s="";return i.indexOf("code.")>-1&&(r=t.code,s="code."),!(null==r||!r)&&(r=r.toLowerCase()," "===r?r="space":"."===r&&(r="dot"),CT.forEach(o=>{o!==r&&(0,_B[o])(t)&&(s+=o+".")}),s+=r,s===i)}static eventCallback(t,i,r){return s=>{n.matchEventFullKeyCode(s,t)&&r.runGuarded(()=>i(s))}}static _normalizeKey(t){return"esc"===t?"escape":t}}return n.\u0275fac=function(t){return new(t||n)(sn(Dr))},n.\u0275prov=Wt({token:n,factory:n.\u0275fac}),n})(),multi:!0,deps:[Dr]},{provide:h_,useClass:h_,deps:[Ch,Lu,Py,wT]},{provide:Bf,useExisting:h_},{provide:vT,useExisting:Lu},{provide:Lu,useClass:Lu,deps:[Dr]},{provide:Ch,useClass:Ch,deps:[Dh,Si]},{provide:class Ak{},useClass:cB,deps:[]},[]];typeof window<"u"&&window;const y_={now:()=>(y_.delegate||Date).now(),delegate:void 0};class Ic extends Yi{constructor(e=1/0,t=1/0,i=y_){super(),this._bufferSize=e,this._windowTime=t,this._timestampProvider=i,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=t===1/0,this._bufferSize=Math.max(1,e),this._windowTime=Math.max(1,t)}next(e){const{isStopped:t,_buffer:i,_infiniteTimeWindow:r,_timestampProvider:s,_windowTime:o}=this;t||(i.push(e),!r&&i.push(s.now()+o)),this._trimBuffer(),super.next(e)}_subscribe(e){this._throwIfClosed(),this._trimBuffer();const t=this._innerSubscribe(e),{_infiniteTimeWindow:i,_buffer:r}=this,s=r.slice();for(let o=0;o<s.length&&!e.closed;o+=i?1:2)e.next(s[o]);return this._checkFinalizedStatuses(e),t}_trimBuffer(){const{_bufferSize:e,_timestampProvider:t,_buffer:i,_infiniteTimeWindow:r}=this,s=(r?1:2)*e;if(e<1/0&&s<i.length&&i.splice(0,i.length-s),!r){const o=t.now();let a=0;for(let c=1;c<i.length&&i[c]<=o;c+=2)a=c;a&&i.splice(0,a+1)}}}class OB extends Rn{constructor(e,t){super()}schedule(e,t=0){return this}}const Ah={setInterval(n,e,...t){const{delegate:i}=Ah;return i?.setInterval?i.setInterval(n,e,...t):setInterval(n,e,...t)},clearInterval(n){const{delegate:e}=Ah;return(e?.clearInterval||clearInterval)(n)},delegate:void 0};class LT extends OB{constructor(e,t){super(e,t),this.scheduler=e,this.work=t,this.pending=!1}schedule(e,t=0){var i;if(this.closed)return this;this.state=e;const r=this.id,s=this.scheduler;return null!=r&&(this.id=this.recycleAsyncId(s,r,t)),this.pending=!0,this.delay=t,this.id=null!==(i=this.id)&&void 0!==i?i:this.requestAsyncId(s,this.id,t),this}requestAsyncId(e,t,i=0){return Ah.setInterval(e.flush.bind(e,this),i)}recycleAsyncId(e,t,i=0){if(null!=i&&this.delay===i&&!1===this.pending)return t;null!=t&&Ah.clearInterval(t)}execute(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const i=this._execute(e,t);if(i)return i;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(e,t){let r,i=!1;try{this.work(e)}catch(s){i=!0,r=s||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),r}unsubscribe(){if(!this.closed){const{id:e,scheduler:t}=this,{actions:i}=t;this.work=this.state=this.scheduler=null,this.pending=!1,ls(i,this),null!=e&&(this.id=this.recycleAsyncId(t,e,null)),this.delay=null,super.unsubscribe()}}}class Nu{constructor(e,t=Nu.now){this.schedulerActionCtor=e,this.now=t}schedule(e,t=0,i){return new this.schedulerActionCtor(this,e).schedule(i,t)}}Nu.now=y_.now;class NT extends Nu{constructor(e,t=Nu.now){super(e,t),this.actions=[],this._active=!1}flush(e){const{actions:t}=this;if(this._active)return void t.push(e);let i;this._active=!0;do{if(i=e.execute(e.state,e.delay))break}while(e=t.shift());if(this._active=!1,i){for(;e=t.shift();)e.unsubscribe();throw i}}}const OT=new NT(LT),FB=OT;function FT(n,e=OT){return xn((t,i)=>{let r=null,s=null,o=null;const a=()=>{if(r){r.unsubscribe(),r=null;const l=s;s=null,i.next(l)}};function c(){const l=o+n,u=e.now();if(u<l)return r=this.schedule(void 0,l-u),void i.add(r);a()}t.subscribe(mn(i,l=>{s=l,o=e.now(),r||(r=e.schedule(c,n),i.add(r))},()=>{a(),i.complete()},void 0,()=>{s=r=null}))})}function Ih(n){return xn((e,t)=>{pi(n).subscribe(mn(t,()=>t.complete(),Fi)),!t.closed&&e.subscribe(t)})}const{isArray:kB}=Array;function __(n){return bn(e=>function BB(n,e){return kB(e)?n(...e):n(e)}(n,e))}const UB=["addListener","removeListener"],VB=["addEventListener","removeEventListener"],zB=["on","off"];function Ou(n,e,t,i){if(bt(t)&&(i=t,t=void 0),i)return Ou(n,e,t).pipe(__(i));const[r,s]=function WB(n){return bt(n.addEventListener)&&bt(n.removeEventListener)}(n)?VB.map(o=>a=>n[o](e,a,t)):function HB(n){return bt(n.addListener)&&bt(n.removeListener)}(n)?UB.map(kT(n,e)):function GB(n){return bt(n.on)&&bt(n.off)}(n)?zB.map(kT(n,e)):[];if(!r&&Ll(n))return Be(o=>Ou(o,e,t))(pi(n));if(!r)throw new TypeError("Invalid event target");return new hn(o=>{const a=(...c)=>o.next(1<c.length?c:c[0]);return r(a),()=>s(a)})}function kT(n,e){return t=>i=>n[t](e,i)}const BT={box:"content-box",scroll:!1,offsetSize:!1,debounce:{scroll:50,resize:0},emitInZone:!0,emitInitialResult:!1},v_=new Mt("NgxResizeOptions",{factory:()=>BT});function jB(n={}){return{provide:v_,useValue:{...BT,...n}}}let $B=(()=>{class n{constructor(t,i,r,s){this.host=t,this.zone=i,this.document=r,this.resizeOptions=s,this.ngxResizeOptions={},this.ngxResize=new Hi}ngOnInit(){const t={...this.resizeOptions,...this.ngxResizeOptions};this.sub=function UT({debounce:n,scroll:e,offsetSize:t,box:i,emitInZone:r,emitInitialResult:s},o,a,c){const l=a.defaultView,u=!!l?.ResizeObserver;let d,f,h=[];const m=new Ic,p=zT(o,l,a.body),g=n?"number"==typeof n?n:n.scroll:null,_=n?"number"==typeof n?n:n.resize:null,v=y=>function Gd(...n){return Xi(n)}(FT(y??0),Ih(m));return new hn(y=>{if(u){if(s){const[x]=VT(o,l,t,[]);y.next(x)}return c.runOutsideAngular(()=>{const x=M=>{h=M;const[A,b]=VT(o,l,t,M);r?c.run(()=>{y.next(A)}):y.next(A),ZB(f||{},b)||(f=b)},w=()=>{x(h)};d=new ResizeObserver(x),d.observe(o,{box:i}),e&&(p&&p.forEach(M=>{Ou(M,"scroll",{capture:!0,passive:!0}).pipe(v(g)).subscribe(w)}),Ou(l,"scroll",{capture:!0,passive:!0}).pipe(v(g)).subscribe(w)),Ou(l,"resize").pipe(v(_)).subscribe(w)}),()=>{d&&(d.unobserve(o),d.disconnect()),m.next(),m.complete()}}y.error("[ngx-resize] your browser does not support ResizeObserver. Please consider using a polyfill")}).pipe(FT(g??0),nt({connector:()=>new Ic(1)}))}(t,this.host.nativeElement,this.document,this.zone).subscribe(this.ngxResize)}ngOnDestroy(){this.sub?.unsubscribe()}}return n.\u0275fac=function(t){return new(t||n)(yt(gs),yt(Si),yt(Dr),yt(v_))},n.\u0275dir=bi({type:n,selectors:[["","ngxResize",""]],inputs:{ngxResizeOptions:"ngxResizeOptions"},outputs:{ngxResize:"ngxResize"},standalone:!0}),n})();function VT(n,e,t,i){const{left:r,top:s,width:o,height:a,bottom:c,right:l,x:u,y:d}=n.getBoundingClientRect(),f={left:r,top:s,width:o,height:a,bottom:c,right:l,x:u,y:d};return n instanceof HTMLElement&&t&&(f.height=n.offsetHeight,f.width=n.offsetWidth),Object.freeze(f),[{entries:i,dpr:e.devicePixelRatio,...f},f]}function zT(n,e,t){const i=[];if(!n||!e||n===t)return i;const{overflow:r,overflowX:s,overflowY:o}=e.getComputedStyle(n);return[r,s,o].some(a=>"auto"===a||"scroll"===a)&&i.push(n),[...i,...zT(n.parentElement,e,t)]}const qB=["x","y","top","bottom","left","right","width","height"],ZB=(n,e)=>qB.every(t=>n[t]===e[t]);function ea(n){return!!n&&(n instanceof hn||bt(n.lift)&&bt(n.subscribe))}function x_(...n){return Xe(n,zt(n))}function Fu(n,e,t){const i=bt(n)||e||t?{next:n,error:e,complete:t}:n;return i?xn((r,s)=>{var o;null===(o=i.subscribe)||void 0===o||o.call(i);let a=!0;r.subscribe(mn(s,c=>{var l;null===(l=i.next)||void 0===l||l.call(i,c),s.next(c)},()=>{var c;a=!1,null===(c=i.complete)||void 0===c||c.call(i),s.complete()},c=>{var l;a=!1,null===(l=i.error)||void 0===l||l.call(i,c),s.error(c)},()=>{var c,l;a&&(null===(c=i.unsubscribe)||void 0===c||c.call(i)),null===(l=i.finalize)||void 0===l||l.call(i)}))}):kr}function Rh(n){return xn((e,t)=>{let s,i=null,r=!1;i=e.subscribe(mn(t,void 0,void 0,o=>{s=pi(n(o,Rh(n)(e))),i?(i.unsubscribe(),i=null,s.subscribe(t)):r=!0})),r&&(i.unsubscribe(),i=null,s.subscribe(t))})}function HT(n,e){return xn((t,i)=>{let r=null,s=0,o=!1;const a=()=>o&&!r&&i.complete();t.subscribe(mn(i,c=>{r?.unsubscribe();let l=0;const u=s++;pi(n(c,u)).subscribe(r=mn(i,d=>i.next(e?e(c,d,u,l++):d),()=>{r=null,a()}))},()=>{o=!0,a()}))})}const{isArray:JB}=Array,{getPrototypeOf:QB,prototype:eU,keys:tU}=Object;function GT(n){if(1===n.length){const e=n[0];if(JB(e))return{args:e,keys:null};if(function nU(n){return n&&"object"==typeof n&&QB(n)===eU}(e)){const t=tU(e);return{args:t.map(i=>e[i]),keys:t}}}return{args:n,keys:null}}function WT(n,e){return n.reduce((t,i,r)=>(t[i]=e[r],t),{})}class Ph extends Yi{constructor(e){super(),this._value=e}get value(){return this.getValue()}_subscribe(e){const t=super._subscribe(e);return!t.closed&&e.next(this._value),t}getValue(){const{hasError:e,thrownError:t,_value:i}=this;if(e)throw t;return this._throwIfClosed(),i}next(e){super.next(this._value=e)}}function jT(n,e,t){n?ye(t,n,e):e()}function $T(...n){return function aU(){return Te(1)}()(Xe(n,zt(n)))}function qT(...n){const e=zt(n);return xn((t,i)=>{(e?$T(n,t,e):$T(n,t)).subscribe(i)})}function Rc(n,e=kr){return n=n??cU,xn((t,i)=>{let r,s=!0;t.subscribe(mn(i,o=>{const a=e(o);(s||!n(r,a))&&(s=!1,r=a,i.next(o))}))})}function cU(n,e){return n===e}function Pc(n,e){return xn((t,i)=>{let r=0;t.subscribe(mn(i,s=>n.call(e,s,r++)&&i.next(s)))})}function ZT(n,e,t,i,r,s,o){try{var a=n[s](o),c=a.value}catch(l){return void t(l)}a.done?e(c):Promise.resolve(c).then(i,r)}function ku(n){return function(){var e=this,t=arguments;return new Promise(function(i,r){var s=n.apply(e,t);function o(c){ZT(s,i,r,o,a,"next",c)}function a(c){ZT(s,i,r,o,a,"throw",c)}o(void 0)})}}const Lh="149",lU={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},uU={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},XT=0,b_=1,YT=2,dU=3,fU=0,w_=1,M_=2,Lc=3,bs=0,ir=1,ws=2,hU=2,Ws=0,ta=1,S_=2,E_=3,T_=4,KT=5,na=100,JT=101,QT=102,D_=103,C_=104,eD=200,tD=201,nD=202,iD=203,A_=204,I_=205,rD=206,sD=207,oD=208,aD=209,cD=210,lD=0,uD=1,dD=2,Nh=3,fD=4,hD=5,pD=6,mD=7,Bu=0,gD=1,yD=2,Yr=0,_D=1,vD=2,xD=3,R_=4,bD=5,Oh=300,yo=301,_o=302,Uu=303,Vu=304,Nc=306,vo=1e3,Ei=1001,Oc=1002,Hn=1003,zu=1004,pU=1004,Fc=1005,mU=1005,Fn=1006,Fh=1007,gU=1007,Ms=1008,yU=1008,xo=1009,wD=1010,MD=1011,P_=1012,SD=1013,bo=1014,js=1015,kc=1016,ED=1017,TD=1018,ia=1020,DD=1021,dr=1023,CD=1024,AD=1025,wo=1026,ra=1027,ID=1028,RD=1029,PD=1030,LD=1031,ND=1033,kh=33776,Bh=33777,Uh=33778,Vh=33779,L_=35840,N_=35841,O_=35842,F_=35843,OD=36196,k_=37492,B_=37496,U_=37808,V_=37809,z_=37810,H_=37811,G_=37812,W_=37813,j_=37814,$_=37815,q_=37816,Z_=37817,X_=37818,Y_=37819,K_=37820,J_=37821,zh=36492,FD=36283,Q_=36284,ev=36285,tv=36286,kD=2200,BD=2201,UD=2202,Bc=2300,sa=2301,Hh=2302,oa=2400,aa=2401,Hu=2402,Gh=2500,nv=2501,VD=0,iv=1,Wh=2,$s=3e3,Qt=3001,zD=3200,HD=3201,Mo=0,GD=1,_U="",Kr="srgb",Uc="srgb-linear",vU=0,jh=7680,xU=7681,bU=7682,wU=7683,MU=34055,SU=34056,EU=5386,TU=512,DU=513,CU=514,AU=515,IU=516,RU=517,PU=518,WD=519,Gu=35044,LU=35048,NU=35040,OU=35045,FU=35049,kU=35041,BU=35046,UU=35050,VU=35042,zU="100",rv="300 es",$h=1035;class qs{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const i=this._listeners;void 0===i[e]&&(i[e]=[]),-1===i[e].indexOf(t)&&i[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const i=this._listeners;return void 0!==i[e]&&-1!==i[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;const r=this._listeners[e];if(void 0!==r){const s=r.indexOf(t);-1!==s&&r.splice(s,1)}}dispatchEvent(e){if(void 0===this._listeners)return;const i=this._listeners[e.type];if(void 0!==i){e.target=this;const r=i.slice(0);for(let s=0,o=r.length;s<o;s++)r[s].call(this,e);e.target=null}}}const Pi=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let jD=1234567;const ca=Math.PI/180,Wu=180/Math.PI;function fr(){const n=4294967295*Math.random()|0,e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(Pi[255&n]+Pi[n>>8&255]+Pi[n>>16&255]+Pi[n>>24&255]+"-"+Pi[255&e]+Pi[e>>8&255]+"-"+Pi[e>>16&15|64]+Pi[e>>24&255]+"-"+Pi[63&t|128]+Pi[t>>8&255]+"-"+Pi[t>>16&255]+Pi[t>>24&255]+Pi[255&i]+Pi[i>>8&255]+Pi[i>>16&255]+Pi[i>>24&255]).toLowerCase()}function Zn(n,e,t){return Math.max(e,Math.min(t,n))}function sv(n,e){return(n%e+e)%e}function ju(n,e,t){return(1-t)*n+t*e}function ov(n){return 0==(n&n-1)&&0!==n}function $D(n){return Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function qh(n){return Math.pow(2,Math.floor(Math.log(n)/Math.LN2))}function Zs(n,e){switch(e.constructor){case Float32Array:return n;case Uint16Array:return n/65535;case Uint8Array:return n/255;case Int16Array:return Math.max(n/32767,-1);case Int8Array:return Math.max(n/127,-1);default:throw new Error("Invalid component type.")}}function yn(n,e){switch(e.constructor){case Float32Array:return n;case Uint16Array:return Math.round(65535*n);case Uint8Array:return Math.round(255*n);case Int16Array:return Math.round(32767*n);case Int8Array:return Math.round(127*n);default:throw new Error("Invalid component type.")}}var av=Object.freeze({__proto__:null,DEG2RAD:ca,RAD2DEG:Wu,ceilPowerOfTwo:$D,clamp:Zn,damp:function WU(n,e,t,i){return ju(n,e,1-Math.exp(-t*i))},degToRad:function JU(n){return n*ca},denormalize:Zs,euclideanModulo:sv,floorPowerOfTwo:qh,generateUUID:fr,inverseLerp:function GU(n,e,t){return n!==e?(t-n)/(e-n):0},isPowerOfTwo:ov,lerp:ju,mapLinear:function HU(n,e,t,i,r){return i+(n-e)*(r-i)/(t-e)},normalize:yn,pingpong:function jU(n,e=1){return e-Math.abs(sv(n,2*e)-e)},radToDeg:function QU(n){return n*Wu},randFloat:function XU(n,e){return n+Math.random()*(e-n)},randFloatSpread:function YU(n){return n*(.5-Math.random())},randInt:function ZU(n,e){return n+Math.floor(Math.random()*(e-n+1))},seededRandom:function KU(n){void 0!==n&&(jD=n);let e=jD+=1831565813;return e=Math.imul(e^e>>>15,1|e),e^=e+Math.imul(e^e>>>7,61|e),((e^e>>>14)>>>0)/4294967296},setQuaternionFromProperEuler:function eV(n,e,t,i,r){const s=Math.cos,o=Math.sin,a=s(t/2),c=o(t/2),l=s((e+i)/2),u=o((e+i)/2),d=s((e-i)/2),f=o((e-i)/2),h=s((i-e)/2),m=o((i-e)/2);switch(r){case"XYX":n.set(a*u,c*d,c*f,a*l);break;case"YZY":n.set(c*f,a*u,c*d,a*l);break;case"ZXZ":n.set(c*d,c*f,a*u,a*l);break;case"XZX":n.set(a*u,c*m,c*h,a*l);break;case"YXY":n.set(c*h,a*u,c*m,a*l);break;case"ZYZ":n.set(c*m,c*h,a*u,a*l);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}},smootherstep:function qU(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e))*n*n*(n*(6*n-15)+10)},smoothstep:function $U(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e))*n*(3-2*n)}});class ce{constructor(e=0,t=0){ce.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,i=this.y,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6],this.y=r[1]*t+r[4]*i+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const i=Math.cos(t),r=Math.sin(t),s=this.x-e.x,o=this.y-e.y;return this.x=s*i-o*r+e.x,this.y=s*r+o*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class ji{constructor(){ji.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(e,t,i,r,s,o,a,c,l){const u=this.elements;return u[0]=e,u[1]=r,u[2]=a,u[3]=t,u[4]=s,u[5]=c,u[6]=i,u[7]=o,u[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,r=t.elements,s=this.elements,o=i[0],a=i[3],c=i[6],l=i[1],u=i[4],d=i[7],f=i[2],h=i[5],m=i[8],p=r[0],g=r[3],_=r[6],v=r[1],y=r[4],x=r[7],w=r[2],M=r[5],A=r[8];return s[0]=o*p+a*v+c*w,s[3]=o*g+a*y+c*M,s[6]=o*_+a*x+c*A,s[1]=l*p+u*v+d*w,s[4]=l*g+u*y+d*M,s[7]=l*_+u*x+d*A,s[2]=f*p+h*v+m*w,s[5]=f*g+h*y+m*M,s[8]=f*_+h*x+m*A,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],c=e[6],l=e[7],u=e[8];return t*o*u-t*a*l-i*s*u+i*a*c+r*s*l-r*o*c}invert(){const e=this.elements,t=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],c=e[6],l=e[7],u=e[8],d=u*o-a*l,f=a*c-u*s,h=l*s-o*c,m=t*d+i*f+r*h;if(0===m)return this.set(0,0,0,0,0,0,0,0,0);const p=1/m;return e[0]=d*p,e[1]=(r*l-u*i)*p,e[2]=(a*i-r*o)*p,e[3]=f*p,e[4]=(u*t-r*c)*p,e[5]=(r*s-a*t)*p,e[6]=h*p,e[7]=(i*c-l*t)*p,e[8]=(o*t-i*s)*p,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,r,s,o,a){const c=Math.cos(s),l=Math.sin(s);return this.set(i*c,i*l,-i*(c*o+l*a)+o+e,-r*l,r*c,-r*(-l*o+c*a)+a+t,0,0,1),this}scale(e,t){return this.premultiply(cv.makeScale(e,t)),this}rotate(e){return this.premultiply(cv.makeRotation(-e)),this}translate(e,t){return this.premultiply(cv.makeTranslation(e,t)),this}makeTranslation(e,t){return this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,i,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,i=e.elements;for(let r=0;r<9;r++)if(t[r]!==i[r])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}const cv=new ji;function qD(n){for(let e=n.length-1;e>=0;--e)if(n[e]>=65535)return!0;return!1}const tV={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function Vc(n,e){return new tV[n](e)}function $u(n){return document.createElementNS("http://www.w3.org/1999/xhtml",n)}function la(n){return n<.04045?.0773993808*n:Math.pow(.9478672986*n+.0521327014,2.4)}function Zh(n){return n<.0031308?12.92*n:1.055*Math.pow(n,.41666)-.055}const lv={[Kr]:{[Uc]:la},[Uc]:{[Kr]:Zh}},ei={legacyMode:!0,get workingColorSpace(){return Uc},set workingColorSpace(n){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(n,e,t){if(this.legacyMode||e===t||!e||!t)return n;if(lv[e]&&void 0!==lv[e][t]){const i=lv[e][t];return n.r=i(n.r),n.g=i(n.g),n.b=i(n.b),n}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(n,e){return this.convert(n,this.workingColorSpace,e)},toWorkingColorSpace:function(n,e){return this.convert(n,e,this.workingColorSpace)}},ZD={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},li={r:0,g:0,b:0},Jr={h:0,s:0,l:0},Xh={h:0,s:0,l:0};function uv(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+6*(e-n)*t:t<.5?e:t<2/3?n+6*(e-n)*(2/3-t):n}function Yh(n,e){return e.r=n.r,e.g=n.g,e.b=n.b,e}let zc,De=(()=>{class n{constructor(t,i,r){return this.isColor=!0,this.r=1,this.g=1,this.b=1,void 0===i&&void 0===r?this.set(t):this.setRGB(t,i,r)}set(t){return t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,i=Kr){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,ei.toWorkingColorSpace(this,i),this}setRGB(t,i,r,s=ei.workingColorSpace){return this.r=t,this.g=i,this.b=r,ei.toWorkingColorSpace(this,s),this}setHSL(t,i,r,s=ei.workingColorSpace){if(t=sv(t,1),i=Zn(i,0,1),r=Zn(r,0,1),0===i)this.r=this.g=this.b=r;else{const o=r<=.5?r*(1+i):r+i-r*i,a=2*r-o;this.r=uv(a,o,t+1/3),this.g=uv(a,o,t),this.b=uv(a,o,t-1/3)}return ei.toWorkingColorSpace(this,s),this}setStyle(t,i=Kr){function r(o){void 0!==o&&parseFloat(o)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let s;if(s=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(t)){let o;const c=s[2];switch(s[1]){case"rgb":case"rgba":if(o=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(c))return this.r=Math.min(255,parseInt(o[1],10))/255,this.g=Math.min(255,parseInt(o[2],10))/255,this.b=Math.min(255,parseInt(o[3],10))/255,ei.toWorkingColorSpace(this,i),r(o[4]),this;if(o=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(c))return this.r=Math.min(100,parseInt(o[1],10))/100,this.g=Math.min(100,parseInt(o[2],10))/100,this.b=Math.min(100,parseInt(o[3],10))/100,ei.toWorkingColorSpace(this,i),r(o[4]),this;break;case"hsl":case"hsla":if(o=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(c)){const l=parseFloat(o[1])/360,u=parseFloat(o[2])/100,d=parseFloat(o[3])/100;return r(o[4]),this.setHSL(l,u,d,i)}}}else if(s=/^\#([A-Fa-f\d]+)$/.exec(t)){const o=s[1],a=o.length;if(3===a)return this.r=parseInt(o.charAt(0)+o.charAt(0),16)/255,this.g=parseInt(o.charAt(1)+o.charAt(1),16)/255,this.b=parseInt(o.charAt(2)+o.charAt(2),16)/255,ei.toWorkingColorSpace(this,i),this;if(6===a)return this.r=parseInt(o.charAt(0)+o.charAt(1),16)/255,this.g=parseInt(o.charAt(2)+o.charAt(3),16)/255,this.b=parseInt(o.charAt(4)+o.charAt(5),16)/255,ei.toWorkingColorSpace(this,i),this}return t&&t.length>0?this.setColorName(t,i):this}setColorName(t,i=Kr){const r=ZD[t.toLowerCase()];return void 0!==r?this.setHex(r,i):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=la(t.r),this.g=la(t.g),this.b=la(t.b),this}copyLinearToSRGB(t){return this.r=Zh(t.r),this.g=Zh(t.g),this.b=Zh(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=Kr){return ei.fromWorkingColorSpace(Yh(this,li),t),Zn(255*li.r,0,255)<<16^Zn(255*li.g,0,255)<<8^Zn(255*li.b,0,255)<<0}getHexString(t=Kr){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,i=ei.workingColorSpace){ei.fromWorkingColorSpace(Yh(this,li),i);const r=li.r,s=li.g,o=li.b,a=Math.max(r,s,o),c=Math.min(r,s,o);let l,u;const d=(c+a)/2;if(c===a)l=0,u=0;else{const f=a-c;switch(u=d<=.5?f/(a+c):f/(2-a-c),a){case r:l=(s-o)/f+(s<o?6:0);break;case s:l=(o-r)/f+2;break;case o:l=(r-s)/f+4}l/=6}return t.h=l,t.s=u,t.l=d,t}getRGB(t,i=ei.workingColorSpace){return ei.fromWorkingColorSpace(Yh(this,li),i),t.r=li.r,t.g=li.g,t.b=li.b,t}getStyle(t=Kr){return ei.fromWorkingColorSpace(Yh(this,li),t),t!==Kr?`color(${t} ${li.r} ${li.g} ${li.b})`:`rgb(${255*li.r|0},${255*li.g|0},${255*li.b|0})`}offsetHSL(t,i,r){return this.getHSL(Jr),Jr.h+=t,Jr.s+=i,Jr.l+=r,this.setHSL(Jr.h,Jr.s,Jr.l),this}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,i){return this.r=t.r+i.r,this.g=t.g+i.g,this.b=t.b+i.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,i){return this.r+=(t.r-this.r)*i,this.g+=(t.g-this.g)*i,this.b+=(t.b-this.b)*i,this}lerpColors(t,i,r){return this.r=t.r+(i.r-t.r)*r,this.g=t.g+(i.g-t.g)*r,this.b=t.b+(i.b-t.b)*r,this}lerpHSL(t,i){this.getHSL(Jr),t.getHSL(Xh);const r=ju(Jr.h,Xh.h,i),s=ju(Jr.s,Xh.s,i),o=ju(Jr.l,Xh.l,i);return this.setHSL(r,s,o),this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,i=0){return this.r=t[i],this.g=t[i+1],this.b=t[i+2],this}toArray(t=[],i=0){return t[i]=this.r,t[i+1]=this.g,t[i+2]=this.b,t}fromBufferAttribute(t,i){return this.r=t.getX(i),this.g=t.getY(i),this.b=t.getZ(i),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}return n.NAMES=ZD,n})();class dv{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===zc&&(zc=$u("canvas")),zc.width=e.width,zc.height=e.height;const i=zc.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=zc}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=$u("canvas");t.width=e.width,t.height=e.height;const i=t.getContext("2d");i.drawImage(e,0,0,e.width,e.height);const r=i.getImageData(0,0,e.width,e.height),s=r.data;for(let o=0;o<s.length;o++)s[o]=255*la(s[o]/255);return i.putImageData(r,0,0),t}if(e.data){const t=e.data.slice(0);for(let i=0;i<t.length;i++)t[i]=t instanceof Uint8Array||t instanceof Uint8ClampedArray?Math.floor(255*la(t[i]/255)):la(t[i]);return{data:t,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}class ua{constructor(e=null){this.isSource=!0,this.uuid=fr(),this.data=e,this.version=0}set needsUpdate(e){!0===e&&this.version++}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];const i={uuid:this.uuid,url:""},r=this.data;if(null!==r){let s;if(Array.isArray(r)){s=[];for(let o=0,a=r.length;o<a;o++)s.push(fv(r[o].isDataTexture?r[o].image:r[o]))}else s=fv(r);i.url=s}return t||(e.images[this.uuid]=i),i}}function fv(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap?dv.getDataURL(n):n.data?{data:Array.from(n.data),width:n.width,height:n.height,type:n.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let nV=0,Ti=(()=>{class n extends qs{constructor(t=n.DEFAULT_IMAGE,i=n.DEFAULT_MAPPING,r=Ei,s=Ei,o=Fn,a=Ms,c=dr,l=xo,u=n.DEFAULT_ANISOTROPY,d=$s){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:nV++}),this.uuid=fr(),this.name="",this.source=new ua(t),this.mipmaps=[],this.mapping=i,this.wrapS=r,this.wrapT=s,this.magFilter=o,this.minFilter=a,this.anisotropy=u,this.format=c,this.internalFormat=null,this.type=l,this.offset=new ce(0,0),this.repeat=new ce(1,1),this.center=new ce(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new ji,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=d,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(t){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){const i=void 0===t||"string"==typeof t;if(!i&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];const r={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(r.userData=this.userData),i||(t.textures[this.uuid]=r),r}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==Oh)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case vo:t.x=t.x-Math.floor(t.x);break;case Ei:t.x=t.x<0?0:1;break;case Oc:t.x=1===Math.abs(Math.floor(t.x)%2)?Math.ceil(t.x)-t.x:t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case vo:t.y=t.y-Math.floor(t.y);break;case Ei:t.y=t.y<0?0:1;break;case Oc:t.y=1===Math.abs(Math.floor(t.y)%2)?Math.ceil(t.y)-t.y:t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){!0===t&&(this.version++,this.source.needsUpdate=!0)}}return n.DEFAULT_IMAGE=null,n.DEFAULT_MAPPING=Oh,n.DEFAULT_ANISOTROPY=1,n})();class dn{constructor(e=0,t=0,i=0,r=1){dn.prototype.isVector4=!0,this.x=e,this.y=t,this.z=i,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,i=this.y,r=this.z,s=this.w,o=e.elements;return this.x=o[0]*t+o[4]*i+o[8]*r+o[12]*s,this.y=o[1]*t+o[5]*i+o[9]*r+o[13]*s,this.z=o[2]*t+o[6]*i+o[10]*r+o[14]*s,this.w=o[3]*t+o[7]*i+o[11]*r+o[15]*s,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,r,s;const c=e.elements,l=c[0],u=c[4],d=c[8],f=c[1],h=c[5],m=c[9],p=c[2],g=c[6],_=c[10];if(Math.abs(u-f)<.01&&Math.abs(d-p)<.01&&Math.abs(m-g)<.01){if(Math.abs(u+f)<.1&&Math.abs(d+p)<.1&&Math.abs(m+g)<.1&&Math.abs(l+h+_-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const y=(l+1)/2,x=(h+1)/2,w=(_+1)/2,M=(u+f)/4,A=(d+p)/4,b=(m+g)/4;return y>x&&y>w?y<.01?(i=0,r=.707106781,s=.707106781):(i=Math.sqrt(y),r=M/i,s=A/i):x>w?x<.01?(i=.707106781,r=0,s=.707106781):(r=Math.sqrt(x),i=M/r,s=b/r):w<.01?(i=.707106781,r=.707106781,s=0):(s=Math.sqrt(w),i=A/s,r=b/s),this.set(i,r,s,t),this}let v=Math.sqrt((g-m)*(g-m)+(d-p)*(d-p)+(f-u)*(f-u));return Math.abs(v)<.001&&(v=1),this.x=(g-m)/v,this.y=(d-p)/v,this.z=(f-u)/v,this.w=Math.acos((l+h+_-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class Qr extends qs{constructor(e=1,t=1,i={}){super(),this.isWebGLRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new dn(0,0,e,t),this.scissorTest=!1,this.viewport=new dn(0,0,e,t),this.texture=new Ti({width:e,height:t,depth:1},i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=void 0!==i.generateMipmaps&&i.generateMipmaps,this.texture.internalFormat=void 0!==i.internalFormat?i.internalFormat:null,this.texture.minFilter=void 0!==i.minFilter?i.minFilter:Fn,this.depthBuffer=void 0===i.depthBuffer||i.depthBuffer,this.stencilBuffer=void 0!==i.stencilBuffer&&i.stencilBuffer,this.depthTexture=void 0!==i.depthTexture?i.depthTexture:null,this.samples=void 0!==i.samples?i.samples:0}setSize(e,t,i=1){(this.width!==e||this.height!==t||this.depth!==i)&&(this.width=e,this.height=t,this.depth=i,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=i,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new ua(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Kh extends Ti{constructor(e=null,t=1,i=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:i,depth:r},this.magFilter=Hn,this.minFilter=Hn,this.wrapR=Ei,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class iV extends Qr{constructor(e=1,t=1,i=1){super(e,t),this.isWebGLArrayRenderTarget=!0,this.depth=i,this.texture=new Kh(null,e,t,i),this.texture.isRenderTargetTexture=!0}}class hv extends Ti{constructor(e=null,t=1,i=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:i,depth:r},this.magFilter=Hn,this.minFilter=Hn,this.wrapR=Ei,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class rV extends Qr{constructor(e=1,t=1,i=1){super(e,t),this.isWebGL3DRenderTarget=!0,this.depth=i,this.texture=new hv(null,e,t,i),this.texture.isRenderTargetTexture=!0}}class sV extends Qr{constructor(e=1,t=1,i=1,r={}){super(e,t,r),this.isWebGLMultipleRenderTargets=!0;const s=this.texture;this.texture=[];for(let o=0;o<i;o++)this.texture[o]=s.clone(),this.texture[o].isRenderTargetTexture=!0}setSize(e,t,i=1){if(this.width!==e||this.height!==t||this.depth!==i){this.width=e,this.height=t,this.depth=i;for(let r=0,s=this.texture.length;r<s;r++)this.texture[r].image.width=e,this.texture[r].image.height=t,this.texture[r].image.depth=i;this.dispose()}return this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t),this}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.texture.length=0;for(let t=0,i=e.texture.length;t<i;t++)this.texture[t]=e.texture[t].clone(),this.texture[t].isRenderTargetTexture=!0;return this}}class Li{constructor(e=0,t=0,i=0,r=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=i,this._w=r}static slerpFlat(e,t,i,r,s,o,a){let c=i[r+0],l=i[r+1],u=i[r+2],d=i[r+3];const f=s[o+0],h=s[o+1],m=s[o+2],p=s[o+3];if(0===a)return e[t+0]=c,e[t+1]=l,e[t+2]=u,void(e[t+3]=d);if(1===a)return e[t+0]=f,e[t+1]=h,e[t+2]=m,void(e[t+3]=p);if(d!==p||c!==f||l!==h||u!==m){let g=1-a;const _=c*f+l*h+u*m+d*p,v=_>=0?1:-1,y=1-_*_;if(y>Number.EPSILON){const w=Math.sqrt(y),M=Math.atan2(w,_*v);g=Math.sin(g*M)/w,a=Math.sin(a*M)/w}const x=a*v;if(c=c*g+f*x,l=l*g+h*x,u=u*g+m*x,d=d*g+p*x,g===1-a){const w=1/Math.sqrt(c*c+l*l+u*u+d*d);c*=w,l*=w,u*=w,d*=w}}e[t]=c,e[t+1]=l,e[t+2]=u,e[t+3]=d}static multiplyQuaternionsFlat(e,t,i,r,s,o){const a=i[r],c=i[r+1],l=i[r+2],u=i[r+3],d=s[o],f=s[o+1],h=s[o+2],m=s[o+3];return e[t]=a*m+u*d+c*h-l*f,e[t+1]=c*m+u*f+l*d-a*h,e[t+2]=l*m+u*h+a*f-c*d,e[t+3]=u*m-a*d-c*f-l*h,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,r){return this._x=e,this._y=t,this._z=i,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){const i=e._x,r=e._y,s=e._z,o=e._order,a=Math.cos,c=Math.sin,l=a(i/2),u=a(r/2),d=a(s/2),f=c(i/2),h=c(r/2),m=c(s/2);switch(o){case"XYZ":this._x=f*u*d+l*h*m,this._y=l*h*d-f*u*m,this._z=l*u*m+f*h*d,this._w=l*u*d-f*h*m;break;case"YXZ":this._x=f*u*d+l*h*m,this._y=l*h*d-f*u*m,this._z=l*u*m-f*h*d,this._w=l*u*d+f*h*m;break;case"ZXY":this._x=f*u*d-l*h*m,this._y=l*h*d+f*u*m,this._z=l*u*m+f*h*d,this._w=l*u*d-f*h*m;break;case"ZYX":this._x=f*u*d-l*h*m,this._y=l*h*d+f*u*m,this._z=l*u*m-f*h*d,this._w=l*u*d+f*h*m;break;case"YZX":this._x=f*u*d+l*h*m,this._y=l*h*d+f*u*m,this._z=l*u*m-f*h*d,this._w=l*u*d-f*h*m;break;case"XZY":this._x=f*u*d-l*h*m,this._y=l*h*d-f*u*m,this._z=l*u*m+f*h*d,this._w=l*u*d+f*h*m;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return!1!==t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const i=t/2,r=Math.sin(i);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,i=t[0],r=t[4],s=t[8],o=t[1],a=t[5],c=t[9],l=t[2],u=t[6],d=t[10],f=i+a+d;if(f>0){const h=.5/Math.sqrt(f+1);this._w=.25/h,this._x=(u-c)*h,this._y=(s-l)*h,this._z=(o-r)*h}else if(i>a&&i>d){const h=2*Math.sqrt(1+i-a-d);this._w=(u-c)/h,this._x=.25*h,this._y=(r+o)/h,this._z=(s+l)/h}else if(a>d){const h=2*Math.sqrt(1+a-i-d);this._w=(s-l)/h,this._x=(r+o)/h,this._y=.25*h,this._z=(c+u)/h}else{const h=2*Math.sqrt(1+d-i-a);this._w=(o-r)/h,this._x=(s+l)/h,this._y=(c+u)/h,this._z=.25*h}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Zn(this.dot(e),-1,1)))}rotateTowards(e,t){const i=this.angleTo(e);if(0===i)return this;const r=Math.min(1,t/i);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const i=e._x,r=e._y,s=e._z,o=e._w,a=t._x,c=t._y,l=t._z,u=t._w;return this._x=i*u+o*a+r*l-s*c,this._y=r*u+o*c+s*a-i*l,this._z=s*u+o*l+i*c-r*a,this._w=o*u-i*a-r*c-s*l,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const i=this._x,r=this._y,s=this._z,o=this._w;let a=o*e._w+i*e._x+r*e._y+s*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=i,this._y=r,this._z=s,this;const c=1-a*a;if(c<=Number.EPSILON){const h=1-t;return this._w=h*o+t*this._w,this._x=h*i+t*this._x,this._y=h*r+t*this._y,this._z=h*s+t*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(c),u=Math.atan2(l,a),d=Math.sin((1-t)*u)/l,f=Math.sin(t*u)/l;return this._w=o*d+this._w*f,this._x=i*d+this._x*f,this._y=r*d+this._y*f,this._z=s*d+this._z*f,this._onChangeCallback(),this}slerpQuaternions(e,t,i){return this.copy(e).slerp(t,i)}random(){const e=Math.random(),t=Math.sqrt(1-e),i=Math.sqrt(e),r=2*Math.PI*Math.random(),s=2*Math.PI*Math.random();return this.set(t*Math.cos(r),i*Math.sin(s),i*Math.cos(s),t*Math.sin(r))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class T{constructor(e=0,t=0,i=0){T.prototype.isVector3=!0,this.x=e,this.y=t,this.z=i}set(e,t,i){return void 0===i&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(XD.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(XD.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,i=this.y,r=this.z,s=e.elements;return this.x=s[0]*t+s[3]*i+s[6]*r,this.y=s[1]*t+s[4]*i+s[7]*r,this.z=s[2]*t+s[5]*i+s[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,i=this.y,r=this.z,s=e.elements,o=1/(s[3]*t+s[7]*i+s[11]*r+s[15]);return this.x=(s[0]*t+s[4]*i+s[8]*r+s[12])*o,this.y=(s[1]*t+s[5]*i+s[9]*r+s[13])*o,this.z=(s[2]*t+s[6]*i+s[10]*r+s[14])*o,this}applyQuaternion(e){const t=this.x,i=this.y,r=this.z,s=e.x,o=e.y,a=e.z,c=e.w,l=c*t+o*r-a*i,u=c*i+a*t-s*r,d=c*r+s*i-o*t,f=-s*t-o*i-a*r;return this.x=l*c+f*-s+u*-a-d*-o,this.y=u*c+f*-o+d*-s-l*-a,this.z=d*c+f*-a+l*-o-u*-s,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,i=this.y,r=this.z,s=e.elements;return this.x=s[0]*t+s[4]*i+s[8]*r,this.y=s[1]*t+s[5]*i+s[9]*r,this.z=s[2]*t+s[6]*i+s[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const i=e.x,r=e.y,s=e.z,o=t.x,a=t.y,c=t.z;return this.x=r*c-s*a,this.y=s*o-i*c,this.z=i*a-r*o,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return pv.copy(this).projectOnVector(e),this.sub(pv)}reflect(e){return this.sub(pv.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(Zn(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y,r=this.z-e.z;return t*t+i*i+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){const r=Math.sin(t)*e;return this.x=r*Math.sin(i),this.y=Math.cos(t)*e,this.z=r*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=2*(Math.random()-.5),t=Math.random()*Math.PI*2,i=Math.sqrt(1-e**2);return this.x=i*Math.cos(t),this.y=i*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const pv=new T,XD=new Li;class So{constructor(e=new T(1/0,1/0,1/0),t=new T(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,i=1/0,r=1/0,s=-1/0,o=-1/0,a=-1/0;for(let c=0,l=e.length;c<l;c+=3){const u=e[c],d=e[c+1],f=e[c+2];u<t&&(t=u),d<i&&(i=d),f<r&&(r=f),u>s&&(s=u),d>o&&(o=d),f>a&&(a=f)}return this.min.set(t,i,r),this.max.set(s,o,a),this}setFromBufferAttribute(e){let t=1/0,i=1/0,r=1/0,s=-1/0,o=-1/0,a=-1/0;for(let c=0,l=e.count;c<l;c++){const u=e.getX(c),d=e.getY(c),f=e.getZ(c);u<t&&(t=u),d<i&&(i=d),f<r&&(r=f),u>s&&(s=u),d>o&&(o=d),f>a&&(a=f)}return this.min.set(t,i,r),this.max.set(s,o,a),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=da.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const i=e.geometry;if(void 0!==i)if(t&&null!=i.attributes&&void 0!==i.attributes.position){const s=i.attributes.position;for(let o=0,a=s.count;o<a;o++)da.fromBufferAttribute(s,o).applyMatrix4(e.matrixWorld),this.expandByPoint(da)}else null===i.boundingBox&&i.computeBoundingBox(),mv.copy(i.boundingBox),mv.applyMatrix4(e.matrixWorld),this.union(mv);const r=e.children;for(let s=0,o=r.length;s<o;s++)this.expandByObject(r[s],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,da),da.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(qu),Jh.subVectors(this.max,qu),Hc.subVectors(e.a,qu),Gc.subVectors(e.b,qu),Wc.subVectors(e.c,qu),Eo.subVectors(Gc,Hc),To.subVectors(Wc,Gc),fa.subVectors(Hc,Wc);let t=[0,-Eo.z,Eo.y,0,-To.z,To.y,0,-fa.z,fa.y,Eo.z,0,-Eo.x,To.z,0,-To.x,fa.z,0,-fa.x,-Eo.y,Eo.x,0,-To.y,To.x,0,-fa.y,fa.x,0];return!(!gv(t,Hc,Gc,Wc,Jh)||(t=[1,0,0,0,1,0,0,0,1],!gv(t,Hc,Gc,Wc,Jh)))&&(Qh.crossVectors(Eo,To),t=[Qh.x,Qh.y,Qh.z],gv(t,Hc,Gc,Wc,Jh))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return da.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return this.getCenter(e.center),e.radius=.5*this.getSize(da).length(),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(Xs[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Xs[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Xs[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Xs[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Xs[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Xs[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Xs[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Xs[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Xs)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const Xs=[new T,new T,new T,new T,new T,new T,new T,new T],da=new T,mv=new So,Hc=new T,Gc=new T,Wc=new T,Eo=new T,To=new T,fa=new T,qu=new T,Jh=new T,Qh=new T,ha=new T;function gv(n,e,t,i,r){for(let s=0,o=n.length-3;s<=o;s+=3){ha.fromArray(n,s);const a=r.x*Math.abs(ha.x)+r.y*Math.abs(ha.y)+r.z*Math.abs(ha.z),c=e.dot(ha),l=t.dot(ha),u=i.dot(ha);if(Math.max(-Math.max(c,l,u),Math.min(c,l,u))>a)return!1}return!0}const oV=new So,Zu=new T,yv=new T;class Do{constructor(e=new T,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const i=this.center;void 0!==t?i.copy(t):oV.setFromPoints(e).getCenter(i);let r=0;for(let s=0,o=e.length;s<o;s++)r=Math.max(r,i.distanceToSquared(e[s]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const i=this.center.distanceToSquared(e);return t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;Zu.subVectors(e,this.center);const t=Zu.lengthSq();if(t>this.radius*this.radius){const i=Math.sqrt(t),r=.5*(i-this.radius);this.center.addScaledVector(Zu,r/i),this.radius+=r}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(!0===this.center.equals(e.center)?this.radius=Math.max(this.radius,e.radius):(yv.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(Zu.copy(e.center).add(yv)),this.expandByPoint(Zu.copy(e.center).sub(yv))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const Ys=new T,_v=new T,ep=new T,Co=new T,vv=new T,tp=new T,xv=new T;class Xu{constructor(e=new T,t=new T(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Ys)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(i).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=Ys.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Ys.copy(this.direction).multiplyScalar(t).add(this.origin),Ys.distanceToSquared(e))}distanceSqToSegment(e,t,i,r){_v.copy(e).add(t).multiplyScalar(.5),ep.copy(t).sub(e).normalize(),Co.copy(this.origin).sub(_v);const s=.5*e.distanceTo(t),o=-this.direction.dot(ep),a=Co.dot(this.direction),c=-Co.dot(ep),l=Co.lengthSq(),u=Math.abs(1-o*o);let d,f,h,m;if(u>0)if(d=o*c-a,f=o*a-c,m=s*u,d>=0)if(f>=-m)if(f<=m){const p=1/u;d*=p,f*=p,h=d*(d+o*f+2*a)+f*(o*d+f+2*c)+l}else f=s,d=Math.max(0,-(o*f+a)),h=-d*d+f*(f+2*c)+l;else f=-s,d=Math.max(0,-(o*f+a)),h=-d*d+f*(f+2*c)+l;else f<=-m?(d=Math.max(0,-(-o*s+a)),f=d>0?-s:Math.min(Math.max(-s,-c),s),h=-d*d+f*(f+2*c)+l):f<=m?(d=0,f=Math.min(Math.max(-s,-c),s),h=f*(f+2*c)+l):(d=Math.max(0,-(o*s+a)),f=d>0?s:Math.min(Math.max(-s,-c),s),h=-d*d+f*(f+2*c)+l);else f=o>0?-s:s,d=Math.max(0,-(o*f+a)),h=-d*d+f*(f+2*c)+l;return i&&i.copy(this.direction).multiplyScalar(d).add(this.origin),r&&r.copy(ep).multiplyScalar(f).add(_v),h}intersectSphere(e,t){Ys.subVectors(e.center,this.origin);const i=Ys.dot(this.direction),r=Ys.dot(Ys)-i*i,s=e.radius*e.radius;if(r>s)return null;const o=Math.sqrt(s-r),a=i-o,c=i+o;return a<0&&c<0?null:this.at(a<0?c:a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){const i=this.distanceToPlane(e);return null===i?null:this.at(i,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,r,s,o,a,c;const l=1/this.direction.x,u=1/this.direction.y,d=1/this.direction.z,f=this.origin;return l>=0?(i=(e.min.x-f.x)*l,r=(e.max.x-f.x)*l):(i=(e.max.x-f.x)*l,r=(e.min.x-f.x)*l),u>=0?(s=(e.min.y-f.y)*u,o=(e.max.y-f.y)*u):(s=(e.max.y-f.y)*u,o=(e.min.y-f.y)*u),i>o||s>r||((s>i||isNaN(i))&&(i=s),(o<r||isNaN(r))&&(r=o),d>=0?(a=(e.min.z-f.z)*d,c=(e.max.z-f.z)*d):(a=(e.max.z-f.z)*d,c=(e.min.z-f.z)*d),i>c||a>r)||((a>i||i!=i)&&(i=a),(c<r||r!=r)&&(r=c),r<0)?null:this.at(i>=0?i:r,t)}intersectsBox(e){return null!==this.intersectBox(e,Ys)}intersectTriangle(e,t,i,r,s){vv.subVectors(t,e),tp.subVectors(i,e),xv.crossVectors(vv,tp);let a,o=this.direction.dot(xv);if(o>0){if(r)return null;a=1}else{if(!(o<0))return null;a=-1,o=-o}Co.subVectors(this.origin,e);const c=a*this.direction.dot(tp.crossVectors(Co,tp));if(c<0)return null;const l=a*this.direction.dot(vv.cross(Co));if(l<0||c+l>o)return null;const u=-a*Co.dot(xv);return u<0?null:this.at(u/o,s)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class pt{constructor(){pt.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(e,t,i,r,s,o,a,c,l,u,d,f,h,m,p,g){const _=this.elements;return _[0]=e,_[4]=t,_[8]=i,_[12]=r,_[1]=s,_[5]=o,_[9]=a,_[13]=c,_[2]=l,_[6]=u,_[10]=d,_[14]=f,_[3]=h,_[7]=m,_[11]=p,_[15]=g,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new pt).fromArray(this.elements)}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){const t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,i=e.elements,r=1/jc.setFromMatrixColumn(e,0).length(),s=1/jc.setFromMatrixColumn(e,1).length(),o=1/jc.setFromMatrixColumn(e,2).length();return t[0]=i[0]*r,t[1]=i[1]*r,t[2]=i[2]*r,t[3]=0,t[4]=i[4]*s,t[5]=i[5]*s,t[6]=i[6]*s,t[7]=0,t[8]=i[8]*o,t[9]=i[9]*o,t[10]=i[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,i=e.x,r=e.y,s=e.z,o=Math.cos(i),a=Math.sin(i),c=Math.cos(r),l=Math.sin(r),u=Math.cos(s),d=Math.sin(s);if("XYZ"===e.order){const f=o*u,h=o*d,m=a*u,p=a*d;t[0]=c*u,t[4]=-c*d,t[8]=l,t[1]=h+m*l,t[5]=f-p*l,t[9]=-a*c,t[2]=p-f*l,t[6]=m+h*l,t[10]=o*c}else if("YXZ"===e.order){const f=c*u,h=c*d,m=l*u,p=l*d;t[0]=f+p*a,t[4]=m*a-h,t[8]=o*l,t[1]=o*d,t[5]=o*u,t[9]=-a,t[2]=h*a-m,t[6]=p+f*a,t[10]=o*c}else if("ZXY"===e.order){const f=c*u,h=c*d,m=l*u,p=l*d;t[0]=f-p*a,t[4]=-o*d,t[8]=m+h*a,t[1]=h+m*a,t[5]=o*u,t[9]=p-f*a,t[2]=-o*l,t[6]=a,t[10]=o*c}else if("ZYX"===e.order){const f=o*u,h=o*d,m=a*u,p=a*d;t[0]=c*u,t[4]=m*l-h,t[8]=f*l+p,t[1]=c*d,t[5]=p*l+f,t[9]=h*l-m,t[2]=-l,t[6]=a*c,t[10]=o*c}else if("YZX"===e.order){const f=o*c,h=o*l,m=a*c,p=a*l;t[0]=c*u,t[4]=p-f*d,t[8]=m*d+h,t[1]=d,t[5]=o*u,t[9]=-a*u,t[2]=-l*u,t[6]=h*d+m,t[10]=f-p*d}else if("XZY"===e.order){const f=o*c,h=o*l,m=a*c,p=a*l;t[0]=c*u,t[4]=-d,t[8]=l*u,t[1]=f*d+p,t[5]=o*u,t[9]=h*d-m,t[2]=m*d-h,t[6]=a*u,t[10]=p*d+f}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(aV,e,cV)}lookAt(e,t,i){const r=this.elements;return hr.subVectors(e,t),0===hr.lengthSq()&&(hr.z=1),hr.normalize(),Ao.crossVectors(i,hr),0===Ao.lengthSq()&&(1===Math.abs(i.z)?hr.x+=1e-4:hr.z+=1e-4,hr.normalize(),Ao.crossVectors(i,hr)),Ao.normalize(),np.crossVectors(hr,Ao),r[0]=Ao.x,r[4]=np.x,r[8]=hr.x,r[1]=Ao.y,r[5]=np.y,r[9]=hr.y,r[2]=Ao.z,r[6]=np.z,r[10]=hr.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,r=t.elements,s=this.elements,o=i[0],a=i[4],c=i[8],l=i[12],u=i[1],d=i[5],f=i[9],h=i[13],m=i[2],p=i[6],g=i[10],_=i[14],v=i[3],y=i[7],x=i[11],w=i[15],M=r[0],A=r[4],b=r[8],S=r[12],R=r[1],B=r[5],G=r[9],k=r[13],N=r[2],q=r[6],ne=r[10],pe=r[14],re=r[3],he=r[7],ue=r[11],ke=r[15];return s[0]=o*M+a*R+c*N+l*re,s[4]=o*A+a*B+c*q+l*he,s[8]=o*b+a*G+c*ne+l*ue,s[12]=o*S+a*k+c*pe+l*ke,s[1]=u*M+d*R+f*N+h*re,s[5]=u*A+d*B+f*q+h*he,s[9]=u*b+d*G+f*ne+h*ue,s[13]=u*S+d*k+f*pe+h*ke,s[2]=m*M+p*R+g*N+_*re,s[6]=m*A+p*B+g*q+_*he,s[10]=m*b+p*G+g*ne+_*ue,s[14]=m*S+p*k+g*pe+_*ke,s[3]=v*M+y*R+x*N+w*re,s[7]=v*A+y*B+x*q+w*he,s[11]=v*b+y*G+x*ne+w*ue,s[15]=v*S+y*k+x*pe+w*ke,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[4],r=e[8],s=e[12],o=e[1],a=e[5],c=e[9],l=e[13],u=e[2],d=e[6],f=e[10],h=e[14];return e[3]*(+s*c*d-r*l*d-s*a*f+i*l*f+r*a*h-i*c*h)+e[7]*(+t*c*h-t*l*f+s*o*f-r*o*h+r*l*u-s*c*u)+e[11]*(+t*l*d-t*a*h-s*o*d+i*o*h+s*a*u-i*l*u)+e[15]*(-r*a*u-t*c*d+t*a*f+r*o*d-i*o*f+i*c*u)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,i){const r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=i),this}invert(){const e=this.elements,t=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],c=e[6],l=e[7],u=e[8],d=e[9],f=e[10],h=e[11],m=e[12],p=e[13],g=e[14],_=e[15],v=d*g*l-p*f*l+p*c*h-a*g*h-d*c*_+a*f*_,y=m*f*l-u*g*l-m*c*h+o*g*h+u*c*_-o*f*_,x=u*p*l-m*d*l+m*a*h-o*p*h-u*a*_+o*d*_,w=m*d*c-u*p*c-m*a*f+o*p*f+u*a*g-o*d*g,M=t*v+i*y+r*x+s*w;if(0===M)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const A=1/M;return e[0]=v*A,e[1]=(p*f*s-d*g*s-p*r*h+i*g*h+d*r*_-i*f*_)*A,e[2]=(a*g*s-p*c*s+p*r*l-i*g*l-a*r*_+i*c*_)*A,e[3]=(d*c*s-a*f*s-d*r*l+i*f*l+a*r*h-i*c*h)*A,e[4]=y*A,e[5]=(u*g*s-m*f*s+m*r*h-t*g*h-u*r*_+t*f*_)*A,e[6]=(m*c*s-o*g*s-m*r*l+t*g*l+o*r*_-t*c*_)*A,e[7]=(o*f*s-u*c*s+u*r*l-t*f*l-o*r*h+t*c*h)*A,e[8]=x*A,e[9]=(m*d*s-u*p*s-m*i*h+t*p*h+u*i*_-t*d*_)*A,e[10]=(o*p*s-m*a*s+m*i*l-t*p*l-o*i*_+t*a*_)*A,e[11]=(u*a*s-o*d*s-u*i*l+t*d*l+o*i*h-t*a*h)*A,e[12]=w*A,e[13]=(u*p*r-m*d*r+m*i*f-t*p*f-u*i*g+t*d*g)*A,e[14]=(m*a*r-o*p*r-m*i*c+t*p*c+o*i*g-t*a*g)*A,e[15]=(o*d*r-u*a*r+u*i*c-t*d*c-o*i*f+t*a*f)*A,this}scale(e){const t=this.elements,i=e.x,r=e.y,s=e.z;return t[0]*=i,t[4]*=r,t[8]*=s,t[1]*=i,t[5]*=r,t[9]*=s,t[2]*=i,t[6]*=r,t[10]*=s,t[3]*=i,t[7]*=r,t[11]*=s,this}getMaxScaleOnAxis(){const e=this.elements;return Math.sqrt(Math.max(e[0]*e[0]+e[1]*e[1]+e[2]*e[2],e[4]*e[4]+e[5]*e[5]+e[6]*e[6],e[8]*e[8]+e[9]*e[9]+e[10]*e[10]))}makeTranslation(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const i=Math.cos(t),r=Math.sin(t),s=1-i,o=e.x,a=e.y,c=e.z,l=s*o,u=s*a;return this.set(l*o+i,l*a-r*c,l*c+r*a,0,l*a+r*c,u*a+i,u*c-r*o,0,l*c-r*a,u*c+r*o,s*c*c+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i,r,s,o){return this.set(1,i,s,0,e,1,o,0,t,r,1,0,0,0,0,1),this}compose(e,t,i){const r=this.elements,s=t._x,o=t._y,a=t._z,c=t._w,l=s+s,u=o+o,d=a+a,f=s*l,h=s*u,m=s*d,p=o*u,g=o*d,_=a*d,v=c*l,y=c*u,x=c*d,w=i.x,M=i.y,A=i.z;return r[0]=(1-(p+_))*w,r[1]=(h+x)*w,r[2]=(m-y)*w,r[3]=0,r[4]=(h-x)*M,r[5]=(1-(f+_))*M,r[6]=(g+v)*M,r[7]=0,r[8]=(m+y)*A,r[9]=(g-v)*A,r[10]=(1-(f+p))*A,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,i){const r=this.elements;let s=jc.set(r[0],r[1],r[2]).length();const o=jc.set(r[4],r[5],r[6]).length(),a=jc.set(r[8],r[9],r[10]).length();this.determinant()<0&&(s=-s),e.x=r[12],e.y=r[13],e.z=r[14],es.copy(this);const l=1/s,u=1/o,d=1/a;return es.elements[0]*=l,es.elements[1]*=l,es.elements[2]*=l,es.elements[4]*=u,es.elements[5]*=u,es.elements[6]*=u,es.elements[8]*=d,es.elements[9]*=d,es.elements[10]*=d,t.setFromRotationMatrix(es),i.x=s,i.y=o,i.z=a,this}makePerspective(e,t,i,r,s,o){const a=this.elements,l=2*s/(i-r),u=(t+e)/(t-e),d=(i+r)/(i-r),f=-(o+s)/(o-s),h=-2*o*s/(o-s);return a[0]=2*s/(t-e),a[4]=0,a[8]=u,a[12]=0,a[1]=0,a[5]=l,a[9]=d,a[13]=0,a[2]=0,a[6]=0,a[10]=f,a[14]=h,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(e,t,i,r,s,o){const a=this.elements,c=1/(t-e),l=1/(i-r),u=1/(o-s),d=(t+e)*c,f=(i+r)*l,h=(o+s)*u;return a[0]=2*c,a[4]=0,a[8]=0,a[12]=-d,a[1]=0,a[5]=2*l,a[9]=0,a[13]=-f,a[2]=0,a[6]=0,a[10]=-2*u,a[14]=-h,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(e){const t=this.elements,i=e.elements;for(let r=0;r<16;r++)if(t[r]!==i[r])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}}const jc=new T,es=new pt,aV=new T(0,0,0),cV=new T(1,1,1),Ao=new T,np=new T,hr=new T,YD=new pt,KD=new Li;let JD=(()=>{class n{constructor(t=0,i=0,r=0,s=n.DEFAULT_ORDER){this.isEuler=!0,this._x=t,this._y=i,this._z=r,this._order=s}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,i,r,s=this._order){return this._x=t,this._y=i,this._z=r,this._order=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,i=this._order,r=!0){const s=t.elements,o=s[0],a=s[4],c=s[8],l=s[1],u=s[5],d=s[9],f=s[2],h=s[6],m=s[10];switch(i){case"XYZ":this._y=Math.asin(Zn(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-d,m),this._z=Math.atan2(-a,o)):(this._x=Math.atan2(h,u),this._z=0);break;case"YXZ":this._x=Math.asin(-Zn(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(c,m),this._z=Math.atan2(l,u)):(this._y=Math.atan2(-f,o),this._z=0);break;case"ZXY":this._x=Math.asin(Zn(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-f,m),this._z=Math.atan2(-a,u)):(this._y=0,this._z=Math.atan2(l,o));break;case"ZYX":this._y=Math.asin(-Zn(f,-1,1)),Math.abs(f)<.9999999?(this._x=Math.atan2(h,m),this._z=Math.atan2(l,o)):(this._x=0,this._z=Math.atan2(-a,u));break;case"YZX":this._z=Math.asin(Zn(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-d,u),this._y=Math.atan2(-f,o)):(this._x=0,this._y=Math.atan2(c,m));break;case"XZY":this._z=Math.asin(-Zn(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(h,u),this._y=Math.atan2(c,o)):(this._x=Math.atan2(-d,m),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+i)}return this._order=i,!0===r&&this._onChangeCallback(),this}setFromQuaternion(t,i,r){return YD.makeRotationFromQuaternion(t),this.setFromRotationMatrix(YD,i,r)}setFromVector3(t,i=this._order){return this.set(t.x,t.y,t.z,i)}reorder(t){return KD.setFromEuler(this),this.setFromQuaternion(KD,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],i=0){return t[i]=this._x,t[i+1]=this._y,t[i+2]=this._z,t[i+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}return n.DEFAULT_ORDER="XYZ",n})();class pa{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return 0!=(this.mask&e.mask)}isEnabled(e){return 0!=(this.mask&(1<<e|0))}}let lV=0;const QD=new T,$c=new Li,Ks=new pt,ip=new T,Yu=new T,uV=new T,dV=new Li,eC=new T(1,0,0),tC=new T(0,1,0),nC=new T(0,0,1),fV={type:"added"},iC={type:"removed"};let _n=(()=>{class n extends qs{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:lV++}),this.uuid=fr(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=n.DEFAULT_UP.clone();const t=new T,i=new JD,r=new Li,s=new T(1,1,1);i._onChange(function o(){r.setFromEuler(i,!1)}),r._onChange(function a(){i.setFromQuaternion(r,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:i},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:s},modelViewMatrix:{value:new pt},normalMatrix:{value:new ji}}),this.matrix=new pt,this.matrixWorld=new pt,this.matrixAutoUpdate=n.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=n.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new pa,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,i){this.quaternion.setFromAxisAngle(t,i)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,i){return $c.setFromAxisAngle(t,i),this.quaternion.multiply($c),this}rotateOnWorldAxis(t,i){return $c.setFromAxisAngle(t,i),this.quaternion.premultiply($c),this}rotateX(t){return this.rotateOnAxis(eC,t)}rotateY(t){return this.rotateOnAxis(tC,t)}rotateZ(t){return this.rotateOnAxis(nC,t)}translateOnAxis(t,i){return QD.copy(t).applyQuaternion(this.quaternion),this.position.add(QD.multiplyScalar(i)),this}translateX(t){return this.translateOnAxis(eC,t)}translateY(t){return this.translateOnAxis(tC,t)}translateZ(t){return this.translateOnAxis(nC,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(Ks.copy(this.matrixWorld).invert())}lookAt(t,i,r){t.isVector3?ip.copy(t):ip.set(t,i,r);const s=this.parent;this.updateWorldMatrix(!0,!1),Yu.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Ks.lookAt(Yu,ip,this.up):Ks.lookAt(ip,Yu,this.up),this.quaternion.setFromRotationMatrix(Ks),s&&(Ks.extractRotation(s.matrixWorld),$c.setFromRotationMatrix(Ks),this.quaternion.premultiply($c.invert()))}add(t){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.add(arguments[i]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(fV)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let r=0;r<arguments.length;r++)this.remove(arguments[r]);return this}const i=this.children.indexOf(t);return-1!==i&&(t.parent=null,this.children.splice(i,1),t.dispatchEvent(iC)),this}removeFromParent(){const t=this.parent;return null!==t&&t.remove(this),this}clear(){for(let t=0;t<this.children.length;t++){const i=this.children[t];i.parent=null,i.dispatchEvent(iC)}return this.children.length=0,this}attach(t){return this.updateWorldMatrix(!0,!1),Ks.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),Ks.multiply(t.parent.matrixWorld)),t.applyMatrix4(Ks),this.add(t),t.updateWorldMatrix(!1,!0),this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,i){if(this[t]===i)return this;for(let r=0,s=this.children.length;r<s;r++){const a=this.children[r].getObjectByProperty(t,i);if(void 0!==a)return a}}getObjectsByProperty(t,i){let r=[];this[t]===i&&r.push(this);for(let s=0,o=this.children.length;s<o;s++){const a=this.children[s].getObjectsByProperty(t,i);a.length>0&&(r=r.concat(a))}return r}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Yu,t,uV),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Yu,dV,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const i=this.matrixWorld.elements;return t.set(i[8],i[9],i[10]).normalize()}raycast(){}traverse(t){t(this);const i=this.children;for(let r=0,s=i.length;r<s;r++)i[r].traverse(t)}traverseVisible(t){if(!1===this.visible)return;t(this);const i=this.children;for(let r=0,s=i.length;r<s;r++)i[r].traverseVisible(t)}traverseAncestors(t){const i=this.parent;null!==i&&(t(i),i.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const i=this.children;for(let r=0,s=i.length;r<s;r++){const o=i[r];(!0===o.matrixWorldAutoUpdate||!0===t)&&o.updateMatrixWorld(t)}}updateWorldMatrix(t,i){const r=this.parent;if(!0===t&&null!==r&&!0===r.matrixWorldAutoUpdate&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===i){const s=this.children;for(let o=0,a=s.length;o<a;o++){const c=s[o];!0===c.matrixWorldAutoUpdate&&c.updateWorldMatrix(!1,!0)}}}toJSON(t){const i=void 0===t||"string"==typeof t,r={};i&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},r.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const s={};function o(c,l){return void 0===c[l.uuid]&&(c[l.uuid]=l.toJSON(t)),l.uuid}if(s.uuid=this.uuid,s.type=this.type,""!==this.name&&(s.name=this.name),!0===this.castShadow&&(s.castShadow=!0),!0===this.receiveShadow&&(s.receiveShadow=!0),!1===this.visible&&(s.visible=!1),!1===this.frustumCulled&&(s.frustumCulled=!1),0!==this.renderOrder&&(s.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(s.userData=this.userData),s.layers=this.layers.mask,s.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(s.matrixAutoUpdate=!1),this.isInstancedMesh&&(s.type="InstancedMesh",s.count=this.count,s.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(s.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?s.background=this.background.toJSON():this.background.isTexture&&(s.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(s.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){s.geometry=o(t.geometries,this.geometry);const c=this.geometry.parameters;if(void 0!==c&&void 0!==c.shapes){const l=c.shapes;if(Array.isArray(l))for(let u=0,d=l.length;u<d;u++)o(t.shapes,l[u]);else o(t.shapes,l)}}if(this.isSkinnedMesh&&(s.bindMode=this.bindMode,s.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(o(t.skeletons,this.skeleton),s.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const c=[];for(let l=0,u=this.material.length;l<u;l++)c.push(o(t.materials,this.material[l]));s.material=c}else s.material=o(t.materials,this.material);if(this.children.length>0){s.children=[];for(let c=0;c<this.children.length;c++)s.children.push(this.children[c].toJSON(t).object)}if(this.animations.length>0){s.animations=[];for(let c=0;c<this.animations.length;c++)s.animations.push(o(t.animations,this.animations[c]))}if(i){const c=a(t.geometries),l=a(t.materials),u=a(t.textures),d=a(t.images),f=a(t.shapes),h=a(t.skeletons),m=a(t.animations),p=a(t.nodes);c.length>0&&(r.geometries=c),l.length>0&&(r.materials=l),u.length>0&&(r.textures=u),d.length>0&&(r.images=d),f.length>0&&(r.shapes=f),h.length>0&&(r.skeletons=h),m.length>0&&(r.animations=m),p.length>0&&(r.nodes=p)}return r.object=s,r;function a(c){const l=[];for(const u in c){const d=c[u];delete d.metadata,l.push(d)}return l}}clone(t){return(new this.constructor).copy(this,t)}copy(t,i=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===i)for(let r=0;r<t.children.length;r++)this.add(t.children[r].clone());return this}}return n.DEFAULT_UP=new T(0,1,0),n.DEFAULT_MATRIX_AUTO_UPDATE=!0,n.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0,n})();const ts=new T,Js=new T,bv=new T,Qs=new T,qc=new T,Zc=new T,rC=new T,wv=new T,Mv=new T,Sv=new T;class Ir{constructor(e=new T,t=new T,i=new T){this.a=e,this.b=t,this.c=i}static getNormal(e,t,i,r){r.subVectors(i,t),ts.subVectors(e,t),r.cross(ts);const s=r.lengthSq();return s>0?r.multiplyScalar(1/Math.sqrt(s)):r.set(0,0,0)}static getBarycoord(e,t,i,r,s){ts.subVectors(r,t),Js.subVectors(i,t),bv.subVectors(e,t);const o=ts.dot(ts),a=ts.dot(Js),c=ts.dot(bv),l=Js.dot(Js),u=Js.dot(bv),d=o*l-a*a;if(0===d)return s.set(-2,-1,-1);const f=1/d,h=(l*c-a*u)*f,m=(o*u-a*c)*f;return s.set(1-h-m,m,h)}static containsPoint(e,t,i,r){return this.getBarycoord(e,t,i,r,Qs),Qs.x>=0&&Qs.y>=0&&Qs.x+Qs.y<=1}static getUV(e,t,i,r,s,o,a,c){return this.getBarycoord(e,t,i,r,Qs),c.set(0,0),c.addScaledVector(s,Qs.x),c.addScaledVector(o,Qs.y),c.addScaledVector(a,Qs.z),c}static isFrontFacing(e,t,i,r){return ts.subVectors(i,t),Js.subVectors(e,t),ts.cross(Js).dot(r)<0}set(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this}setFromPointsAndIndices(e,t,i,r){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,t,i,r){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,i),this.c.fromBufferAttribute(e,r),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return ts.subVectors(this.c,this.b),Js.subVectors(this.a,this.b),.5*ts.cross(Js).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Ir.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Ir.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,i,r,s){return Ir.getUV(e,this.a,this.b,this.c,t,i,r,s)}containsPoint(e){return Ir.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Ir.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const i=this.a,r=this.b,s=this.c;let o,a;qc.subVectors(r,i),Zc.subVectors(s,i),wv.subVectors(e,i);const c=qc.dot(wv),l=Zc.dot(wv);if(c<=0&&l<=0)return t.copy(i);Mv.subVectors(e,r);const u=qc.dot(Mv),d=Zc.dot(Mv);if(u>=0&&d<=u)return t.copy(r);const f=c*d-u*l;if(f<=0&&c>=0&&u<=0)return o=c/(c-u),t.copy(i).addScaledVector(qc,o);Sv.subVectors(e,s);const h=qc.dot(Sv),m=Zc.dot(Sv);if(m>=0&&h<=m)return t.copy(s);const p=h*l-c*m;if(p<=0&&l>=0&&m<=0)return a=l/(l-m),t.copy(i).addScaledVector(Zc,a);const g=u*m-h*d;if(g<=0&&d-u>=0&&h-m>=0)return rC.subVectors(s,r),a=(d-u)/(d-u+(h-m)),t.copy(r).addScaledVector(rC,a);const _=1/(g+p+f);return o=p*_,a=f*_,t.copy(i).addScaledVector(qc,o).addScaledVector(Zc,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let hV=0;class ui extends qs{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:hV++}),this.uuid=fr(),this.name="",this.type="Material",this.blending=ta,this.side=bs,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=A_,this.blendDst=I_,this.blendEquation=na,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=Nh,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=WD,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=jh,this.stencilZFail=jh,this.stencilZPass=jh,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(const t in e){const i=e[t];if(void 0===i){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}const r=this[t];void 0!==r?r&&r.isColor?r.set(i):r&&r.isVector3&&i&&i.isVector3?r.copy(i):this[t]=i:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}}toJSON(e){const t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});const i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function r(s){const o=[];for(const a in s){const c=s[a];delete c.metadata,o.push(c)}return o}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),void 0!==this.roughness&&(i.roughness=this.roughness),void 0!==this.metalness&&(i.metalness=this.metalness),void 0!==this.sheen&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(i.shininess=this.shininess),void 0!==this.clearcoat&&(i.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.iridescence&&(i.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(i.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(i.combine=this.combine)),void 0!==this.envMapIntensity&&(i.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(i.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(i.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(i.size=this.size),null!==this.shadowSide&&(i.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==ta&&(i.blending=this.blending),this.side!==bs&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),!0===this.transparent&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.colorWrite=this.colorWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,void 0!==this.rotation&&0!==this.rotation&&(i.rotation=this.rotation),!0===this.polygonOffset&&(i.polygonOffset=!0),0!==this.polygonOffsetFactor&&(i.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(i.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(i.linewidth=this.linewidth),void 0!==this.dashSize&&(i.dashSize=this.dashSize),void 0!==this.gapSize&&(i.gapSize=this.gapSize),void 0!==this.scale&&(i.scale=this.scale),!0===this.dithering&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(i.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(i.premultipliedAlpha=this.premultipliedAlpha),!0===this.forceSinglePass&&(i.forceSinglePass=this.forceSinglePass),!0===this.wireframe&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(i.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(i.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(i.flatShading=this.flatShading),!1===this.visible&&(i.visible=!1),!1===this.toneMapped&&(i.toneMapped=!1),!1===this.fog&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData),t){const s=r(e.textures),o=r(e.images);s.length>0&&(i.textures=s),o.length>0&&(i.images=o)}return i}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let i=null;if(null!==t){const r=t.length;i=new Array(r);for(let s=0;s!==r;++s)i[s]=t[s].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}}class pr extends ui{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new De(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Bu,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const ti=new T,rp=new ce;class an{constructor(e,t,i=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=i,this.usage=Gu,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let r=0,s=this.itemSize;r<s;r++)this.array[e+r]=t.array[i+r];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,i=this.count;t<i;t++)rp.fromBufferAttribute(this,t),rp.applyMatrix3(e),this.setXY(t,rp.x,rp.y);else if(3===this.itemSize)for(let t=0,i=this.count;t<i;t++)ti.fromBufferAttribute(this,t),ti.applyMatrix3(e),this.setXYZ(t,ti.x,ti.y,ti.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)ti.fromBufferAttribute(this,t),ti.applyMatrix4(e),this.setXYZ(t,ti.x,ti.y,ti.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)ti.fromBufferAttribute(this,t),ti.applyNormalMatrix(e),this.setXYZ(t,ti.x,ti.y,ti.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)ti.fromBufferAttribute(this,t),ti.transformDirection(e),this.setXYZ(t,ti.x,ti.y,ti.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=Zs(t,this.array)),t}setX(e,t){return this.normalized&&(t=yn(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=Zs(t,this.array)),t}setY(e,t){return this.normalized&&(t=yn(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=Zs(t,this.array)),t}setZ(e,t){return this.normalized&&(t=yn(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=Zs(t,this.array)),t}setW(e,t){return this.normalized&&(t=yn(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=yn(t,this.array),i=yn(i,this.array)),this.array[e+0]=t,this.array[e+1]=i,this}setXYZ(e,t,i,r){return e*=this.itemSize,this.normalized&&(t=yn(t,this.array),i=yn(i,this.array),r=yn(r,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this}setXYZW(e,t,i,r,s){return e*=this.itemSize,this.normalized&&(t=yn(t,this.array),i=yn(i,this.array),r=yn(r,this.array),s=yn(s,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this.array[e+3]=s,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),this.usage!==Gu&&(e.usage=this.usage),(0!==this.updateRange.offset||-1!==this.updateRange.count)&&(e.updateRange=this.updateRange),e}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}}class pV extends an{constructor(e,t,i){super(new Int8Array(e),t,i)}}class mV extends an{constructor(e,t,i){super(new Uint8Array(e),t,i)}}class gV extends an{constructor(e,t,i){super(new Uint8ClampedArray(e),t,i)}}class yV extends an{constructor(e,t,i){super(new Int16Array(e),t,i)}}class Ev extends an{constructor(e,t,i){super(new Uint16Array(e),t,i)}}class _V extends an{constructor(e,t,i){super(new Int32Array(e),t,i)}}class Tv extends an{constructor(e,t,i){super(new Uint32Array(e),t,i)}}class vV extends an{constructor(e,t,i){super(new Uint16Array(e),t,i),this.isFloat16BufferAttribute=!0}}class Ve extends an{constructor(e,t,i){super(new Float32Array(e),t,i)}}class xV extends an{constructor(e,t,i){super(new Float64Array(e),t,i)}}let bV=0;const Rr=new pt,Dv=new _n,Xc=new T,mr=new So,Ku=new So,gi=new T;class Pt extends qs{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:bV++}),this.uuid=fr(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return this.index=Array.isArray(e)?new(qD(e)?Tv:Ev)(e,1):e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t,i=0){this.groups.push({start:e,count:t,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const i=this.attributes.normal;if(void 0!==i){const s=(new ji).getNormalMatrix(e);i.applyNormalMatrix(s),i.needsUpdate=!0}const r=this.attributes.tangent;return void 0!==r&&(r.transformDirection(e),r.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return Rr.makeRotationFromQuaternion(e),this.applyMatrix4(Rr),this}rotateX(e){return Rr.makeRotationX(e),this.applyMatrix4(Rr),this}rotateY(e){return Rr.makeRotationY(e),this.applyMatrix4(Rr),this}rotateZ(e){return Rr.makeRotationZ(e),this.applyMatrix4(Rr),this}translate(e,t,i){return Rr.makeTranslation(e,t,i),this.applyMatrix4(Rr),this}scale(e,t,i){return Rr.makeScale(e,t,i),this.applyMatrix4(Rr),this}lookAt(e){return Dv.lookAt(e),Dv.updateMatrix(),this.applyMatrix4(Dv.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Xc).negate(),this.translate(Xc.x,Xc.y,Xc.z),this}setFromPoints(e){const t=[];for(let i=0,r=e.length;i<r;i++){const s=e[i];t.push(s.x,s.y,s.z||0)}return this.setAttribute("position",new Ve(t,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new So);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new T(-1/0,-1/0,-1/0),new T(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let i=0,r=t.length;i<r;i++)mr.setFromBufferAttribute(t[i]),this.morphTargetsRelative?(gi.addVectors(this.boundingBox.min,mr.min),this.boundingBox.expandByPoint(gi),gi.addVectors(this.boundingBox.max,mr.max),this.boundingBox.expandByPoint(gi)):(this.boundingBox.expandByPoint(mr.min),this.boundingBox.expandByPoint(mr.max))}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Do);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new T,1/0);if(e){const i=this.boundingSphere.center;if(mr.setFromBufferAttribute(e),t)for(let s=0,o=t.length;s<o;s++)Ku.setFromBufferAttribute(t[s]),this.morphTargetsRelative?(gi.addVectors(mr.min,Ku.min),mr.expandByPoint(gi),gi.addVectors(mr.max,Ku.max),mr.expandByPoint(gi)):(mr.expandByPoint(Ku.min),mr.expandByPoint(Ku.max));mr.getCenter(i);let r=0;for(let s=0,o=e.count;s<o;s++)gi.fromBufferAttribute(e,s),r=Math.max(r,i.distanceToSquared(gi));if(t)for(let s=0,o=t.length;s<o;s++){const a=t[s],c=this.morphTargetsRelative;for(let l=0,u=a.count;l<u;l++)gi.fromBufferAttribute(a,l),c&&(Xc.fromBufferAttribute(e,l),gi.add(Xc)),r=Math.max(r,i.distanceToSquared(gi))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const i=e.array,r=t.position.array,s=t.normal.array,o=t.uv.array,a=r.length/3;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new an(new Float32Array(4*a),4));const c=this.getAttribute("tangent").array,l=[],u=[];for(let R=0;R<a;R++)l[R]=new T,u[R]=new T;const d=new T,f=new T,h=new T,m=new ce,p=new ce,g=new ce,_=new T,v=new T;function y(R,B,G){d.fromArray(r,3*R),f.fromArray(r,3*B),h.fromArray(r,3*G),m.fromArray(o,2*R),p.fromArray(o,2*B),g.fromArray(o,2*G),f.sub(d),h.sub(d),p.sub(m),g.sub(m);const k=1/(p.x*g.y-g.x*p.y);isFinite(k)&&(_.copy(f).multiplyScalar(g.y).addScaledVector(h,-p.y).multiplyScalar(k),v.copy(h).multiplyScalar(p.x).addScaledVector(f,-g.x).multiplyScalar(k),l[R].add(_),l[B].add(_),l[G].add(_),u[R].add(v),u[B].add(v),u[G].add(v))}let x=this.groups;0===x.length&&(x=[{start:0,count:i.length}]);for(let R=0,B=x.length;R<B;++R){const G=x[R],k=G.start;for(let q=k,ne=k+G.count;q<ne;q+=3)y(i[q+0],i[q+1],i[q+2])}const w=new T,M=new T,A=new T,b=new T;function S(R){A.fromArray(s,3*R),b.copy(A);const B=l[R];w.copy(B),w.sub(A.multiplyScalar(A.dot(B))).normalize(),M.crossVectors(b,B);const k=M.dot(u[R])<0?-1:1;c[4*R]=w.x,c[4*R+1]=w.y,c[4*R+2]=w.z,c[4*R+3]=k}for(let R=0,B=x.length;R<B;++R){const G=x[R],k=G.start;for(let q=k,ne=k+G.count;q<ne;q+=3)S(i[q+0]),S(i[q+1]),S(i[q+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(void 0!==t){let i=this.getAttribute("normal");if(void 0===i)i=new an(new Float32Array(3*t.count),3),this.setAttribute("normal",i);else for(let f=0,h=i.count;f<h;f++)i.setXYZ(f,0,0,0);const r=new T,s=new T,o=new T,a=new T,c=new T,l=new T,u=new T,d=new T;if(e)for(let f=0,h=e.count;f<h;f+=3){const m=e.getX(f+0),p=e.getX(f+1),g=e.getX(f+2);r.fromBufferAttribute(t,m),s.fromBufferAttribute(t,p),o.fromBufferAttribute(t,g),u.subVectors(o,s),d.subVectors(r,s),u.cross(d),a.fromBufferAttribute(i,m),c.fromBufferAttribute(i,p),l.fromBufferAttribute(i,g),a.add(u),c.add(u),l.add(u),i.setXYZ(m,a.x,a.y,a.z),i.setXYZ(p,c.x,c.y,c.z),i.setXYZ(g,l.x,l.y,l.z)}else for(let f=0,h=t.count;f<h;f+=3)r.fromBufferAttribute(t,f+0),s.fromBufferAttribute(t,f+1),o.fromBufferAttribute(t,f+2),u.subVectors(o,s),d.subVectors(r,s),u.cross(d),i.setXYZ(f+0,u.x,u.y,u.z),i.setXYZ(f+1,u.x,u.y,u.z),i.setXYZ(f+2,u.x,u.y,u.z);this.normalizeNormals(),i.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeBufferGeometries() instead."),this}normalizeNormals(){const e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)gi.fromBufferAttribute(e,t),gi.normalize(),e.setXYZ(t,gi.x,gi.y,gi.z)}toNonIndexed(){function e(a,c){const l=a.array,u=a.itemSize,d=a.normalized,f=new l.constructor(c.length*u);let h=0,m=0;for(let p=0,g=c.length;p<g;p++){h=a.isInterleavedBufferAttribute?c[p]*a.data.stride+a.offset:c[p]*u;for(let _=0;_<u;_++)f[m++]=l[h++]}return new an(f,u,d)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new Pt,i=this.index.array,r=this.attributes;for(const a in r){const l=e(r[a],i);t.setAttribute(a,l)}const s=this.morphAttributes;for(const a in s){const c=[],l=s[a];for(let u=0,d=l.length;u<d;u++){const h=e(l[u],i);c.push(h)}t.morphAttributes[a]=c}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let a=0,c=o.length;a<c;a++){const l=o[a];t.addGroup(l.start,l.count,l.materialIndex)}return t}toJSON(){const e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const c=this.parameters;for(const l in c)void 0!==c[l]&&(e[l]=c[l]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const i=this.attributes;for(const c in i)e.data.attributes[c]=i[c].toJSON(e.data);const r={};let s=!1;for(const c in this.morphAttributes){const l=this.morphAttributes[c],u=[];for(let d=0,f=l.length;d<f;d++)u.push(l[d].toJSON(e.data));u.length>0&&(r[c]=u,s=!0)}s&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const a=this.boundingSphere;return null!==a&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return(new this.constructor).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const i=e.index;null!==i&&this.setIndex(i.clone(t));const r=e.attributes;for(const l in r)this.setAttribute(l,r[l].clone(t));const s=e.morphAttributes;for(const l in s){const u=[],d=s[l];for(let f=0,h=d.length;f<h;f++)u.push(d[f].clone(t));this.morphAttributes[l]=u}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let l=0,u=o.length;l<u;l++){const d=o[l];this.addGroup(d.start,d.count,d.materialIndex)}const a=e.boundingBox;null!==a&&(this.boundingBox=a.clone());const c=e.boundingSphere;return null!==c&&(this.boundingSphere=c.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,void 0!==e.parameters&&(this.parameters=Object.assign({},e.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}const sC=new pt,Yc=new Xu,Cv=new Do,Ju=new T,Qu=new T,ed=new T,Av=new T,sp=new T,op=new ce,ap=new ce,cp=new ce,Iv=new T,lp=new T;class yi extends _n{constructor(e=new Pt,t=new pr){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const r=t[i[0]];if(void 0!==r){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=r.length;s<o;s++){const a=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}getVertexPosition(e,t){const i=this.geometry,s=i.morphAttributes.position,o=i.morphTargetsRelative;t.fromBufferAttribute(i.attributes.position,e);const a=this.morphTargetInfluences;if(s&&a){sp.set(0,0,0);for(let c=0,l=s.length;c<l;c++){const u=a[c];0!==u&&(Av.fromBufferAttribute(s[c],e),sp.addScaledVector(o?Av:Av.sub(t),u))}t.add(sp)}return this.isSkinnedMesh&&this.boneTransform(e,t),t}raycast(e,t){const i=this.geometry,r=this.material,s=this.matrixWorld;if(void 0===r||(null===i.boundingSphere&&i.computeBoundingSphere(),Cv.copy(i.boundingSphere),Cv.applyMatrix4(s),!1===e.ray.intersectsSphere(Cv))||(sC.copy(s).invert(),Yc.copy(e.ray).applyMatrix4(sC),null!==i.boundingBox&&!1===Yc.intersectsBox(i.boundingBox)))return;let o;const a=i.index,c=i.attributes.position,l=i.attributes.uv,u=i.attributes.uv2,d=i.groups,f=i.drawRange;if(null!==a)if(Array.isArray(r))for(let h=0,m=d.length;h<m;h++){const p=d[h],g=r[p.materialIndex];for(let y=Math.max(p.start,f.start),x=Math.min(a.count,Math.min(p.start+p.count,f.start+f.count));y<x;y+=3){const w=a.getX(y),M=a.getX(y+1),A=a.getX(y+2);o=up(this,g,e,Yc,l,u,w,M,A),o&&(o.faceIndex=Math.floor(y/3),o.face.materialIndex=p.materialIndex,t.push(o))}}else for(let p=Math.max(0,f.start),g=Math.min(a.count,f.start+f.count);p<g;p+=3){const _=a.getX(p),v=a.getX(p+1),y=a.getX(p+2);o=up(this,r,e,Yc,l,u,_,v,y),o&&(o.faceIndex=Math.floor(p/3),t.push(o))}else if(void 0!==c)if(Array.isArray(r))for(let h=0,m=d.length;h<m;h++){const p=d[h],g=r[p.materialIndex];for(let y=Math.max(p.start,f.start),x=Math.min(c.count,Math.min(p.start+p.count,f.start+f.count));y<x;y+=3)o=up(this,g,e,Yc,l,u,y,y+1,y+2),o&&(o.faceIndex=Math.floor(y/3),o.face.materialIndex=p.materialIndex,t.push(o))}else for(let p=Math.max(0,f.start),g=Math.min(c.count,f.start+f.count);p<g;p+=3)o=up(this,r,e,Yc,l,u,p,p+1,p+2),o&&(o.faceIndex=Math.floor(p/3),t.push(o))}}function up(n,e,t,i,r,s,o,a,c){n.getVertexPosition(o,Ju),n.getVertexPosition(a,Qu),n.getVertexPosition(c,ed);const l=function wV(n,e,t,i,r,s,o,a){let c;if(c=e.side===ir?i.intersectTriangle(o,s,r,!0,a):i.intersectTriangle(r,s,o,e.side===bs,a),null===c)return null;lp.copy(a),lp.applyMatrix4(n.matrixWorld);const l=t.ray.origin.distanceTo(lp);return l<t.near||l>t.far?null:{distance:l,point:lp.clone(),object:n}}(n,e,t,i,Ju,Qu,ed,Iv);if(l){r&&(op.fromBufferAttribute(r,o),ap.fromBufferAttribute(r,a),cp.fromBufferAttribute(r,c),l.uv=Ir.getUV(Iv,Ju,Qu,ed,op,ap,cp,new ce)),s&&(op.fromBufferAttribute(s,o),ap.fromBufferAttribute(s,a),cp.fromBufferAttribute(s,c),l.uv2=Ir.getUV(Iv,Ju,Qu,ed,op,ap,cp,new ce));const u={a:o,b:a,c,normal:new T,materialIndex:0};Ir.getNormal(Ju,Qu,ed,u.normal),l.face=u}return l}class Io extends Pt{constructor(e=1,t=1,i=1,r=1,s=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:r,heightSegments:s,depthSegments:o};const a=this;r=Math.floor(r),s=Math.floor(s),o=Math.floor(o);const c=[],l=[],u=[],d=[];let f=0,h=0;function m(p,g,_,v,y,x,w,M,A,b,S){const R=x/A,B=w/b,G=x/2,k=w/2,N=M/2,q=A+1,ne=b+1;let pe=0,re=0;const he=new T;for(let ue=0;ue<ne;ue++){const ke=ue*B-k;for(let $=0;$<q;$++)he[p]=($*R-G)*v,he[g]=ke*y,he[_]=N,l.push(he.x,he.y,he.z),he[p]=0,he[g]=0,he[_]=M>0?1:-1,u.push(he.x,he.y,he.z),d.push($/A),d.push(1-ue/b),pe+=1}for(let ue=0;ue<b;ue++)for(let ke=0;ke<A;ke++){const de=f+ke+q*(ue+1),_e=f+(ke+1)+q*(ue+1),xe=f+(ke+1)+q*ue;c.push(f+ke+q*ue,de,xe),c.push(de,_e,xe),re+=6}a.addGroup(h,re,S),h+=re,f+=pe}m("z","y","x",-1,-1,i,t,e,o,s,0),m("z","y","x",1,-1,i,t,-e,o,s,1),m("x","z","y",1,1,e,i,t,r,o,2),m("x","z","y",1,-1,e,i,-t,r,o,3),m("x","y","z",1,-1,e,t,i,r,s,4),m("x","y","z",-1,-1,e,t,-i,r,s,5),this.setIndex(c),this.setAttribute("position",new Ve(l,3)),this.setAttribute("normal",new Ve(u,3)),this.setAttribute("uv",new Ve(d,2))}static fromJSON(e){return new Io(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function Kc(n){const e={};for(const t in n){e[t]={};for(const i in n[t]){const r=n[t][i];e[t][i]=r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?r.clone():Array.isArray(r)?r.slice():r}}return e}function $i(n){const e={};for(let t=0;t<n.length;t++){const i=Kc(n[t]);for(const r in i)e[r]=i[r]}return e}function oC(n){return null===n.getRenderTarget()&&n.outputEncoding===Qt?Kr:Uc}const aC={clone:Kc,merge:$i};class Ss extends ui{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Kc(e.uniforms),this.uniformsGroups=function MV(n){const e=[];for(let t=0;t<n.length;t++)e.push(n[t].clone());return e}(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const r in this.uniforms){const o=this.uniforms[r].value;t.uniforms[r]=o&&o.isTexture?{type:"t",value:o.toJSON(e).uuid}:o&&o.isColor?{type:"c",value:o.getHex()}:o&&o.isVector2?{type:"v2",value:o.toArray()}:o&&o.isVector3?{type:"v3",value:o.toArray()}:o&&o.isVector4?{type:"v4",value:o.toArray()}:o&&o.isMatrix3?{type:"m3",value:o.toArray()}:o&&o.isMatrix4?{type:"m4",value:o.toArray()}:{value:o}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;const i={};for(const r in this.extensions)!0===this.extensions[r]&&(i[r]=!0);return Object.keys(i).length>0&&(t.extensions=i),t}}class dp extends _n{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new pt,this.projectionMatrix=new pt,this.projectionMatrixInverse=new pt}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}class di extends dp{constructor(e=50,t=1,i=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*Wu*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*ca*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*Wu*Math.atan(Math.tan(.5*ca*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,i,r,s,o){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(.5*ca*this.fov)/this.zoom,i=2*t,r=this.aspect*i,s=-.5*r;const o=this.view;if(null!==this.view&&this.view.enabled){const c=o.fullWidth,l=o.fullHeight;s+=o.offsetX*r/c,t-=o.offsetY*i/l,r*=o.width/c,i*=o.height/l}const a=this.filmOffset;0!==a&&(s+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+r,t,t-i,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}class cC extends _n{constructor(e,t,i){super(),this.type="CubeCamera",this.renderTarget=i;const r=new di(-90,1,e,t);r.layers=this.layers,r.up.set(0,1,0),r.lookAt(1,0,0),this.add(r);const s=new di(-90,1,e,t);s.layers=this.layers,s.up.set(0,1,0),s.lookAt(-1,0,0),this.add(s);const o=new di(-90,1,e,t);o.layers=this.layers,o.up.set(0,0,-1),o.lookAt(0,1,0),this.add(o);const a=new di(-90,1,e,t);a.layers=this.layers,a.up.set(0,0,1),a.lookAt(0,-1,0),this.add(a);const c=new di(-90,1,e,t);c.layers=this.layers,c.up.set(0,1,0),c.lookAt(0,0,1),this.add(c);const l=new di(-90,1,e,t);l.layers=this.layers,l.up.set(0,1,0),l.lookAt(0,0,-1),this.add(l)}update(e,t){null===this.parent&&this.updateMatrixWorld();const i=this.renderTarget,[r,s,o,a,c,l]=this.children,u=e.getRenderTarget(),d=e.toneMapping,f=e.xr.enabled;e.toneMapping=Yr,e.xr.enabled=!1;const h=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0),e.render(t,r),e.setRenderTarget(i,1),e.render(t,s),e.setRenderTarget(i,2),e.render(t,o),e.setRenderTarget(i,3),e.render(t,a),e.setRenderTarget(i,4),e.render(t,c),i.texture.generateMipmaps=h,e.setRenderTarget(i,5),e.render(t,l),e.setRenderTarget(u),e.toneMapping=d,e.xr.enabled=f,i.texture.needsPMREMUpdate=!0}}class td extends Ti{constructor(e,t,i,r,s,o,a,c,l,u){super(e=void 0!==e?e:[],t=void 0!==t?t:yo,i,r,s,o,a,c,l,u),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class lC extends Qr{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const i={width:e,height:e,depth:1};this.texture=new td([i,i,i,i,i,i],t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:Fn}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const i_uniforms={tEquirect:{value:null}},i_vertexShader="\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",i_fragmentShader="\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",r=new Io(5,5,5),s=new Ss({name:"CubemapFromEquirect",uniforms:Kc(i_uniforms),vertexShader:i_vertexShader,fragmentShader:i_fragmentShader,side:ir,blending:Ws});s.uniforms.tEquirect.value=t;const o=new yi(r,s),a=t.minFilter;return t.minFilter===Ms&&(t.minFilter=Fn),new cC(1,10,this).update(e,o),t.minFilter=a,o.geometry.dispose(),o.material.dispose(),this}clear(e,t,i,r){const s=e.getRenderTarget();for(let o=0;o<6;o++)e.setRenderTarget(this,o),e.clear(t,i,r);e.setRenderTarget(s)}}const Rv=new T,TV=new T,DV=new ji;class Ro{constructor(e=new T(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,r){return this.normal.set(e,t,i),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){const r=Rv.subVectors(i,t).cross(TV.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){const i=e.delta(Rv),r=this.normal.dot(i);if(0===r)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;const s=-(e.start.dot(this.normal)+this.constant)/r;return s<0||s>1?null:t.copy(i).multiplyScalar(s).add(e.start)}intersectsLine(e){const t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const i=t||DV.getNormalMatrix(e),r=this.coplanarPoint(Rv).applyMatrix4(e),s=this.normal.applyMatrix3(i).normalize();return this.constant=-r.dot(s),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}const el=new Do,fp=new T;class hp{constructor(e=new Ro,t=new Ro,i=new Ro,r=new Ro,s=new Ro,o=new Ro){this.planes=[e,t,i,r,s,o]}set(e,t,i,r,s,o){const a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(i),a[3].copy(r),a[4].copy(s),a[5].copy(o),this}copy(e){const t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e){const t=this.planes,i=e.elements,r=i[0],s=i[1],o=i[2],a=i[3],c=i[4],l=i[5],u=i[6],d=i[7],f=i[8],h=i[9],m=i[10],p=i[11],g=i[12],_=i[13],v=i[14],y=i[15];return t[0].setComponents(a-r,d-c,p-f,y-g).normalize(),t[1].setComponents(a+r,d+c,p+f,y+g).normalize(),t[2].setComponents(a+s,d+l,p+h,y+_).normalize(),t[3].setComponents(a-s,d-l,p-h,y-_).normalize(),t[4].setComponents(a-o,d-u,p-m,y-v).normalize(),t[5].setComponents(a+o,d+u,p+m,y+v).normalize(),this}intersectsObject(e){const t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),el.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(el)}intersectsSprite(e){return el.center.set(0,0,0),el.radius=.7071067811865476,el.applyMatrix4(e.matrixWorld),this.intersectsSphere(el)}intersectsSphere(e){const t=this.planes,i=e.center,r=-e.radius;for(let s=0;s<6;s++)if(t[s].distanceToPoint(i)<r)return!1;return!0}intersectsBox(e){const t=this.planes;for(let i=0;i<6;i++){const r=t[i];if(fp.x=r.normal.x>0?e.max.x:e.min.x,fp.y=r.normal.y>0?e.max.y:e.min.y,fp.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(fp)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function uC(){let n=null,e=!1,t=null,i=null;function r(s,o){t(s,o),i=n.requestAnimationFrame(r)}return{start:function(){!0!==e&&null!==t&&(i=n.requestAnimationFrame(r),e=!0)},stop:function(){n.cancelAnimationFrame(i),e=!1},setAnimationLoop:function(s){t=s},setContext:function(s){n=s}}}function CV(n,e){const t=e.isWebGL2,i=new WeakMap;return{get:function o(l){return l.isInterleavedBufferAttribute&&(l=l.data),i.get(l)},remove:function a(l){l.isInterleavedBufferAttribute&&(l=l.data);const u=i.get(l);u&&(n.deleteBuffer(u.buffer),i.delete(l))},update:function c(l,u){if(l.isGLBufferAttribute){const f=i.get(l);return void((!f||f.version<l.version)&&i.set(l,{buffer:l.buffer,type:l.type,bytesPerElement:l.elementSize,version:l.version}))}l.isInterleavedBufferAttribute&&(l=l.data);const d=i.get(l);void 0===d?i.set(l,function r(l,u){const d=l.array,f=l.usage,h=n.createBuffer();let m;if(n.bindBuffer(u,h),n.bufferData(u,d,f),l.onUploadCallback(),d instanceof Float32Array)m=5126;else if(d instanceof Uint16Array)if(l.isFloat16BufferAttribute){if(!t)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");m=5131}else m=5123;else if(d instanceof Int16Array)m=5122;else if(d instanceof Uint32Array)m=5125;else if(d instanceof Int32Array)m=5124;else if(d instanceof Int8Array)m=5120;else if(d instanceof Uint8Array)m=5121;else{if(!(d instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+d);m=5121}return{buffer:h,type:m,bytesPerElement:d.BYTES_PER_ELEMENT,version:l.version}}(l,u)):d.version<l.version&&(function s(l,u,d){const f=u.array,h=u.updateRange;n.bindBuffer(d,l),-1===h.count?n.bufferSubData(d,0,f):(t?n.bufferSubData(d,h.offset*f.BYTES_PER_ELEMENT,f,h.offset,h.count):n.bufferSubData(d,h.offset*f.BYTES_PER_ELEMENT,f.subarray(h.offset,h.offset+h.count)),h.count=-1),u.onUploadCallback()}(d.buffer,l,u),d.version=l.version)}}}class tl extends Pt{constructor(e=1,t=1,i=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:r};const s=e/2,o=t/2,a=Math.floor(i),c=Math.floor(r),l=a+1,u=c+1,d=e/a,f=t/c,h=[],m=[],p=[],g=[];for(let _=0;_<u;_++){const v=_*f-o;for(let y=0;y<l;y++)m.push(y*d-s,-v,0),p.push(0,0,1),g.push(y/a),g.push(1-_/c)}for(let _=0;_<c;_++)for(let v=0;v<a;v++){const x=v+l*(_+1),w=v+1+l*(_+1),M=v+1+l*_;h.push(v+l*_,x,M),h.push(x,w,M)}this.setIndex(h),this.setAttribute("position",new Ve(m,3)),this.setAttribute("normal",new Ve(p,3)),this.setAttribute("uv",new Ve(g,2))}static fromJSON(e){return new tl(e.width,e.height,e.widthSegments,e.heightSegments)}}const Lt={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( V * D );\n}\n#ifdef USE_IRIDESCENCE\n\tvec3 BRDF_GGX_Iridescence( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float iridescence, const in vec3 iridescenceFresnel, const in float roughness ) {\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = mix( F_Schlick( f0, f90, dotVH ), iridescenceFresnel, iridescence );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\t return vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat R21 = R12;\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = dFdx( surf_pos.xyz );\n\t\tvec3 vSigmaY = dFdy( surf_pos.xyz );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat luminance( const in vec3 rgb ) {\n\tconst vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );\n\treturn dot( weights, rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_v0 0.339\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_v1 0.276\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_v4 0.046\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_v5 0.016\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_v6 0.0038\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"vec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#else\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULARINTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;\n\t\t#endif\n\t\t#ifdef USE_SPECULARCOLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vUv ).rgb;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;\n\t#endif\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec3 sheenSpecular = vec3( 0.0 );\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\treflectedLight.directSpecular += irradiance * BRDF_GGX_Iridescence( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness );\n\t#else\n\t\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometry.viewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry.normal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform ivec2 morphTargetsTextureSize;\n\t\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",output_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha + 0.1;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec2 packDepthToRG( in highp float v ) {\n\treturn packDepthToRGBA( v ).yx;\n}\nfloat unpackRGToDepth( const in highp vec2 v ) {\n\treturn unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n  uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n  uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\tvec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tuniform int boneTextureSize;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tfloat j = i * 4.0;\n\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\ty = dy * ( y + 0.5 );\n\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\treturn bone;\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmission = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmission.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\t#ifdef texture2DLodEXT\n\t\t\treturn texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#else\n\t\t\treturn texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#endif\n\t}\n\tvec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn radiance;\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance * radiance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );\n\t}\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\ttexColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",backgroundCube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",backgroundCube_frag:"#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULARINTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n\t#ifdef USE_SPECULARCOLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;\n\t#endif\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}"},Ee={common:{diffuse:{value:new De(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new ji},uv2Transform:{value:new ji},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new ce(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new De(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new De(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new ji}},sprite:{diffuse:{value:new De(16777215)},opacity:{value:1},center:{value:new ce(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new ji}}},ns={basic:{uniforms:$i([Ee.common,Ee.specularmap,Ee.envmap,Ee.aomap,Ee.lightmap,Ee.fog]),vertexShader:Lt.meshbasic_vert,fragmentShader:Lt.meshbasic_frag},lambert:{uniforms:$i([Ee.common,Ee.specularmap,Ee.envmap,Ee.aomap,Ee.lightmap,Ee.emissivemap,Ee.bumpmap,Ee.normalmap,Ee.displacementmap,Ee.fog,Ee.lights,{emissive:{value:new De(0)}}]),vertexShader:Lt.meshlambert_vert,fragmentShader:Lt.meshlambert_frag},phong:{uniforms:$i([Ee.common,Ee.specularmap,Ee.envmap,Ee.aomap,Ee.lightmap,Ee.emissivemap,Ee.bumpmap,Ee.normalmap,Ee.displacementmap,Ee.fog,Ee.lights,{emissive:{value:new De(0)},specular:{value:new De(1118481)},shininess:{value:30}}]),vertexShader:Lt.meshphong_vert,fragmentShader:Lt.meshphong_frag},standard:{uniforms:$i([Ee.common,Ee.envmap,Ee.aomap,Ee.lightmap,Ee.emissivemap,Ee.bumpmap,Ee.normalmap,Ee.displacementmap,Ee.roughnessmap,Ee.metalnessmap,Ee.fog,Ee.lights,{emissive:{value:new De(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Lt.meshphysical_vert,fragmentShader:Lt.meshphysical_frag},toon:{uniforms:$i([Ee.common,Ee.aomap,Ee.lightmap,Ee.emissivemap,Ee.bumpmap,Ee.normalmap,Ee.displacementmap,Ee.gradientmap,Ee.fog,Ee.lights,{emissive:{value:new De(0)}}]),vertexShader:Lt.meshtoon_vert,fragmentShader:Lt.meshtoon_frag},matcap:{uniforms:$i([Ee.common,Ee.bumpmap,Ee.normalmap,Ee.displacementmap,Ee.fog,{matcap:{value:null}}]),vertexShader:Lt.meshmatcap_vert,fragmentShader:Lt.meshmatcap_frag},points:{uniforms:$i([Ee.points,Ee.fog]),vertexShader:Lt.points_vert,fragmentShader:Lt.points_frag},dashed:{uniforms:$i([Ee.common,Ee.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Lt.linedashed_vert,fragmentShader:Lt.linedashed_frag},depth:{uniforms:$i([Ee.common,Ee.displacementmap]),vertexShader:Lt.depth_vert,fragmentShader:Lt.depth_frag},normal:{uniforms:$i([Ee.common,Ee.bumpmap,Ee.normalmap,Ee.displacementmap,{opacity:{value:1}}]),vertexShader:Lt.meshnormal_vert,fragmentShader:Lt.meshnormal_frag},sprite:{uniforms:$i([Ee.sprite,Ee.fog]),vertexShader:Lt.sprite_vert,fragmentShader:Lt.sprite_frag},background:{uniforms:{uvTransform:{value:new ji},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Lt.background_vert,fragmentShader:Lt.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:Lt.backgroundCube_vert,fragmentShader:Lt.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Lt.cube_vert,fragmentShader:Lt.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Lt.equirect_vert,fragmentShader:Lt.equirect_frag},distanceRGBA:{uniforms:$i([Ee.common,Ee.displacementmap,{referencePosition:{value:new T},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Lt.distanceRGBA_vert,fragmentShader:Lt.distanceRGBA_frag},shadow:{uniforms:$i([Ee.lights,Ee.fog,{color:{value:new De(0)},opacity:{value:1}}]),vertexShader:Lt.shadow_vert,fragmentShader:Lt.shadow_frag}};ns.physical={uniforms:$i([ns.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new ce(1,1)},clearcoatNormalMap:{value:null},iridescence:{value:0},iridescenceMap:{value:null},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},sheen:{value:0},sheenColor:{value:new De(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new ce},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new De(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new De(1,1,1)},specularColorMap:{value:null}}]),vertexShader:Lt.meshphysical_vert,fragmentShader:Lt.meshphysical_frag};const pp={r:0,b:0,g:0};function DH(n,e,t,i,r,s,o){const a=new De(0);let l,u,c=!0===s?0:1,d=null,f=0,h=null;function p(g,_){g.getRGB(pp,oC(n)),i.buffers.color.setClear(pp.r,pp.g,pp.b,_,o)}return{getClearColor:function(){return a},setClearColor:function(g,_=1){a.set(g),c=_,p(a,c)},getClearAlpha:function(){return c},setClearAlpha:function(g){c=g,p(a,c)},render:function m(g,_){let v=!1,y=!0===_.isScene?_.background:null;y&&y.isTexture&&(y=(_.backgroundBlurriness>0?t:e).get(y));const x=n.xr,w=x.getSession&&x.getSession();w&&"additive"===w.environmentBlendMode&&(y=null),null===y?p(a,c):y&&y.isColor&&(p(y,1),v=!0),(n.autoClear||v)&&n.clear(n.autoClearColor,n.autoClearDepth,n.autoClearStencil),y&&(y.isCubeTexture||y.mapping===Nc)?(void 0===u&&(u=new yi(new Io(1,1,1),new Ss({name:"BackgroundCubeMaterial",uniforms:Kc(ns.backgroundCube.uniforms),vertexShader:ns.backgroundCube.vertexShader,fragmentShader:ns.backgroundCube.fragmentShader,side:ir,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.deleteAttribute("normal"),u.geometry.deleteAttribute("uv"),u.onBeforeRender=function(M,A,b){this.matrixWorld.copyPosition(b.matrixWorld)},Object.defineProperty(u.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(u)),u.material.uniforms.envMap.value=y,u.material.uniforms.flipEnvMap.value=y.isCubeTexture&&!1===y.isRenderTargetTexture?-1:1,u.material.uniforms.backgroundBlurriness.value=_.backgroundBlurriness,u.material.uniforms.backgroundIntensity.value=_.backgroundIntensity,u.material.toneMapped=y.encoding!==Qt,(d!==y||f!==y.version||h!==n.toneMapping)&&(u.material.needsUpdate=!0,d=y,f=y.version,h=n.toneMapping),u.layers.enableAll(),g.unshift(u,u.geometry,u.material,0,0,null)):y&&y.isTexture&&(void 0===l&&(l=new yi(new tl(2,2),new Ss({name:"BackgroundMaterial",uniforms:Kc(ns.background.uniforms),vertexShader:ns.background.vertexShader,fragmentShader:ns.background.fragmentShader,side:bs,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(l)),l.material.uniforms.t2D.value=y,l.material.uniforms.backgroundIntensity.value=_.backgroundIntensity,l.material.toneMapped=y.encoding!==Qt,!0===y.matrixAutoUpdate&&y.updateMatrix(),l.material.uniforms.uvTransform.value.copy(y.matrix),(d!==y||f!==y.version||h!==n.toneMapping)&&(l.material.needsUpdate=!0,d=y,f=y.version,h=n.toneMapping),l.layers.enableAll(),g.unshift(l,l.geometry,l.material,0,0,null))}}}function CH(n,e,t,i){const r=n.getParameter(34921),s=i.isWebGL2?null:e.get("OES_vertex_array_object"),o=i.isWebGL2||null!==s,a={},c=g(null);let l=c,u=!1;function h(N){return i.isWebGL2?n.bindVertexArray(N):s.bindVertexArrayOES(N)}function m(N){return i.isWebGL2?n.deleteVertexArray(N):s.deleteVertexArrayOES(N)}function g(N){const q=[],ne=[],pe=[];for(let re=0;re<r;re++)q[re]=0,ne[re]=0,pe[re]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:q,enabledAttributes:ne,attributeDivisors:pe,object:N,attributes:{},index:null}}function y(){const N=l.newAttributes;for(let q=0,ne=N.length;q<ne;q++)N[q]=0}function x(N){w(N,0)}function w(N,q){const pe=l.enabledAttributes,re=l.attributeDivisors;l.newAttributes[N]=1,0===pe[N]&&(n.enableVertexAttribArray(N),pe[N]=1),re[N]!==q&&((i.isWebGL2?n:e.get("ANGLE_instanced_arrays"))[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](N,q),re[N]=q)}function M(){const N=l.newAttributes,q=l.enabledAttributes;for(let ne=0,pe=q.length;ne<pe;ne++)q[ne]!==N[ne]&&(n.disableVertexAttribArray(ne),q[ne]=0)}function A(N,q,ne,pe,re,he){!0!==i.isWebGL2||5124!==ne&&5125!==ne?n.vertexAttribPointer(N,q,ne,pe,re,he):n.vertexAttribIPointer(N,q,ne,re,he)}function G(){k(),u=!0,l!==c&&(l=c,h(l.object))}function k(){c.geometry=null,c.program=null,c.wireframe=!1}return{setup:function d(N,q,ne,pe,re){let he=!1;if(o){const ue=function p(N,q,ne){const pe=!0===ne.wireframe;let re=a[N.id];void 0===re&&(re={},a[N.id]=re);let he=re[q.id];void 0===he&&(he={},re[q.id]=he);let ue=he[pe];return void 0===ue&&(ue=g(function f(){return i.isWebGL2?n.createVertexArray():s.createVertexArrayOES()}()),he[pe]=ue),ue}(pe,ne,q);l!==ue&&(l=ue,h(l.object)),he=function _(N,q,ne,pe){const re=l.attributes,he=q.attributes;let ue=0;const ke=ne.getAttributes();for(const $ in ke)if(ke[$].location>=0){const _e=re[$];let xe=he[$];if(void 0===xe&&("instanceMatrix"===$&&N.instanceMatrix&&(xe=N.instanceMatrix),"instanceColor"===$&&N.instanceColor&&(xe=N.instanceColor)),void 0===_e||_e.attribute!==xe||xe&&_e.data!==xe.data)return!0;ue++}return l.attributesNum!==ue||l.index!==pe}(N,pe,ne,re),he&&function v(N,q,ne,pe){const re={},he=q.attributes;let ue=0;const ke=ne.getAttributes();for(const $ in ke)if(ke[$].location>=0){let _e=he[$];void 0===_e&&("instanceMatrix"===$&&N.instanceMatrix&&(_e=N.instanceMatrix),"instanceColor"===$&&N.instanceColor&&(_e=N.instanceColor));const xe={};xe.attribute=_e,_e&&_e.data&&(xe.data=_e.data),re[$]=xe,ue++}l.attributes=re,l.attributesNum=ue,l.index=pe}(N,pe,ne,re)}else{const ue=!0===q.wireframe;(l.geometry!==pe.id||l.program!==ne.id||l.wireframe!==ue)&&(l.geometry=pe.id,l.program=ne.id,l.wireframe=ue,he=!0)}null!==re&&t.update(re,34963),(he||u)&&(u=!1,function b(N,q,ne,pe){if(!1===i.isWebGL2&&(N.isInstancedMesh||pe.isInstancedBufferGeometry)&&null===e.get("ANGLE_instanced_arrays"))return;y();const re=pe.attributes,he=ne.getAttributes(),ue=q.defaultAttributeValues;for(const ke in he){const $=he[ke];if($.location>=0){let de=re[ke];if(void 0===de&&("instanceMatrix"===ke&&N.instanceMatrix&&(de=N.instanceMatrix),"instanceColor"===ke&&N.instanceColor&&(de=N.instanceColor)),void 0!==de){const _e=de.normalized,xe=de.itemSize,j=t.get(de);if(void 0===j)continue;const $e=j.buffer,Oe=j.type,Ge=j.bytesPerElement;if(de.isInterleavedBufferAttribute){const be=de.data,Nt=be.stride,ae=de.offset;if(be.isInstancedInterleavedBuffer){for(let oe=0;oe<$.locationSize;oe++)w($.location+oe,be.meshPerAttribute);!0!==N.isInstancedMesh&&void 0===pe._maxInstanceCount&&(pe._maxInstanceCount=be.meshPerAttribute*be.count)}else for(let oe=0;oe<$.locationSize;oe++)x($.location+oe);n.bindBuffer(34962,$e);for(let oe=0;oe<$.locationSize;oe++)A($.location+oe,xe/$.locationSize,Oe,_e,Nt*Ge,(ae+xe/$.locationSize*oe)*Ge)}else{if(de.isInstancedBufferAttribute){for(let be=0;be<$.locationSize;be++)w($.location+be,de.meshPerAttribute);!0!==N.isInstancedMesh&&void 0===pe._maxInstanceCount&&(pe._maxInstanceCount=de.meshPerAttribute*de.count)}else for(let be=0;be<$.locationSize;be++)x($.location+be);n.bindBuffer(34962,$e);for(let be=0;be<$.locationSize;be++)A($.location+be,xe/$.locationSize,Oe,_e,xe*Ge,xe/$.locationSize*be*Ge)}}else if(void 0!==ue){const _e=ue[ke];if(void 0!==_e)switch(_e.length){case 2:n.vertexAttrib2fv($.location,_e);break;case 3:n.vertexAttrib3fv($.location,_e);break;case 4:n.vertexAttrib4fv($.location,_e);break;default:n.vertexAttrib1fv($.location,_e)}}}}M()}(N,q,ne,pe),null!==re&&n.bindBuffer(34963,t.get(re).buffer))},reset:G,resetDefaultState:k,dispose:function S(){G();for(const N in a){const q=a[N];for(const ne in q){const pe=q[ne];for(const re in pe)m(pe[re].object),delete pe[re];delete q[ne]}delete a[N]}},releaseStatesOfGeometry:function R(N){if(void 0===a[N.id])return;const q=a[N.id];for(const ne in q){const pe=q[ne];for(const re in pe)m(pe[re].object),delete pe[re];delete q[ne]}delete a[N.id]},releaseStatesOfProgram:function B(N){for(const q in a){const ne=a[q];if(void 0===ne[N.id])continue;const pe=ne[N.id];for(const re in pe)m(pe[re].object),delete pe[re];delete ne[N.id]}},initAttributes:y,enableAttribute:x,disableUnusedAttributes:M}}function AH(n,e,t,i){const r=i.isWebGL2;let s;this.setMode=function o(l){s=l},this.render=function a(l,u){n.drawArrays(s,l,u),t.update(u,s,1)},this.renderInstances=function c(l,u,d){if(0===d)return;let f,h;if(r)f=n,h="drawArraysInstanced";else if(f=e.get("ANGLE_instanced_arrays"),h="drawArraysInstancedANGLE",null===f)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");f[h](s,l,u,d),t.update(u,s,d)}}function IH(n,e,t){let i;function s(A){if("highp"===A){if(n.getShaderPrecisionFormat(35633,36338).precision>0&&n.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";A="mediump"}return"mediump"===A&&n.getShaderPrecisionFormat(35633,36337).precision>0&&n.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const o=typeof WebGL2RenderingContext<"u"&&n instanceof WebGL2RenderingContext;let a=void 0!==t.precision?t.precision:"highp";const c=s(a);c!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",c,"instead."),a=c);const l=o||e.has("WEBGL_draw_buffers"),u=!0===t.logarithmicDepthBuffer,d=n.getParameter(34930),f=n.getParameter(35660),h=n.getParameter(3379),m=n.getParameter(34076),p=n.getParameter(34921),g=n.getParameter(36347),_=n.getParameter(36348),v=n.getParameter(36349),y=f>0,x=o||e.has("OES_texture_float");return{isWebGL2:o,drawBuffers:l,getMaxAnisotropy:function r(){if(void 0!==i)return i;if(!0===e.has("EXT_texture_filter_anisotropic")){const A=e.get("EXT_texture_filter_anisotropic");i=n.getParameter(A.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i},getMaxPrecision:s,precision:a,logarithmicDepthBuffer:u,maxTextures:d,maxVertexTextures:f,maxTextureSize:h,maxCubemapSize:m,maxAttributes:p,maxVertexUniforms:g,maxVaryings:_,maxFragmentUniforms:v,vertexTextures:y,floatFragmentTextures:x,floatVertexTextures:y&&x,maxSamples:o?n.getParameter(36183):0}}function RH(n){const e=this;let t=null,i=0,r=!1,s=!1;const o=new Ro,a=new ji,c={value:null,needsUpdate:!1};function u(d,f,h,m){const p=null!==d?d.length:0;let g=null;if(0!==p){if(g=c.value,!0!==m||null===g){const _=h+4*p,v=f.matrixWorldInverse;a.getNormalMatrix(v),(null===g||g.length<_)&&(g=new Float32Array(_));for(let y=0,x=h;y!==p;++y,x+=4)o.copy(d[y]).applyMatrix4(v,a),o.normal.toArray(g,x),g[x+3]=o.constant}c.value=g,c.needsUpdate=!0}return e.numPlanes=p,e.numIntersection=0,g}this.uniform=c,this.numPlanes=0,this.numIntersection=0,this.init=function(d,f){const h=0!==d.length||f||0!==i||r;return r=f,i=d.length,h},this.beginShadows=function(){s=!0,u(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(d,f){t=u(d,f,0)},this.setState=function(d,f,h){const m=d.clippingPlanes,p=d.clipIntersection,g=d.clipShadows,_=n.get(d);if(!r||null===m||0===m.length||s&&!g)s?u(null):function l(){c.value!==t&&(c.value=t,c.needsUpdate=i>0),e.numPlanes=i,e.numIntersection=0}();else{const v=s?0:i,y=4*v;let x=_.clippingState||null;c.value=x,x=u(m,f,y,h);for(let w=0;w!==y;++w)x[w]=t[w];_.clippingState=x,this.numIntersection=p?this.numPlanes:0,this.numPlanes+=v}}}function PH(n){let e=new WeakMap;function t(o,a){return a===Uu?o.mapping=yo:a===Vu&&(o.mapping=_o),o}function r(o){const a=o.target;a.removeEventListener("dispose",r);const c=e.get(a);void 0!==c&&(e.delete(a),c.dispose())}return{get:function i(o){if(o&&o.isTexture&&!1===o.isRenderTargetTexture){const a=o.mapping;if(a===Uu||a===Vu){if(e.has(o))return t(e.get(o).texture,o.mapping);{const c=o.image;if(c&&c.height>0){const l=new lC(c.height/2);return l.fromEquirectangularTexture(n,o),e.set(o,l),o.addEventListener("dispose",r),t(l.texture,o.mapping)}return null}}}return o},dispose:function s(){e=new WeakMap}}}class nl extends dp{constructor(e=-1,t=1,i=1,r=-1,s=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=r,this.near=s,this.far=o,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,i,r,s,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let s=i-e,o=i+e,a=r+t,c=r-t;if(null!==this.view&&this.view.enabled){const l=(this.right-this.left)/this.view.fullWidth/this.zoom,u=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=l*this.view.offsetX,o=s+l*this.view.width,a-=u*this.view.offsetY,c=a-u*this.view.height}this.projectionMatrix.makeOrthographic(s,o,a,c,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}const dC=[.125,.215,.35,.446,.526,.582],Pv=new nl,fC=new De;let Lv=null;const ga=(1+Math.sqrt(5))/2,rl=1/ga,hC=[new T(1,1,1),new T(-1,1,1),new T(1,1,-1),new T(-1,1,-1),new T(0,ga,rl),new T(0,ga,-rl),new T(rl,0,ga),new T(-rl,0,ga),new T(ga,rl,0),new T(-ga,rl,0)];class Nv{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,i=.1,r=100){Lv=this._renderer.getRenderTarget(),this._setSize(256);const s=this._allocateTargets();return s.depthBuffer=!0,this._sceneToCubeUV(e,i,r,s),t>0&&this._blur(s,0,0,t),this._applyPMREM(s),this._cleanup(s),s}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=gC(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=mC(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(Lv),e.scissorTest=!1,mp(e,0,0,e.width,e.height)}_fromTexture(e,t){this._setSize(e.mapping===yo||e.mapping===_o?0===e.image.length?16:e.image[0].width||e.image[0].image.width:e.image.width/4),Lv=this._renderer.getRenderTarget();const i=t||this._allocateTargets();return this._textureToCubeUV(e,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,i={magFilter:Fn,minFilter:Fn,generateMipmaps:!1,type:kc,format:dr,encoding:$s,depthBuffer:!1},r=pC(e,t,i);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=pC(e,t,i);const{_lodMax:s}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function LH(n){const e=[],t=[],i=[];let r=n;const s=n-4+1+dC.length;for(let o=0;o<s;o++){const a=Math.pow(2,r);t.push(a);let c=1/a;o>n-4?c=dC[o-n+4-1]:0===o&&(c=0),i.push(c);const l=1/(a-2),u=-l,d=1+l,f=[u,u,d,u,d,d,u,u,d,d,u,d],h=6,m=6,p=3,g=2,_=1,v=new Float32Array(p*m*h),y=new Float32Array(g*m*h),x=new Float32Array(_*m*h);for(let M=0;M<h;M++){const A=M%3*2/3-1,b=M>2?0:-1;v.set([A,b,0,A+2/3,b,0,A+2/3,b+1,0,A,b,0,A+2/3,b+1,0,A,b+1,0],p*m*M),y.set(f,g*m*M),x.set([M,M,M,M,M,M],_*m*M)}const w=new Pt;w.setAttribute("position",new an(v,p)),w.setAttribute("uv",new an(y,g)),w.setAttribute("faceIndex",new an(x,_)),e.push(w),r>4&&r--}return{lodPlanes:e,sizeLods:t,sigmas:i}}(s)),this._blurMaterial=function NH(n,e,t){const i=new Float32Array(20),r=new T(0,1,0);return new Ss({name:"SphericalGaussianBlur",defines:{n:20,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${n}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:Ws,depthTest:!1,depthWrite:!1})}(s,e,t)}return r}_compileMaterial(e){const t=new yi(this._lodPlanes[0],e);this._renderer.compile(t,Pv)}_sceneToCubeUV(e,t,i,r){const a=new di(90,1,t,i),c=[1,-1,1,1,1,1],l=[1,1,1,-1,-1,-1],u=this._renderer,d=u.autoClear,f=u.toneMapping;u.getClearColor(fC),u.toneMapping=Yr,u.autoClear=!1;const h=new pr({name:"PMREM.Background",side:ir,depthWrite:!1,depthTest:!1}),m=new yi(new Io,h);let p=!1;const g=e.background;g?g.isColor&&(h.color.copy(g),e.background=null,p=!0):(h.color.copy(fC),p=!0);for(let _=0;_<6;_++){const v=_%3;0===v?(a.up.set(0,c[_],0),a.lookAt(l[_],0,0)):1===v?(a.up.set(0,0,c[_]),a.lookAt(0,l[_],0)):(a.up.set(0,c[_],0),a.lookAt(0,0,l[_]));const y=this._cubeSize;mp(r,v*y,_>2?y:0,y,y),u.setRenderTarget(r),p&&u.render(m,a),u.render(e,a)}m.geometry.dispose(),m.material.dispose(),u.toneMapping=f,u.autoClear=d,e.background=g}_textureToCubeUV(e,t){const i=this._renderer,r=e.mapping===yo||e.mapping===_o;r?(null===this._cubemapMaterial&&(this._cubemapMaterial=gC()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===e.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=mC());const s=r?this._cubemapMaterial:this._equirectMaterial,o=new yi(this._lodPlanes[0],s);s.uniforms.envMap.value=e;const c=this._cubeSize;mp(t,0,0,3*c,2*c),i.setRenderTarget(t),i.render(o,Pv)}_applyPMREM(e){const t=this._renderer,i=t.autoClear;t.autoClear=!1;for(let r=1;r<this._lodPlanes.length;r++){const s=Math.sqrt(this._sigmas[r]*this._sigmas[r]-this._sigmas[r-1]*this._sigmas[r-1]);this._blur(e,r-1,r,s,hC[(r-1)%hC.length])}t.autoClear=i}_blur(e,t,i,r,s){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,i,r,"latitudinal",s),this._halfBlur(o,e,i,i,r,"longitudinal",s)}_halfBlur(e,t,i,r,s,o,a){const c=this._renderer,l=this._blurMaterial;"latitudinal"!==o&&"longitudinal"!==o&&console.error("blur direction must be either latitudinal or longitudinal!");const d=new yi(this._lodPlanes[r],l),f=l.uniforms,h=this._sizeLods[i]-1,m=isFinite(s)?Math.PI/(2*h):2*Math.PI/39,p=s/m,g=isFinite(s)?1+Math.floor(3*p):20;g>20&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${g} samples when the maximum is set to 20`);const _=[];let v=0;for(let A=0;A<20;++A){const b=A/p,S=Math.exp(-b*b/2);_.push(S),0===A?v+=S:A<g&&(v+=2*S)}for(let A=0;A<_.length;A++)_[A]=_[A]/v;f.envMap.value=e.texture,f.samples.value=g,f.weights.value=_,f.latitudinal.value="latitudinal"===o,a&&(f.poleAxis.value=a);const{_lodMax:y}=this;f.dTheta.value=m,f.mipInt.value=y-i;const x=this._sizeLods[r];mp(t,3*x*(r>y-4?r-y+4:0),4*(this._cubeSize-x),3*x,2*x),c.setRenderTarget(t),c.render(d,Pv)}}function pC(n,e,t){const i=new Qr(n,e,t);return i.texture.mapping=Nc,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function mp(n,e,t,i,r){n.viewport.set(e,t,i,r),n.scissor.set(e,t,i,r)}function mC(){return new Ss({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:Ws,depthTest:!1,depthWrite:!1})}function gC(){return new Ss({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:Ws,depthTest:!1,depthWrite:!1})}function OH(n){let e=new WeakMap,t=null;function s(a){const c=a.target;c.removeEventListener("dispose",s);const l=e.get(c);void 0!==l&&(e.delete(c),l.dispose())}return{get:function i(a){if(a&&a.isTexture){const c=a.mapping,l=c===Uu||c===Vu,u=c===yo||c===_o;if(l||u){if(a.isRenderTargetTexture&&!0===a.needsPMREMUpdate){a.needsPMREMUpdate=!1;let d=e.get(a);return null===t&&(t=new Nv(n)),d=l?t.fromEquirectangular(a,d):t.fromCubemap(a,d),e.set(a,d),d.texture}if(e.has(a))return e.get(a).texture;{const d=a.image;if(l&&d&&d.height>0||u&&d&&function r(a){let c=0;for(let u=0;u<6;u++)void 0!==a[u]&&c++;return 6===c}(d)){null===t&&(t=new Nv(n));const f=l?t.fromEquirectangular(a):t.fromCubemap(a);return e.set(a,f),a.addEventListener("dispose",s),f.texture}return null}}}return a},dispose:function o(){e=new WeakMap,null!==t&&(t.dispose(),t=null)}}}function FH(n){const e={};function t(i){if(void 0!==e[i])return e[i];let r;switch(i){case"WEBGL_depth_texture":r=n.getExtension("WEBGL_depth_texture")||n.getExtension("MOZ_WEBGL_depth_texture")||n.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=n.getExtension("WEBGL_compressed_texture_s3tc")||n.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=n.getExtension("WEBGL_compressed_texture_pvrtc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=n.getExtension(i)}return e[i]=r,r}return{has:function(i){return null!==t(i)},init:function(i){i.isWebGL2?t("EXT_color_buffer_float"):(t("WEBGL_depth_texture"),t("OES_texture_float"),t("OES_texture_half_float"),t("OES_texture_half_float_linear"),t("OES_standard_derivatives"),t("OES_element_index_uint"),t("OES_vertex_array_object"),t("ANGLE_instanced_arrays")),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture")},get:function(i){const r=t(i);return null===r&&console.warn("THREE.WebGLRenderer: "+i+" extension not supported."),r}}}function kH(n,e,t,i){const r={},s=new WeakMap;function o(d){const f=d.target;null!==f.index&&e.remove(f.index);for(const m in f.attributes)e.remove(f.attributes[m]);f.removeEventListener("dispose",o),delete r[f.id];const h=s.get(f);h&&(e.remove(h),s.delete(f)),i.releaseStatesOfGeometry(f),!0===f.isInstancedBufferGeometry&&delete f._maxInstanceCount,t.memory.geometries--}function l(d){const f=[],h=d.index,m=d.attributes.position;let p=0;if(null!==h){const v=h.array;p=h.version;for(let y=0,x=v.length;y<x;y+=3){const w=v[y+0],M=v[y+1],A=v[y+2];f.push(w,M,M,A,A,w)}}else{p=m.version;for(let y=0,x=m.array.length/3-1;y<x;y+=3){const w=y+0,M=y+1,A=y+2;f.push(w,M,M,A,A,w)}}const g=new(qD(f)?Tv:Ev)(f,1);g.version=p;const _=s.get(d);_&&e.remove(_),s.set(d,g)}return{get:function a(d,f){return!0===r[f.id]||(f.addEventListener("dispose",o),r[f.id]=!0,t.memory.geometries++),f},update:function c(d){const f=d.attributes;for(const m in f)e.update(f[m],34962);const h=d.morphAttributes;for(const m in h){const p=h[m];for(let g=0,_=p.length;g<_;g++)e.update(p[g],34962)}},getWireframeAttribute:function u(d){const f=s.get(d);if(f){const h=d.index;null!==h&&f.version<h.version&&l(d)}else l(d);return s.get(d)}}}function BH(n,e,t,i){const r=i.isWebGL2;let s,a,c;this.setMode=function o(f){s=f},this.setIndex=function l(f){a=f.type,c=f.bytesPerElement},this.render=function u(f,h){n.drawElements(s,h,a,f*c),t.update(h,s,1)},this.renderInstances=function d(f,h,m){if(0===m)return;let p,g;if(r)p=n,g="drawElementsInstanced";else if(p=e.get("ANGLE_instanced_arrays"),g="drawElementsInstancedANGLE",null===p)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");p[g](s,h,a,f*c,m),t.update(h,s,m)}}function UH(n){const t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function r(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function i(s,o,a){switch(t.calls++,o){case 4:t.triangles+=a*(s/3);break;case 1:t.lines+=a*(s/2);break;case 3:t.lines+=a*(s-1);break;case 2:t.lines+=a*s;break;case 0:t.points+=a*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",o)}}}}function VH(n,e){return n[0]-e[0]}function zH(n,e){return Math.abs(e[1])-Math.abs(n[1])}function HH(n,e,t){const i={},r=new Float32Array(8),s=new WeakMap,o=new dn,a=[];for(let l=0;l<8;l++)a[l]=[l,0];return{update:function c(l,u,d,f){const h=l.morphTargetInfluences;if(!0===e.isWebGL2){const m=u.morphAttributes.position||u.morphAttributes.normal||u.morphAttributes.color,p=void 0!==m?m.length:0;let g=s.get(u);if(void 0===g||g.count!==p){let q=function(){k.dispose(),s.delete(u),u.removeEventListener("dispose",q)};void 0!==g&&g.texture.dispose();const y=void 0!==u.morphAttributes.position,x=void 0!==u.morphAttributes.normal,w=void 0!==u.morphAttributes.color,M=u.morphAttributes.position||[],A=u.morphAttributes.normal||[],b=u.morphAttributes.color||[];let S=0;!0===y&&(S=1),!0===x&&(S=2),!0===w&&(S=3);let R=u.attributes.position.count*S,B=1;R>e.maxTextureSize&&(B=Math.ceil(R/e.maxTextureSize),R=e.maxTextureSize);const G=new Float32Array(R*B*4*p),k=new Kh(G,R,B,p);k.type=js,k.needsUpdate=!0;const N=4*S;for(let ne=0;ne<p;ne++){const pe=M[ne],re=A[ne],he=b[ne],ue=R*B*4*ne;for(let ke=0;ke<pe.count;ke++){const $=ke*N;!0===y&&(o.fromBufferAttribute(pe,ke),G[ue+$+0]=o.x,G[ue+$+1]=o.y,G[ue+$+2]=o.z,G[ue+$+3]=0),!0===x&&(o.fromBufferAttribute(re,ke),G[ue+$+4]=o.x,G[ue+$+5]=o.y,G[ue+$+6]=o.z,G[ue+$+7]=0),!0===w&&(o.fromBufferAttribute(he,ke),G[ue+$+8]=o.x,G[ue+$+9]=o.y,G[ue+$+10]=o.z,G[ue+$+11]=4===he.itemSize?o.w:1)}}g={count:p,texture:k,size:new ce(R,B)},s.set(u,g),u.addEventListener("dispose",q)}let _=0;for(let y=0;y<h.length;y++)_+=h[y];const v=u.morphTargetsRelative?1:1-_;f.getUniforms().setValue(n,"morphTargetBaseInfluence",v),f.getUniforms().setValue(n,"morphTargetInfluences",h),f.getUniforms().setValue(n,"morphTargetsTexture",g.texture,t),f.getUniforms().setValue(n,"morphTargetsTextureSize",g.size)}else{const m=void 0===h?0:h.length;let p=i[u.id];if(void 0===p||p.length!==m){p=[];for(let x=0;x<m;x++)p[x]=[x,0];i[u.id]=p}for(let x=0;x<m;x++){const w=p[x];w[0]=x,w[1]=h[x]}p.sort(zH);for(let x=0;x<8;x++)x<m&&p[x][1]?(a[x][0]=p[x][0],a[x][1]=p[x][1]):(a[x][0]=Number.MAX_SAFE_INTEGER,a[x][1]=0);a.sort(VH);const g=u.morphAttributes.position,_=u.morphAttributes.normal;let v=0;for(let x=0;x<8;x++){const w=a[x],M=w[0],A=w[1];M!==Number.MAX_SAFE_INTEGER&&A?(g&&u.getAttribute("morphTarget"+x)!==g[M]&&u.setAttribute("morphTarget"+x,g[M]),_&&u.getAttribute("morphNormal"+x)!==_[M]&&u.setAttribute("morphNormal"+x,_[M]),r[x]=A,v+=A):(g&&!0===u.hasAttribute("morphTarget"+x)&&u.deleteAttribute("morphTarget"+x),_&&!0===u.hasAttribute("morphNormal"+x)&&u.deleteAttribute("morphNormal"+x),r[x]=0)}const y=u.morphTargetsRelative?1:1-v;f.getUniforms().setValue(n,"morphTargetBaseInfluence",y),f.getUniforms().setValue(n,"morphTargetInfluences",r)}}}}function GH(n,e,t,i){let r=new WeakMap;function a(c){const l=c.target;l.removeEventListener("dispose",a),t.remove(l.instanceMatrix),null!==l.instanceColor&&t.remove(l.instanceColor)}return{update:function s(c){const l=i.render.frame,d=e.get(c,c.geometry);return r.get(d)!==l&&(e.update(d),r.set(d,l)),c.isInstancedMesh&&(!1===c.hasEventListener("dispose",a)&&c.addEventListener("dispose",a),t.update(c.instanceMatrix,34962),null!==c.instanceColor&&t.update(c.instanceColor,34962)),d},dispose:function o(){r=new WeakMap}}}const yC=new Ti,_C=new Kh,vC=new hv,xC=new td,bC=[],wC=[],MC=new Float32Array(16),SC=new Float32Array(9),EC=new Float32Array(4);function sl(n,e,t){const i=n[0];if(i<=0||i>0)return n;const r=e*t;let s=bC[r];if(void 0===s&&(s=new Float32Array(r),bC[r]=s),0!==e){i.toArray(s,0);for(let o=1,a=0;o!==e;++o)a+=t,n[o].toArray(s,a)}return s}function fi(n,e){if(n.length!==e.length)return!1;for(let t=0,i=n.length;t<i;t++)if(n[t]!==e[t])return!1;return!0}function hi(n,e){for(let t=0,i=e.length;t<i;t++)n[t]=e[t]}function gp(n,e){let t=wC[e];void 0===t&&(t=new Int32Array(e),wC[e]=t);for(let i=0;i!==e;++i)t[i]=n.allocateTextureUnit();return t}function WH(n,e){const t=this.cache;t[0]!==e&&(n.uniform1f(this.addr,e),t[0]=e)}function jH(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(fi(t,e))return;n.uniform2fv(this.addr,e),hi(t,e)}}function $H(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(void 0!==e.r)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(n.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(fi(t,e))return;n.uniform3fv(this.addr,e),hi(t,e)}}function qH(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(fi(t,e))return;n.uniform4fv(this.addr,e),hi(t,e)}}function ZH(n,e){const t=this.cache,i=e.elements;if(void 0===i){if(fi(t,e))return;n.uniformMatrix2fv(this.addr,!1,e),hi(t,e)}else{if(fi(t,i))return;EC.set(i),n.uniformMatrix2fv(this.addr,!1,EC),hi(t,i)}}function XH(n,e){const t=this.cache,i=e.elements;if(void 0===i){if(fi(t,e))return;n.uniformMatrix3fv(this.addr,!1,e),hi(t,e)}else{if(fi(t,i))return;SC.set(i),n.uniformMatrix3fv(this.addr,!1,SC),hi(t,i)}}function YH(n,e){const t=this.cache,i=e.elements;if(void 0===i){if(fi(t,e))return;n.uniformMatrix4fv(this.addr,!1,e),hi(t,e)}else{if(fi(t,i))return;MC.set(i),n.uniformMatrix4fv(this.addr,!1,MC),hi(t,i)}}function KH(n,e){const t=this.cache;t[0]!==e&&(n.uniform1i(this.addr,e),t[0]=e)}function JH(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(fi(t,e))return;n.uniform2iv(this.addr,e),hi(t,e)}}function QH(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(fi(t,e))return;n.uniform3iv(this.addr,e),hi(t,e)}}function eG(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(fi(t,e))return;n.uniform4iv(this.addr,e),hi(t,e)}}function tG(n,e){const t=this.cache;t[0]!==e&&(n.uniform1ui(this.addr,e),t[0]=e)}function nG(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(fi(t,e))return;n.uniform2uiv(this.addr,e),hi(t,e)}}function iG(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(fi(t,e))return;n.uniform3uiv(this.addr,e),hi(t,e)}}function rG(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(fi(t,e))return;n.uniform4uiv(this.addr,e),hi(t,e)}}function sG(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.setTexture2D(e||yC,r)}function oG(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.setTexture3D(e||vC,r)}function aG(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.setTextureCube(e||xC,r)}function cG(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.setTexture2DArray(e||_C,r)}function uG(n,e){n.uniform1fv(this.addr,e)}function dG(n,e){const t=sl(e,this.size,2);n.uniform2fv(this.addr,t)}function fG(n,e){const t=sl(e,this.size,3);n.uniform3fv(this.addr,t)}function hG(n,e){const t=sl(e,this.size,4);n.uniform4fv(this.addr,t)}function pG(n,e){const t=sl(e,this.size,4);n.uniformMatrix2fv(this.addr,!1,t)}function mG(n,e){const t=sl(e,this.size,9);n.uniformMatrix3fv(this.addr,!1,t)}function gG(n,e){const t=sl(e,this.size,16);n.uniformMatrix4fv(this.addr,!1,t)}function yG(n,e){n.uniform1iv(this.addr,e)}function _G(n,e){n.uniform2iv(this.addr,e)}function vG(n,e){n.uniform3iv(this.addr,e)}function xG(n,e){n.uniform4iv(this.addr,e)}function bG(n,e){n.uniform1uiv(this.addr,e)}function wG(n,e){n.uniform2uiv(this.addr,e)}function MG(n,e){n.uniform3uiv(this.addr,e)}function SG(n,e){n.uniform4uiv(this.addr,e)}function EG(n,e,t){const i=this.cache,r=e.length,s=gp(t,r);fi(i,s)||(n.uniform1iv(this.addr,s),hi(i,s));for(let o=0;o!==r;++o)t.setTexture2D(e[o]||yC,s[o])}function TG(n,e,t){const i=this.cache,r=e.length,s=gp(t,r);fi(i,s)||(n.uniform1iv(this.addr,s),hi(i,s));for(let o=0;o!==r;++o)t.setTexture3D(e[o]||vC,s[o])}function DG(n,e,t){const i=this.cache,r=e.length,s=gp(t,r);fi(i,s)||(n.uniform1iv(this.addr,s),hi(i,s));for(let o=0;o!==r;++o)t.setTextureCube(e[o]||xC,s[o])}function CG(n,e,t){const i=this.cache,r=e.length,s=gp(t,r);fi(i,s)||(n.uniform1iv(this.addr,s),hi(i,s));for(let o=0;o!==r;++o)t.setTexture2DArray(e[o]||_C,s[o])}class IG{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.setValue=function lG(n){switch(n){case 5126:return WH;case 35664:return jH;case 35665:return $H;case 35666:return qH;case 35674:return ZH;case 35675:return XH;case 35676:return YH;case 5124:case 35670:return KH;case 35667:case 35671:return JH;case 35668:case 35672:return QH;case 35669:case 35673:return eG;case 5125:return tG;case 36294:return nG;case 36295:return iG;case 36296:return rG;case 35678:case 36198:case 36298:case 36306:case 35682:return sG;case 35679:case 36299:case 36307:return oG;case 35680:case 36300:case 36308:case 36293:return aG;case 36289:case 36303:case 36311:case 36292:return cG}}(t.type)}}class RG{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.size=t.size,this.setValue=function AG(n){switch(n){case 5126:return uG;case 35664:return dG;case 35665:return fG;case 35666:return hG;case 35674:return pG;case 35675:return mG;case 35676:return gG;case 5124:case 35670:return yG;case 35667:case 35671:return _G;case 35668:case 35672:return vG;case 35669:case 35673:return xG;case 5125:return bG;case 36294:return wG;case 36295:return MG;case 36296:return SG;case 35678:case 36198:case 36298:case 36306:case 35682:return EG;case 35679:case 36299:case 36307:return TG;case 35680:case 36300:case 36308:case 36293:return DG;case 36289:case 36303:case 36311:case 36292:return CG}}(t.type)}}class PG{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,i){const r=this.seq;for(let s=0,o=r.length;s!==o;++s){const a=r[s];a.setValue(e,t[a.id],i)}}}const Fv=/(\w+)(\])?(\[|\.)?/g;function TC(n,e){n.seq.push(e),n.map[e.id]=e}function LG(n,e,t){const i=n.name,r=i.length;for(Fv.lastIndex=0;;){const s=Fv.exec(i);let a=s[1];const l=s[3];if("]"===s[2]&&(a|=0),void 0===l||"["===l&&Fv.lastIndex+2===r){TC(t,void 0===l?new IG(a,n,e):new RG(a,n,e));break}{let d=t.map[a];void 0===d&&(d=new PG(a),TC(t,d)),t=d}}}class yp{constructor(e,t){this.seq=[],this.map={};const i=e.getProgramParameter(t,35718);for(let r=0;r<i;++r){const s=e.getActiveUniform(t,r);LG(s,e.getUniformLocation(t,s.name),this)}}setValue(e,t,i,r){const s=this.map[t];void 0!==s&&s.setValue(e,i,r)}setOptional(e,t,i){const r=t[i];void 0!==r&&this.setValue(e,i,r)}static upload(e,t,i,r){for(let s=0,o=t.length;s!==o;++s){const a=t[s],c=i[a.id];!1!==c.needsUpdate&&a.setValue(e,c.value,r)}}static seqWithValue(e,t){const i=[];for(let r=0,s=e.length;r!==s;++r){const o=e[r];o.id in t&&i.push(o)}return i}}function DC(n,e,t){const i=n.createShader(e);return n.shaderSource(i,t),n.compileShader(i),i}let NG=0;function CC(n,e,t){const i=n.getShaderParameter(e,35713),r=n.getShaderInfoLog(e).trim();if(i&&""===r)return"";const s=/ERROR: 0:(\d+)/.exec(r);if(s){const o=parseInt(s[1]);return t.toUpperCase()+"\n\n"+r+"\n\n"+function OG(n,e){const t=n.split("\n"),i=[],r=Math.max(e-6,0),s=Math.min(e+6,t.length);for(let o=r;o<s;o++){const a=o+1;i.push(`${a===e?">":" "} ${a}: ${t[o]}`)}return i.join("\n")}(n.getShaderSource(e),o)}return r}function kG(n,e){const t=function FG(n){switch(n){case $s:return["Linear","( value )"];case Qt:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",n),["Linear","( value )"]}}(e);return"vec4 "+n+"( vec4 value ) { return LinearTo"+t[0]+t[1]+"; }"}function BG(n,e){let t;switch(e){case _D:t="Linear";break;case vD:t="Reinhard";break;case xD:t="OptimizedCineon";break;case R_:t="ACESFilmic";break;case bD:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+n+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}function nd(n){return""!==n}function AC(n,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return n.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function IC(n,e){return n.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const HG=/^[ \t]*#include +<([\w\d./]+)>/gm;function kv(n){return n.replace(HG,GG)}function GG(n,e){const t=Lt[e];if(void 0===t)throw new Error("Can not resolve #include <"+e+">");return kv(t)}const WG=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function RC(n){return n.replace(WG,jG)}function jG(n,e,t,i){let r="";for(let s=parseInt(e);s<parseInt(t);s++)r+=i.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return r}function PC(n){let e="precision "+n.precision+" float;\nprecision "+n.precision+" int;";return"highp"===n.precision?e+="\n#define HIGH_PRECISION":"mediump"===n.precision?e+="\n#define MEDIUM_PRECISION":"lowp"===n.precision&&(e+="\n#define LOW_PRECISION"),e}function KG(n,e,t,i){const r=n.getContext(),s=t.defines;let o=t.vertexShader,a=t.fragmentShader;const c=function $G(n){let e="SHADOWMAP_TYPE_BASIC";return n.shadowMapType===w_?e="SHADOWMAP_TYPE_PCF":n.shadowMapType===M_?e="SHADOWMAP_TYPE_PCF_SOFT":n.shadowMapType===Lc&&(e="SHADOWMAP_TYPE_VSM"),e}(t),l=function qG(n){let e="ENVMAP_TYPE_CUBE";if(n.envMap)switch(n.envMapMode){case yo:case _o:e="ENVMAP_TYPE_CUBE";break;case Nc:e="ENVMAP_TYPE_CUBE_UV"}return e}(t),u=function ZG(n){let e="ENVMAP_MODE_REFLECTION";return n.envMap&&n.envMapMode===_o&&(e="ENVMAP_MODE_REFRACTION"),e}(t),d=function XG(n){let e="ENVMAP_BLENDING_NONE";if(n.envMap)switch(n.combine){case Bu:e="ENVMAP_BLENDING_MULTIPLY";break;case gD:e="ENVMAP_BLENDING_MIX";break;case yD:e="ENVMAP_BLENDING_ADD"}return e}(t),f=function YG(n){const e=n.envMapCubeUVHeight;if(null===e)return null;const t=Math.log2(e)-2,i=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),112)),texelHeight:i,maxMip:t}}(t),h=t.isWebGL2?"":function UG(n){return[n.extensionDerivatives||n.envMapCubeUVHeight||n.bumpMap||n.tangentSpaceNormalMap||n.clearcoatNormalMap||n.flatShading||"physical"===n.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(n.extensionFragDepth||n.logarithmicDepthBuffer)&&n.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",n.extensionDrawBuffers&&n.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(n.extensionShaderTextureLOD||n.envMap||n.transmission)&&n.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(nd).join("\n")}(t),m=function VG(n){const e=[];for(const t in n){const i=n[t];!1!==i&&e.push("#define "+t+" "+i)}return e.join("\n")}(s),p=r.createProgram();let g,_,v=t.glslVersion?"#version "+t.glslVersion+"\n":"";t.isRawShaderMaterial?(g=[m].filter(nd).join("\n"),g.length>0&&(g+="\n"),_=[h,m].filter(nd).join("\n"),_.length>0&&(_+="\n")):(g=[PC(t),"#define SHADER_NAME "+t.shaderName,m,t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.supportsVertexTextures?"#define VERTEX_TEXTURES":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+u:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.displacementMap&&t.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",t.specularColorMap?"#define USE_SPECULARCOLORMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEENCOLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&!1===t.flatShading?"#define USE_MORPHNORMALS":"",t.morphColors&&t.isWebGL2?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+c:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(nd).join("\n"),_=[h,PC(t),"#define SHADER_NAME "+t.shaderName,m,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+l:"",t.envMap?"#define "+u:"",t.envMap?"#define "+d:"",f?"#define CUBEUV_TEXEL_WIDTH "+f.texelWidth:"",f?"#define CUBEUV_TEXEL_HEIGHT "+f.texelHeight:"",f?"#define CUBEUV_MAX_MIP "+f.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",t.specularColorMap?"#define USE_SPECULARCOLORMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEENCOLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+c:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==Yr?"#define TONE_MAPPING":"",t.toneMapping!==Yr?Lt.tonemapping_pars_fragment:"",t.toneMapping!==Yr?BG("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",Lt.encodings_pars_fragment,kG("linearToOutputTexel",t.outputEncoding),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"","\n"].filter(nd).join("\n")),o=kv(o),o=AC(o,t),o=IC(o,t),a=kv(a),a=AC(a,t),a=IC(a,t),o=RC(o),a=RC(a),t.isWebGL2&&!0!==t.isRawShaderMaterial&&(v="#version 300 es\n",g=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+g,_=["#define varying in",t.glslVersion===rv?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===rv?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+_);const x=v+_+a,w=DC(r,35633,v+g+o),M=DC(r,35632,x);if(r.attachShader(p,w),r.attachShader(p,M),void 0!==t.index0AttributeName?r.bindAttribLocation(p,0,t.index0AttributeName):!0===t.morphTargets&&r.bindAttribLocation(p,0,"position"),r.linkProgram(p),n.debug.checkShaderErrors){const S=r.getProgramInfoLog(p).trim(),R=r.getShaderInfoLog(w).trim(),B=r.getShaderInfoLog(M).trim();let G=!0,k=!0;if(!1===r.getProgramParameter(p,35714)){G=!1;const N=CC(r,w,"vertex"),q=CC(r,M,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(p,35715)+"\n\nProgram Info Log: "+S+"\n"+N+"\n"+q)}else""!==S?console.warn("THREE.WebGLProgram: Program Info Log:",S):(""===R||""===B)&&(k=!1);k&&(this.diagnostics={runnable:G,programLog:S,vertexShader:{log:R,prefix:g},fragmentShader:{log:B,prefix:_}})}let A,b;return r.deleteShader(w),r.deleteShader(M),this.getUniforms=function(){return void 0===A&&(A=new yp(r,p)),A},this.getAttributes=function(){return void 0===b&&(b=function zG(n,e){const t={},i=n.getProgramParameter(e,35721);for(let r=0;r<i;r++){const s=n.getActiveAttrib(e,r),o=s.name;let a=1;35674===s.type&&(a=2),35675===s.type&&(a=3),35676===s.type&&(a=4),t[o]={type:s.type,location:n.getAttribLocation(e,o),locationSize:a}}return t}(r,p)),b},this.destroy=function(){i.releaseStatesOfProgram(this),r.deleteProgram(p),this.program=void 0},this.name=t.shaderName,this.id=NG++,this.cacheKey=e,this.usedTimes=1,this.program=p,this.vertexShader=w,this.fragmentShader=M,this}let JG=0;class QG{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const i=e.fragmentShader,r=this._getShaderStage(e.vertexShader),s=this._getShaderStage(i),o=this._getShaderCacheForMaterial(e);return!1===o.has(r)&&(o.add(r),r.usedTimes++),!1===o.has(s)&&(o.add(s),s.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const i of t)i.usedTimes--,0===i.usedTimes&&this.shaderCache.delete(i.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let i=t.get(e);return void 0===i&&(i=new Set,t.set(e,i)),i}_getShaderStage(e){const t=this.shaderCache;let i=t.get(e);return void 0===i&&(i=new e4(e),t.set(e,i)),i}}class e4{constructor(e){this.id=JG++,this.code=e,this.usedTimes=0}}function t4(n,e,t,i,r,s,o){const a=new pa,c=new QG,l=[],u=r.isWebGL2,d=r.logarithmicDepthBuffer,f=r.vertexTextures;let h=r.precision;const m={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};return{getParameters:function p(b,S,R,B,G){const k=B.fog,N=G.geometry,ne=(b.isMeshStandardMaterial?t:e).get(b.envMap||(b.isMeshStandardMaterial?B.environment:null)),pe=ne&&ne.mapping===Nc?ne.image.height:null,re=m[b.type];null!==b.precision&&(h=r.getMaxPrecision(b.precision),h!==b.precision&&console.warn("THREE.WebGLProgram.getParameters:",b.precision,"not supported, using",h,"instead."));const he=N.morphAttributes.position||N.morphAttributes.normal||N.morphAttributes.color,ue=void 0!==he?he.length:0;let $,de,_e,xe,ke=0;if(void 0!==N.morphAttributes.position&&(ke=1),void 0!==N.morphAttributes.normal&&(ke=2),void 0!==N.morphAttributes.color&&(ke=3),re){const Nt=ns[re];$=Nt.vertexShader,de=Nt.fragmentShader}else $=b.vertexShader,de=b.fragmentShader,c.update(b),_e=c.getVertexShaderID(b),xe=c.getFragmentShaderID(b);const j=n.getRenderTarget(),Oe=b.clearcoat>0,Ge=b.iridescence>0;return{isWebGL2:u,shaderID:re,shaderName:b.type,vertexShader:$,fragmentShader:de,defines:b.defines,customVertexShaderID:_e,customFragmentShaderID:xe,isRawShaderMaterial:!0===b.isRawShaderMaterial,glslVersion:b.glslVersion,precision:h,instancing:!0===G.isInstancedMesh,instancingColor:!0===G.isInstancedMesh&&null!==G.instanceColor,supportsVertexTextures:f,outputEncoding:null===j?n.outputEncoding:!0===j.isXRRenderTarget?j.texture.encoding:$s,map:!!b.map,matcap:!!b.matcap,envMap:!!ne,envMapMode:ne&&ne.mapping,envMapCubeUVHeight:pe,lightMap:!!b.lightMap,aoMap:!!b.aoMap,emissiveMap:!!b.emissiveMap,bumpMap:!!b.bumpMap,normalMap:!!b.normalMap,objectSpaceNormalMap:b.normalMapType===GD,tangentSpaceNormalMap:b.normalMapType===Mo,decodeVideoTexture:!!b.map&&!0===b.map.isVideoTexture&&b.map.encoding===Qt,clearcoat:Oe,clearcoatMap:Oe&&!!b.clearcoatMap,clearcoatRoughnessMap:Oe&&!!b.clearcoatRoughnessMap,clearcoatNormalMap:Oe&&!!b.clearcoatNormalMap,iridescence:Ge,iridescenceMap:Ge&&!!b.iridescenceMap,iridescenceThicknessMap:Ge&&!!b.iridescenceThicknessMap,displacementMap:!!b.displacementMap,roughnessMap:!!b.roughnessMap,metalnessMap:!!b.metalnessMap,specularMap:!!b.specularMap,specularIntensityMap:!!b.specularIntensityMap,specularColorMap:!!b.specularColorMap,opaque:!1===b.transparent&&b.blending===ta,alphaMap:!!b.alphaMap,alphaTest:b.alphaTest>0,gradientMap:!!b.gradientMap,sheen:b.sheen>0,sheenColorMap:!!b.sheenColorMap,sheenRoughnessMap:!!b.sheenRoughnessMap,transmission:b.transmission>0,transmissionMap:!!b.transmissionMap,thicknessMap:!!b.thicknessMap,combine:b.combine,vertexTangents:!!b.normalMap&&!!N.attributes.tangent,vertexColors:b.vertexColors,vertexAlphas:!0===b.vertexColors&&!!N.attributes.color&&4===N.attributes.color.itemSize,vertexUvs:!!(b.map||b.bumpMap||b.normalMap||b.specularMap||b.alphaMap||b.emissiveMap||b.roughnessMap||b.metalnessMap||b.clearcoatMap||b.clearcoatRoughnessMap||b.clearcoatNormalMap||b.iridescenceMap||b.iridescenceThicknessMap||b.displacementMap||b.transmissionMap||b.thicknessMap||b.specularIntensityMap||b.specularColorMap||b.sheenColorMap||b.sheenRoughnessMap),uvsVertexOnly:!(b.map||b.bumpMap||b.normalMap||b.specularMap||b.alphaMap||b.emissiveMap||b.roughnessMap||b.metalnessMap||b.clearcoatNormalMap||b.iridescenceMap||b.iridescenceThicknessMap||b.transmission>0||b.transmissionMap||b.thicknessMap||b.specularIntensityMap||b.specularColorMap||b.sheen>0||b.sheenColorMap||b.sheenRoughnessMap||!b.displacementMap),fog:!!k,useFog:!0===b.fog,fogExp2:k&&k.isFogExp2,flatShading:!!b.flatShading,sizeAttenuation:b.sizeAttenuation,logarithmicDepthBuffer:d,skinning:!0===G.isSkinnedMesh,morphTargets:void 0!==N.morphAttributes.position,morphNormals:void 0!==N.morphAttributes.normal,morphColors:void 0!==N.morphAttributes.color,morphTargetsCount:ue,morphTextureStride:ke,numDirLights:S.directional.length,numPointLights:S.point.length,numSpotLights:S.spot.length,numSpotLightMaps:S.spotLightMap.length,numRectAreaLights:S.rectArea.length,numHemiLights:S.hemi.length,numDirLightShadows:S.directionalShadowMap.length,numPointLightShadows:S.pointShadowMap.length,numSpotLightShadows:S.spotShadowMap.length,numSpotLightShadowsWithMaps:S.numSpotLightShadowsWithMaps,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:b.dithering,shadowMapEnabled:n.shadowMap.enabled&&R.length>0,shadowMapType:n.shadowMap.type,toneMapping:b.toneMapped?n.toneMapping:Yr,physicallyCorrectLights:n.physicallyCorrectLights,premultipliedAlpha:b.premultipliedAlpha,doubleSided:b.side===ws,flipSided:b.side===ir,useDepthPacking:!!b.depthPacking,depthPacking:b.depthPacking||0,index0AttributeName:b.index0AttributeName,extensionDerivatives:b.extensions&&b.extensions.derivatives,extensionFragDepth:b.extensions&&b.extensions.fragDepth,extensionDrawBuffers:b.extensions&&b.extensions.drawBuffers,extensionShaderTextureLOD:b.extensions&&b.extensions.shaderTextureLOD,rendererExtensionFragDepth:u||i.has("EXT_frag_depth"),rendererExtensionDrawBuffers:u||i.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:u||i.has("EXT_shader_texture_lod"),customProgramCacheKey:b.customProgramCacheKey()}},getProgramCacheKey:function g(b){const S=[];if(b.shaderID?S.push(b.shaderID):(S.push(b.customVertexShaderID),S.push(b.customFragmentShaderID)),void 0!==b.defines)for(const R in b.defines)S.push(R),S.push(b.defines[R]);return!1===b.isRawShaderMaterial&&(function _(b,S){b.push(S.precision),b.push(S.outputEncoding),b.push(S.envMapMode),b.push(S.envMapCubeUVHeight),b.push(S.combine),b.push(S.vertexUvs),b.push(S.fogExp2),b.push(S.sizeAttenuation),b.push(S.morphTargetsCount),b.push(S.morphAttributeCount),b.push(S.numDirLights),b.push(S.numPointLights),b.push(S.numSpotLights),b.push(S.numSpotLightMaps),b.push(S.numHemiLights),b.push(S.numRectAreaLights),b.push(S.numDirLightShadows),b.push(S.numPointLightShadows),b.push(S.numSpotLightShadows),b.push(S.numSpotLightShadowsWithMaps),b.push(S.shadowMapType),b.push(S.toneMapping),b.push(S.numClippingPlanes),b.push(S.numClipIntersection),b.push(S.depthPacking)}(S,b),function v(b,S){a.disableAll(),S.isWebGL2&&a.enable(0),S.supportsVertexTextures&&a.enable(1),S.instancing&&a.enable(2),S.instancingColor&&a.enable(3),S.map&&a.enable(4),S.matcap&&a.enable(5),S.envMap&&a.enable(6),S.lightMap&&a.enable(7),S.aoMap&&a.enable(8),S.emissiveMap&&a.enable(9),S.bumpMap&&a.enable(10),S.normalMap&&a.enable(11),S.objectSpaceNormalMap&&a.enable(12),S.tangentSpaceNormalMap&&a.enable(13),S.clearcoat&&a.enable(14),S.clearcoatMap&&a.enable(15),S.clearcoatRoughnessMap&&a.enable(16),S.clearcoatNormalMap&&a.enable(17),S.iridescence&&a.enable(18),S.iridescenceMap&&a.enable(19),S.iridescenceThicknessMap&&a.enable(20),S.displacementMap&&a.enable(21),S.specularMap&&a.enable(22),S.roughnessMap&&a.enable(23),S.metalnessMap&&a.enable(24),S.gradientMap&&a.enable(25),S.alphaMap&&a.enable(26),S.alphaTest&&a.enable(27),S.vertexColors&&a.enable(28),S.vertexAlphas&&a.enable(29),S.vertexUvs&&a.enable(30),S.vertexTangents&&a.enable(31),S.uvsVertexOnly&&a.enable(32),b.push(a.mask),a.disableAll(),S.fog&&a.enable(0),S.useFog&&a.enable(1),S.flatShading&&a.enable(2),S.logarithmicDepthBuffer&&a.enable(3),S.skinning&&a.enable(4),S.morphTargets&&a.enable(5),S.morphNormals&&a.enable(6),S.morphColors&&a.enable(7),S.premultipliedAlpha&&a.enable(8),S.shadowMapEnabled&&a.enable(9),S.physicallyCorrectLights&&a.enable(10),S.doubleSided&&a.enable(11),S.flipSided&&a.enable(12),S.useDepthPacking&&a.enable(13),S.dithering&&a.enable(14),S.specularIntensityMap&&a.enable(15),S.specularColorMap&&a.enable(16),S.transmission&&a.enable(17),S.transmissionMap&&a.enable(18),S.thicknessMap&&a.enable(19),S.sheen&&a.enable(20),S.sheenColorMap&&a.enable(21),S.sheenRoughnessMap&&a.enable(22),S.decodeVideoTexture&&a.enable(23),S.opaque&&a.enable(24),b.push(a.mask)}(S,b),S.push(n.outputEncoding)),S.push(b.customProgramCacheKey),S.join()},getUniforms:function y(b){const S=m[b.type];let R;return R=S?aC.clone(ns[S].uniforms):b.uniforms,R},acquireProgram:function x(b,S){let R;for(let B=0,G=l.length;B<G;B++){const k=l[B];if(k.cacheKey===S){R=k,++R.usedTimes;break}}return void 0===R&&(R=new KG(n,S,b,s),l.push(R)),R},releaseProgram:function w(b){if(0==--b.usedTimes){const S=l.indexOf(b);l[S]=l[l.length-1],l.pop(),b.destroy()}},releaseShaderCache:function M(b){c.remove(b)},programs:l,dispose:function A(){c.dispose()}}}function n4(){let n=new WeakMap;return{get:function e(s){let o=n.get(s);return void 0===o&&(o={},n.set(s,o)),o},remove:function t(s){n.delete(s)},update:function i(s,o,a){n.get(s)[o]=a},dispose:function r(){n=new WeakMap}}}function i4(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.material.id!==e.material.id?n.material.id-e.material.id:n.z!==e.z?n.z-e.z:n.id-e.id}function LC(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.z!==e.z?e.z-n.z:n.id-e.id}function NC(){const n=[];let e=0;const t=[],i=[],r=[];function o(d,f,h,m,p,g){let _=n[e];return void 0===_?(_={id:d.id,object:d,geometry:f,material:h,groupOrder:m,renderOrder:d.renderOrder,z:p,group:g},n[e]=_):(_.id=d.id,_.object=d,_.geometry=f,_.material=h,_.groupOrder=m,_.renderOrder=d.renderOrder,_.z=p,_.group=g),e++,_}return{opaque:t,transmissive:i,transparent:r,init:function s(){e=0,t.length=0,i.length=0,r.length=0},push:function a(d,f,h,m,p,g){const _=o(d,f,h,m,p,g);h.transmission>0?i.push(_):!0===h.transparent?r.push(_):t.push(_)},unshift:function c(d,f,h,m,p,g){const _=o(d,f,h,m,p,g);h.transmission>0?i.unshift(_):!0===h.transparent?r.unshift(_):t.unshift(_)},finish:function u(){for(let d=e,f=n.length;d<f;d++){const h=n[d];if(null===h.id)break;h.id=null,h.object=null,h.geometry=null,h.material=null,h.group=null}},sort:function l(d,f){t.length>1&&t.sort(d||i4),i.length>1&&i.sort(f||LC),r.length>1&&r.sort(f||LC)}}}function r4(){let n=new WeakMap;return{get:function e(i,r){const s=n.get(i);let o;return void 0===s?(o=new NC,n.set(i,[o])):r>=s.length?(o=new NC,s.push(o)):o=s[r],o},dispose:function t(){n=new WeakMap}}}function s4(){const n={};return{get:function(e){if(void 0!==n[e.id])return n[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new T,color:new De};break;case"SpotLight":t={position:new T,direction:new T,color:new De,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new T,color:new De,distance:0,decay:0};break;case"HemisphereLight":t={direction:new T,skyColor:new De,groundColor:new De};break;case"RectAreaLight":t={color:new De,position:new T,halfWidth:new T,halfHeight:new T}}return n[e.id]=t,t}}}let a4=0;function c4(n,e){return(e.castShadow?2:0)-(n.castShadow?2:0)+(e.map?1:0)-(n.map?1:0)}function l4(n,e){const t=new s4,i=function o4(){const n={};return{get:function(e){if(void 0!==n[e.id])return n[e.id];let t;switch(e.type){case"DirectionalLight":case"SpotLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ce};break;case"PointLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ce,shadowCameraNear:1,shadowCameraFar:1e3}}return n[e.id]=t,t}}}(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let u=0;u<9;u++)r.probe.push(new T);const s=new T,o=new pt,a=new pt;return{setup:function c(u,d){let f=0,h=0,m=0;for(let B=0;B<9;B++)r.probe[B].set(0,0,0);let p=0,g=0,_=0,v=0,y=0,x=0,w=0,M=0,A=0,b=0;u.sort(c4);const S=!0!==d?Math.PI:1;for(let B=0,G=u.length;B<G;B++){const k=u[B],N=k.color,q=k.intensity,ne=k.distance,pe=k.shadow&&k.shadow.map?k.shadow.map.texture:null;if(k.isAmbientLight)f+=N.r*q*S,h+=N.g*q*S,m+=N.b*q*S;else if(k.isLightProbe)for(let re=0;re<9;re++)r.probe[re].addScaledVector(k.sh.coefficients[re],q);else if(k.isDirectionalLight){const re=t.get(k);if(re.color.copy(k.color).multiplyScalar(k.intensity*S),k.castShadow){const he=k.shadow,ue=i.get(k);ue.shadowBias=he.bias,ue.shadowNormalBias=he.normalBias,ue.shadowRadius=he.radius,ue.shadowMapSize=he.mapSize,r.directionalShadow[p]=ue,r.directionalShadowMap[p]=pe,r.directionalShadowMatrix[p]=k.shadow.matrix,x++}r.directional[p]=re,p++}else if(k.isSpotLight){const re=t.get(k);re.position.setFromMatrixPosition(k.matrixWorld),re.color.copy(N).multiplyScalar(q*S),re.distance=ne,re.coneCos=Math.cos(k.angle),re.penumbraCos=Math.cos(k.angle*(1-k.penumbra)),re.decay=k.decay,r.spot[_]=re;const he=k.shadow;if(k.map&&(r.spotLightMap[A]=k.map,A++,he.updateMatrices(k),k.castShadow&&b++),r.spotLightMatrix[_]=he.matrix,k.castShadow){const ue=i.get(k);ue.shadowBias=he.bias,ue.shadowNormalBias=he.normalBias,ue.shadowRadius=he.radius,ue.shadowMapSize=he.mapSize,r.spotShadow[_]=ue,r.spotShadowMap[_]=pe,M++}_++}else if(k.isRectAreaLight){const re=t.get(k);re.color.copy(N).multiplyScalar(q),re.halfWidth.set(.5*k.width,0,0),re.halfHeight.set(0,.5*k.height,0),r.rectArea[v]=re,v++}else if(k.isPointLight){const re=t.get(k);if(re.color.copy(k.color).multiplyScalar(k.intensity*S),re.distance=k.distance,re.decay=k.decay,k.castShadow){const he=k.shadow,ue=i.get(k);ue.shadowBias=he.bias,ue.shadowNormalBias=he.normalBias,ue.shadowRadius=he.radius,ue.shadowMapSize=he.mapSize,ue.shadowCameraNear=he.camera.near,ue.shadowCameraFar=he.camera.far,r.pointShadow[g]=ue,r.pointShadowMap[g]=pe,r.pointShadowMatrix[g]=k.shadow.matrix,w++}r.point[g]=re,g++}else if(k.isHemisphereLight){const re=t.get(k);re.skyColor.copy(k.color).multiplyScalar(q*S),re.groundColor.copy(k.groundColor).multiplyScalar(q*S),r.hemi[y]=re,y++}}v>0&&(e.isWebGL2||!0===n.has("OES_texture_float_linear")?(r.rectAreaLTC1=Ee.LTC_FLOAT_1,r.rectAreaLTC2=Ee.LTC_FLOAT_2):!0===n.has("OES_texture_half_float_linear")?(r.rectAreaLTC1=Ee.LTC_HALF_1,r.rectAreaLTC2=Ee.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),r.ambient[0]=f,r.ambient[1]=h,r.ambient[2]=m;const R=r.hash;(R.directionalLength!==p||R.pointLength!==g||R.spotLength!==_||R.rectAreaLength!==v||R.hemiLength!==y||R.numDirectionalShadows!==x||R.numPointShadows!==w||R.numSpotShadows!==M||R.numSpotMaps!==A)&&(r.directional.length=p,r.spot.length=_,r.rectArea.length=v,r.point.length=g,r.hemi.length=y,r.directionalShadow.length=x,r.directionalShadowMap.length=x,r.pointShadow.length=w,r.pointShadowMap.length=w,r.spotShadow.length=M,r.spotShadowMap.length=M,r.directionalShadowMatrix.length=x,r.pointShadowMatrix.length=w,r.spotLightMatrix.length=M+A-b,r.spotLightMap.length=A,r.numSpotLightShadowsWithMaps=b,R.directionalLength=p,R.pointLength=g,R.spotLength=_,R.rectAreaLength=v,R.hemiLength=y,R.numDirectionalShadows=x,R.numPointShadows=w,R.numSpotShadows=M,R.numSpotMaps=A,r.version=a4++)},setupView:function l(u,d){let f=0,h=0,m=0,p=0,g=0;const _=d.matrixWorldInverse;for(let v=0,y=u.length;v<y;v++){const x=u[v];if(x.isDirectionalLight){const w=r.directional[f];w.direction.setFromMatrixPosition(x.matrixWorld),s.setFromMatrixPosition(x.target.matrixWorld),w.direction.sub(s),w.direction.transformDirection(_),f++}else if(x.isSpotLight){const w=r.spot[m];w.position.setFromMatrixPosition(x.matrixWorld),w.position.applyMatrix4(_),w.direction.setFromMatrixPosition(x.matrixWorld),s.setFromMatrixPosition(x.target.matrixWorld),w.direction.sub(s),w.direction.transformDirection(_),m++}else if(x.isRectAreaLight){const w=r.rectArea[p];w.position.setFromMatrixPosition(x.matrixWorld),w.position.applyMatrix4(_),a.identity(),o.copy(x.matrixWorld),o.premultiply(_),a.extractRotation(o),w.halfWidth.set(.5*x.width,0,0),w.halfHeight.set(0,.5*x.height,0),w.halfWidth.applyMatrix4(a),w.halfHeight.applyMatrix4(a),p++}else if(x.isPointLight){const w=r.point[h];w.position.setFromMatrixPosition(x.matrixWorld),w.position.applyMatrix4(_),h++}else if(x.isHemisphereLight){const w=r.hemi[g];w.direction.setFromMatrixPosition(x.matrixWorld),w.direction.transformDirection(_),g++}}},state:r}}function OC(n,e){const t=new l4(n,e),i=[],r=[];return{init:function s(){i.length=0,r.length=0},state:{lightsArray:i,shadowsArray:r,lights:t},setupLights:function c(d){t.setup(i,d)},setupLightsView:function l(d){t.setupView(i,d)},pushLight:function o(d){i.push(d)},pushShadow:function a(d){r.push(d)}}}function u4(n,e){let t=new WeakMap;return{get:function i(s,o=0){const a=t.get(s);let c;return void 0===a?(c=new OC(n,e),t.set(s,[c])):o>=a.length?(c=new OC(n,e),a.push(c)):c=a[o],c},dispose:function r(){t=new WeakMap}}}class Bv extends ui{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=zD,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class Uv extends ui{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.referencePosition=new T,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}const d4="void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",f4="uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}";function h4(n,e,t){let i=new hp;const r=new ce,s=new ce,o=new dn,a=new Bv({depthPacking:HD}),c=new Uv,l={},u=t.maxTextureSize,d={[bs]:ir,[ir]:bs,[ws]:ws},f=new Ss({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new ce},radius:{value:4}},vertexShader:d4,fragmentShader:f4}),h=f.clone();h.defines.HORIZONTAL_PASS=1;const m=new Pt;m.setAttribute("position",new an(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const p=new yi(m,f),g=this;function _(x,w){const M=e.update(p);f.defines.VSM_SAMPLES!==x.blurSamples&&(f.defines.VSM_SAMPLES=x.blurSamples,h.defines.VSM_SAMPLES=x.blurSamples,f.needsUpdate=!0,h.needsUpdate=!0),null===x.mapPass&&(x.mapPass=new Qr(r.x,r.y)),f.uniforms.shadow_pass.value=x.map.texture,f.uniforms.resolution.value=x.mapSize,f.uniforms.radius.value=x.radius,n.setRenderTarget(x.mapPass),n.clear(),n.renderBufferDirect(w,null,M,f,p,null),h.uniforms.shadow_pass.value=x.mapPass.texture,h.uniforms.resolution.value=x.mapSize,h.uniforms.radius.value=x.radius,n.setRenderTarget(x.map),n.clear(),n.renderBufferDirect(w,null,M,h,p,null)}function v(x,w,M,A,b,S){let R=null;const B=!0===M.isPointLight?x.customDistanceMaterial:x.customDepthMaterial;if(void 0!==B)R=B;else if(R=!0===M.isPointLight?c:a,n.localClippingEnabled&&!0===w.clipShadows&&Array.isArray(w.clippingPlanes)&&0!==w.clippingPlanes.length||w.displacementMap&&0!==w.displacementScale||w.alphaMap&&w.alphaTest>0||w.map&&w.alphaTest>0){const G=R.uuid,k=w.uuid;let N=l[G];void 0===N&&(N={},l[G]=N);let q=N[k];void 0===q&&(q=R.clone(),N[k]=q),R=q}return R.visible=w.visible,R.wireframe=w.wireframe,R.side=S===Lc?null!==w.shadowSide?w.shadowSide:w.side:null!==w.shadowSide?w.shadowSide:d[w.side],R.alphaMap=w.alphaMap,R.alphaTest=w.alphaTest,R.map=w.map,R.clipShadows=w.clipShadows,R.clippingPlanes=w.clippingPlanes,R.clipIntersection=w.clipIntersection,R.displacementMap=w.displacementMap,R.displacementScale=w.displacementScale,R.displacementBias=w.displacementBias,R.wireframeLinewidth=w.wireframeLinewidth,R.linewidth=w.linewidth,!0===M.isPointLight&&!0===R.isMeshDistanceMaterial&&(R.referencePosition.setFromMatrixPosition(M.matrixWorld),R.nearDistance=A,R.farDistance=b),R}function y(x,w,M,A,b){if(!1===x.visible)return;if(x.layers.test(w.layers)&&(x.isMesh||x.isLine||x.isPoints)&&(x.castShadow||x.receiveShadow&&b===Lc)&&(!x.frustumCulled||i.intersectsObject(x))){x.modelViewMatrix.multiplyMatrices(M.matrixWorldInverse,x.matrixWorld);const B=e.update(x),G=x.material;if(Array.isArray(G)){const k=B.groups;for(let N=0,q=k.length;N<q;N++){const ne=k[N],pe=G[ne.materialIndex];if(pe&&pe.visible){const re=v(x,pe,A,M.near,M.far,b);n.renderBufferDirect(M,null,B,re,x,ne)}}}else if(G.visible){const k=v(x,G,A,M.near,M.far,b);n.renderBufferDirect(M,null,B,k,x,null)}}const R=x.children;for(let B=0,G=R.length;B<G;B++)y(R[B],w,M,A,b)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=w_,this.render=function(x,w,M){if(!1===g.enabled||!1===g.autoUpdate&&!1===g.needsUpdate||0===x.length)return;const A=n.getRenderTarget(),b=n.getActiveCubeFace(),S=n.getActiveMipmapLevel(),R=n.state;R.setBlending(Ws),R.buffers.color.setClear(1,1,1,1),R.buffers.depth.setTest(!0),R.setScissorTest(!1);for(let B=0,G=x.length;B<G;B++){const k=x[B],N=k.shadow;if(void 0===N){console.warn("THREE.WebGLShadowMap:",k,"has no shadow.");continue}if(!1===N.autoUpdate&&!1===N.needsUpdate)continue;r.copy(N.mapSize);const q=N.getFrameExtents();r.multiply(q),s.copy(N.mapSize),(r.x>u||r.y>u)&&(r.x>u&&(s.x=Math.floor(u/q.x),r.x=s.x*q.x,N.mapSize.x=s.x),r.y>u&&(s.y=Math.floor(u/q.y),r.y=s.y*q.y,N.mapSize.y=s.y)),null===N.map&&(N.map=new Qr(r.x,r.y,this.type!==Lc?{minFilter:Hn,magFilter:Hn}:{}),N.map.texture.name=k.name+".shadowMap",N.camera.updateProjectionMatrix()),n.setRenderTarget(N.map),n.clear();const ne=N.getViewportCount();for(let pe=0;pe<ne;pe++){const re=N.getViewport(pe);o.set(s.x*re.x,s.y*re.y,s.x*re.z,s.y*re.w),R.viewport(o),N.updateMatrices(k,pe),i=N.getFrustum(),y(w,M,N.camera,k,this.type)}!0!==N.isPointLightShadow&&this.type===Lc&&_(N,M),N.needsUpdate=!1}g.needsUpdate=!1,n.setRenderTarget(A,b,S)}}function p4(n,e,t){const i=t.isWebGL2,a=new function r(){let F=!1;const ee=new dn;let me=null;const Ne=new dn(0,0,0,0);return{setMask:function(qe){me!==qe&&!F&&(n.colorMask(qe,qe,qe,qe),me=qe)},setLocked:function(qe){F=qe},setClear:function(qe,cn,vi,Oi,Ra){!0===Ra&&(qe*=Oi,cn*=Oi,vi*=Oi),ee.set(qe,cn,vi,Oi),!1===Ne.equals(ee)&&(n.clearColor(qe,cn,vi,Oi),Ne.copy(ee))},reset:function(){F=!1,me=null,Ne.set(-1,0,0,0)}}},c=new function s(){let F=!1,ee=null,me=null,Ne=null;return{setTest:function(qe){qe?$e(2929):Oe(2929)},setMask:function(qe){ee!==qe&&!F&&(n.depthMask(qe),ee=qe)},setFunc:function(qe){if(me!==qe){switch(qe){case lD:n.depthFunc(512);break;case uD:n.depthFunc(519);break;case dD:n.depthFunc(513);break;case Nh:n.depthFunc(515);break;case fD:n.depthFunc(514);break;case hD:n.depthFunc(518);break;case pD:n.depthFunc(516);break;case mD:n.depthFunc(517);break;default:n.depthFunc(515)}me=qe}},setLocked:function(qe){F=qe},setClear:function(qe){Ne!==qe&&(n.clearDepth(qe),Ne=qe)},reset:function(){F=!1,ee=null,me=null,Ne=null}}},l=new function o(){let F=!1,ee=null,me=null,Ne=null,qe=null,cn=null,vi=null,Oi=null,Ra=null;return{setTest:function(Ln){F||(Ln?$e(2960):Oe(2960))},setMask:function(Ln){ee!==Ln&&!F&&(n.stencilMask(Ln),ee=Ln)},setFunc:function(Ln,oo,Nr){(me!==Ln||Ne!==oo||qe!==Nr)&&(n.stencilFunc(Ln,oo,Nr),me=Ln,Ne=oo,qe=Nr)},setOp:function(Ln,oo,Nr){(cn!==Ln||vi!==oo||Oi!==Nr)&&(n.stencilOp(Ln,oo,Nr),cn=Ln,vi=oo,Oi=Nr)},setLocked:function(Ln){F=Ln},setClear:function(Ln){Ra!==Ln&&(n.clearStencil(Ln),Ra=Ln)},reset:function(){F=!1,ee=null,me=null,Ne=null,qe=null,cn=null,vi=null,Oi=null,Ra=null}}},u=new WeakMap,d=new WeakMap;let f={},h={},m=new WeakMap,p=[],g=null,_=!1,v=null,y=null,x=null,w=null,M=null,A=null,b=null,S=!1,R=null,B=null,G=null,k=null,N=null;const q=n.getParameter(35661);let ne=!1,pe=0;const re=n.getParameter(7938);-1!==re.indexOf("WebGL")?(pe=parseFloat(/^WebGL (\d)/.exec(re)[1]),ne=pe>=1):-1!==re.indexOf("OpenGL ES")&&(pe=parseFloat(/^OpenGL ES (\d)/.exec(re)[1]),ne=pe>=2);let he=null,ue={};const ke=n.getParameter(3088),$=n.getParameter(2978),de=(new dn).fromArray(ke),_e=(new dn).fromArray($);function xe(F,ee,me){const Ne=new Uint8Array(4),qe=n.createTexture();n.bindTexture(F,qe),n.texParameteri(F,10241,9728),n.texParameteri(F,10240,9728);for(let cn=0;cn<me;cn++)n.texImage2D(ee+cn,0,6408,1,1,0,6408,5121,Ne);return qe}const j={};function $e(F){!0!==f[F]&&(n.enable(F),f[F]=!0)}function Oe(F){!1!==f[F]&&(n.disable(F),f[F]=!1)}j[3553]=xe(3553,3553,1),j[34067]=xe(34067,34069,6),a.setClear(0,0,0,1),c.setClear(1),l.setClear(0),$e(2929),c.setFunc(Nh),Ce(!1),St(b_),$e(2884),Se(Ws);const ae={[na]:32774,[JT]:32778,[QT]:32779};if(i)ae[D_]=32775,ae[C_]=32776;else{const F=e.get("EXT_blend_minmax");null!==F&&(ae[D_]=F.MIN_EXT,ae[C_]=F.MAX_EXT)}const oe={[eD]:0,[tD]:1,[nD]:768,[A_]:770,[cD]:776,[oD]:774,[rD]:772,[iD]:769,[I_]:771,[aD]:775,[sD]:773};function Se(F,ee,me,Ne,qe,cn,vi,Oi){if(F!==Ws){if(!1===_&&($e(3042),_=!0),F===KT)qe=qe||ee,cn=cn||me,vi=vi||Ne,(ee!==y||qe!==M)&&(n.blendEquationSeparate(ae[ee],ae[qe]),y=ee,M=qe),(me!==x||Ne!==w||cn!==A||vi!==b)&&(n.blendFuncSeparate(oe[me],oe[Ne],oe[cn],oe[vi]),x=me,w=Ne,A=cn,b=vi),v=F,S=!1;else if(F!==v||Oi!==S){if((y!==na||M!==na)&&(n.blendEquation(32774),y=na,M=na),Oi)switch(F){case ta:n.blendFuncSeparate(1,771,1,771);break;case S_:n.blendFunc(1,1);break;case E_:n.blendFuncSeparate(0,769,0,1);break;case T_:n.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",F)}else switch(F){case ta:n.blendFuncSeparate(770,771,1,771);break;case S_:n.blendFunc(770,1);break;case E_:n.blendFuncSeparate(0,769,0,1);break;case T_:n.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",F)}x=null,w=null,A=null,b=null,v=F,S=Oi}}else!0===_&&(Oe(3042),_=!1)}function Ce(F){R!==F&&(n.frontFace(F?2304:2305),R=F)}function St(F){F!==XT?($e(2884),F!==B&&n.cullFace(F===b_?1029:F===YT?1028:1032)):Oe(2884),B=F}function Qe(F,ee,me){F?($e(32823),(k!==ee||N!==me)&&(n.polygonOffset(ee,me),k=ee,N=me)):Oe(32823)}return{buffers:{color:a,depth:c,stencil:l},enable:$e,disable:Oe,bindFramebuffer:function Ge(F,ee){return h[F]!==ee&&(n.bindFramebuffer(F,ee),h[F]=ee,i&&(36009===F&&(h[36160]=ee),36160===F&&(h[36009]=ee)),!0)},drawBuffers:function be(F,ee){let me=p,Ne=!1;if(F)if(me=m.get(ee),void 0===me&&(me=[],m.set(ee,me)),F.isWebGLMultipleRenderTargets){const qe=F.texture;if(me.length!==qe.length||36064!==me[0]){for(let cn=0,vi=qe.length;cn<vi;cn++)me[cn]=36064+cn;me.length=qe.length,Ne=!0}}else 36064!==me[0]&&(me[0]=36064,Ne=!0);else 1029!==me[0]&&(me[0]=1029,Ne=!0);Ne&&(t.isWebGL2?n.drawBuffers(me):e.get("WEBGL_draw_buffers").drawBuffersWEBGL(me))},useProgram:function Nt(F){return g!==F&&(n.useProgram(F),g=F,!0)},setBlending:Se,setMaterial:function We(F,ee){F.side===ws?Oe(2884):$e(2884);let me=F.side===ir;ee&&(me=!me),Ce(me),F.blending===ta&&!1===F.transparent?Se(Ws):Se(F.blending,F.blendEquation,F.blendSrc,F.blendDst,F.blendEquationAlpha,F.blendSrcAlpha,F.blendDstAlpha,F.premultipliedAlpha),c.setFunc(F.depthFunc),c.setTest(F.depthTest),c.setMask(F.depthWrite),a.setMask(F.colorWrite);const Ne=F.stencilWrite;l.setTest(Ne),Ne&&(l.setMask(F.stencilWriteMask),l.setFunc(F.stencilFunc,F.stencilRef,F.stencilFuncMask),l.setOp(F.stencilFail,F.stencilZFail,F.stencilZPass)),Qe(F.polygonOffset,F.polygonOffsetFactor,F.polygonOffsetUnits),!0===F.alphaToCoverage?$e(32926):Oe(32926)},setFlipSided:Ce,setCullFace:St,setLineWidth:function ct(F){F!==G&&(ne&&n.lineWidth(F),G=F)},setPolygonOffset:Qe,setScissorTest:function In(F){F?$e(3089):Oe(3089)},activeTexture:function fn(F){void 0===F&&(F=33984+q-1),he!==F&&(n.activeTexture(F),he=F)},bindTexture:function I(F,ee,me){void 0===me&&(me=null===he?33984+q-1:he);let Ne=ue[me];void 0===Ne&&(Ne={type:void 0,texture:void 0},ue[me]=Ne),(Ne.type!==F||Ne.texture!==ee)&&(he!==me&&(n.activeTexture(me),he=me),n.bindTexture(F,ee||j[F]),Ne.type=F,Ne.texture=ee)},unbindTexture:function E(){const F=ue[he];void 0!==F&&void 0!==F.type&&(n.bindTexture(F.type,null),F.type=void 0,F.texture=void 0)},compressedTexImage2D:function K(){try{n.compressedTexImage2D.apply(n,arguments)}catch(F){console.error("THREE.WebGLState:",F)}},compressedTexImage3D:function ge(){try{n.compressedTexImage3D.apply(n,arguments)}catch(F){console.error("THREE.WebGLState:",F)}},texImage2D:function ut(){try{n.texImage2D.apply(n,arguments)}catch(F){console.error("THREE.WebGLState:",F)}},texImage3D:function je(){try{n.texImage3D.apply(n,arguments)}catch(F){console.error("THREE.WebGLState:",F)}},updateUBOMapping:function tn(F,ee){let me=d.get(ee);void 0===me&&(me=new WeakMap,d.set(ee,me));let Ne=me.get(F);void 0===Ne&&(Ne=n.getUniformBlockIndex(ee,F.name),me.set(F,Ne))},uniformBlockBinding:function Pn(F,ee){const Ne=d.get(ee).get(F);u.get(ee)!==Ne&&(n.uniformBlockBinding(ee,Ne,F.__bindingPointIndex),u.set(ee,Ne))},texStorage2D:function se(){try{n.texStorage2D.apply(n,arguments)}catch(F){console.error("THREE.WebGLState:",F)}},texStorage3D:function et(){try{n.texStorage3D.apply(n,arguments)}catch(F){console.error("THREE.WebGLState:",F)}},texSubImage2D:function we(){try{n.texSubImage2D.apply(n,arguments)}catch(F){console.error("THREE.WebGLState:",F)}},texSubImage3D:function Re(){try{n.texSubImage3D.apply(n,arguments)}catch(F){console.error("THREE.WebGLState:",F)}},compressedTexSubImage2D:function _t(){try{n.compressedTexSubImage2D.apply(n,arguments)}catch(F){console.error("THREE.WebGLState:",F)}},compressedTexSubImage3D:function Pe(){try{n.compressedTexSubImage3D.apply(n,arguments)}catch(F){console.error("THREE.WebGLState:",F)}},scissor:function lt(F){!1===de.equals(F)&&(n.scissor(F.x,F.y,F.z,F.w),de.copy(F))},viewport:function tt(F){!1===_e.equals(F)&&(n.viewport(F.x,F.y,F.z,F.w),_e.copy(F))},reset:function _i(){n.disable(3042),n.disable(2884),n.disable(2929),n.disable(32823),n.disable(3089),n.disable(2960),n.disable(32926),n.blendEquation(32774),n.blendFunc(1,0),n.blendFuncSeparate(1,0,1,0),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0),n.depthMask(!0),n.depthFunc(513),n.clearDepth(1),n.stencilMask(4294967295),n.stencilFunc(519,0,4294967295),n.stencilOp(7680,7680,7680),n.clearStencil(0),n.cullFace(1029),n.frontFace(2305),n.polygonOffset(0,0),n.activeTexture(33984),n.bindFramebuffer(36160,null),!0===i&&(n.bindFramebuffer(36009,null),n.bindFramebuffer(36008,null)),n.useProgram(null),n.lineWidth(1),n.scissor(0,0,n.canvas.width,n.canvas.height),n.viewport(0,0,n.canvas.width,n.canvas.height),f={},he=null,ue={},h={},m=new WeakMap,p=[],g=null,_=!1,v=null,y=null,x=null,w=null,M=null,A=null,b=null,S=!1,R=null,B=null,G=null,k=null,N=null,de.set(0,0,n.canvas.width,n.canvas.height),_e.set(0,0,n.canvas.width,n.canvas.height),a.reset(),c.reset(),l.reset()}}}function m4(n,e,t,i,r,s,o){const a=r.isWebGL2,c=r.maxTextures,l=r.maxCubemapSize,u=r.maxTextureSize,d=r.maxSamples,f=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,h=!(typeof navigator>"u")&&/OculusBrowser/g.test(navigator.userAgent),m=new WeakMap;let p;const g=new WeakMap;let _=!1;try{_=typeof OffscreenCanvas<"u"&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch{}function v(I,E){return _?new OffscreenCanvas(I,E):$u("canvas")}function y(I,E,K,ge){let we=1;if((I.width>ge||I.height>ge)&&(we=ge/Math.max(I.width,I.height)),we<1||!0===E){if(typeof HTMLImageElement<"u"&&I instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&I instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&I instanceof ImageBitmap){const Re=E?qh:Math.floor,_t=Re(we*I.width),Pe=Re(we*I.height);void 0===p&&(p=v(_t,Pe));const se=K?v(_t,Pe):p;return se.width=_t,se.height=Pe,se.getContext("2d").drawImage(I,0,0,_t,Pe),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+I.width+"x"+I.height+") to ("+_t+"x"+Pe+")."),se}return"data"in I&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+I.width+"x"+I.height+")."),I}return I}function x(I){return ov(I.width)&&ov(I.height)}function M(I,E){return I.generateMipmaps&&E&&I.minFilter!==Hn&&I.minFilter!==Fn}function A(I){n.generateMipmap(I)}function b(I,E,K,ge,we=!1){if(!1===a)return E;if(null!==I){if(void 0!==n[I])return n[I];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+I+"'")}let Re=E;return 6403===E&&(5126===K&&(Re=33326),5131===K&&(Re=33325),5121===K&&(Re=33321)),33319===E&&(5126===K&&(Re=33328),5131===K&&(Re=33327),5121===K&&(Re=33323)),6408===E&&(5126===K&&(Re=34836),5131===K&&(Re=34842),5121===K&&(Re=ge===Qt&&!1===we?35907:32856),32819===K&&(Re=32854),32820===K&&(Re=32855)),(33325===Re||33326===Re||33327===Re||33328===Re||34842===Re||34836===Re)&&e.get("EXT_color_buffer_float"),Re}function S(I,E,K){return!0===M(I,K)||I.isFramebufferTexture&&I.minFilter!==Hn&&I.minFilter!==Fn?Math.log2(Math.max(E.width,E.height))+1:void 0!==I.mipmaps&&I.mipmaps.length>0?I.mipmaps.length:I.isCompressedTexture&&Array.isArray(I.image)?E.mipmaps.length:1}function R(I){return I===Hn||I===zu||I===Fc?9728:9729}function B(I){const E=I.target;E.removeEventListener("dispose",B),function k(I){const E=i.get(I);if(void 0===E.__webglInit)return;const K=I.source,ge=g.get(K);if(ge){const we=ge[E.__cacheKey];we.usedTimes--,0===we.usedTimes&&N(I),0===Object.keys(ge).length&&g.delete(K)}i.remove(I)}(E),E.isVideoTexture&&m.delete(E)}function G(I){const E=I.target;E.removeEventListener("dispose",G),function q(I){const E=I.texture,K=i.get(I),ge=i.get(E);if(void 0!==ge.__webglTexture&&(n.deleteTexture(ge.__webglTexture),o.memory.textures--),I.depthTexture&&I.depthTexture.dispose(),I.isWebGLCubeRenderTarget)for(let we=0;we<6;we++)n.deleteFramebuffer(K.__webglFramebuffer[we]),K.__webglDepthbuffer&&n.deleteRenderbuffer(K.__webglDepthbuffer[we]);else{if(n.deleteFramebuffer(K.__webglFramebuffer),K.__webglDepthbuffer&&n.deleteRenderbuffer(K.__webglDepthbuffer),K.__webglMultisampledFramebuffer&&n.deleteFramebuffer(K.__webglMultisampledFramebuffer),K.__webglColorRenderbuffer)for(let we=0;we<K.__webglColorRenderbuffer.length;we++)K.__webglColorRenderbuffer[we]&&n.deleteRenderbuffer(K.__webglColorRenderbuffer[we]);K.__webglDepthRenderbuffer&&n.deleteRenderbuffer(K.__webglDepthRenderbuffer)}if(I.isWebGLMultipleRenderTargets)for(let we=0,Re=E.length;we<Re;we++){const _t=i.get(E[we]);_t.__webglTexture&&(n.deleteTexture(_t.__webglTexture),o.memory.textures--),i.remove(E[we])}i.remove(E),i.remove(I)}(E)}function N(I){const E=i.get(I);n.deleteTexture(E.__webglTexture),delete g.get(I.source)[E.__cacheKey],o.memory.textures--}let ne=0;function ue(I,E){const K=i.get(I);if(I.isVideoTexture&&function In(I){const E=o.render.frame;m.get(I)!==E&&(m.set(I,E),I.update())}(I),!1===I.isRenderTargetTexture&&I.version>0&&K.__version!==I.version){const ge=I.image;if(null===ge)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==ge.complete)return void Oe(K,I,E);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}t.bindTexture(3553,K.__webglTexture,33984+E)}const _e={[vo]:10497,[Ei]:33071,[Oc]:33648},xe={[Hn]:9728,[zu]:9984,[Fc]:9986,[Fn]:9729,[Fh]:9985,[Ms]:9987};function j(I,E,K){if(K?(n.texParameteri(I,10242,_e[E.wrapS]),n.texParameteri(I,10243,_e[E.wrapT]),(32879===I||35866===I)&&n.texParameteri(I,32882,_e[E.wrapR]),n.texParameteri(I,10240,xe[E.magFilter]),n.texParameteri(I,10241,xe[E.minFilter])):(n.texParameteri(I,10242,33071),n.texParameteri(I,10243,33071),(32879===I||35866===I)&&n.texParameteri(I,32882,33071),(E.wrapS!==Ei||E.wrapT!==Ei)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),n.texParameteri(I,10240,R(E.magFilter)),n.texParameteri(I,10241,R(E.minFilter)),E.minFilter!==Hn&&E.minFilter!==Fn&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===e.has("EXT_texture_filter_anisotropic")){const ge=e.get("EXT_texture_filter_anisotropic");if(E.magFilter===Hn||E.minFilter!==Fc&&E.minFilter!==Ms||E.type===js&&!1===e.has("OES_texture_float_linear")||!1===a&&E.type===kc&&!1===e.has("OES_texture_half_float_linear"))return;(E.anisotropy>1||i.get(E).__currentAnisotropy)&&(n.texParameterf(I,ge.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(E.anisotropy,r.getMaxAnisotropy())),i.get(E).__currentAnisotropy=E.anisotropy)}}function $e(I,E){let K=!1;void 0===I.__webglInit&&(I.__webglInit=!0,E.addEventListener("dispose",B));const ge=E.source;let we=g.get(ge);void 0===we&&(we={},g.set(ge,we));const Re=function he(I){const E=[];return E.push(I.wrapS),E.push(I.wrapT),E.push(I.wrapR||0),E.push(I.magFilter),E.push(I.minFilter),E.push(I.anisotropy),E.push(I.internalFormat),E.push(I.format),E.push(I.type),E.push(I.generateMipmaps),E.push(I.premultiplyAlpha),E.push(I.flipY),E.push(I.unpackAlignment),E.push(I.encoding),E.join()}(E);if(Re!==I.__cacheKey){void 0===we[Re]&&(we[Re]={texture:n.createTexture(),usedTimes:0},o.memory.textures++,K=!0),we[Re].usedTimes++;const _t=we[I.__cacheKey];void 0!==_t&&(we[I.__cacheKey].usedTimes--,0===_t.usedTimes&&N(E)),I.__cacheKey=Re,I.__webglTexture=we[Re].texture}return K}function Oe(I,E,K){let ge=3553;(E.isDataArrayTexture||E.isCompressedArrayTexture)&&(ge=35866),E.isData3DTexture&&(ge=32879);const we=$e(I,E),Re=E.source;t.bindTexture(ge,I.__webglTexture,33984+K);const _t=i.get(Re);if(Re.version!==_t.__version||!0===we){t.activeTexture(33984+K),n.pixelStorei(37440,E.flipY),n.pixelStorei(37441,E.premultiplyAlpha),n.pixelStorei(3317,E.unpackAlignment),n.pixelStorei(37443,0);const Pe=function w(I){return!a&&(I.wrapS!==Ei||I.wrapT!==Ei||I.minFilter!==Hn&&I.minFilter!==Fn)}(E)&&!1===x(E.image);let se=y(E.image,Pe,!1,u);se=fn(E,se);const et=x(se)||a,ut=s.convert(E.format,E.encoding);let tt,je=s.convert(E.type),lt=b(E.internalFormat,ut,je,E.encoding,E.isVideoTexture);j(ge,E,et);const tn=E.mipmaps,Pn=a&&!0!==E.isVideoTexture,_i=void 0===_t.__version||!0===we,F=S(E,se,et);if(E.isDepthTexture)lt=6402,a?lt=E.type===js?36012:E.type===bo?33190:E.type===ia?35056:33189:E.type===js&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),E.format===wo&&6402===lt&&E.type!==P_&&E.type!==bo&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),E.type=bo,je=s.convert(E.type)),E.format===ra&&6402===lt&&(lt=34041,E.type!==ia&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),E.type=ia,je=s.convert(E.type))),_i&&(Pn?t.texStorage2D(3553,1,lt,se.width,se.height):t.texImage2D(3553,0,lt,se.width,se.height,0,ut,je,null));else if(E.isDataTexture)if(tn.length>0&&et){Pn&&_i&&t.texStorage2D(3553,F,lt,tn[0].width,tn[0].height);for(let ee=0,me=tn.length;ee<me;ee++)tt=tn[ee],Pn?t.texSubImage2D(3553,ee,0,0,tt.width,tt.height,ut,je,tt.data):t.texImage2D(3553,ee,lt,tt.width,tt.height,0,ut,je,tt.data);E.generateMipmaps=!1}else Pn?(_i&&t.texStorage2D(3553,F,lt,se.width,se.height),t.texSubImage2D(3553,0,0,0,se.width,se.height,ut,je,se.data)):t.texImage2D(3553,0,lt,se.width,se.height,0,ut,je,se.data);else if(E.isCompressedTexture)if(E.isCompressedArrayTexture){Pn&&_i&&t.texStorage3D(35866,F,lt,tn[0].width,tn[0].height,se.depth);for(let ee=0,me=tn.length;ee<me;ee++)tt=tn[ee],E.format!==dr?null!==ut?Pn?t.compressedTexSubImage3D(35866,ee,0,0,0,tt.width,tt.height,se.depth,ut,tt.data,0,0):t.compressedTexImage3D(35866,ee,lt,tt.width,tt.height,se.depth,0,tt.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Pn?t.texSubImage3D(35866,ee,0,0,0,tt.width,tt.height,se.depth,ut,je,tt.data):t.texImage3D(35866,ee,lt,tt.width,tt.height,se.depth,0,ut,je,tt.data)}else{Pn&&_i&&t.texStorage2D(3553,F,lt,tn[0].width,tn[0].height);for(let ee=0,me=tn.length;ee<me;ee++)tt=tn[ee],E.format!==dr?null!==ut?Pn?t.compressedTexSubImage2D(3553,ee,0,0,tt.width,tt.height,ut,tt.data):t.compressedTexImage2D(3553,ee,lt,tt.width,tt.height,0,tt.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Pn?t.texSubImage2D(3553,ee,0,0,tt.width,tt.height,ut,je,tt.data):t.texImage2D(3553,ee,lt,tt.width,tt.height,0,ut,je,tt.data)}else if(E.isDataArrayTexture)Pn?(_i&&t.texStorage3D(35866,F,lt,se.width,se.height,se.depth),t.texSubImage3D(35866,0,0,0,0,se.width,se.height,se.depth,ut,je,se.data)):t.texImage3D(35866,0,lt,se.width,se.height,se.depth,0,ut,je,se.data);else if(E.isData3DTexture)Pn?(_i&&t.texStorage3D(32879,F,lt,se.width,se.height,se.depth),t.texSubImage3D(32879,0,0,0,0,se.width,se.height,se.depth,ut,je,se.data)):t.texImage3D(32879,0,lt,se.width,se.height,se.depth,0,ut,je,se.data);else if(E.isFramebufferTexture){if(_i)if(Pn)t.texStorage2D(3553,F,lt,se.width,se.height);else{let ee=se.width,me=se.height;for(let Ne=0;Ne<F;Ne++)t.texImage2D(3553,Ne,lt,ee,me,0,ut,je,null),ee>>=1,me>>=1}}else if(tn.length>0&&et){Pn&&_i&&t.texStorage2D(3553,F,lt,tn[0].width,tn[0].height);for(let ee=0,me=tn.length;ee<me;ee++)tt=tn[ee],Pn?t.texSubImage2D(3553,ee,0,0,ut,je,tt):t.texImage2D(3553,ee,lt,ut,je,tt);E.generateMipmaps=!1}else Pn?(_i&&t.texStorage2D(3553,F,lt,se.width,se.height),t.texSubImage2D(3553,0,0,0,ut,je,se)):t.texImage2D(3553,0,lt,ut,je,se);M(E,et)&&A(ge),_t.__version=Re.version,E.onUpdate&&E.onUpdate(E)}I.__version=E.version}function be(I,E,K,ge,we){const Re=s.convert(K.format,K.encoding),_t=s.convert(K.type),Pe=b(K.internalFormat,Re,_t,K.encoding);i.get(E).__hasExternalTextures||(32879===we||35866===we?t.texImage3D(we,0,Pe,E.width,E.height,E.depth,0,Re,_t,null):t.texImage2D(we,0,Pe,E.width,E.height,0,Re,_t,null)),t.bindFramebuffer(36160,I),Qe(E)?f.framebufferTexture2DMultisampleEXT(36160,ge,we,i.get(K).__webglTexture,0,ct(E)):(3553===we||we>=34069&&we<=34074)&&n.framebufferTexture2D(36160,ge,we,i.get(K).__webglTexture,0),t.bindFramebuffer(36160,null)}function Nt(I,E,K){if(n.bindRenderbuffer(36161,I),E.depthBuffer&&!E.stencilBuffer){let ge=33189;if(K||Qe(E)){const we=E.depthTexture;we&&we.isDepthTexture&&(we.type===js?ge=36012:we.type===bo&&(ge=33190));const Re=ct(E);Qe(E)?f.renderbufferStorageMultisampleEXT(36161,Re,ge,E.width,E.height):n.renderbufferStorageMultisample(36161,Re,ge,E.width,E.height)}else n.renderbufferStorage(36161,ge,E.width,E.height);n.framebufferRenderbuffer(36160,36096,36161,I)}else if(E.depthBuffer&&E.stencilBuffer){const ge=ct(E);K&&!1===Qe(E)?n.renderbufferStorageMultisample(36161,ge,35056,E.width,E.height):Qe(E)?f.renderbufferStorageMultisampleEXT(36161,ge,35056,E.width,E.height):n.renderbufferStorage(36161,34041,E.width,E.height),n.framebufferRenderbuffer(36160,33306,36161,I)}else{const ge=!0===E.isWebGLMultipleRenderTargets?E.texture:[E.texture];for(let we=0;we<ge.length;we++){const Re=ge[we],_t=s.convert(Re.format,Re.encoding),Pe=s.convert(Re.type),se=b(Re.internalFormat,_t,Pe,Re.encoding),et=ct(E);K&&!1===Qe(E)?n.renderbufferStorageMultisample(36161,et,se,E.width,E.height):Qe(E)?f.renderbufferStorageMultisampleEXT(36161,et,se,E.width,E.height):n.renderbufferStorage(36161,se,E.width,E.height)}}n.bindRenderbuffer(36161,null)}function oe(I){const E=i.get(I),K=!0===I.isWebGLCubeRenderTarget;if(I.depthTexture&&!E.__autoAllocateDepthBuffer){if(K)throw new Error("target.depthTexture not supported in Cube render targets");!function ae(I,E){if(E&&E.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(36160,I),!E.depthTexture||!E.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!i.get(E.depthTexture).__webglTexture||E.depthTexture.image.width!==E.width||E.depthTexture.image.height!==E.height)&&(E.depthTexture.image.width=E.width,E.depthTexture.image.height=E.height,E.depthTexture.needsUpdate=!0),ue(E.depthTexture,0);const ge=i.get(E.depthTexture).__webglTexture,we=ct(E);if(E.depthTexture.format===wo)Qe(E)?f.framebufferTexture2DMultisampleEXT(36160,36096,3553,ge,0,we):n.framebufferTexture2D(36160,36096,3553,ge,0);else{if(E.depthTexture.format!==ra)throw new Error("Unknown depthTexture format");Qe(E)?f.framebufferTexture2DMultisampleEXT(36160,33306,3553,ge,0,we):n.framebufferTexture2D(36160,33306,3553,ge,0)}}(E.__webglFramebuffer,I)}else if(K){E.__webglDepthbuffer=[];for(let ge=0;ge<6;ge++)t.bindFramebuffer(36160,E.__webglFramebuffer[ge]),E.__webglDepthbuffer[ge]=n.createRenderbuffer(),Nt(E.__webglDepthbuffer[ge],I,!1)}else t.bindFramebuffer(36160,E.__webglFramebuffer),E.__webglDepthbuffer=n.createRenderbuffer(),Nt(E.__webglDepthbuffer,I,!1);t.bindFramebuffer(36160,null)}function ct(I){return Math.min(d,I.samples)}function Qe(I){const E=i.get(I);return a&&I.samples>0&&!0===e.has("WEBGL_multisampled_render_to_texture")&&!1!==E.__useRenderToTexture}function fn(I,E){const K=I.encoding,ge=I.format,we=I.type;return!0===I.isCompressedTexture||!0===I.isVideoTexture||I.format===$h||K!==$s&&(K===Qt?!1===a?!0===e.has("EXT_sRGB")&&ge===dr?(I.format=$h,I.minFilter=Fn,I.generateMipmaps=!1):E=dv.sRGBToLinear(E):(ge!==dr||we!==xo)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",K)),E}this.allocateTextureUnit=function re(){const I=ne;return I>=c&&console.warn("THREE.WebGLTextures: Trying to use "+I+" texture units while this GPU supports only "+c),ne+=1,I},this.resetTextureUnits=function pe(){ne=0},this.setTexture2D=ue,this.setTexture2DArray=function ke(I,E){const K=i.get(I);I.version>0&&K.__version!==I.version?Oe(K,I,E):t.bindTexture(35866,K.__webglTexture,33984+E)},this.setTexture3D=function $(I,E){const K=i.get(I);I.version>0&&K.__version!==I.version?Oe(K,I,E):t.bindTexture(32879,K.__webglTexture,33984+E)},this.setTextureCube=function de(I,E){const K=i.get(I);I.version>0&&K.__version!==I.version?function Ge(I,E,K){if(6!==E.image.length)return;const ge=$e(I,E),we=E.source;t.bindTexture(34067,I.__webglTexture,33984+K);const Re=i.get(we);if(we.version!==Re.__version||!0===ge){t.activeTexture(33984+K),n.pixelStorei(37440,E.flipY),n.pixelStorei(37441,E.premultiplyAlpha),n.pixelStorei(3317,E.unpackAlignment),n.pixelStorei(37443,0);const _t=E.isCompressedTexture||E.image[0].isCompressedTexture,Pe=E.image[0]&&E.image[0].isDataTexture,se=[];for(let ee=0;ee<6;ee++)se[ee]=_t||Pe?Pe?E.image[ee].image:E.image[ee]:y(E.image[ee],!1,!0,l),se[ee]=fn(E,se[ee]);const et=se[0],ut=x(et)||a,je=s.convert(E.format,E.encoding),lt=s.convert(E.type),tt=b(E.internalFormat,je,lt,E.encoding),tn=a&&!0!==E.isVideoTexture,Pn=void 0===Re.__version||!0===ge;let F,_i=S(E,et,ut);if(j(34067,E,ut),_t){tn&&Pn&&t.texStorage2D(34067,_i,tt,et.width,et.height);for(let ee=0;ee<6;ee++){F=se[ee].mipmaps;for(let me=0;me<F.length;me++){const Ne=F[me];E.format!==dr?null!==je?tn?t.compressedTexSubImage2D(34069+ee,me,0,0,Ne.width,Ne.height,je,Ne.data):t.compressedTexImage2D(34069+ee,me,tt,Ne.width,Ne.height,0,Ne.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):tn?t.texSubImage2D(34069+ee,me,0,0,Ne.width,Ne.height,je,lt,Ne.data):t.texImage2D(34069+ee,me,tt,Ne.width,Ne.height,0,je,lt,Ne.data)}}}else{F=E.mipmaps,tn&&Pn&&(F.length>0&&_i++,t.texStorage2D(34067,_i,tt,se[0].width,se[0].height));for(let ee=0;ee<6;ee++)if(Pe){tn?t.texSubImage2D(34069+ee,0,0,0,se[ee].width,se[ee].height,je,lt,se[ee].data):t.texImage2D(34069+ee,0,tt,se[ee].width,se[ee].height,0,je,lt,se[ee].data);for(let me=0;me<F.length;me++){const qe=F[me].image[ee].image;tn?t.texSubImage2D(34069+ee,me+1,0,0,qe.width,qe.height,je,lt,qe.data):t.texImage2D(34069+ee,me+1,tt,qe.width,qe.height,0,je,lt,qe.data)}}else{tn?t.texSubImage2D(34069+ee,0,0,0,je,lt,se[ee]):t.texImage2D(34069+ee,0,tt,je,lt,se[ee]);for(let me=0;me<F.length;me++){const Ne=F[me];tn?t.texSubImage2D(34069+ee,me+1,0,0,je,lt,Ne.image[ee]):t.texImage2D(34069+ee,me+1,tt,je,lt,Ne.image[ee])}}}M(E,ut)&&A(34067),Re.__version=we.version,E.onUpdate&&E.onUpdate(E)}I.__version=E.version}(K,I,E):t.bindTexture(34067,K.__webglTexture,33984+E)},this.rebindTextures=function Se(I,E,K){const ge=i.get(I);void 0!==E&&be(ge.__webglFramebuffer,I,I.texture,36064,3553),void 0!==K&&oe(I)},this.setupRenderTarget=function We(I){const E=I.texture,K=i.get(I),ge=i.get(E);I.addEventListener("dispose",G),!0!==I.isWebGLMultipleRenderTargets&&(void 0===ge.__webglTexture&&(ge.__webglTexture=n.createTexture()),ge.__version=E.version,o.memory.textures++);const we=!0===I.isWebGLCubeRenderTarget,Re=!0===I.isWebGLMultipleRenderTargets,_t=x(I)||a;if(we){K.__webglFramebuffer=[];for(let Pe=0;Pe<6;Pe++)K.__webglFramebuffer[Pe]=n.createFramebuffer()}else{if(K.__webglFramebuffer=n.createFramebuffer(),Re)if(r.drawBuffers){const Pe=I.texture;for(let se=0,et=Pe.length;se<et;se++){const ut=i.get(Pe[se]);void 0===ut.__webglTexture&&(ut.__webglTexture=n.createTexture(),o.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(a&&I.samples>0&&!1===Qe(I)){const Pe=Re?E:[E];K.__webglMultisampledFramebuffer=n.createFramebuffer(),K.__webglColorRenderbuffer=[],t.bindFramebuffer(36160,K.__webglMultisampledFramebuffer);for(let se=0;se<Pe.length;se++){const et=Pe[se];K.__webglColorRenderbuffer[se]=n.createRenderbuffer(),n.bindRenderbuffer(36161,K.__webglColorRenderbuffer[se]);const ut=s.convert(et.format,et.encoding),je=s.convert(et.type),lt=b(et.internalFormat,ut,je,et.encoding,!0===I.isXRRenderTarget),tt=ct(I);n.renderbufferStorageMultisample(36161,tt,lt,I.width,I.height),n.framebufferRenderbuffer(36160,36064+se,36161,K.__webglColorRenderbuffer[se])}n.bindRenderbuffer(36161,null),I.depthBuffer&&(K.__webglDepthRenderbuffer=n.createRenderbuffer(),Nt(K.__webglDepthRenderbuffer,I,!0)),t.bindFramebuffer(36160,null)}}if(we){t.bindTexture(34067,ge.__webglTexture),j(34067,E,_t);for(let Pe=0;Pe<6;Pe++)be(K.__webglFramebuffer[Pe],I,E,36064,34069+Pe);M(E,_t)&&A(34067),t.unbindTexture()}else if(Re){const Pe=I.texture;for(let se=0,et=Pe.length;se<et;se++){const ut=Pe[se],je=i.get(ut);t.bindTexture(3553,je.__webglTexture),j(3553,ut,_t),be(K.__webglFramebuffer,I,ut,36064+se,3553),M(ut,_t)&&A(3553)}t.unbindTexture()}else{let Pe=3553;(I.isWebGL3DRenderTarget||I.isWebGLArrayRenderTarget)&&(a?Pe=I.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),t.bindTexture(Pe,ge.__webglTexture),j(Pe,E,_t),be(K.__webglFramebuffer,I,E,36064,Pe),M(E,_t)&&A(Pe),t.unbindTexture()}I.depthBuffer&&oe(I)},this.updateRenderTargetMipmap=function Ce(I){const E=x(I)||a,K=!0===I.isWebGLMultipleRenderTargets?I.texture:[I.texture];for(let ge=0,we=K.length;ge<we;ge++){const Re=K[ge];if(M(Re,E)){const _t=I.isWebGLCubeRenderTarget?34067:3553,Pe=i.get(Re).__webglTexture;t.bindTexture(_t,Pe),A(_t),t.unbindTexture()}}},this.updateMultisampleRenderTarget=function St(I){if(a&&I.samples>0&&!1===Qe(I)){const E=I.isWebGLMultipleRenderTargets?I.texture:[I.texture],K=I.width,ge=I.height;let we=16384;const Re=[],_t=I.stencilBuffer?33306:36096,Pe=i.get(I),se=!0===I.isWebGLMultipleRenderTargets;if(se)for(let et=0;et<E.length;et++)t.bindFramebuffer(36160,Pe.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(36160,36064+et,36161,null),t.bindFramebuffer(36160,Pe.__webglFramebuffer),n.framebufferTexture2D(36009,36064+et,3553,null,0);t.bindFramebuffer(36008,Pe.__webglMultisampledFramebuffer),t.bindFramebuffer(36009,Pe.__webglFramebuffer);for(let et=0;et<E.length;et++){Re.push(36064+et),I.depthBuffer&&Re.push(_t);const ut=void 0!==Pe.__ignoreDepthValues&&Pe.__ignoreDepthValues;if(!1===ut&&(I.depthBuffer&&(we|=256),I.stencilBuffer&&(we|=1024)),se&&n.framebufferRenderbuffer(36008,36064,36161,Pe.__webglColorRenderbuffer[et]),!0===ut&&(n.invalidateFramebuffer(36008,[_t]),n.invalidateFramebuffer(36009,[_t])),se){const je=i.get(E[et]).__webglTexture;n.framebufferTexture2D(36009,36064,3553,je,0)}n.blitFramebuffer(0,0,K,ge,0,0,K,ge,we,9728),h&&n.invalidateFramebuffer(36008,Re)}if(t.bindFramebuffer(36008,null),t.bindFramebuffer(36009,null),se)for(let et=0;et<E.length;et++){t.bindFramebuffer(36160,Pe.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(36160,36064+et,36161,Pe.__webglColorRenderbuffer[et]);const ut=i.get(E[et]).__webglTexture;t.bindFramebuffer(36160,Pe.__webglFramebuffer),n.framebufferTexture2D(36009,36064+et,3553,ut,0)}t.bindFramebuffer(36009,Pe.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=oe,this.setupFrameBufferTexture=be,this.useMultisampledRTT=Qe}function FC(n,e,t){const i=t.isWebGL2;return{convert:function r(s,o=null){let a;if(s===xo)return 5121;if(s===ED)return 32819;if(s===TD)return 32820;if(s===wD)return 5120;if(s===MD)return 5122;if(s===P_)return 5123;if(s===SD)return 5124;if(s===bo)return 5125;if(s===js)return 5126;if(s===kc)return i?5131:(a=e.get("OES_texture_half_float"),null!==a?a.HALF_FLOAT_OES:null);if(s===DD)return 6406;if(s===dr)return 6408;if(s===CD)return 6409;if(s===AD)return 6410;if(s===wo)return 6402;if(s===ra)return 34041;if(s===$h)return a=e.get("EXT_sRGB"),null!==a?a.SRGB_ALPHA_EXT:null;if(s===ID)return 6403;if(s===RD)return 36244;if(s===PD)return 33319;if(s===LD)return 33320;if(s===ND)return 36249;if(s===kh||s===Bh||s===Uh||s===Vh)if(o===Qt){if(a=e.get("WEBGL_compressed_texture_s3tc_srgb"),null===a)return null;if(s===kh)return a.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(s===Bh)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(s===Uh)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(s===Vh)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(a=e.get("WEBGL_compressed_texture_s3tc"),null===a)return null;if(s===kh)return a.COMPRESSED_RGB_S3TC_DXT1_EXT;if(s===Bh)return a.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(s===Uh)return a.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(s===Vh)return a.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(s===L_||s===N_||s===O_||s===F_){if(a=e.get("WEBGL_compressed_texture_pvrtc"),null===a)return null;if(s===L_)return a.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(s===N_)return a.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(s===O_)return a.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(s===F_)return a.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(s===OD)return a=e.get("WEBGL_compressed_texture_etc1"),null!==a?a.COMPRESSED_RGB_ETC1_WEBGL:null;if(s===k_||s===B_){if(a=e.get("WEBGL_compressed_texture_etc"),null===a)return null;if(s===k_)return o===Qt?a.COMPRESSED_SRGB8_ETC2:a.COMPRESSED_RGB8_ETC2;if(s===B_)return o===Qt?a.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:a.COMPRESSED_RGBA8_ETC2_EAC}if(s===U_||s===V_||s===z_||s===H_||s===G_||s===W_||s===j_||s===$_||s===q_||s===Z_||s===X_||s===Y_||s===K_||s===J_){if(a=e.get("WEBGL_compressed_texture_astc"),null===a)return null;if(s===U_)return o===Qt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:a.COMPRESSED_RGBA_ASTC_4x4_KHR;if(s===V_)return o===Qt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:a.COMPRESSED_RGBA_ASTC_5x4_KHR;if(s===z_)return o===Qt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:a.COMPRESSED_RGBA_ASTC_5x5_KHR;if(s===H_)return o===Qt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:a.COMPRESSED_RGBA_ASTC_6x5_KHR;if(s===G_)return o===Qt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:a.COMPRESSED_RGBA_ASTC_6x6_KHR;if(s===W_)return o===Qt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:a.COMPRESSED_RGBA_ASTC_8x5_KHR;if(s===j_)return o===Qt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:a.COMPRESSED_RGBA_ASTC_8x6_KHR;if(s===$_)return o===Qt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:a.COMPRESSED_RGBA_ASTC_8x8_KHR;if(s===q_)return o===Qt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:a.COMPRESSED_RGBA_ASTC_10x5_KHR;if(s===Z_)return o===Qt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:a.COMPRESSED_RGBA_ASTC_10x6_KHR;if(s===X_)return o===Qt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:a.COMPRESSED_RGBA_ASTC_10x8_KHR;if(s===Y_)return o===Qt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:a.COMPRESSED_RGBA_ASTC_10x10_KHR;if(s===K_)return o===Qt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:a.COMPRESSED_RGBA_ASTC_12x10_KHR;if(s===J_)return o===Qt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:a.COMPRESSED_RGBA_ASTC_12x12_KHR}if(s===zh){if(a=e.get("EXT_texture_compression_bptc"),null===a)return null;if(s===zh)return o===Qt?a.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:a.COMPRESSED_RGBA_BPTC_UNORM_EXT}if(s===FD||s===Q_||s===ev||s===tv){if(a=e.get("EXT_texture_compression_rgtc"),null===a)return null;if(s===zh)return a.COMPRESSED_RED_RGTC1_EXT;if(s===Q_)return a.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(s===ev)return a.COMPRESSED_RED_GREEN_RGTC2_EXT;if(s===tv)return a.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return s===ia?i?34042:(a=e.get("WEBGL_depth_texture"),null!==a?a.UNSIGNED_INT_24_8_WEBGL:null):void 0!==n[s]?n[s]:null}}}class kC extends di{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class eo extends _n{constructor(){super(),this.isGroup=!0,this.type="Group"}}const g4={type:"move"};class Vv{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new eo,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new eo,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new T,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new T),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new eo,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new T,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new T),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const i of e.hand.values())this._getHandJoint(t,i)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,i){let r=null,s=null,o=null;const a=this._targetRay,c=this._grip,l=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState){if(l&&e.hand){o=!0;for(const p of e.hand.values()){const g=t.getJointPose(p,i),_=this._getHandJoint(l,p);null!==g&&(_.matrix.fromArray(g.transform.matrix),_.matrix.decompose(_.position,_.rotation,_.scale),_.jointRadius=g.radius),_.visible=null!==g}const f=l.joints["index-finger-tip"].position.distanceTo(l.joints["thumb-tip"].position),h=.02,m=.005;l.inputState.pinching&&f>h+m?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&f<=h-m&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==c&&e.gripSpace&&(s=t.getPose(e.gripSpace,i),null!==s&&(c.matrix.fromArray(s.transform.matrix),c.matrix.decompose(c.position,c.rotation,c.scale),s.linearVelocity?(c.hasLinearVelocity=!0,c.linearVelocity.copy(s.linearVelocity)):c.hasLinearVelocity=!1,s.angularVelocity?(c.hasAngularVelocity=!0,c.angularVelocity.copy(s.angularVelocity)):c.hasAngularVelocity=!1));null!==a&&(r=t.getPose(e.targetRaySpace,i),null===r&&null!==s&&(r=s),null!==r&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),r.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(r.linearVelocity)):a.hasLinearVelocity=!1,r.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(r.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(g4)))}return null!==a&&(a.visible=null!==r),null!==c&&(c.visible=null!==s),null!==l&&(l.visible=null!==o),this}_getHandJoint(e,t){if(void 0===e.joints[t.jointName]){const i=new eo;i.matrixAutoUpdate=!1,i.visible=!1,e.joints[t.jointName]=i,e.add(i)}return e.joints[t.jointName]}}class BC extends Ti{constructor(e,t,i,r,s,o,a,c,l,u){if((u=void 0!==u?u:wo)!==wo&&u!==ra)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===i&&u===wo&&(i=bo),void 0===i&&u===ra&&(i=ia),super(null,r,s,o,a,c,u,i,l),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=void 0!==a?a:Hn,this.minFilter=void 0!==c?c:Hn,this.flipY=!1,this.generateMipmaps=!1}}class y4 extends qs{constructor(e,t){super();const i=this;let r=null,s=1,o=null,a="local-floor",c=1,l=null,u=null,d=null,f=null,h=null,m=null;const p=t.getContextAttributes();let g=null,_=null;const v=[],y=[],x=new Set,w=new Map,M=new di;M.layers.enable(1),M.viewport=new dn;const A=new di;A.layers.enable(2),A.viewport=new dn;const b=[M,A],S=new kC;S.layers.enable(1),S.layers.enable(2);let R=null,B=null;function G($){const de=y.indexOf($.inputSource);if(-1===de)return;const _e=v[de];void 0!==_e&&_e.dispatchEvent({type:$.type,data:$.inputSource})}function k(){r.removeEventListener("select",G),r.removeEventListener("selectstart",G),r.removeEventListener("selectend",G),r.removeEventListener("squeeze",G),r.removeEventListener("squeezestart",G),r.removeEventListener("squeezeend",G),r.removeEventListener("end",k),r.removeEventListener("inputsourceschange",N);for(let $=0;$<v.length;$++){const de=y[$];null!==de&&(y[$]=null,v[$].disconnect(de))}R=null,B=null,e.setRenderTarget(g),h=null,f=null,d=null,r=null,_=null,ke.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}function N($){for(let de=0;de<$.removed.length;de++){const _e=$.removed[de],xe=y.indexOf(_e);xe>=0&&(y[xe]=null,v[xe].disconnect(_e))}for(let de=0;de<$.added.length;de++){const _e=$.added[de];let xe=y.indexOf(_e);if(-1===xe){for(let $e=0;$e<v.length;$e++){if($e>=y.length){y.push(_e),xe=$e;break}if(null===y[$e]){y[$e]=_e,xe=$e;break}}if(-1===xe)break}const j=v[xe];j&&j.connect(_e)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function($){let de=v[$];return void 0===de&&(de=new Vv,v[$]=de),de.getTargetRaySpace()},this.getControllerGrip=function($){let de=v[$];return void 0===de&&(de=new Vv,v[$]=de),de.getGripSpace()},this.getHand=function($){let de=v[$];return void 0===de&&(de=new Vv,v[$]=de),de.getHandSpace()},this.setFramebufferScaleFactor=function($){s=$,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function($){a=$,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||o},this.setReferenceSpace=function($){l=$},this.getBaseLayer=function(){return null!==f?f:h},this.getBinding=function(){return d},this.getFrame=function(){return m},this.getSession=function(){return r},this.setSession=function(){var $=ku(function*(de){if(r=de,null!==r){if(g=e.getRenderTarget(),r.addEventListener("select",G),r.addEventListener("selectstart",G),r.addEventListener("selectend",G),r.addEventListener("squeeze",G),r.addEventListener("squeezestart",G),r.addEventListener("squeezeend",G),r.addEventListener("end",k),r.addEventListener("inputsourceschange",N),!0!==p.xrCompatible&&(yield t.makeXRCompatible()),void 0===r.renderState.layers||!1===e.capabilities.isWebGL2)h=new XRWebGLLayer(r,t,{antialias:void 0!==r.renderState.layers||p.antialias,alpha:p.alpha,depth:p.depth,stencil:p.stencil,framebufferScaleFactor:s}),r.updateRenderState({baseLayer:h}),_=new Qr(h.framebufferWidth,h.framebufferHeight,{format:dr,type:xo,encoding:e.outputEncoding,stencilBuffer:p.stencil});else{let _e=null,xe=null,j=null;p.depth&&(j=p.stencil?35056:33190,_e=p.stencil?ra:wo,xe=p.stencil?ia:bo);const $e={colorFormat:32856,depthFormat:j,scaleFactor:s};d=new XRWebGLBinding(r,t),f=d.createProjectionLayer($e),r.updateRenderState({layers:[f]}),_=new Qr(f.textureWidth,f.textureHeight,{format:dr,type:xo,depthTexture:new BC(f.textureWidth,f.textureHeight,xe,void 0,void 0,void 0,void 0,void 0,void 0,_e),stencilBuffer:p.stencil,encoding:e.outputEncoding,samples:p.antialias?4:0}),e.properties.get(_).__ignoreDepthValues=f.ignoreDepthValues}_.isXRRenderTarget=!0,this.setFoveation(c),l=null,o=yield r.requestReferenceSpace(a),ke.setContext(r),ke.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}});return function(de){return $.apply(this,arguments)}}();const q=new T,ne=new T;function re($,de){null===de?$.matrixWorld.copy($.matrix):$.matrixWorld.multiplyMatrices(de.matrixWorld,$.matrix),$.matrixWorldInverse.copy($.matrixWorld).invert()}this.updateCamera=function($){if(null===r)return;S.near=A.near=M.near=$.near,S.far=A.far=M.far=$.far,(R!==S.near||B!==S.far)&&(r.updateRenderState({depthNear:S.near,depthFar:S.far}),R=S.near,B=S.far);const de=$.parent,_e=S.cameras;re(S,de);for(let j=0;j<_e.length;j++)re(_e[j],de);S.matrixWorld.decompose(S.position,S.quaternion,S.scale),$.matrix.copy(S.matrix),$.matrix.decompose($.position,$.quaternion,$.scale);const xe=$.children;for(let j=0,$e=xe.length;j<$e;j++)xe[j].updateMatrixWorld(!0);2===_e.length?function pe($,de,_e){q.setFromMatrixPosition(de.matrixWorld),ne.setFromMatrixPosition(_e.matrixWorld);const xe=q.distanceTo(ne),j=de.projectionMatrix.elements,$e=_e.projectionMatrix.elements,Oe=j[14]/(j[10]-1),Ge=j[14]/(j[10]+1),be=(j[9]+1)/j[5],Nt=(j[9]-1)/j[5],ae=(j[8]-1)/j[0],oe=($e[8]+1)/$e[0],Se=Oe*ae,We=Oe*oe,Ce=xe/(-ae+oe),St=Ce*-ae;de.matrixWorld.decompose($.position,$.quaternion,$.scale),$.translateX(St),$.translateZ(Ce),$.matrixWorld.compose($.position,$.quaternion,$.scale),$.matrixWorldInverse.copy($.matrixWorld).invert();const ct=Oe+Ce,Qe=Ge+Ce;$.projectionMatrix.makePerspective(Se-St,We+(xe-St),be*Ge/Qe*ct,Nt*Ge/Qe*ct,ct,Qe)}(S,M,A):S.projectionMatrix.copy(M.projectionMatrix)},this.getCamera=function(){return S},this.getFoveation=function(){if(null!==f||null!==h)return c},this.setFoveation=function($){c=$,null!==f&&(f.fixedFoveation=$),null!==h&&void 0!==h.fixedFoveation&&(h.fixedFoveation=$)},this.getPlanes=function(){return x};let he=null;const ke=new uC;ke.setAnimationLoop(function ue($,de){if(u=de.getViewerPose(l||o),m=de,null!==u){const _e=u.views;null!==h&&(e.setRenderTargetFramebuffer(_,h.framebuffer),e.setRenderTarget(_));let xe=!1;_e.length!==S.cameras.length&&(S.cameras.length=0,xe=!0);for(let j=0;j<_e.length;j++){const $e=_e[j];let Oe=null;if(null!==h)Oe=h.getViewport($e);else{const be=d.getViewSubImage(f,$e);Oe=be.viewport,0===j&&(e.setRenderTargetTextures(_,be.colorTexture,f.ignoreDepthValues?void 0:be.depthStencilTexture),e.setRenderTarget(_))}let Ge=b[j];void 0===Ge&&(Ge=new di,Ge.layers.enable(j),Ge.viewport=new dn,b[j]=Ge),Ge.matrix.fromArray($e.transform.matrix),Ge.projectionMatrix.fromArray($e.projectionMatrix),Ge.viewport.set(Oe.x,Oe.y,Oe.width,Oe.height),0===j&&S.matrix.copy(Ge.matrix),!0===xe&&S.cameras.push(Ge)}}for(let _e=0;_e<v.length;_e++){const xe=y[_e],j=v[_e];null!==xe&&void 0!==j&&j.update(xe,de,l||o)}if(he&&he($,de),de.detectedPlanes){i.dispatchEvent({type:"planesdetected",data:de.detectedPlanes});let _e=null;for(const xe of x)de.detectedPlanes.has(xe)||(null===_e&&(_e=[]),_e.push(xe));if(null!==_e)for(const xe of _e)x.delete(xe),w.delete(xe),i.dispatchEvent({type:"planeremoved",data:xe});for(const xe of de.detectedPlanes)if(x.has(xe)){const j=w.get(xe);xe.lastChangedTime>j&&(w.set(xe,xe.lastChangedTime),i.dispatchEvent({type:"planechanged",data:xe}))}else x.add(xe),w.set(xe,de.lastChangedTime),i.dispatchEvent({type:"planeadded",data:xe})}m=null}),this.setAnimationLoop=function($){he=$},this.dispose=function(){}}}function _4(n,e){function r(p,g){p.opacity.value=g.opacity,g.color&&p.diffuse.value.copy(g.color),g.emissive&&p.emissive.value.copy(g.emissive).multiplyScalar(g.emissiveIntensity),g.map&&(p.map.value=g.map),g.alphaMap&&(p.alphaMap.value=g.alphaMap),g.bumpMap&&(p.bumpMap.value=g.bumpMap,p.bumpScale.value=g.bumpScale,g.side===ir&&(p.bumpScale.value*=-1)),g.displacementMap&&(p.displacementMap.value=g.displacementMap,p.displacementScale.value=g.displacementScale,p.displacementBias.value=g.displacementBias),g.emissiveMap&&(p.emissiveMap.value=g.emissiveMap),g.normalMap&&(p.normalMap.value=g.normalMap,p.normalScale.value.copy(g.normalScale),g.side===ir&&p.normalScale.value.negate()),g.specularMap&&(p.specularMap.value=g.specularMap),g.alphaTest>0&&(p.alphaTest.value=g.alphaTest);const _=e.get(g).envMap;if(_&&(p.envMap.value=_,p.flipEnvMap.value=_.isCubeTexture&&!1===_.isRenderTargetTexture?-1:1,p.reflectivity.value=g.reflectivity,p.ior.value=g.ior,p.refractionRatio.value=g.refractionRatio),g.lightMap){p.lightMap.value=g.lightMap;const x=!0!==n.physicallyCorrectLights?Math.PI:1;p.lightMapIntensity.value=g.lightMapIntensity*x}let v,y;g.aoMap&&(p.aoMap.value=g.aoMap,p.aoMapIntensity.value=g.aoMapIntensity),g.map?v=g.map:g.specularMap?v=g.specularMap:g.displacementMap?v=g.displacementMap:g.normalMap?v=g.normalMap:g.bumpMap?v=g.bumpMap:g.roughnessMap?v=g.roughnessMap:g.metalnessMap?v=g.metalnessMap:g.alphaMap?v=g.alphaMap:g.emissiveMap?v=g.emissiveMap:g.clearcoatMap?v=g.clearcoatMap:g.clearcoatNormalMap?v=g.clearcoatNormalMap:g.clearcoatRoughnessMap?v=g.clearcoatRoughnessMap:g.iridescenceMap?v=g.iridescenceMap:g.iridescenceThicknessMap?v=g.iridescenceThicknessMap:g.specularIntensityMap?v=g.specularIntensityMap:g.specularColorMap?v=g.specularColorMap:g.transmissionMap?v=g.transmissionMap:g.thicknessMap?v=g.thicknessMap:g.sheenColorMap?v=g.sheenColorMap:g.sheenRoughnessMap&&(v=g.sheenRoughnessMap),void 0!==v&&(v.isWebGLRenderTarget&&(v=v.texture),!0===v.matrixAutoUpdate&&v.updateMatrix(),p.uvTransform.value.copy(v.matrix)),g.aoMap?y=g.aoMap:g.lightMap&&(y=g.lightMap),void 0!==y&&(y.isWebGLRenderTarget&&(y=y.texture),!0===y.matrixAutoUpdate&&y.updateMatrix(),p.uv2Transform.value.copy(y.matrix))}return{refreshFogUniforms:function t(p,g){g.color.getRGB(p.fogColor.value,oC(n)),g.isFog?(p.fogNear.value=g.near,p.fogFar.value=g.far):g.isFogExp2&&(p.fogDensity.value=g.density)},refreshMaterialUniforms:function i(p,g,_,v,y){g.isMeshBasicMaterial||g.isMeshLambertMaterial?r(p,g):g.isMeshToonMaterial?(r(p,g),function u(p,g){g.gradientMap&&(p.gradientMap.value=g.gradientMap)}(p,g)):g.isMeshPhongMaterial?(r(p,g),function l(p,g){p.specular.value.copy(g.specular),p.shininess.value=Math.max(g.shininess,1e-4)}(p,g)):g.isMeshStandardMaterial?(r(p,g),function d(p,g){p.roughness.value=g.roughness,p.metalness.value=g.metalness,g.roughnessMap&&(p.roughnessMap.value=g.roughnessMap),g.metalnessMap&&(p.metalnessMap.value=g.metalnessMap),e.get(g).envMap&&(p.envMapIntensity.value=g.envMapIntensity)}(p,g),g.isMeshPhysicalMaterial&&function f(p,g,_){p.ior.value=g.ior,g.sheen>0&&(p.sheenColor.value.copy(g.sheenColor).multiplyScalar(g.sheen),p.sheenRoughness.value=g.sheenRoughness,g.sheenColorMap&&(p.sheenColorMap.value=g.sheenColorMap),g.sheenRoughnessMap&&(p.sheenRoughnessMap.value=g.sheenRoughnessMap)),g.clearcoat>0&&(p.clearcoat.value=g.clearcoat,p.clearcoatRoughness.value=g.clearcoatRoughness,g.clearcoatMap&&(p.clearcoatMap.value=g.clearcoatMap),g.clearcoatRoughnessMap&&(p.clearcoatRoughnessMap.value=g.clearcoatRoughnessMap),g.clearcoatNormalMap&&(p.clearcoatNormalScale.value.copy(g.clearcoatNormalScale),p.clearcoatNormalMap.value=g.clearcoatNormalMap,g.side===ir&&p.clearcoatNormalScale.value.negate())),g.iridescence>0&&(p.iridescence.value=g.iridescence,p.iridescenceIOR.value=g.iridescenceIOR,p.iridescenceThicknessMinimum.value=g.iridescenceThicknessRange[0],p.iridescenceThicknessMaximum.value=g.iridescenceThicknessRange[1],g.iridescenceMap&&(p.iridescenceMap.value=g.iridescenceMap),g.iridescenceThicknessMap&&(p.iridescenceThicknessMap.value=g.iridescenceThicknessMap)),g.transmission>0&&(p.transmission.value=g.transmission,p.transmissionSamplerMap.value=_.texture,p.transmissionSamplerSize.value.set(_.width,_.height),g.transmissionMap&&(p.transmissionMap.value=g.transmissionMap),p.thickness.value=g.thickness,g.thicknessMap&&(p.thicknessMap.value=g.thicknessMap),p.attenuationDistance.value=g.attenuationDistance,p.attenuationColor.value.copy(g.attenuationColor)),p.specularIntensity.value=g.specularIntensity,p.specularColor.value.copy(g.specularColor),g.specularIntensityMap&&(p.specularIntensityMap.value=g.specularIntensityMap),g.specularColorMap&&(p.specularColorMap.value=g.specularColorMap)}(p,g,y)):g.isMeshMatcapMaterial?(r(p,g),function h(p,g){g.matcap&&(p.matcap.value=g.matcap)}(p,g)):g.isMeshDepthMaterial?r(p,g):g.isMeshDistanceMaterial?(r(p,g),function m(p,g){p.referencePosition.value.copy(g.referencePosition),p.nearDistance.value=g.nearDistance,p.farDistance.value=g.farDistance}(p,g)):g.isMeshNormalMaterial?r(p,g):g.isLineBasicMaterial?(function s(p,g){p.diffuse.value.copy(g.color),p.opacity.value=g.opacity}(p,g),g.isLineDashedMaterial&&function o(p,g){p.dashSize.value=g.dashSize,p.totalSize.value=g.dashSize+g.gapSize,p.scale.value=g.scale}(p,g)):g.isPointsMaterial?function a(p,g,_,v){let y;p.diffuse.value.copy(g.color),p.opacity.value=g.opacity,p.size.value=g.size*_,p.scale.value=.5*v,g.map&&(p.map.value=g.map),g.alphaMap&&(p.alphaMap.value=g.alphaMap),g.alphaTest>0&&(p.alphaTest.value=g.alphaTest),g.map?y=g.map:g.alphaMap&&(y=g.alphaMap),void 0!==y&&(!0===y.matrixAutoUpdate&&y.updateMatrix(),p.uvTransform.value.copy(y.matrix))}(p,g,_,v):g.isSpriteMaterial?function c(p,g){let _;p.diffuse.value.copy(g.color),p.opacity.value=g.opacity,p.rotation.value=g.rotation,g.map&&(p.map.value=g.map),g.alphaMap&&(p.alphaMap.value=g.alphaMap),g.alphaTest>0&&(p.alphaTest.value=g.alphaTest),g.map?_=g.map:g.alphaMap&&(_=g.alphaMap),void 0!==_&&(!0===_.matrixAutoUpdate&&_.updateMatrix(),p.uvTransform.value.copy(_.matrix))}(p,g):g.isShadowMaterial?(p.color.value.copy(g.color),p.opacity.value=g.opacity):g.isShaderMaterial&&(g.uniformsNeedUpdate=!1)}}}function v4(n,e,t,i){let r={},s={},o=[];const a=t.isWebGL2?n.getParameter(35375):0;function h(v,y,x){const w=v.value;if(void 0===x[y]){if("number"==typeof w)x[y]=w;else{const M=Array.isArray(w)?w:[w],A=[];for(let b=0;b<M.length;b++)A.push(M[b].clone());x[y]=A}return!0}if("number"==typeof w){if(x[y]!==w)return x[y]=w,!0}else{const M=Array.isArray(x[y])?x[y]:[x[y]],A=Array.isArray(w)?w:[w];for(let b=0;b<M.length;b++){const S=M[b];if(!1===S.equals(A[b]))return S.copy(A[b]),!0}}return!1}function p(v){const y={boundary:0,storage:0};return"number"==typeof v?(y.boundary=4,y.storage=4):v.isVector2?(y.boundary=8,y.storage=8):v.isVector3||v.isColor?(y.boundary=16,y.storage=12):v.isVector4?(y.boundary=16,y.storage=16):v.isMatrix3?(y.boundary=48,y.storage=48):v.isMatrix4?(y.boundary=64,y.storage=64):v.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",v),y}function g(v){const y=v.target;y.removeEventListener("dispose",g);const x=o.indexOf(y.__bindingPointIndex);o.splice(x,1),n.deleteBuffer(r[y.id]),delete r[y.id],delete s[y.id]}return{bind:function c(v,y){i.uniformBlockBinding(v,y.program)},update:function l(v,y){let x=r[v.id];void 0===x&&(function m(v){const y=v.uniforms;let x=0;let M=0;for(let A=0,b=y.length;A<b;A++){const S=y[A],R={boundary:0,storage:0},B=Array.isArray(S.value)?S.value:[S.value];for(let G=0,k=B.length;G<k;G++){const q=p(B[G]);R.boundary+=q.boundary,R.storage+=q.storage}S.__data=new Float32Array(R.storage/Float32Array.BYTES_PER_ELEMENT),S.__offset=x,A>0&&(M=x%16,0!==M&&16-M-R.boundary<0&&(x+=16-M,S.__offset=x)),x+=R.storage}M=x%16,M>0&&(x+=16-M),v.__size=x,v.__cache={}}(v),x=function u(v){const y=function d(){for(let v=0;v<a;v++)if(-1===o.indexOf(v))return o.push(v),v;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();v.__bindingPointIndex=y;const x=n.createBuffer(),w=v.__size,M=v.usage;return n.bindBuffer(35345,x),n.bufferData(35345,w,M),n.bindBuffer(35345,null),n.bindBufferBase(35345,y,x),x}(v),r[v.id]=x,v.addEventListener("dispose",g)),i.updateUBOMapping(v,y.program);const M=e.render.frame;s[v.id]!==M&&(function f(v){const x=v.uniforms,w=v.__cache;n.bindBuffer(35345,r[v.id]);for(let M=0,A=x.length;M<A;M++){const b=x[M];if(!0===h(b,M,w)){const S=b.__offset,R=Array.isArray(b.value)?b.value:[b.value];let B=0;for(let G=0;G<R.length;G++){const k=R[G],N=p(k);"number"==typeof k?(b.__data[0]=k,n.bufferSubData(35345,S+B,b.__data)):k.isMatrix3?(b.__data[0]=k.elements[0],b.__data[1]=k.elements[1],b.__data[2]=k.elements[2],b.__data[3]=k.elements[0],b.__data[4]=k.elements[3],b.__data[5]=k.elements[4],b.__data[6]=k.elements[5],b.__data[7]=k.elements[0],b.__data[8]=k.elements[6],b.__data[9]=k.elements[7],b.__data[10]=k.elements[8],b.__data[11]=k.elements[0]):(k.toArray(b.__data,B),B+=N.storage/Float32Array.BYTES_PER_ELEMENT)}n.bufferSubData(35345,S,b.__data)}}n.bindBuffer(35345,null)}(v),s[v.id]=M)},dispose:function _(){for(const v in r)n.deleteBuffer(r[v]);o=[],r={},s={}}}}function _p(n={}){this.isWebGLRenderer=!0;const e=void 0!==n.canvas?n.canvas:function x4(){const n=$u("canvas");return n.style.display="block",n}(),t=void 0!==n.context?n.context:null,i=void 0===n.depth||n.depth,r=void 0===n.stencil||n.stencil,s=void 0!==n.antialias&&n.antialias,o=void 0===n.premultipliedAlpha||n.premultipliedAlpha,a=void 0!==n.preserveDrawingBuffer&&n.preserveDrawingBuffer,c=void 0!==n.powerPreference?n.powerPreference:"default",l=void 0!==n.failIfMajorPerformanceCaveat&&n.failIfMajorPerformanceCaveat;let u;u=null!==t?t.getContextAttributes().alpha:void 0!==n.alpha&&n.alpha;let d=null,f=null;const h=[],m=[];this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=$s,this.physicallyCorrectLights=!1,this.toneMapping=Yr,this.toneMappingExposure=1;const p=this;let g=!1,_=0,v=0,y=null,x=-1,w=null;const M=new dn,A=new dn;let b=null,S=e.width,R=e.height,B=1,G=null,k=null;const N=new dn(0,0,S,R),q=new dn(0,0,S,R);let ne=!1;const pe=new hp;let re=!1,he=!1,ue=null;const ke=new pt,$=new ce,de=new T,_e={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function xe(){return null===y?B:1}let Oe,Ge,be,Nt,ae,oe,Se,We,Ce,St,ct,Qe,In,fn,I,E,K,ge,we,Re,_t,Pe,se,et,j=t;function $e(C,W){for(let te=0;te<C.length;te++){const ie=e.getContext(C[te],W);if(null!==ie)return ie}return null}try{const C={alpha:!0,depth:i,stencil:r,antialias:s,premultipliedAlpha:o,preserveDrawingBuffer:a,powerPreference:c,failIfMajorPerformanceCaveat:l};if("setAttribute"in e&&e.setAttribute("data-engine",`three.js r${Lh}`),e.addEventListener("webglcontextlost",lt,!1),e.addEventListener("webglcontextrestored",tt,!1),e.addEventListener("webglcontextcreationerror",tn,!1),null===j){const W=["webgl2","webgl","experimental-webgl"];if(!0===p.isWebGL1Renderer&&W.shift(),j=$e(W,C),null===j)throw $e(W)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===j.getShaderPrecisionFormat&&(j.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(C){throw console.error("THREE.WebGLRenderer: "+C.message),C}function ut(){Oe=new FH(j),Ge=new IH(j,Oe,n),Oe.init(Ge),Pe=new FC(j,Oe,Ge),be=new p4(j,Oe,Ge),Nt=new UH,ae=new n4,oe=new m4(j,Oe,be,ae,Ge,Pe,Nt),Se=new PH(p),We=new OH(p),Ce=new CV(j,Ge),se=new CH(j,Oe,Ce,Ge),St=new kH(j,Ce,Nt,se),ct=new GH(j,St,Ce,Nt),we=new HH(j,Ge,oe),E=new RH(ae),Qe=new t4(p,Se,We,Oe,Ge,se,E),In=new _4(p,ae),fn=new r4,I=new u4(Oe,Ge),ge=new DH(p,Se,We,be,ct,u,o),K=new h4(p,ct,Ge),et=new v4(j,Nt,Ge,be),Re=new AH(j,Oe,Nt,Ge),_t=new BH(j,Oe,Nt,Ge),Nt.programs=Qe.programs,p.capabilities=Ge,p.extensions=Oe,p.properties=ae,p.renderLists=fn,p.shadowMap=K,p.state=be,p.info=Nt}ut();const je=new y4(p,j);function lt(C){C.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),g=!0}function tt(){console.log("THREE.WebGLRenderer: Context Restored."),g=!1;const C=Nt.autoReset,W=K.enabled,te=K.autoUpdate,H=K.needsUpdate,ie=K.type;ut(),Nt.autoReset=C,K.enabled=W,K.autoUpdate=te,K.needsUpdate=H,K.type=ie}function tn(C){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",C.statusMessage)}function Pn(C){const W=C.target;W.removeEventListener("dispose",Pn),function _i(C){(function F(C){const W=ae.get(C).programs;void 0!==W&&(W.forEach(function(te){Qe.releaseProgram(te)}),C.isShaderMaterial&&Qe.releaseShaderCache(C))})(C),ae.remove(C)}(W)}this.xr=je,this.getContext=function(){return j},this.getContextAttributes=function(){return j.getContextAttributes()},this.forceContextLoss=function(){const C=Oe.get("WEBGL_lose_context");C&&C.loseContext()},this.forceContextRestore=function(){const C=Oe.get("WEBGL_lose_context");C&&C.restoreContext()},this.getPixelRatio=function(){return B},this.setPixelRatio=function(C){void 0!==C&&(B=C,this.setSize(S,R,!1))},this.getSize=function(C){return C.set(S,R)},this.setSize=function(C,W,te){je.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(S=C,R=W,e.width=Math.floor(C*B),e.height=Math.floor(W*B),!1!==te&&(e.style.width=C+"px",e.style.height=W+"px"),this.setViewport(0,0,C,W))},this.getDrawingBufferSize=function(C){return C.set(S*B,R*B).floor()},this.setDrawingBufferSize=function(C,W,te){S=C,R=W,B=te,e.width=Math.floor(C*te),e.height=Math.floor(W*te),this.setViewport(0,0,C,W)},this.getCurrentViewport=function(C){return C.copy(M)},this.getViewport=function(C){return C.copy(N)},this.setViewport=function(C,W,te,H){C.isVector4?N.set(C.x,C.y,C.z,C.w):N.set(C,W,te,H),be.viewport(M.copy(N).multiplyScalar(B).floor())},this.getScissor=function(C){return C.copy(q)},this.setScissor=function(C,W,te,H){C.isVector4?q.set(C.x,C.y,C.z,C.w):q.set(C,W,te,H),be.scissor(A.copy(q).multiplyScalar(B).floor())},this.getScissorTest=function(){return ne},this.setScissorTest=function(C){be.setScissorTest(ne=C)},this.setOpaqueSort=function(C){G=C},this.setTransparentSort=function(C){k=C},this.getClearColor=function(C){return C.copy(ge.getClearColor())},this.setClearColor=function(){ge.setClearColor.apply(ge,arguments)},this.getClearAlpha=function(){return ge.getClearAlpha()},this.setClearAlpha=function(){ge.setClearAlpha.apply(ge,arguments)},this.clear=function(C=!0,W=!0,te=!0){let H=0;C&&(H|=16384),W&&(H|=256),te&&(H|=1024),j.clear(H)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",lt,!1),e.removeEventListener("webglcontextrestored",tt,!1),e.removeEventListener("webglcontextcreationerror",tn,!1),fn.dispose(),I.dispose(),ae.dispose(),Se.dispose(),We.dispose(),ct.dispose(),se.dispose(),et.dispose(),Qe.dispose(),je.dispose(),je.removeEventListener("sessionstart",Ne),je.removeEventListener("sessionend",qe),ue&&(ue.dispose(),ue=null),cn.stop()},this.renderBufferDirect=function(C,W,te,H,ie,st){null===W&&(W=_e);const Et=ie.isMesh&&ie.matrixWorld.determinant()<0,kt=function u8(C,W,te,H,ie){!0!==W.isScene&&(W=_e),oe.resetTextureUnits();const st=W.fog,kt=null===y?p.outputEncoding:!0===y.isXRRenderTarget?y.texture.encoding:$s,Vt=(H.isMeshStandardMaterial?We:Se).get(H.envMap||(H.isMeshStandardMaterial?W.environment:null)),nn=!0===H.vertexColors&&!!te.attributes.color&&4===te.attributes.color.itemSize,Zt=!!H.normalMap&&!!te.attributes.tangent,Xt=!!te.morphAttributes.position,ni=!!te.morphAttributes.normal,gr=!!te.morphAttributes.color,ao=H.toneMapped?p.toneMapping:Yr,Pa=te.morphAttributes.position||te.morphAttributes.normal||te.morphAttributes.color,ii=void 0!==Pa?Pa.length:0,Yt=ae.get(H),Y0=f.state.lights;!0!==re||!0!==he&&C===w||E.setState(H,C,C===w&&H.id===x);let xi=!1;H.version===Yt.__version?(Yt.needsLights&&Yt.lightsStateVersion!==Y0.state.version||Yt.outputEncoding!==kt||ie.isInstancedMesh&&!1===Yt.instancing||!ie.isInstancedMesh&&!0===Yt.instancing||ie.isSkinnedMesh&&!1===Yt.skinning||!ie.isSkinnedMesh&&!0===Yt.skinning||Yt.envMap!==Vt||!0===H.fog&&Yt.fog!==st||void 0!==Yt.numClippingPlanes&&(Yt.numClippingPlanes!==E.numPlanes||Yt.numIntersection!==E.numIntersection)||Yt.vertexAlphas!==nn||Yt.vertexTangents!==Zt||Yt.morphTargets!==Xt||Yt.morphNormals!==ni||Yt.morphColors!==gr||Yt.toneMapping!==ao||!0===Ge.isWebGL2&&Yt.morphTargetsCount!==ii)&&(xi=!0):(xi=!0,Yt.__version=H.version);let La=Yt.currentProgram;!0===xi&&(La=Nr(H,W,ie));let Z1=!1,Vd=!1,K0=!1;const Zi=La.getUniforms(),Na=Yt.uniforms;if(be.useProgram(La.program)&&(Z1=!0,Vd=!0,K0=!0),H.id!==x&&(x=H.id,Vd=!0),Z1||w!==C){if(Zi.setValue(j,"projectionMatrix",C.projectionMatrix),Ge.logarithmicDepthBuffer&&Zi.setValue(j,"logDepthBufFC",2/(Math.log(C.far+1)/Math.LN2)),w!==C&&(w=C,Vd=!0,K0=!0),H.isShaderMaterial||H.isMeshPhongMaterial||H.isMeshToonMaterial||H.isMeshStandardMaterial||H.envMap){const yr=Zi.map.cameraPosition;void 0!==yr&&yr.setValue(j,de.setFromMatrixPosition(C.matrixWorld))}(H.isMeshPhongMaterial||H.isMeshToonMaterial||H.isMeshLambertMaterial||H.isMeshBasicMaterial||H.isMeshStandardMaterial||H.isShaderMaterial)&&Zi.setValue(j,"isOrthographic",!0===C.isOrthographicCamera),(H.isMeshPhongMaterial||H.isMeshToonMaterial||H.isMeshLambertMaterial||H.isMeshBasicMaterial||H.isMeshStandardMaterial||H.isShaderMaterial||H.isShadowMaterial||ie.isSkinnedMesh)&&Zi.setValue(j,"viewMatrix",C.matrixWorldInverse)}if(ie.isSkinnedMesh){Zi.setOptional(j,ie,"bindMatrix"),Zi.setOptional(j,ie,"bindMatrixInverse");const yr=ie.skeleton;yr&&(Ge.floatVertexTextures?(null===yr.boneTexture&&yr.computeBoneTexture(),Zi.setValue(j,"boneTexture",yr.boneTexture,oe),Zi.setValue(j,"boneTextureSize",yr.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const J0=te.morphAttributes;if((void 0!==J0.position||void 0!==J0.normal||void 0!==J0.color&&!0===Ge.isWebGL2)&&we.update(ie,te,H,La),(Vd||Yt.receiveShadow!==ie.receiveShadow)&&(Yt.receiveShadow=ie.receiveShadow,Zi.setValue(j,"receiveShadow",ie.receiveShadow)),H.isMeshGouraudMaterial&&null!==H.envMap&&(Na.envMap.value=Vt,Na.flipEnvMap.value=Vt.isCubeTexture&&!1===Vt.isRenderTargetTexture?-1:1),Vd&&(Zi.setValue(j,"toneMappingExposure",p.toneMappingExposure),Yt.needsLights&&function d8(C,W){C.ambientLightColor.needsUpdate=W,C.lightProbe.needsUpdate=W,C.directionalLights.needsUpdate=W,C.directionalLightShadows.needsUpdate=W,C.pointLights.needsUpdate=W,C.pointLightShadows.needsUpdate=W,C.spotLights.needsUpdate=W,C.spotLightShadows.needsUpdate=W,C.rectAreaLights.needsUpdate=W,C.hemisphereLights.needsUpdate=W}(Na,K0),st&&!0===H.fog&&In.refreshFogUniforms(Na,st),In.refreshMaterialUniforms(Na,H,B,R,ue),yp.upload(j,Yt.uniformsList,Na,oe)),H.isShaderMaterial&&!0===H.uniformsNeedUpdate&&(yp.upload(j,Yt.uniformsList,Na,oe),H.uniformsNeedUpdate=!1),H.isSpriteMaterial&&Zi.setValue(j,"center",ie.center),Zi.setValue(j,"modelViewMatrix",ie.modelViewMatrix),Zi.setValue(j,"normalMatrix",ie.normalMatrix),Zi.setValue(j,"modelMatrix",ie.matrixWorld),H.isShaderMaterial||H.isRawShaderMaterial){const yr=H.uniformsGroups;for(let Q0=0,h8=yr.length;Q0<h8;Q0++)if(Ge.isWebGL2){const X1=yr[Q0];et.update(X1,La),et.bind(X1,La)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return La}(C,W,te,H,ie);be.setMaterial(H,Et);let Vt=te.index,nn=1;!0===H.wireframe&&(Vt=St.getWireframeAttribute(te),nn=2);const Zt=te.drawRange,Xt=te.attributes.position;let ni=Zt.start*nn,gr=(Zt.start+Zt.count)*nn;null!==st&&(ni=Math.max(ni,st.start*nn),gr=Math.min(gr,(st.start+st.count)*nn)),null!==Vt?(ni=Math.max(ni,0),gr=Math.min(gr,Vt.count)):null!=Xt&&(ni=Math.max(ni,0),gr=Math.min(gr,Xt.count));const ao=gr-ni;if(ao<0||ao===1/0)return;se.setup(ie,H,kt,te,Vt);let Pa,ii=Re;if(null!==Vt&&(Pa=Ce.get(Vt),ii=_t,ii.setIndex(Pa)),ie.isMesh)!0===H.wireframe?(be.setLineWidth(H.wireframeLinewidth*xe()),ii.setMode(1)):ii.setMode(4);else if(ie.isLine){let Yt=H.linewidth;void 0===Yt&&(Yt=1),be.setLineWidth(Yt*xe()),ii.setMode(ie.isLineSegments?1:ie.isLineLoop?2:3)}else ie.isPoints?ii.setMode(0):ie.isSprite&&ii.setMode(4);if(ie.isInstancedMesh)ii.renderInstances(ni,ao,ie.count);else if(te.isInstancedBufferGeometry){const Y0=Math.min(te.instanceCount,void 0!==te._maxInstanceCount?te._maxInstanceCount:1/0);ii.renderInstances(ni,ao,Y0)}else ii.render(ni,ao)},this.compile=function(C,W){function te(H,ie,st){!0===H.transparent&&H.side===ws&&!1===H.forceSinglePass?(H.side=ir,H.needsUpdate=!0,Nr(H,ie,st),H.side=bs,H.needsUpdate=!0,Nr(H,ie,st),H.side=ws):Nr(H,ie,st)}f=I.get(C),f.init(),m.push(f),C.traverseVisible(function(H){H.isLight&&H.layers.test(W.layers)&&(f.pushLight(H),H.castShadow&&f.pushShadow(H))}),f.setupLights(p.physicallyCorrectLights),C.traverse(function(H){const ie=H.material;if(ie)if(Array.isArray(ie))for(let st=0;st<ie.length;st++)te(ie[st],C,H);else te(ie,C,H)}),m.pop(),f=null};let ee=null;function Ne(){cn.stop()}function qe(){cn.start()}const cn=new uC;function vi(C,W,te,H){if(!1===C.visible)return;if(C.layers.test(W.layers))if(C.isGroup)te=C.renderOrder;else if(C.isLOD)!0===C.autoUpdate&&C.update(W);else if(C.isLight)f.pushLight(C),C.castShadow&&f.pushShadow(C);else if(C.isSprite){if(!C.frustumCulled||pe.intersectsSprite(C)){H&&de.setFromMatrixPosition(C.matrixWorld).applyMatrix4(ke);const Et=ct.update(C),kt=C.material;kt.visible&&d.push(C,Et,kt,te,de.z,null)}}else if((C.isMesh||C.isLine||C.isPoints)&&(C.isSkinnedMesh&&C.skeleton.frame!==Nt.render.frame&&(C.skeleton.update(),C.skeleton.frame=Nt.render.frame),!C.frustumCulled||pe.intersectsObject(C))){H&&de.setFromMatrixPosition(C.matrixWorld).applyMatrix4(ke);const Et=ct.update(C),kt=C.material;if(Array.isArray(kt)){const Vt=Et.groups;for(let nn=0,Zt=Vt.length;nn<Zt;nn++){const Xt=Vt[nn],ni=kt[Xt.materialIndex];ni&&ni.visible&&d.push(C,Et,ni,te,de.z,Xt)}}else kt.visible&&d.push(C,Et,kt,te,de.z,null)}const st=C.children;for(let Et=0,kt=st.length;Et<kt;Et++)vi(st[Et],W,te,H)}function Oi(C,W,te,H){const ie=C.opaque,st=C.transmissive,Et=C.transparent;f.setupLightsView(te),!0===re&&E.setGlobalState(p.clippingPlanes,te),st.length>0&&function Ra(C,W,te){const H=Ge.isWebGL2;null===ue&&(ue=new Qr(1,1,{generateMipmaps:!0,type:Oe.has("EXT_color_buffer_half_float")?kc:xo,minFilter:Ms,samples:H&&!0===s?4:0})),p.getDrawingBufferSize($),H?ue.setSize($.x,$.y):ue.setSize(qh($.x),qh($.y));const ie=p.getRenderTarget();p.setRenderTarget(ue),p.clear();const st=p.toneMapping;p.toneMapping=Yr,Ln(C,W,te),p.toneMapping=st,oe.updateMultisampleRenderTarget(ue),oe.updateRenderTargetMipmap(ue),p.setRenderTarget(ie)}(ie,W,te),H&&be.viewport(M.copy(H)),ie.length>0&&Ln(ie,W,te),st.length>0&&Ln(st,W,te),Et.length>0&&Ln(Et,W,te),be.buffers.depth.setTest(!0),be.buffers.depth.setMask(!0),be.buffers.color.setMask(!0),be.setPolygonOffset(!1)}function Ln(C,W,te){const H=!0===W.isScene?W.overrideMaterial:null;for(let ie=0,st=C.length;ie<st;ie++){const Et=C[ie],kt=Et.object,Vt=Et.geometry,nn=null===H?Et.material:H,Zt=Et.group;kt.layers.test(te.layers)&&oo(kt,W,te,Vt,nn,Zt)}}function oo(C,W,te,H,ie,st){C.onBeforeRender(p,W,te,H,ie,st),C.modelViewMatrix.multiplyMatrices(te.matrixWorldInverse,C.matrixWorld),C.normalMatrix.getNormalMatrix(C.modelViewMatrix),ie.onBeforeRender(p,W,te,H,C,st),!0===ie.transparent&&ie.side===ws&&!1===ie.forceSinglePass?(ie.side=ir,ie.needsUpdate=!0,p.renderBufferDirect(te,W,H,ie,C,st),ie.side=bs,ie.needsUpdate=!0,p.renderBufferDirect(te,W,H,ie,C,st),ie.side=ws):p.renderBufferDirect(te,W,H,ie,C,st),C.onAfterRender(p,W,te,H,ie,st)}function Nr(C,W,te){!0!==W.isScene&&(W=_e);const H=ae.get(C),ie=f.state.lights,Et=ie.state.version,kt=Qe.getParameters(C,ie.state,f.state.shadowsArray,W,te),Vt=Qe.getProgramCacheKey(kt);let nn=H.programs;H.environment=C.isMeshStandardMaterial?W.environment:null,H.fog=W.fog,H.envMap=(C.isMeshStandardMaterial?We:Se).get(C.envMap||H.environment),void 0===nn&&(C.addEventListener("dispose",Pn),nn=new Map,H.programs=nn);let Zt=nn.get(Vt);if(void 0!==Zt){if(H.currentProgram===Zt&&H.lightsStateVersion===Et)return q1(C,kt),Zt}else kt.uniforms=Qe.getUniforms(C),C.onBuild(te,kt,p),C.onBeforeCompile(kt,p),Zt=Qe.acquireProgram(kt,Vt),nn.set(Vt,Zt),H.uniforms=kt.uniforms;const Xt=H.uniforms;(!C.isShaderMaterial&&!C.isRawShaderMaterial||!0===C.clipping)&&(Xt.clippingPlanes=E.uniform),q1(C,kt),H.needsLights=function f8(C){return C.isMeshLambertMaterial||C.isMeshToonMaterial||C.isMeshPhongMaterial||C.isMeshStandardMaterial||C.isShadowMaterial||C.isShaderMaterial&&!0===C.lights}(C),H.lightsStateVersion=Et,H.needsLights&&(Xt.ambientLightColor.value=ie.state.ambient,Xt.lightProbe.value=ie.state.probe,Xt.directionalLights.value=ie.state.directional,Xt.directionalLightShadows.value=ie.state.directionalShadow,Xt.spotLights.value=ie.state.spot,Xt.spotLightShadows.value=ie.state.spotShadow,Xt.rectAreaLights.value=ie.state.rectArea,Xt.ltc_1.value=ie.state.rectAreaLTC1,Xt.ltc_2.value=ie.state.rectAreaLTC2,Xt.pointLights.value=ie.state.point,Xt.pointLightShadows.value=ie.state.pointShadow,Xt.hemisphereLights.value=ie.state.hemi,Xt.directionalShadowMap.value=ie.state.directionalShadowMap,Xt.directionalShadowMatrix.value=ie.state.directionalShadowMatrix,Xt.spotShadowMap.value=ie.state.spotShadowMap,Xt.spotLightMatrix.value=ie.state.spotLightMatrix,Xt.spotLightMap.value=ie.state.spotLightMap,Xt.pointShadowMap.value=ie.state.pointShadowMap,Xt.pointShadowMatrix.value=ie.state.pointShadowMatrix);const ni=Zt.getUniforms(),gr=yp.seqWithValue(ni.seq,Xt);return H.currentProgram=Zt,H.uniformsList=gr,Zt}function q1(C,W){const te=ae.get(C);te.outputEncoding=W.outputEncoding,te.instancing=W.instancing,te.skinning=W.skinning,te.morphTargets=W.morphTargets,te.morphNormals=W.morphNormals,te.morphColors=W.morphColors,te.morphTargetsCount=W.morphTargetsCount,te.numClippingPlanes=W.numClippingPlanes,te.numIntersection=W.numClipIntersection,te.vertexAlphas=W.vertexAlphas,te.vertexTangents=W.vertexTangents,te.toneMapping=W.toneMapping}cn.setAnimationLoop(function me(C){ee&&ee(C)}),typeof self<"u"&&cn.setContext(self),this.setAnimationLoop=function(C){ee=C,je.setAnimationLoop(C),null===C?cn.stop():cn.start()},je.addEventListener("sessionstart",Ne),je.addEventListener("sessionend",qe),this.render=function(C,W){if(void 0===W||!0===W.isCamera){if(!0!==g){if(!0===C.matrixWorldAutoUpdate&&C.updateMatrixWorld(),null===W.parent&&!0===W.matrixWorldAutoUpdate&&W.updateMatrixWorld(),!0===je.enabled&&!0===je.isPresenting&&(!0===je.cameraAutoUpdate&&je.updateCamera(W),W=je.getCamera()),!0===C.isScene&&C.onBeforeRender(p,C,W,y),f=I.get(C,m.length),f.init(),m.push(f),ke.multiplyMatrices(W.projectionMatrix,W.matrixWorldInverse),pe.setFromProjectionMatrix(ke),he=this.localClippingEnabled,re=E.init(this.clippingPlanes,he),d=fn.get(C,h.length),d.init(),h.push(d),vi(C,W,0,p.sortObjects),d.finish(),!0===p.sortObjects&&d.sort(G,k),!0===re&&E.beginShadows(),K.render(f.state.shadowsArray,C,W),!0===re&&E.endShadows(),!0===this.info.autoReset&&this.info.reset(),ge.render(d,C),f.setupLights(p.physicallyCorrectLights),W.isArrayCamera){const H=W.cameras;for(let ie=0,st=H.length;ie<st;ie++){const Et=H[ie];Oi(d,C,Et,Et.viewport)}}else Oi(d,C,W);null!==y&&(oe.updateMultisampleRenderTarget(y),oe.updateRenderTargetMipmap(y)),!0===C.isScene&&C.onAfterRender(p,C,W),se.resetDefaultState(),x=-1,w=null,m.pop(),f=m.length>0?m[m.length-1]:null,h.pop(),d=h.length>0?h[h.length-1]:null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.getActiveCubeFace=function(){return _},this.getActiveMipmapLevel=function(){return v},this.getRenderTarget=function(){return y},this.setRenderTargetTextures=function(C,W,te){ae.get(C.texture).__webglTexture=W,ae.get(C.depthTexture).__webglTexture=te;const H=ae.get(C);H.__hasExternalTextures=!0,H.__hasExternalTextures&&(H.__autoAllocateDepthBuffer=void 0===te,H.__autoAllocateDepthBuffer||!0===Oe.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),H.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(C,W){const te=ae.get(C);te.__webglFramebuffer=W,te.__useDefaultFramebuffer=void 0===W},this.setRenderTarget=function(C,W=0,te=0){y=C,_=W,v=te;let H=!0,ie=null,st=!1,Et=!1;if(C){const Vt=ae.get(C);void 0!==Vt.__useDefaultFramebuffer?(be.bindFramebuffer(36160,null),H=!1):void 0===Vt.__webglFramebuffer?oe.setupRenderTarget(C):Vt.__hasExternalTextures&&oe.rebindTextures(C,ae.get(C.texture).__webglTexture,ae.get(C.depthTexture).__webglTexture);const nn=C.texture;(nn.isData3DTexture||nn.isDataArrayTexture||nn.isCompressedArrayTexture)&&(Et=!0);const Zt=ae.get(C).__webglFramebuffer;C.isWebGLCubeRenderTarget?(ie=Zt[W],st=!0):ie=Ge.isWebGL2&&C.samples>0&&!1===oe.useMultisampledRTT(C)?ae.get(C).__webglMultisampledFramebuffer:Zt,M.copy(C.viewport),A.copy(C.scissor),b=C.scissorTest}else M.copy(N).multiplyScalar(B).floor(),A.copy(q).multiplyScalar(B).floor(),b=ne;if(be.bindFramebuffer(36160,ie)&&Ge.drawBuffers&&H&&be.drawBuffers(C,ie),be.viewport(M),be.scissor(A),be.setScissorTest(b),st){const Vt=ae.get(C.texture);j.framebufferTexture2D(36160,36064,34069+W,Vt.__webglTexture,te)}else if(Et){const Vt=ae.get(C.texture);j.framebufferTextureLayer(36160,36064,Vt.__webglTexture,te||0,W||0)}x=-1},this.readRenderTargetPixels=function(C,W,te,H,ie,st,Et){if(!C||!C.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let kt=ae.get(C).__webglFramebuffer;if(C.isWebGLCubeRenderTarget&&void 0!==Et&&(kt=kt[Et]),kt){be.bindFramebuffer(36160,kt);try{const Vt=C.texture,nn=Vt.format,Zt=Vt.type;if(nn!==dr&&Pe.convert(nn)!==j.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const Xt=Zt===kc&&(Oe.has("EXT_color_buffer_half_float")||Ge.isWebGL2&&Oe.has("EXT_color_buffer_float"));if(!(Zt===xo||Pe.convert(Zt)===j.getParameter(35738)||Zt===js&&(Ge.isWebGL2||Oe.has("OES_texture_float")||Oe.has("WEBGL_color_buffer_float"))||Xt))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");W>=0&&W<=C.width-H&&te>=0&&te<=C.height-ie&&j.readPixels(W,te,H,ie,Pe.convert(nn),Pe.convert(Zt),st)}finally{const Vt=null!==y?ae.get(y).__webglFramebuffer:null;be.bindFramebuffer(36160,Vt)}}},this.copyFramebufferToTexture=function(C,W,te=0){const H=Math.pow(2,-te),ie=Math.floor(W.image.width*H),st=Math.floor(W.image.height*H);oe.setTexture2D(W,0),j.copyTexSubImage2D(3553,te,0,0,C.x,C.y,ie,st),be.unbindTexture()},this.copyTextureToTexture=function(C,W,te,H=0){const ie=W.image.width,st=W.image.height,Et=Pe.convert(te.format),kt=Pe.convert(te.type);oe.setTexture2D(te,0),j.pixelStorei(37440,te.flipY),j.pixelStorei(37441,te.premultiplyAlpha),j.pixelStorei(3317,te.unpackAlignment),W.isDataTexture?j.texSubImage2D(3553,H,C.x,C.y,ie,st,Et,kt,W.image.data):W.isCompressedTexture?j.compressedTexSubImage2D(3553,H,C.x,C.y,W.mipmaps[0].width,W.mipmaps[0].height,Et,W.mipmaps[0].data):j.texSubImage2D(3553,H,C.x,C.y,Et,kt,W.image),0===H&&te.generateMipmaps&&j.generateMipmap(3553),be.unbindTexture()},this.copyTextureToTexture3D=function(C,W,te,H,ie=0){if(p.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const st=C.max.x-C.min.x+1,Et=C.max.y-C.min.y+1,kt=C.max.z-C.min.z+1,Vt=Pe.convert(H.format),nn=Pe.convert(H.type);let Zt;if(H.isData3DTexture)oe.setTexture3D(H,0),Zt=32879;else{if(!H.isDataArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");oe.setTexture2DArray(H,0),Zt=35866}j.pixelStorei(37440,H.flipY),j.pixelStorei(37441,H.premultiplyAlpha),j.pixelStorei(3317,H.unpackAlignment);const Xt=j.getParameter(3314),ni=j.getParameter(32878),gr=j.getParameter(3316),ao=j.getParameter(3315),Pa=j.getParameter(32877),ii=te.isCompressedTexture?te.mipmaps[0]:te.image;j.pixelStorei(3314,ii.width),j.pixelStorei(32878,ii.height),j.pixelStorei(3316,C.min.x),j.pixelStorei(3315,C.min.y),j.pixelStorei(32877,C.min.z),te.isDataTexture||te.isData3DTexture?j.texSubImage3D(Zt,ie,W.x,W.y,W.z,st,Et,kt,Vt,nn,ii.data):te.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),j.compressedTexSubImage3D(Zt,ie,W.x,W.y,W.z,st,Et,kt,Vt,ii.data)):j.texSubImage3D(Zt,ie,W.x,W.y,W.z,st,Et,kt,Vt,nn,ii),j.pixelStorei(3314,Xt),j.pixelStorei(32878,ni),j.pixelStorei(3316,gr),j.pixelStorei(3315,ao),j.pixelStorei(32877,Pa),0===ie&&H.generateMipmaps&&j.generateMipmap(Zt),be.unbindTexture()},this.initTexture=function(C){C.isCubeTexture?oe.setTextureCube(C,0):C.isData3DTexture?oe.setTexture3D(C,0):C.isDataArrayTexture||C.isCompressedArrayTexture?oe.setTexture2DArray(C,0):oe.setTexture2D(C,0),be.unbindTexture()},this.resetState=function(){_=0,v=0,y=null,be.reset(),se.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}class UC extends _p{}UC.prototype.isWebGL1Renderer=!0;class vp{constructor(e,t=25e-5){this.isFogExp2=!0,this.name="",this.color=new De(e),this.density=t}clone(){return new vp(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}class xp{constructor(e,t=1,i=1e3){this.isFog=!0,this.name="",this.color=new De(e),this.near=t,this.far=i}clone(){return new xp(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}class bp extends _n{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(t.object.backgroundIntensity=this.backgroundIntensity),t}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(e){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=e}}class id{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=Gu,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=fr()}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,i){e*=this.stride,i*=t.stride;for(let r=0,s=this.stride;r<s;r++)this.array[e+r]=t.array[i+r];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=fr()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(t,this.stride);return i.setUsage(this.usage),i}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=fr()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const qi=new T;class Po{constructor(e,t,i,r=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=i,this.normalized=r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,i=this.data.count;t<i;t++)qi.fromBufferAttribute(this,t),qi.applyMatrix4(e),this.setXYZ(t,qi.x,qi.y,qi.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)qi.fromBufferAttribute(this,t),qi.applyNormalMatrix(e),this.setXYZ(t,qi.x,qi.y,qi.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)qi.fromBufferAttribute(this,t),qi.transformDirection(e),this.setXYZ(t,qi.x,qi.y,qi.z);return this}setX(e,t){return this.normalized&&(t=yn(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=yn(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=yn(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=yn(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=Zs(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=Zs(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=Zs(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=Zs(t,this.array)),t}setXY(e,t,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=yn(t,this.array),i=yn(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this}setXYZ(e,t,i,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=yn(t,this.array),i=yn(i,this.array),r=yn(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this}setXYZW(e,t,i,r,s){return e=e*this.data.stride+this.offset,this.normalized&&(t=yn(t,this.array),i=yn(i,this.array),r=yn(r,this.array),s=yn(s,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this.data.array[e+3]=s,this}clone(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const r=i*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)t.push(this.data.array[r+s])}return new an(new this.array.constructor(t),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new Po(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const r=i*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)t.push(this.data.array[r+s])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class zv extends ui{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new De(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let ol;const rd=new T,al=new T,cl=new T,ll=new ce,sd=new ce,VC=new pt,wp=new T,od=new T,Mp=new T,zC=new ce,Hv=new ce,HC=new ce;class GC extends _n{constructor(e){if(super(),this.isSprite=!0,this.type="Sprite",void 0===ol){ol=new Pt;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),i=new id(t,5);ol.setIndex([0,1,2,0,2,3]),ol.setAttribute("position",new Po(i,3,0,!1)),ol.setAttribute("uv",new Po(i,2,3,!1))}this.geometry=ol,this.material=void 0!==e?e:new zv,this.center=new ce(.5,.5)}raycast(e,t){null===e.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),al.setFromMatrixScale(this.matrixWorld),VC.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),cl.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&al.multiplyScalar(-cl.z);const i=this.material.rotation;let r,s;0!==i&&(s=Math.cos(i),r=Math.sin(i));const o=this.center;Sp(wp.set(-.5,-.5,0),cl,o,al,r,s),Sp(od.set(.5,-.5,0),cl,o,al,r,s),Sp(Mp.set(.5,.5,0),cl,o,al,r,s),zC.set(0,0),Hv.set(1,0),HC.set(1,1);let a=e.ray.intersectTriangle(wp,od,Mp,!1,rd);if(null===a&&(Sp(od.set(-.5,.5,0),cl,o,al,r,s),Hv.set(0,1),a=e.ray.intersectTriangle(wp,Mp,od,!1,rd),null===a))return;const c=e.ray.origin.distanceTo(rd);c<e.near||c>e.far||t.push({distance:c,point:rd.clone(),uv:Ir.getUV(rd,wp,od,Mp,zC,Hv,HC,new ce),face:null,object:this})}copy(e,t){return super.copy(e,t),void 0!==e.center&&this.center.copy(e.center),this.material=e.material,this}}function Sp(n,e,t,i,r,s){ll.subVectors(n,t).addScalar(.5).multiply(i),void 0!==r?(sd.x=s*ll.x-r*ll.y,sd.y=r*ll.x+s*ll.y):sd.copy(ll),n.copy(e),n.x+=sd.x,n.y+=sd.y,n.applyMatrix4(VC)}const Ep=new T,WC=new T;class jC extends _n{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const t=e.levels;for(let i=0,r=t.length;i<r;i++){const s=t[i];this.addLevel(s.object.clone(),s.distance,s.hysteresis)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0,i=0){t=Math.abs(t);const r=this.levels;let s;for(s=0;s<r.length&&!(t<r[s].distance);s++);return r.splice(s,0,{distance:t,hysteresis:i,object:e}),this.add(e),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const t=this.levels;if(t.length>0){let i,r;for(i=1,r=t.length;i<r;i++){let s=t[i].distance;if(t[i].object.visible&&(s-=s*t[i].hysteresis),e<s)break}return t[i-1].object}return null}raycast(e,t){if(this.levels.length>0){Ep.setFromMatrixPosition(this.matrixWorld);const r=e.ray.origin.distanceTo(Ep);this.getObjectForDistance(r).raycast(e,t)}}update(e){const t=this.levels;if(t.length>1){Ep.setFromMatrixPosition(e.matrixWorld),WC.setFromMatrixPosition(this.matrixWorld);const i=Ep.distanceTo(WC)/e.zoom;let r,s;for(t[0].object.visible=!0,r=1,s=t.length;r<s;r++){let o=t[r].distance;if(t[r].object.visible&&(o-=o*t[r].hysteresis),!(i>=o))break;t[r-1].object.visible=!1,t[r].object.visible=!0}for(this._currentLevel=r-1;r<s;r++)t[r].object.visible=!1}}toJSON(e){const t=super.toJSON(e);!1===this.autoUpdate&&(t.object.autoUpdate=!1),t.object.levels=[];const i=this.levels;for(let r=0,s=i.length;r<s;r++){const o=i[r];t.object.levels.push({object:o.object.uuid,distance:o.distance,hysteresis:o.hysteresis})}return t}}const $C=new T,qC=new dn,ZC=new dn,b4=new T,XC=new pt;class Gv extends yi{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new pt,this.bindMatrixInverse=new pt}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this}bind(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new dn,t=this.geometry.attributes.skinWeight;for(let i=0,r=t.count;i<r;i++){e.fromBufferAttribute(t,i);const s=1/e.manhattanLength();s!==1/0?e.multiplyScalar(s):e.set(1,0,0,0),t.setXYZW(i,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(e,t){const i=this.skeleton,r=this.geometry;qC.fromBufferAttribute(r.attributes.skinIndex,e),ZC.fromBufferAttribute(r.attributes.skinWeight,e),$C.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let s=0;s<4;s++){const o=ZC.getComponent(s);if(0!==o){const a=qC.getComponent(s);XC.multiplyMatrices(i.bones[a].matrixWorld,i.boneInverses[a]),t.addScaledVector(b4.copy($C).applyMatrix4(XC),o)}}return t.applyMatrix4(this.bindMatrixInverse)}}class Tp extends _n{constructor(){super(),this.isBone=!0,this.type="Bone"}}class ul extends Ti{constructor(e=null,t=1,i=1,r,s,o,a,c,l=Hn,u=Hn,d,f){super(null,o,a,c,l,u,r,s,d,f),this.isDataTexture=!0,this.image={data:e,width:t,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const YC=new pt,w4=new pt;class ad{constructor(e=[],t=[]){this.uuid=fr(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let i=0,r=this.bones.length;i<r;i++)this.boneInverses.push(new pt)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const i=new pt;this.bones[e]&&i.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(i)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const i=this.bones[e];i&&i.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const i=this.bones[e];i&&(i.parent&&i.parent.isBone?(i.matrix.copy(i.parent.matrixWorld).invert(),i.matrix.multiply(i.matrixWorld)):i.matrix.copy(i.matrixWorld),i.matrix.decompose(i.position,i.quaternion,i.scale))}}update(){const e=this.bones,t=this.boneInverses,i=this.boneMatrices,r=this.boneTexture;for(let s=0,o=e.length;s<o;s++)YC.multiplyMatrices(e[s]?e[s].matrixWorld:w4,t[s]),YC.toArray(i,16*s);null!==r&&(r.needsUpdate=!0)}clone(){return new ad(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(4*this.bones.length);e=$D(e),e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const i=new ul(t,e,e,dr,js);return i.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=i,this.boneTextureSize=e,this}getBoneByName(e){for(let t=0,i=this.bones.length;t<i;t++){const r=this.bones[t];if(r.name===e)return r}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let i=0,r=e.bones.length;i<r;i++){const s=e.bones[i];let o=t[s];void 0===o&&(console.warn("THREE.Skeleton: No bone found with UUID:",s),o=new Tp),this.bones.push(o),this.boneInverses.push((new pt).fromArray(e.boneInverses[i]))}return this.init(),this}toJSON(){const e={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,i=this.boneInverses;for(let r=0,s=t.length;r<s;r++)e.bones.push(t[r].uuid),e.boneInverses.push(i[r].toArray());return e}}class dl extends an{constructor(e,t,i,r=1){super(e,t,i),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const KC=new pt,JC=new pt,Dp=[],M4=new pt,cd=new yi;class Wv extends yi{constructor(e,t,i){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new dl(new Float32Array(16*i),16),this.instanceColor=null,this.count=i,this.frustumCulled=!1;for(let r=0;r<i;r++)this.setMatrixAt(r,M4)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}getColorAt(e,t){t.fromArray(this.instanceColor.array,3*e)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,16*e)}raycast(e,t){const i=this.matrixWorld,r=this.count;if(cd.geometry=this.geometry,cd.material=this.material,void 0!==cd.material)for(let s=0;s<r;s++){this.getMatrixAt(s,KC),JC.multiplyMatrices(i,KC),cd.matrixWorld=JC,cd.raycast(e,Dp);for(let o=0,a=Dp.length;o<a;o++){const c=Dp[o];c.instanceId=s,c.object=this,t.push(c)}Dp.length=0}}setColorAt(e,t){null===this.instanceColor&&(this.instanceColor=new dl(new Float32Array(3*this.instanceMatrix.count),3)),t.toArray(this.instanceColor.array,3*e)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,16*e)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}class Ni extends ui{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new De(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const QC=new T,eA=new T,tA=new pt,jv=new Xu,Cp=new Do;class to extends _n{constructor(e=new Pt,t=new Ni){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,i=[0];for(let r=1,s=t.count;r<s;r++)QC.fromBufferAttribute(t,r-1),eA.fromBufferAttribute(t,r),i[r]=i[r-1],i[r]+=QC.distanceTo(eA);e.setAttribute("lineDistance",new Ve(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const i=this.geometry,r=this.matrixWorld,s=e.params.Line.threshold,o=i.drawRange;if(null===i.boundingSphere&&i.computeBoundingSphere(),Cp.copy(i.boundingSphere),Cp.applyMatrix4(r),Cp.radius+=s,!1===e.ray.intersectsSphere(Cp))return;tA.copy(r).invert(),jv.copy(e.ray).applyMatrix4(tA);const a=s/((this.scale.x+this.scale.y+this.scale.z)/3),c=a*a,l=new T,u=new T,d=new T,f=new T,h=this.isLineSegments?2:1,m=i.index,g=i.attributes.position;if(null!==m)for(let y=Math.max(0,o.start),x=Math.min(m.count,o.start+o.count)-1;y<x;y+=h){const w=m.getX(y),M=m.getX(y+1);if(l.fromBufferAttribute(g,w),u.fromBufferAttribute(g,M),jv.distanceSqToSegment(l,u,f,d)>c)continue;f.applyMatrix4(this.matrixWorld);const b=e.ray.origin.distanceTo(f);b<e.near||b>e.far||t.push({distance:b,point:d.clone().applyMatrix4(this.matrixWorld),index:y,face:null,faceIndex:null,object:this})}else for(let y=Math.max(0,o.start),x=Math.min(g.count,o.start+o.count)-1;y<x;y+=h){if(l.fromBufferAttribute(g,y),u.fromBufferAttribute(g,y+1),jv.distanceSqToSegment(l,u,f,d)>c)continue;f.applyMatrix4(this.matrixWorld);const M=e.ray.origin.distanceTo(f);M<e.near||M>e.far||t.push({distance:M,point:d.clone().applyMatrix4(this.matrixWorld),index:y,face:null,faceIndex:null,object:this})}}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const r=t[i[0]];if(void 0!==r){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=r.length;s<o;s++){const a=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}}const nA=new T,iA=new T;class is extends to{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,i=[];for(let r=0,s=t.count;r<s;r+=2)nA.fromBufferAttribute(t,r),iA.fromBufferAttribute(t,r+1),i[r]=0===r?0:i[r-1],i[r+1]=i[r]+nA.distanceTo(iA);e.setAttribute("lineDistance",new Ve(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class $v extends to{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class Ap extends ui{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new De(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const rA=new pt,qv=new Xu,Ip=new Do,Rp=new T;class Zv extends _n{constructor(e=new Pt,t=new Ap){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}raycast(e,t){const i=this.geometry,r=this.matrixWorld,s=e.params.Points.threshold,o=i.drawRange;if(null===i.boundingSphere&&i.computeBoundingSphere(),Ip.copy(i.boundingSphere),Ip.applyMatrix4(r),Ip.radius+=s,!1===e.ray.intersectsSphere(Ip))return;rA.copy(r).invert(),qv.copy(e.ray).applyMatrix4(rA);const a=s/((this.scale.x+this.scale.y+this.scale.z)/3),c=a*a,l=i.index,d=i.attributes.position;if(null!==l)for(let m=Math.max(0,o.start),p=Math.min(l.count,o.start+o.count);m<p;m++){const g=l.getX(m);Rp.fromBufferAttribute(d,g),sA(Rp,g,c,r,e,t,this)}else for(let m=Math.max(0,o.start),p=Math.min(d.count,o.start+o.count);m<p;m++)Rp.fromBufferAttribute(d,m),sA(Rp,m,c,r,e,t,this)}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const r=t[i[0]];if(void 0!==r){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=r.length;s<o;s++){const a=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}}function sA(n,e,t,i,r,s,o){const a=qv.distanceSqToPoint(n);if(a<t){const c=new T;qv.closestPointToPoint(n,c),c.applyMatrix4(i);const l=r.ray.origin.distanceTo(c);if(l<r.near||l>r.far)return;s.push({distance:l,distanceToRay:Math.sqrt(a),point:c,index:e,face:null,object:o})}}class S4 extends Ti{constructor(e,t,i,r,s,o,a,c,l){super(e,t,i,r,s,o,a,c,l),this.isVideoTexture=!0,this.minFilter=void 0!==o?o:Fn,this.magFilter=void 0!==s?s:Fn,this.generateMipmaps=!1;const u=this;"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(function d(){u.needsUpdate=!0,e.requestVideoFrameCallback(d)})}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;"requestVideoFrameCallback"in e==0&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class E4 extends Ti{constructor(e,t,i){super({width:e,height:t}),this.isFramebufferTexture=!0,this.format=i,this.magFilter=Hn,this.minFilter=Hn,this.generateMipmaps=!1,this.needsUpdate=!0}}class Xv extends Ti{constructor(e,t,i,r,s,o,a,c,l,u,d,f){super(null,o,a,c,l,u,r,s,d,f),this.isCompressedTexture=!0,this.image={width:t,height:i},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}class T4 extends Xv{constructor(e,t,i,r,s,o){super(e,t,i,s,o),this.isCompressedArrayTexture=!0,this.image.depth=r,this.wrapR=Ei}}class D4 extends Ti{constructor(e,t,i,r,s,o,a,c,l){super(e,t,i,r,s,o,a,c,l),this.isCanvasTexture=!0,this.needsUpdate=!0}}class rs{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const i=this.getUtoTmapping(e);return this.getPoint(i,t)}getPoints(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return t}getSpacedPoints(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPointAt(i/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let i,r=this.getPoint(0),s=0;t.push(0);for(let o=1;o<=e;o++)i=this.getPoint(o/e),s+=i.distanceTo(r),t.push(s),r=i;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const i=this.getLengths();let r=0;const s=i.length;let o;o=t||e*i[s-1];let l,a=0,c=s-1;for(;a<=c;)if(r=Math.floor(a+(c-a)/2),l=i[r]-o,l<0)a=r+1;else{if(!(l>0)){c=r;break}c=r-1}if(r=c,i[r]===o)return r/(s-1);const u=i[r];return(r+(o-u)/(i[r+1]-u))/(s-1)}getTangent(e,t){let r=e-1e-4,s=e+1e-4;r<0&&(r=0),s>1&&(s=1);const o=this.getPoint(r),a=this.getPoint(s),c=t||(o.isVector2?new ce:new T);return c.copy(a).sub(o).normalize(),c}getTangentAt(e,t){const i=this.getUtoTmapping(e);return this.getTangent(i,t)}computeFrenetFrames(e,t){const i=new T,r=[],s=[],o=[],a=new T,c=new pt;for(let h=0;h<=e;h++)r[h]=this.getTangentAt(h/e,new T);s[0]=new T,o[0]=new T;let l=Number.MAX_VALUE;const u=Math.abs(r[0].x),d=Math.abs(r[0].y),f=Math.abs(r[0].z);u<=l&&(l=u,i.set(1,0,0)),d<=l&&(l=d,i.set(0,1,0)),f<=l&&i.set(0,0,1),a.crossVectors(r[0],i).normalize(),s[0].crossVectors(r[0],a),o[0].crossVectors(r[0],s[0]);for(let h=1;h<=e;h++){if(s[h]=s[h-1].clone(),o[h]=o[h-1].clone(),a.crossVectors(r[h-1],r[h]),a.length()>Number.EPSILON){a.normalize();const m=Math.acos(Zn(r[h-1].dot(r[h]),-1,1));s[h].applyMatrix4(c.makeRotationAxis(a,m))}o[h].crossVectors(r[h],s[h])}if(!0===t){let h=Math.acos(Zn(s[0].dot(s[e]),-1,1));h/=e,r[0].dot(a.crossVectors(s[0],s[e]))>0&&(h=-h);for(let m=1;m<=e;m++)s[m].applyMatrix4(c.makeRotationAxis(r[m],h*m)),o[m].crossVectors(r[m],s[m])}return{tangents:r,normals:s,binormals:o}}clone(){return(new this.constructor).copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class Pp extends rs{constructor(e=0,t=0,i=1,r=1,s=0,o=2*Math.PI,a=!1,c=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=i,this.yRadius=r,this.aStartAngle=s,this.aEndAngle=o,this.aClockwise=a,this.aRotation=c}getPoint(e,t){const i=t||new ce,r=2*Math.PI;let s=this.aEndAngle-this.aStartAngle;const o=Math.abs(s)<Number.EPSILON;for(;s<0;)s+=r;for(;s>r;)s-=r;s<Number.EPSILON&&(s=o?0:r),!0===this.aClockwise&&!o&&(s===r?s=-r:s-=r);const a=this.aStartAngle+e*s;let c=this.aX+this.xRadius*Math.cos(a),l=this.aY+this.yRadius*Math.sin(a);if(0!==this.aRotation){const u=Math.cos(this.aRotation),d=Math.sin(this.aRotation),f=c-this.aX,h=l-this.aY;c=f*u-h*d+this.aX,l=f*d+h*u+this.aY}return i.set(c,l)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class oA extends Pp{constructor(e,t,i,r,s,o){super(e,t,i,i,r,s,o),this.isArcCurve=!0,this.type="ArcCurve"}}function Yv(){let n=0,e=0,t=0,i=0;function r(s,o,a,c){n=s,e=a,t=-3*s+3*o-2*a-c,i=2*s-2*o+a+c}return{initCatmullRom:function(s,o,a,c,l){r(o,a,l*(a-s),l*(c-o))},initNonuniformCatmullRom:function(s,o,a,c,l,u,d){let f=(o-s)/l-(a-s)/(l+u)+(a-o)/u,h=(a-o)/u-(c-o)/(u+d)+(c-a)/d;f*=u,h*=u,r(o,a,f,h)},calc:function(s){const o=s*s;return n+e*s+t*o+i*(o*s)}}}const Lp=new T,Kv=new Yv,Jv=new Yv,Qv=new Yv;class aA extends rs{constructor(e=[],t=!1,i="centripetal",r=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=i,this.tension=r}getPoint(e,t=new T){const i=t,r=this.points,s=r.length,o=(s-(this.closed?0:1))*e;let l,u,a=Math.floor(o),c=o-a;this.closed?a+=a>0?0:(Math.floor(Math.abs(a)/s)+1)*s:0===c&&a===s-1&&(a=s-2,c=1),this.closed||a>0?l=r[(a-1)%s]:(Lp.subVectors(r[0],r[1]).add(r[0]),l=Lp);const d=r[a%s],f=r[(a+1)%s];if(this.closed||a+2<s?u=r[(a+2)%s]:(Lp.subVectors(r[s-1],r[s-2]).add(r[s-1]),u=Lp),"centripetal"===this.curveType||"chordal"===this.curveType){const h="chordal"===this.curveType?.5:.25;let m=Math.pow(l.distanceToSquared(d),h),p=Math.pow(d.distanceToSquared(f),h),g=Math.pow(f.distanceToSquared(u),h);p<1e-4&&(p=1),m<1e-4&&(m=p),g<1e-4&&(g=p),Kv.initNonuniformCatmullRom(l.x,d.x,f.x,u.x,m,p,g),Jv.initNonuniformCatmullRom(l.y,d.y,f.y,u.y,m,p,g),Qv.initNonuniformCatmullRom(l.z,d.z,f.z,u.z,m,p,g)}else"catmullrom"===this.curveType&&(Kv.initCatmullRom(l.x,d.x,f.x,u.x,this.tension),Jv.initCatmullRom(l.y,d.y,f.y,u.y,this.tension),Qv.initCatmullRom(l.z,d.z,f.z,u.z,this.tension));return i.set(Kv.calc(c),Jv.calc(c),Qv.calc(c)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++)this.points.push(e.points[t].clone());return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++)e.points.push(this.points[t].toArray());return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const r=e.points[t];this.points.push((new T).fromArray(r))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function cA(n,e,t,i,r){const s=.5*(i-e),o=.5*(r-t),a=n*n;return(2*t-2*i+s+o)*(n*a)+(-3*t+3*i-2*s-o)*a+s*n+t}function ld(n,e,t,i){return function C4(n,e){const t=1-n;return t*t*e}(n,e)+function A4(n,e){return 2*(1-n)*n*e}(n,t)+function I4(n,e){return n*n*e}(n,i)}function ud(n,e,t,i,r){return function R4(n,e){const t=1-n;return t*t*t*e}(n,e)+function P4(n,e){const t=1-n;return 3*t*t*n*e}(n,t)+function L4(n,e){return 3*(1-n)*n*n*e}(n,i)+function N4(n,e){return n*n*n*e}(n,r)}class e0 extends rs{constructor(e=new ce,t=new ce,i=new ce,r=new ce){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=i,this.v3=r}getPoint(e,t=new ce){const i=t,r=this.v0,s=this.v1,o=this.v2,a=this.v3;return i.set(ud(e,r.x,s.x,o.x,a.x),ud(e,r.y,s.y,o.y,a.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class lA extends rs{constructor(e=new T,t=new T,i=new T,r=new T){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=i,this.v3=r}getPoint(e,t=new T){const i=t,r=this.v0,s=this.v1,o=this.v2,a=this.v3;return i.set(ud(e,r.x,s.x,o.x,a.x),ud(e,r.y,s.y,o.y,a.y),ud(e,r.z,s.z,o.z,a.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class Np extends rs{constructor(e=new ce,t=new ce){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new ce){const i=t;return 1===e?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t){const i=t||new ce;return i.copy(this.v2).sub(this.v1).normalize(),i}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class uA extends rs{constructor(e=new T,t=new T){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new T){const i=t;return 1===e?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class t0 extends rs{constructor(e=new ce,t=new ce,i=new ce){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new ce){const i=t,r=this.v0,s=this.v1,o=this.v2;return i.set(ld(e,r.x,s.x,o.x),ld(e,r.y,s.y,o.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class n0 extends rs{constructor(e=new T,t=new T,i=new T){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new T){const i=t,r=this.v0,s=this.v1,o=this.v2;return i.set(ld(e,r.x,s.x,o.x),ld(e,r.y,s.y,o.y),ld(e,r.z,s.z,o.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class r0 extends rs{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new ce){const i=t,r=this.points,s=(r.length-1)*e,o=Math.floor(s),a=s-o,c=r[0===o?o:o-1],l=r[o],u=r[o>r.length-2?r.length-1:o+1],d=r[o>r.length-3?r.length-1:o+2];return i.set(cA(a,c.x,l.x,u.x,d.x),cA(a,c.y,l.y,u.y,d.y)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++)this.points.push(e.points[t].clone());return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++)e.points.push(this.points[t].toArray());return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const r=e.points[t];this.points.push((new ce).fromArray(r))}return this}}var s0=Object.freeze({__proto__:null,ArcCurve:oA,CatmullRomCurve3:aA,CubicBezierCurve:e0,CubicBezierCurve3:lA,EllipseCurve:Pp,LineCurve:Np,LineCurve3:uA,QuadraticBezierCurve:t0,QuadraticBezierCurve3:n0,SplineCurve:r0});class dA extends rs{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new Np(t,e))}getPoint(e,t){const i=e*this.getLength(),r=this.getCurveLengths();let s=0;for(;s<r.length;){if(r[s]>=i){const o=r[s]-i,a=this.curves[s],c=a.getLength();return a.getPointAt(0===c?0:1-o/c,t)}s++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let i=0,r=this.curves.length;i<r;i++)t+=this.curves[i].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let i;for(let r=0,s=this.curves;r<s.length;r++){const o=s[r],c=o.getPoints(o.isEllipseCurve?2*e:o.isLineCurve||o.isLineCurve3?1:o.isSplineCurve?e*o.points.length:e);for(let l=0;l<c.length;l++){const u=c[l];i&&i.equals(u)||(t.push(u),i=u)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,i=e.curves.length;t<i;t++)this.curves.push(e.curves[t].clone());return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,i=this.curves.length;t<i;t++)e.curves.push(this.curves[t].toJSON());return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){const r=e.curves[t];this.curves.push((new s0[r.type]).fromJSON(r))}return this}}class dd extends dA{constructor(e){super(),this.type="Path",this.currentPoint=new ce,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,i=e.length;t<i;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const i=new Np(this.currentPoint.clone(),new ce(e,t));return this.curves.push(i),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,i,r){const s=new t0(this.currentPoint.clone(),new ce(e,t),new ce(i,r));return this.curves.push(s),this.currentPoint.set(i,r),this}bezierCurveTo(e,t,i,r,s,o){const a=new e0(this.currentPoint.clone(),new ce(e,t),new ce(i,r),new ce(s,o));return this.curves.push(a),this.currentPoint.set(s,o),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),i=new r0(t);return this.curves.push(i),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,i,r,s,o){return this.absarc(e+this.currentPoint.x,t+this.currentPoint.y,i,r,s,o),this}absarc(e,t,i,r,s,o){return this.absellipse(e,t,i,i,r,s,o),this}ellipse(e,t,i,r,s,o,a,c){return this.absellipse(e+this.currentPoint.x,t+this.currentPoint.y,i,r,s,o,a,c),this}absellipse(e,t,i,r,s,o,a,c){const l=new Pp(e,t,i,r,s,o,a,c);if(this.curves.length>0){const d=l.getPoint(0);d.equals(this.currentPoint)||this.lineTo(d.x,d.y)}this.curves.push(l);const u=l.getPoint(1);return this.currentPoint.copy(u),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class fl extends Pt{constructor(e=[new ce(0,-.5),new ce(.5,0),new ce(0,.5)],t=12,i=0,r=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:i,phiLength:r},t=Math.floor(t),r=Zn(r,0,2*Math.PI);const s=[],o=[],a=[],c=[],l=[],u=1/t,d=new T,f=new ce,h=new T,m=new T,p=new T;let g=0,_=0;for(let v=0;v<=e.length-1;v++)switch(v){case 0:g=e[v+1].x-e[v].x,_=e[v+1].y-e[v].y,h.x=1*_,h.y=-g,h.z=0*_,p.copy(h),h.normalize(),c.push(h.x,h.y,h.z);break;case e.length-1:c.push(p.x,p.y,p.z);break;default:g=e[v+1].x-e[v].x,_=e[v+1].y-e[v].y,h.x=1*_,h.y=-g,h.z=0*_,m.copy(h),h.x+=p.x,h.y+=p.y,h.z+=p.z,h.normalize(),c.push(h.x,h.y,h.z),p.copy(m)}for(let v=0;v<=t;v++){const y=i+v*u*r,x=Math.sin(y),w=Math.cos(y);for(let M=0;M<=e.length-1;M++)d.x=e[M].x*x,d.y=e[M].y,d.z=e[M].x*w,o.push(d.x,d.y,d.z),f.x=v/t,f.y=M/(e.length-1),a.push(f.x,f.y),l.push(c[3*M+0]*x,c[3*M+1],c[3*M+0]*w)}for(let v=0;v<t;v++)for(let y=0;y<e.length-1;y++){const x=y+v*e.length,M=x+e.length,A=x+e.length+1,b=x+1;s.push(x,M,b),s.push(A,b,M)}this.setIndex(s),this.setAttribute("position",new Ve(o,3)),this.setAttribute("uv",new Ve(a,2)),this.setAttribute("normal",new Ve(l,3))}static fromJSON(e){return new fl(e.points,e.segments,e.phiStart,e.phiLength)}}class fd extends fl{constructor(e=1,t=1,i=4,r=8){const s=new dd;s.absarc(0,-t/2,e,1.5*Math.PI,0),s.absarc(0,t/2,e,0,.5*Math.PI),super(s.getPoints(i),r),this.type="CapsuleGeometry",this.parameters={radius:e,height:t,capSegments:i,radialSegments:r}}static fromJSON(e){return new fd(e.radius,e.length,e.capSegments,e.radialSegments)}}class hd extends Pt{constructor(e=1,t=32,i=0,r=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:i,thetaLength:r},t=Math.max(3,t);const s=[],o=[],a=[],c=[],l=new T,u=new ce;o.push(0,0,0),a.push(0,0,1),c.push(.5,.5);for(let d=0,f=3;d<=t;d++,f+=3){const h=i+d/t*r;l.x=e*Math.cos(h),l.y=e*Math.sin(h),o.push(l.x,l.y,l.z),a.push(0,0,1),u.x=(o[f]/e+1)/2,u.y=(o[f+1]/e+1)/2,c.push(u.x,u.y)}for(let d=1;d<=t;d++)s.push(d,d+1,0);this.setIndex(s),this.setAttribute("position",new Ve(o,3)),this.setAttribute("normal",new Ve(a,3)),this.setAttribute("uv",new Ve(c,2))}static fromJSON(e){return new hd(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class ya extends Pt{constructor(e=1,t=1,i=1,r=32,s=1,o=!1,a=0,c=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:r,heightSegments:s,openEnded:o,thetaStart:a,thetaLength:c};const l=this;r=Math.floor(r),s=Math.floor(s);const u=[],d=[],f=[],h=[];let m=0;const p=[],g=i/2;let _=0;function y(x){const w=m,M=new ce,A=new T;let b=0;const S=!0===x?e:t,R=!0===x?1:-1;for(let G=1;G<=r;G++)d.push(0,g*R,0),f.push(0,R,0),h.push(.5,.5),m++;const B=m;for(let G=0;G<=r;G++){const N=G/r*c+a,q=Math.cos(N),ne=Math.sin(N);A.x=S*ne,A.y=g*R,A.z=S*q,d.push(A.x,A.y,A.z),f.push(0,R,0),M.x=.5*q+.5,M.y=.5*ne*R+.5,h.push(M.x,M.y),m++}for(let G=0;G<r;G++){const k=w+G,N=B+G;!0===x?u.push(N,N+1,k):u.push(N+1,N,k),b+=3}l.addGroup(_,b,!0===x?1:2),_+=b}(function v(){const x=new T,w=new T;let M=0;const A=(t-e)/i;for(let b=0;b<=s;b++){const S=[],R=b/s,B=R*(t-e)+e;for(let G=0;G<=r;G++){const k=G/r,N=k*c+a,q=Math.sin(N),ne=Math.cos(N);w.x=B*q,w.y=-R*i+g,w.z=B*ne,d.push(w.x,w.y,w.z),x.set(q,A,ne).normalize(),f.push(x.x,x.y,x.z),h.push(k,1-R),S.push(m++)}p.push(S)}for(let b=0;b<r;b++)for(let S=0;S<s;S++){const B=p[S+1][b],G=p[S+1][b+1],k=p[S][b+1];u.push(p[S][b],B,k),u.push(B,G,k),M+=6}l.addGroup(_,M,0),_+=M})(),!1===o&&(e>0&&y(!0),t>0&&y(!1)),this.setIndex(u),this.setAttribute("position",new Ve(d,3)),this.setAttribute("normal",new Ve(f,3)),this.setAttribute("uv",new Ve(h,2))}static fromJSON(e){return new ya(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class pd extends ya{constructor(e=1,t=1,i=32,r=1,s=!1,o=0,a=2*Math.PI){super(0,e,t,i,r,s,o,a),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:i,heightSegments:r,openEnded:s,thetaStart:o,thetaLength:a}}static fromJSON(e){return new pd(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class no extends Pt{constructor(e=[],t=[],i=1,r=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:i,detail:r};const s=[],o=[];function c(v,y,x,w){const M=w+1,A=[];for(let b=0;b<=M;b++){A[b]=[];const S=v.clone().lerp(x,b/M),R=y.clone().lerp(x,b/M),B=M-b;for(let G=0;G<=B;G++)A[b][G]=0===G&&b===M?S:S.clone().lerp(R,G/B)}for(let b=0;b<M;b++)for(let S=0;S<2*(M-b)-1;S++){const R=Math.floor(S/2);S%2==0?(f(A[b][R+1]),f(A[b+1][R]),f(A[b][R])):(f(A[b][R+1]),f(A[b+1][R+1]),f(A[b+1][R]))}}function f(v){s.push(v.x,v.y,v.z)}function h(v,y){const x=3*v;y.x=e[x+0],y.y=e[x+1],y.z=e[x+2]}function p(v,y,x,w){w<0&&1===v.x&&(o[y]=v.x-1),0===x.x&&0===x.z&&(o[y]=w/2/Math.PI+.5)}function g(v){return Math.atan2(v.z,-v.x)}function _(v){return Math.atan2(-v.y,Math.sqrt(v.x*v.x+v.z*v.z))}(function a(v){const y=new T,x=new T,w=new T;for(let M=0;M<t.length;M+=3)h(t[M+0],y),h(t[M+1],x),h(t[M+2],w),c(y,x,w,v)})(r),function l(v){const y=new T;for(let x=0;x<s.length;x+=3)y.x=s[x+0],y.y=s[x+1],y.z=s[x+2],y.normalize().multiplyScalar(v),s[x+0]=y.x,s[x+1]=y.y,s[x+2]=y.z}(i),function u(){const v=new T;for(let y=0;y<s.length;y+=3){v.x=s[y+0],v.y=s[y+1],v.z=s[y+2];const x=g(v)/2/Math.PI+.5,w=_(v)/Math.PI+.5;o.push(x,1-w)}(function m(){const v=new T,y=new T,x=new T,w=new T,M=new ce,A=new ce,b=new ce;for(let S=0,R=0;S<s.length;S+=9,R+=6){v.set(s[S+0],s[S+1],s[S+2]),y.set(s[S+3],s[S+4],s[S+5]),x.set(s[S+6],s[S+7],s[S+8]),M.set(o[R+0],o[R+1]),A.set(o[R+2],o[R+3]),b.set(o[R+4],o[R+5]),w.copy(v).add(y).add(x).divideScalar(3);const B=g(w);p(M,R+0,v,B),p(A,R+2,y,B),p(b,R+4,x,B)}})(),function d(){for(let v=0;v<o.length;v+=6){const y=o[v+0],x=o[v+2],w=o[v+4],M=Math.max(y,x,w),A=Math.min(y,x,w);M>.9&&A<.1&&(y<.2&&(o[v+0]+=1),x<.2&&(o[v+2]+=1),w<.2&&(o[v+4]+=1))}}()}(),this.setAttribute("position",new Ve(s,3)),this.setAttribute("normal",new Ve(s.slice(),3)),this.setAttribute("uv",new Ve(o,2)),0===r?this.computeVertexNormals():this.normalizeNormals()}static fromJSON(e){return new no(e.vertices,e.indices,e.radius,e.details)}}class md extends no{constructor(e=1,t=0){const i=(1+Math.sqrt(5))/2,r=1/i;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-i,0,-r,i,0,r,-i,0,r,i,-r,-i,0,-r,i,0,r,-i,0,r,i,0,-i,0,-r,i,0,-r,-i,0,r,i,0,r],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new md(e.radius,e.detail)}}const Op=new T,Fp=new T,o0=new T,kp=new Ir;class fA extends Pt{constructor(e=null,t=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},null!==e){const r=Math.pow(10,4),s=Math.cos(ca*t),o=e.getIndex(),a=e.getAttribute("position"),c=o?o.count:a.count,l=[0,0,0],u=["a","b","c"],d=new Array(3),f={},h=[];for(let m=0;m<c;m+=3){o?(l[0]=o.getX(m),l[1]=o.getX(m+1),l[2]=o.getX(m+2)):(l[0]=m,l[1]=m+1,l[2]=m+2);const{a:p,b:g,c:_}=kp;if(p.fromBufferAttribute(a,l[0]),g.fromBufferAttribute(a,l[1]),_.fromBufferAttribute(a,l[2]),kp.getNormal(o0),d[0]=`${Math.round(p.x*r)},${Math.round(p.y*r)},${Math.round(p.z*r)}`,d[1]=`${Math.round(g.x*r)},${Math.round(g.y*r)},${Math.round(g.z*r)}`,d[2]=`${Math.round(_.x*r)},${Math.round(_.y*r)},${Math.round(_.z*r)}`,d[0]!==d[1]&&d[1]!==d[2]&&d[2]!==d[0])for(let v=0;v<3;v++){const y=(v+1)%3,x=d[v],w=d[y],M=kp[u[v]],A=kp[u[y]],b=`${x}_${w}`,S=`${w}_${x}`;S in f&&f[S]?(o0.dot(f[S].normal)<=s&&(h.push(M.x,M.y,M.z),h.push(A.x,A.y,A.z)),f[S]=null):b in f||(f[b]={index0:l[v],index1:l[y],normal:o0.clone()})}}for(const m in f)if(f[m]){const{index0:p,index1:g}=f[m];Op.fromBufferAttribute(a,p),Fp.fromBufferAttribute(a,g),h.push(Op.x,Op.y,Op.z),h.push(Fp.x,Fp.y,Fp.z)}this.setAttribute("position",new Ve(h,3))}}}class _a extends dd{constructor(e){super(e),this.uuid=fr(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let i=0,r=this.holes.length;i<r;i++)t[i]=this.holes[i].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,i=e.holes.length;t<i;t++)this.holes.push(e.holes[t].clone());return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,i=this.holes.length;t<i;t++)e.holes.push(this.holes[t].toJSON());return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){const r=e.holes[t];this.holes.push((new dd).fromJSON(r))}return this}}function hA(n,e,t,i,r){let s,o;if(r===function K4(n,e,t,i){let r=0;for(let s=e,o=t-i;s<t;s+=i)r+=(n[o]-n[s])*(n[s+1]+n[o+1]),o=s;return r}(n,e,t,i)>0)for(s=e;s<t;s+=i)o=gA(s,n[s],n[s+1],o);else for(s=t-i;s>=e;s-=i)o=gA(s,n[s],n[s+1],o);return o&&Bp(o,o.next)&&(_d(o),o=o.next),o}function va(n,e){if(!n)return n;e||(e=n);let i,t=n;do{if(i=!1,t.steiner||!Bp(t,t.next)&&0!==kn(t.prev,t,t.next))t=t.next;else{if(_d(t),t=e=t.prev,t===t.next)break;i=!0}}while(i||t!==e);return e}function gd(n,e,t,i,r,s,o){if(!n)return;!o&&s&&function j4(n,e,t,i){let r=n;do{0===r.z&&(r.z=a0(r.x,r.y,e,t,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==n);r.prevZ.nextZ=null,r.prevZ=null,function $4(n){let e,t,i,r,s,o,a,c,l=1;do{for(t=n,n=null,s=null,o=0;t;){for(o++,i=t,a=0,e=0;e<l&&(a++,i=i.nextZ,i);e++);for(c=l;a>0||c>0&&i;)0!==a&&(0===c||!i||t.z<=i.z)?(r=t,t=t.nextZ,a--):(r=i,i=i.nextZ,c--),s?s.nextZ=r:n=r,r.prevZ=s,s=r;t=i}s.nextZ=null,l*=2}while(o>1)}(r)}(n,i,r,s);let c,l,a=n;for(;n.prev!==n.next;)if(c=n.prev,l=n.next,s?k4(n,i,r,s):F4(n))e.push(c.i/t|0),e.push(n.i/t|0),e.push(l.i/t|0),_d(n),n=l.next,a=l.next;else if((n=l)===a){o?1===o?gd(n=B4(va(n),e,t),e,t,i,r,s,2):2===o&&U4(n,e,t,i,r,s):gd(va(n),e,t,i,r,s,1);break}}function F4(n){const e=n.prev,t=n,i=n.next;if(kn(e,t,i)>=0)return!1;const r=e.x,s=t.x,o=i.x,a=e.y,c=t.y,l=i.y,u=r<s?r<o?r:o:s<o?s:o,d=a<c?a<l?a:l:c<l?c:l,f=r>s?r>o?r:o:s>o?s:o,h=a>c?a>l?a:l:c>l?c:l;let m=i.next;for(;m!==e;){if(m.x>=u&&m.x<=f&&m.y>=d&&m.y<=h&&hl(r,a,s,c,o,l,m.x,m.y)&&kn(m.prev,m,m.next)>=0)return!1;m=m.next}return!0}function k4(n,e,t,i){const r=n.prev,s=n,o=n.next;if(kn(r,s,o)>=0)return!1;const a=r.x,c=s.x,l=o.x,u=r.y,d=s.y,f=o.y,h=a<c?a<l?a:l:c<l?c:l,m=u<d?u<f?u:f:d<f?d:f,p=a>c?a>l?a:l:c>l?c:l,g=u>d?u>f?u:f:d>f?d:f,_=a0(h,m,e,t,i),v=a0(p,g,e,t,i);let y=n.prevZ,x=n.nextZ;for(;y&&y.z>=_&&x&&x.z<=v;){if(y.x>=h&&y.x<=p&&y.y>=m&&y.y<=g&&y!==r&&y!==o&&hl(a,u,c,d,l,f,y.x,y.y)&&kn(y.prev,y,y.next)>=0||(y=y.prevZ,x.x>=h&&x.x<=p&&x.y>=m&&x.y<=g&&x!==r&&x!==o&&hl(a,u,c,d,l,f,x.x,x.y)&&kn(x.prev,x,x.next)>=0))return!1;x=x.nextZ}for(;y&&y.z>=_;){if(y.x>=h&&y.x<=p&&y.y>=m&&y.y<=g&&y!==r&&y!==o&&hl(a,u,c,d,l,f,y.x,y.y)&&kn(y.prev,y,y.next)>=0)return!1;y=y.prevZ}for(;x&&x.z<=v;){if(x.x>=h&&x.x<=p&&x.y>=m&&x.y<=g&&x!==r&&x!==o&&hl(a,u,c,d,l,f,x.x,x.y)&&kn(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function B4(n,e,t){let i=n;do{const r=i.prev,s=i.next.next;!Bp(r,s)&&pA(r,i,i.next,s)&&yd(r,s)&&yd(s,r)&&(e.push(r.i/t|0),e.push(i.i/t|0),e.push(s.i/t|0),_d(i),_d(i.next),i=n=s),i=i.next}while(i!==n);return va(i)}function U4(n,e,t,i,r,s){let o=n;do{let a=o.next.next;for(;a!==o.prev;){if(o.i!==a.i&&Z4(o,a)){let c=mA(o,a);return o=va(o,o.next),c=va(c,c.next),gd(o,e,t,i,r,s,0),void gd(c,e,t,i,r,s,0)}a=a.next}o=o.next}while(o!==n)}function z4(n,e){return n.x-e.x}function H4(n,e){const t=function G4(n,e){let r,t=e,i=-1/0;const s=n.x,o=n.y;do{if(o<=t.y&&o>=t.next.y&&t.next.y!==t.y){const f=t.x+(o-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(f<=s&&f>i&&(i=f,r=t.x<t.next.x?t:t.next,f===s))return r}t=t.next}while(t!==e);if(!r)return null;const a=r,c=r.x,l=r.y;let d,u=1/0;t=r;do{s>=t.x&&t.x>=c&&s!==t.x&&hl(o<l?s:i,o,c,l,o<l?i:s,o,t.x,t.y)&&(d=Math.abs(o-t.y)/(s-t.x),yd(t,n)&&(d<u||d===u&&(t.x>r.x||t.x===r.x&&W4(r,t)))&&(r=t,u=d)),t=t.next}while(t!==a);return r}(n,e);if(!t)return e;const i=mA(t,n);return va(i,i.next),va(t,t.next)}function W4(n,e){return kn(n.prev,n,e.prev)<0&&kn(e.next,n,n.next)<0}function a0(n,e,t,i,r){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-t)*r|0)|n<<8))|n<<4))|n<<2))|n<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-i)*r|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function q4(n){let e=n,t=n;do{(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next}while(e!==n);return t}function hl(n,e,t,i,r,s,o,a){return(r-o)*(e-a)>=(n-o)*(s-a)&&(n-o)*(i-a)>=(t-o)*(e-a)&&(t-o)*(s-a)>=(r-o)*(i-a)}function Z4(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!function X4(n,e){let t=n;do{if(t.i!==n.i&&t.next.i!==n.i&&t.i!==e.i&&t.next.i!==e.i&&pA(t,t.next,n,e))return!0;t=t.next}while(t!==n);return!1}(n,e)&&(yd(n,e)&&yd(e,n)&&function Y4(n,e){let t=n,i=!1;const r=(n.x+e.x)/2,s=(n.y+e.y)/2;do{t.y>s!=t.next.y>s&&t.next.y!==t.y&&r<(t.next.x-t.x)*(s-t.y)/(t.next.y-t.y)+t.x&&(i=!i),t=t.next}while(t!==n);return i}(n,e)&&(kn(n.prev,n,e.prev)||kn(n,e.prev,e))||Bp(n,e)&&kn(n.prev,n,n.next)>0&&kn(e.prev,e,e.next)>0)}function kn(n,e,t){return(e.y-n.y)*(t.x-e.x)-(e.x-n.x)*(t.y-e.y)}function Bp(n,e){return n.x===e.x&&n.y===e.y}function pA(n,e,t,i){const r=Vp(kn(n,e,t)),s=Vp(kn(n,e,i)),o=Vp(kn(t,i,n)),a=Vp(kn(t,i,e));return!!(r!==s&&o!==a||0===r&&Up(n,t,e)||0===s&&Up(n,i,e)||0===o&&Up(t,n,i)||0===a&&Up(t,e,i))}function Up(n,e,t){return e.x<=Math.max(n.x,t.x)&&e.x>=Math.min(n.x,t.x)&&e.y<=Math.max(n.y,t.y)&&e.y>=Math.min(n.y,t.y)}function Vp(n){return n>0?1:n<0?-1:0}function yd(n,e){return kn(n.prev,n,n.next)<0?kn(n,e,n.next)>=0&&kn(n,n.prev,e)>=0:kn(n,e,n.prev)<0||kn(n,n.next,e)<0}function mA(n,e){const t=new c0(n.i,n.x,n.y),i=new c0(e.i,e.x,e.y),r=n.next,s=e.prev;return n.next=e,e.prev=n,t.next=r,r.prev=t,i.next=t,t.prev=i,s.next=i,i.prev=s,i}function gA(n,e,t,i){const r=new c0(n,e,t);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function _d(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function c0(n,e,t){this.i=n,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}class Es{static area(e){const t=e.length;let i=0;for(let r=t-1,s=0;s<t;r=s++)i+=e[r].x*e[s].y-e[s].x*e[r].y;return.5*i}static isClockWise(e){return Es.area(e)<0}static triangulateShape(e,t){const i=[],r=[],s=[];yA(e),_A(i,e);let o=e.length;t.forEach(yA);for(let c=0;c<t.length;c++)r.push(o),o+=t[c].length,_A(i,t[c]);const a=function(n,e,t=2){const i=e&&e.length,r=i?e[0]*t:n.length;let s=hA(n,0,r,t,!0);const o=[];if(!s||s.next===s.prev)return o;let a,c,l,u,d,f,h;if(i&&(s=function V4(n,e,t,i){const r=[];let s,o,a,c,l;for(s=0,o=e.length;s<o;s++)a=e[s]*i,c=s<o-1?e[s+1]*i:n.length,l=hA(n,a,c,i,!1),l===l.next&&(l.steiner=!0),r.push(q4(l));for(r.sort(z4),s=0;s<r.length;s++)t=H4(r[s],t);return t}(n,e,s,t)),n.length>80*t){a=l=n[0],c=u=n[1];for(let m=t;m<r;m+=t)d=n[m],f=n[m+1],d<a&&(a=d),f<c&&(c=f),d>l&&(l=d),f>u&&(u=f);h=Math.max(l-a,u-c),h=0!==h?32767/h:0}return gd(s,o,t,a,c,h,0),o}(i,r);for(let c=0;c<a.length;c+=3)s.push(a.slice(c,c+3));return s}}function yA(n){const e=n.length;e>2&&n[e-1].equals(n[0])&&n.pop()}function _A(n,e){for(let t=0;t<e.length;t++)n.push(e[t].x),n.push(e[t].y)}class vd extends Pt{constructor(e=new _a([new ce(.5,.5),new ce(-.5,.5),new ce(-.5,-.5),new ce(.5,-.5)]),t={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const i=this,r=[],s=[];for(let a=0,c=e.length;a<c;a++)o(e[a]);function o(a){const c=[],l=void 0!==t.curveSegments?t.curveSegments:12,u=void 0!==t.steps?t.steps:1,d=void 0!==t.depth?t.depth:1;let f=void 0===t.bevelEnabled||t.bevelEnabled,h=void 0!==t.bevelThickness?t.bevelThickness:.2,m=void 0!==t.bevelSize?t.bevelSize:h-.1,p=void 0!==t.bevelOffset?t.bevelOffset:0,g=void 0!==t.bevelSegments?t.bevelSegments:3;const _=t.extrudePath,v=void 0!==t.UVGenerator?t.UVGenerator:J4;let y,w,M,A,b,x=!1;_&&(y=_.getSpacedPoints(u),x=!0,f=!1,w=_.computeFrenetFrames(u,!1),M=new T,A=new T,b=new T),f||(g=0,h=0,m=0,p=0);const S=a.extractPoints(l);let R=S.shape;const B=S.holes;if(!Es.isClockWise(R)){R=R.reverse();for(let ae=0,oe=B.length;ae<oe;ae++){const Se=B[ae];Es.isClockWise(Se)&&(B[ae]=Se.reverse())}}const k=Es.triangulateShape(R,B),N=R;for(let ae=0,oe=B.length;ae<oe;ae++)R=R.concat(B[ae]);function q(ae,oe,Se){return oe||console.error("THREE.ExtrudeGeometry: vec does not exist"),oe.clone().multiplyScalar(Se).add(ae)}const ne=R.length,pe=k.length;function re(ae,oe,Se){let We,Ce,St;const ct=ae.x-oe.x,Qe=ae.y-oe.y,In=Se.x-ae.x,fn=Se.y-ae.y,I=ct*ct+Qe*Qe;if(Math.abs(ct*fn-Qe*In)>Number.EPSILON){const K=Math.sqrt(I),ge=Math.sqrt(In*In+fn*fn),we=oe.x-Qe/K,Re=oe.y+ct/K,se=((Se.x-fn/ge-we)*fn-(Se.y+In/ge-Re)*In)/(ct*fn-Qe*In);We=we+ct*se-ae.x,Ce=Re+Qe*se-ae.y;const et=We*We+Ce*Ce;if(et<=2)return new ce(We,Ce);St=Math.sqrt(et/2)}else{let K=!1;ct>Number.EPSILON?In>Number.EPSILON&&(K=!0):ct<-Number.EPSILON?In<-Number.EPSILON&&(K=!0):Math.sign(Qe)===Math.sign(fn)&&(K=!0),K?(We=-Qe,Ce=ct,St=Math.sqrt(I)):(We=ct,Ce=Qe,St=Math.sqrt(I/2))}return new ce(We/St,Ce/St)}const he=[];for(let ae=0,oe=N.length,Se=oe-1,We=ae+1;ae<oe;ae++,Se++,We++)Se===oe&&(Se=0),We===oe&&(We=0),he[ae]=re(N[ae],N[Se],N[We]);const ue=[];let ke,$=he.concat();for(let ae=0,oe=B.length;ae<oe;ae++){const Se=B[ae];ke=[];for(let We=0,Ce=Se.length,St=Ce-1,ct=We+1;We<Ce;We++,St++,ct++)St===Ce&&(St=0),ct===Ce&&(ct=0),ke[We]=re(Se[We],Se[St],Se[ct]);ue.push(ke),$=$.concat(ke)}for(let ae=0;ae<g;ae++){const oe=ae/g,Se=h*Math.cos(oe*Math.PI/2),We=m*Math.sin(oe*Math.PI/2)+p;for(let Ce=0,St=N.length;Ce<St;Ce++){const ct=q(N[Ce],he[Ce],We);$e(ct.x,ct.y,-Se)}for(let Ce=0,St=B.length;Ce<St;Ce++){const ct=B[Ce];ke=ue[Ce];for(let Qe=0,In=ct.length;Qe<In;Qe++){const fn=q(ct[Qe],ke[Qe],We);$e(fn.x,fn.y,-Se)}}}const de=m+p;for(let ae=0;ae<ne;ae++){const oe=f?q(R[ae],$[ae],de):R[ae];x?(A.copy(w.normals[0]).multiplyScalar(oe.x),M.copy(w.binormals[0]).multiplyScalar(oe.y),b.copy(y[0]).add(A).add(M),$e(b.x,b.y,b.z)):$e(oe.x,oe.y,0)}for(let ae=1;ae<=u;ae++)for(let oe=0;oe<ne;oe++){const Se=f?q(R[oe],$[oe],de):R[oe];x?(A.copy(w.normals[ae]).multiplyScalar(Se.x),M.copy(w.binormals[ae]).multiplyScalar(Se.y),b.copy(y[ae]).add(A).add(M),$e(b.x,b.y,b.z)):$e(Se.x,Se.y,d/u*ae)}for(let ae=g-1;ae>=0;ae--){const oe=ae/g,Se=h*Math.cos(oe*Math.PI/2),We=m*Math.sin(oe*Math.PI/2)+p;for(let Ce=0,St=N.length;Ce<St;Ce++){const ct=q(N[Ce],he[Ce],We);$e(ct.x,ct.y,d+Se)}for(let Ce=0,St=B.length;Ce<St;Ce++){const ct=B[Ce];ke=ue[Ce];for(let Qe=0,In=ct.length;Qe<In;Qe++){const fn=q(ct[Qe],ke[Qe],We);x?$e(fn.x,fn.y+y[u-1].y,y[u-1].x+Se):$e(fn.x,fn.y,d+Se)}}}function j(ae,oe){let Se=ae.length;for(;--Se>=0;){const We=Se;let Ce=Se-1;Ce<0&&(Ce=ae.length-1);for(let St=0,ct=u+2*g;St<ct;St++){const Qe=ne*St,In=ne*(St+1);Ge(oe+We+Qe,oe+Ce+Qe,oe+Ce+In,oe+We+In)}}}function $e(ae,oe,Se){c.push(ae),c.push(oe),c.push(Se)}function Oe(ae,oe,Se){be(ae),be(oe),be(Se);const We=r.length/3,Ce=v.generateTopUV(i,r,We-3,We-2,We-1);Nt(Ce[0]),Nt(Ce[1]),Nt(Ce[2])}function Ge(ae,oe,Se,We){be(ae),be(oe),be(We),be(oe),be(Se),be(We);const Ce=r.length/3,St=v.generateSideWallUV(i,r,Ce-6,Ce-3,Ce-2,Ce-1);Nt(St[0]),Nt(St[1]),Nt(St[3]),Nt(St[1]),Nt(St[2]),Nt(St[3])}function be(ae){r.push(c[3*ae+0]),r.push(c[3*ae+1]),r.push(c[3*ae+2])}function Nt(ae){s.push(ae.x),s.push(ae.y)}(function _e(){const ae=r.length/3;if(f){let oe=0,Se=ne*oe;for(let We=0;We<pe;We++){const Ce=k[We];Oe(Ce[2]+Se,Ce[1]+Se,Ce[0]+Se)}oe=u+2*g,Se=ne*oe;for(let We=0;We<pe;We++){const Ce=k[We];Oe(Ce[0]+Se,Ce[1]+Se,Ce[2]+Se)}}else{for(let oe=0;oe<pe;oe++){const Se=k[oe];Oe(Se[2],Se[1],Se[0])}for(let oe=0;oe<pe;oe++){const Se=k[oe];Oe(Se[0]+ne*u,Se[1]+ne*u,Se[2]+ne*u)}}i.addGroup(ae,r.length/3-ae,0)})(),function xe(){const ae=r.length/3;let oe=0;j(N,oe),oe+=N.length;for(let Se=0,We=B.length;Se<We;Se++){const Ce=B[Se];j(Ce,oe),oe+=Ce.length}i.addGroup(ae,r.length/3-ae,1)}()}this.setAttribute("position",new Ve(r,3)),this.setAttribute("uv",new Ve(s,2)),this.computeVertexNormals()}toJSON(){const e=super.toJSON();return function Q4(n,e,t){if(t.shapes=[],Array.isArray(n))for(let i=0,r=n.length;i<r;i++)t.shapes.push(n[i].uuid);else t.shapes.push(n.uuid);return t.options=Object.assign({},e),void 0!==e.extrudePath&&(t.options.extrudePath=e.extrudePath.toJSON()),t}(this.parameters.shapes,this.parameters.options,e)}static fromJSON(e,t){const i=[];for(let s=0,o=e.shapes.length;s<o;s++)i.push(t[e.shapes[s]]);const r=e.options.extrudePath;return void 0!==r&&(e.options.extrudePath=(new s0[r.type]).fromJSON(r)),new vd(i,e.options)}}const J4={generateTopUV:function(n,e,t,i,r){const a=e[3*i],c=e[3*i+1],l=e[3*r],u=e[3*r+1];return[new ce(e[3*t],e[3*t+1]),new ce(a,c),new ce(l,u)]},generateSideWallUV:function(n,e,t,i,r,s){const o=e[3*t],a=e[3*t+1],c=e[3*t+2],l=e[3*i],u=e[3*i+1],d=e[3*i+2],f=e[3*r],h=e[3*r+1],m=e[3*r+2],p=e[3*s],g=e[3*s+1],_=e[3*s+2];return Math.abs(a-u)<Math.abs(o-l)?[new ce(o,1-c),new ce(l,1-d),new ce(f,1-m),new ce(p,1-_)]:[new ce(a,1-c),new ce(u,1-d),new ce(h,1-m),new ce(g,1-_)]}};class xd extends no{constructor(e=1,t=0){const i=(1+Math.sqrt(5))/2;super([-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new xd(e.radius,e.detail)}}class pl extends no{constructor(e=1,t=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new pl(e.radius,e.detail)}}class bd extends Pt{constructor(e=.5,t=1,i=32,r=1,s=0,o=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:i,phiSegments:r,thetaStart:s,thetaLength:o},i=Math.max(3,i);const a=[],c=[],l=[],u=[];let d=e;const f=(t-e)/(r=Math.max(1,r)),h=new T,m=new ce;for(let p=0;p<=r;p++){for(let g=0;g<=i;g++){const _=s+g/i*o;h.x=d*Math.cos(_),h.y=d*Math.sin(_),c.push(h.x,h.y,h.z),l.push(0,0,1),m.x=(h.x/t+1)/2,m.y=(h.y/t+1)/2,u.push(m.x,m.y)}d+=f}for(let p=0;p<r;p++){const g=p*(i+1);for(let _=0;_<i;_++){const v=_+g,x=v+i+1,w=v+i+2,M=v+1;a.push(v,x,M),a.push(x,w,M)}}this.setIndex(a),this.setAttribute("position",new Ve(c,3)),this.setAttribute("normal",new Ve(l,3)),this.setAttribute("uv",new Ve(u,2))}static fromJSON(e){return new bd(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class wd extends Pt{constructor(e=new _a([new ce(0,.5),new ce(-.5,-.5),new ce(.5,-.5)]),t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const i=[],r=[],s=[],o=[];let a=0,c=0;if(!1===Array.isArray(e))l(e);else for(let u=0;u<e.length;u++)l(e[u]),this.addGroup(a,c,u),a+=c,c=0;function l(u){const d=r.length/3,f=u.extractPoints(t);let h=f.shape;const m=f.holes;!1===Es.isClockWise(h)&&(h=h.reverse());for(let g=0,_=m.length;g<_;g++){const v=m[g];!0===Es.isClockWise(v)&&(m[g]=v.reverse())}const p=Es.triangulateShape(h,m);for(let g=0,_=m.length;g<_;g++)h=h.concat(m[g]);for(let g=0,_=h.length;g<_;g++){const v=h[g];r.push(v.x,v.y,0),s.push(0,0,1),o.push(v.x,v.y)}for(let g=0,_=p.length;g<_;g++){const v=p[g];i.push(v[0]+d,v[1]+d,v[2]+d),c+=3}}this.setIndex(i),this.setAttribute("position",new Ve(r,3)),this.setAttribute("normal",new Ve(s,3)),this.setAttribute("uv",new Ve(o,2))}toJSON(){const e=super.toJSON();return function e5(n,e){if(e.shapes=[],Array.isArray(n))for(let t=0,i=n.length;t<i;t++)e.shapes.push(n[t].uuid);else e.shapes.push(n.uuid);return e}(this.parameters.shapes,e)}static fromJSON(e,t){const i=[];for(let r=0,s=e.shapes.length;r<s;r++)i.push(t[e.shapes[r]]);return new wd(i,e.curveSegments)}}class ml extends Pt{constructor(e=1,t=32,i=16,r=0,s=2*Math.PI,o=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:r,phiLength:s,thetaStart:o,thetaLength:a},t=Math.max(3,Math.floor(t)),i=Math.max(2,Math.floor(i));const c=Math.min(o+a,Math.PI);let l=0;const u=[],d=new T,f=new T,h=[],m=[],p=[],g=[];for(let _=0;_<=i;_++){const v=[],y=_/i;let x=0;0==_&&0==o?x=.5/t:_==i&&c==Math.PI&&(x=-.5/t);for(let w=0;w<=t;w++){const M=w/t;d.x=-e*Math.cos(r+M*s)*Math.sin(o+y*a),d.y=e*Math.cos(o+y*a),d.z=e*Math.sin(r+M*s)*Math.sin(o+y*a),m.push(d.x,d.y,d.z),f.copy(d).normalize(),p.push(f.x,f.y,f.z),g.push(M+x,1-y),v.push(l++)}u.push(v)}for(let _=0;_<i;_++)for(let v=0;v<t;v++){const x=u[_][v],w=u[_+1][v],M=u[_+1][v+1];(0!==_||o>0)&&h.push(u[_][v+1],x,M),(_!==i-1||c<Math.PI)&&h.push(x,w,M)}this.setIndex(h),this.setAttribute("position",new Ve(m,3)),this.setAttribute("normal",new Ve(p,3)),this.setAttribute("uv",new Ve(g,2))}static fromJSON(e){return new ml(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class Md extends no{constructor(e=1,t=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Md(e.radius,e.detail)}}class Sd extends Pt{constructor(e=1,t=.4,i=12,r=48,s=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:i,tubularSegments:r,arc:s},i=Math.floor(i),r=Math.floor(r);const o=[],a=[],c=[],l=[],u=new T,d=new T,f=new T;for(let h=0;h<=i;h++)for(let m=0;m<=r;m++){const p=m/r*s,g=h/i*Math.PI*2;d.x=(e+t*Math.cos(g))*Math.cos(p),d.y=(e+t*Math.cos(g))*Math.sin(p),d.z=t*Math.sin(g),a.push(d.x,d.y,d.z),u.x=e*Math.cos(p),u.y=e*Math.sin(p),f.subVectors(d,u).normalize(),c.push(f.x,f.y,f.z),l.push(m/r),l.push(h/i)}for(let h=1;h<=i;h++)for(let m=1;m<=r;m++){const g=(r+1)*(h-1)+m-1,_=(r+1)*(h-1)+m,v=(r+1)*h+m;o.push((r+1)*h+m-1,g,v),o.push(g,_,v)}this.setIndex(o),this.setAttribute("position",new Ve(a,3)),this.setAttribute("normal",new Ve(c,3)),this.setAttribute("uv",new Ve(l,2))}static fromJSON(e){return new Sd(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class Ed extends Pt{constructor(e=1,t=.4,i=64,r=8,s=2,o=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:i,radialSegments:r,p:s,q:o},i=Math.floor(i),r=Math.floor(r);const a=[],c=[],l=[],u=[],d=new T,f=new T,h=new T,m=new T,p=new T,g=new T,_=new T;for(let y=0;y<=i;++y){const x=y/i*s*Math.PI*2;v(x,s,o,e,h),v(x+.01,s,o,e,m),g.subVectors(m,h),_.addVectors(m,h),p.crossVectors(g,_),_.crossVectors(p,g),p.normalize(),_.normalize();for(let w=0;w<=r;++w){const M=w/r*Math.PI*2,A=-t*Math.cos(M),b=t*Math.sin(M);d.x=h.x+(A*_.x+b*p.x),d.y=h.y+(A*_.y+b*p.y),d.z=h.z+(A*_.z+b*p.z),c.push(d.x,d.y,d.z),f.subVectors(d,h).normalize(),l.push(f.x,f.y,f.z),u.push(y/i),u.push(w/r)}}for(let y=1;y<=i;y++)for(let x=1;x<=r;x++){const M=(r+1)*y+(x-1),A=(r+1)*y+x,b=(r+1)*(y-1)+x;a.push((r+1)*(y-1)+(x-1),M,b),a.push(M,A,b)}function v(y,x,w,M,A){const b=Math.cos(y),S=Math.sin(y),R=w/x*y,B=Math.cos(R);A.x=M*(2+B)*.5*b,A.y=M*(2+B)*S*.5,A.z=M*Math.sin(R)*.5}this.setIndex(a),this.setAttribute("position",new Ve(c,3)),this.setAttribute("normal",new Ve(l,3)),this.setAttribute("uv",new Ve(u,2))}static fromJSON(e){return new Ed(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class Td extends Pt{constructor(e=new n0(new T(-1,-1,0),new T(-1,1,0),new T(1,1,0)),t=64,i=1,r=8,s=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:i,radialSegments:r,closed:s};const o=e.computeFrenetFrames(t,s);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals;const a=new T,c=new T,l=new ce;let u=new T;const d=[],f=[],h=[],m=[];function g(y){u=e.getPointAt(y/t,u);const x=o.normals[y],w=o.binormals[y];for(let M=0;M<=r;M++){const A=M/r*Math.PI*2,b=Math.sin(A),S=-Math.cos(A);c.x=S*x.x+b*w.x,c.y=S*x.y+b*w.y,c.z=S*x.z+b*w.z,c.normalize(),f.push(c.x,c.y,c.z),a.x=u.x+i*c.x,a.y=u.y+i*c.y,a.z=u.z+i*c.z,d.push(a.x,a.y,a.z)}}(function p(){for(let y=0;y<t;y++)g(y);g(!1===s?t:0),function v(){for(let y=0;y<=t;y++)for(let x=0;x<=r;x++)l.x=y/t,l.y=x/r,h.push(l.x,l.y)}(),function _(){for(let y=1;y<=t;y++)for(let x=1;x<=r;x++){const M=(r+1)*y+(x-1),A=(r+1)*y+x,b=(r+1)*(y-1)+x;m.push((r+1)*(y-1)+(x-1),M,b),m.push(M,A,b)}}()})(),this.setIndex(m),this.setAttribute("position",new Ve(d,3)),this.setAttribute("normal",new Ve(f,3)),this.setAttribute("uv",new Ve(h,2))}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new Td((new s0[e.path.type]).fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class vA extends Pt{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},null!==e){const t=[],i=new Set,r=new T,s=new T;if(null!==e.index){const o=e.attributes.position,a=e.index;let c=e.groups;0===c.length&&(c=[{start:0,count:a.count,materialIndex:0}]);for(let l=0,u=c.length;l<u;++l){const d=c[l],f=d.start;for(let m=f,p=f+d.count;m<p;m+=3)for(let g=0;g<3;g++){const _=a.getX(m+g),v=a.getX(m+(g+1)%3);r.fromBufferAttribute(o,_),s.fromBufferAttribute(o,v),!0===xA(r,s,i)&&(t.push(r.x,r.y,r.z),t.push(s.x,s.y,s.z))}}}else{const o=e.attributes.position;for(let a=0,c=o.count/3;a<c;a++)for(let l=0;l<3;l++){const d=3*a+(l+1)%3;r.fromBufferAttribute(o,3*a+l),s.fromBufferAttribute(o,d),!0===xA(r,s,i)&&(t.push(r.x,r.y,r.z),t.push(s.x,s.y,s.z))}}this.setAttribute("position",new Ve(t,3))}}}function xA(n,e,t){const i=`${n.x},${n.y},${n.z}-${e.x},${e.y},${e.z}`,r=`${e.x},${e.y},${e.z}-${n.x},${n.y},${n.z}`;return!0!==t.has(i)&&!0!==t.has(r)&&(t.add(i),t.add(r),!0)}var bA=Object.freeze({__proto__:null,BoxGeometry:Io,CapsuleGeometry:fd,CircleGeometry:hd,ConeGeometry:pd,CylinderGeometry:ya,DodecahedronGeometry:md,EdgesGeometry:fA,ExtrudeGeometry:vd,IcosahedronGeometry:xd,LatheGeometry:fl,OctahedronGeometry:pl,PlaneGeometry:tl,PolyhedronGeometry:no,RingGeometry:bd,ShapeGeometry:wd,SphereGeometry:ml,TetrahedronGeometry:Md,TorusGeometry:Sd,TorusKnotGeometry:Ed,TubeGeometry:Td,WireframeGeometry:vA});class wA extends ui{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new De(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class MA extends Ss{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class Dd extends ui{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new De(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new De(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Mo,this.normalScale=new ce(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class io extends Dd{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new ce(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Zn(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new De(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new De(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new De(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._iridescence=0,this._transmission=0,this.setValues(e)}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class SA extends ui{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new De(16777215),this.specular=new De(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new De(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Mo,this.normalScale=new ce(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Bu,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class EA extends ui{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new De(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new De(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Mo,this.normalScale=new ce(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class TA extends ui{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Mo,this.normalScale=new ce(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class DA extends ui{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new De(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new De(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Mo,this.normalScale=new ce(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Bu,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class CA extends ui{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new De(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Mo,this.normalScale=new ce(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}class AA extends Ni{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function Pr(n,e,t){return l0(n)?new n.constructor(n.subarray(e,void 0!==t?t:n.length)):n.slice(e,t)}function xa(n,e,t){return!n||!t&&n.constructor===e?n:"number"==typeof e.BYTES_PER_ELEMENT?new e(n):Array.prototype.slice.call(n)}function l0(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function IA(n){const t=n.length,i=new Array(t);for(let r=0;r!==t;++r)i[r]=r;return i.sort(function e(r,s){return n[r]-n[s]}),i}function u0(n,e,t){const i=n.length,r=new n.constructor(i);for(let s=0,o=0;o!==i;++s){const a=t[s]*e;for(let c=0;c!==e;++c)r[o++]=n[a+c]}return r}function d0(n,e,t,i){let r=1,s=n[0];for(;void 0!==s&&void 0===s[i];)s=n[r++];if(void 0===s)return;let o=s[i];if(void 0!==o)if(Array.isArray(o))do{o=s[i],void 0!==o&&(e.push(s.time),t.push.apply(t,o)),s=n[r++]}while(void 0!==s);else if(void 0!==o.toArray)do{o=s[i],void 0!==o&&(e.push(s.time),o.toArray(t,t.length)),s=n[r++]}while(void 0!==s);else do{o=s[i],void 0!==o&&(e.push(s.time),t.push(o)),s=n[r++]}while(void 0!==s)}var i5=Object.freeze({__proto__:null,arraySlice:Pr,convertArray:xa,flattenJSON:d0,getKeyframeOrder:IA,isTypedArray:l0,makeClipAdditive:function n5(n,e=0,t=n,i=30){i<=0&&(i=30);const r=t.tracks.length,s=e/i;for(let o=0;o<r;++o){const a=t.tracks[o],c=a.ValueTypeName;if("bool"===c||"string"===c)continue;const l=n.tracks.find(function(_){return _.name===a.name&&_.ValueTypeName===c});if(void 0===l)continue;let u=0;const d=a.getValueSize();a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(u=d/3);let f=0;const h=l.getValueSize();l.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(f=h/3);const m=a.times.length-1;let p;if(s<=a.times[0])p=Pr(a.values,u,d-u);else if(s>=a.times[m]){const _=m*d+u;p=Pr(a.values,_,_+d-u)}else{const _=a.createInterpolant(),v=u,y=d-u;_.evaluate(s),p=Pr(_.resultBuffer,v,y)}"quaternion"===c&&(new Li).fromArray(p).normalize().conjugate().toArray(p);const g=l.times.length;for(let _=0;_<g;++_){const v=_*h+f;if("quaternion"===c)Li.multiplyQuaternionsFlat(l.values,v,p,0,l.values,v);else{const y=h-2*f;for(let x=0;x<y;++x)l.values[v+x]-=p[x]}}}return n.blendMode=nv,n},sortedArray:u0,subclip:function t5(n,e,t,i,r=30){const s=n.clone();s.name=e;const o=[];for(let c=0;c<s.tracks.length;++c){const l=s.tracks[c],u=l.getValueSize(),d=[],f=[];for(let h=0;h<l.times.length;++h){const m=l.times[h]*r;if(!(m<t||m>=i)){d.push(l.times[h]);for(let p=0;p<u;++p)f.push(l.values[h*u+p])}}0!==d.length&&(l.times=xa(d,l.times.constructor),l.values=xa(f,l.values.constructor),o.push(l))}s.tracks=o;let a=1/0;for(let c=0;c<s.tracks.length;++c)a>s.tracks[c].times[0]&&(a=s.tracks[c].times[0]);for(let c=0;c<s.tracks.length;++c)s.tracks[c].shift(-1*a);return s.resetDuration(),s}});class gl{constructor(e,t,i,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new t.constructor(i),this.sampleValues=t,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let i=this._cachedIndex,r=t[i],s=t[i-1];e:{t:{let o;n:{i:if(!(e<r)){for(let a=i+2;;){if(void 0===r){if(e<s)break i;return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===a)break;if(s=r,r=t[++i],e<r)break t}o=t.length;break n}if(e>=s)break e;{const a=t[1];e<a&&(i=2,s=a);for(let c=i-2;;){if(void 0===s)return this._cachedIndex=0,this.copySampleValue_(0);if(i===c)break;if(r=s,s=t[--i-1],e>=s)break t}o=i,i=0}}for(;i<o;){const a=i+o>>>1;e<t[a]?o=a:i=a+1}if(r=t[i],s=t[i-1],void 0===s)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===r)return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,s,r)}return this.interpolate_(i,s,e,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,r=this.valueSize,s=e*r;for(let o=0;o!==r;++o)t[o]=i[s+o];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class RA extends gl{constructor(e,t,i,r){super(e,t,i,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:oa,endingEnd:oa}}intervalChanged_(e,t,i){const r=this.parameterPositions;let s=e-2,o=e+1,a=r[s],c=r[o];if(void 0===a)switch(this.getSettings_().endingStart){case aa:s=e,a=2*t-i;break;case Hu:s=r.length-2,a=t+r[s]-r[s+1];break;default:s=e,a=i}if(void 0===c)switch(this.getSettings_().endingEnd){case aa:o=e,c=2*i-t;break;case Hu:o=1,c=i+r[1]-r[0];break;default:o=e-1,c=t}const l=.5*(i-t),u=this.valueSize;this._weightPrev=l/(t-a),this._weightNext=l/(c-i),this._offsetPrev=s*u,this._offsetNext=o*u}interpolate_(e,t,i,r){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,c=e*a,l=c-a,u=this._offsetPrev,d=this._offsetNext,f=this._weightPrev,h=this._weightNext,m=(i-t)/(r-t),p=m*m,g=p*m,_=-f*g+2*f*p-f*m,v=(1+f)*g+(-1.5-2*f)*p+(-.5+f)*m+1,y=(-1-h)*g+(1.5+h)*p+.5*m,x=h*g-h*p;for(let w=0;w!==a;++w)s[w]=_*o[u+w]+v*o[l+w]+y*o[c+w]+x*o[d+w];return s}}class f0 extends gl{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e,t,i,r){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,c=e*a,l=c-a,u=(i-t)/(r-t),d=1-u;for(let f=0;f!==a;++f)s[f]=o[l+f]*d+o[c+f]*u;return s}}class PA extends gl{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e){return this.copySampleValue_(e-1)}}class ss{constructor(e,t,i,r){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=xa(t,this.TimeBufferType),this.values=xa(i,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let i;if(t.toJSON!==this.toJSON)i=t.toJSON(e);else{i={name:e.name,times:xa(e.times,Array),values:xa(e.values,Array)};const r=e.getInterpolation();r!==e.DefaultInterpolation&&(i.interpolation=r)}return i.type=e.ValueTypeName,i}InterpolantFactoryMethodDiscrete(e){return new PA(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new f0(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new RA(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case Bc:t=this.InterpolantFactoryMethodDiscrete;break;case sa:t=this.InterpolantFactoryMethodLinear;break;case Hh:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){const i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(i);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Bc;case this.InterpolantFactoryMethodLinear:return sa;case this.InterpolantFactoryMethodSmooth:return Hh}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){const t=this.times;for(let i=0,r=t.length;i!==r;++i)t[i]+=e}return this}scale(e){if(1!==e){const t=this.times;for(let i=0,r=t.length;i!==r;++i)t[i]*=e}return this}trim(e,t){const i=this.times,r=i.length;let s=0,o=r-1;for(;s!==r&&i[s]<e;)++s;for(;-1!==o&&i[o]>t;)--o;if(++o,0!==s||o!==r){s>=o&&(o=Math.max(o,1),s=o-1);const a=this.getValueSize();this.times=Pr(i,s,o),this.values=Pr(this.values,s*a,o*a)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const i=this.times,r=this.values,s=i.length;0===s&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let o=null;for(let a=0;a!==s;a++){const c=i[a];if("number"==typeof c&&isNaN(c)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,c),e=!1;break}if(null!==o&&o>c){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,c,o),e=!1;break}o=c}if(void 0!==r&&l0(r))for(let a=0,c=r.length;a!==c;++a){const l=r[a];if(isNaN(l)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,l),e=!1;break}}return e}optimize(){const e=Pr(this.times),t=Pr(this.values),i=this.getValueSize(),r=this.getInterpolation()===Hh,s=e.length-1;let o=1;for(let a=1;a<s;++a){let c=!1;const l=e[a];if(l!==e[a+1]&&(1!==a||l!==e[0]))if(r)c=!0;else{const d=a*i,f=d-i,h=d+i;for(let m=0;m!==i;++m){const p=t[d+m];if(p!==t[f+m]||p!==t[h+m]){c=!0;break}}}if(c){if(a!==o){e[o]=e[a];const d=a*i,f=o*i;for(let h=0;h!==i;++h)t[f+h]=t[d+h]}++o}}if(s>0){e[o]=e[s];for(let a=s*i,c=o*i,l=0;l!==i;++l)t[c+l]=t[a+l];++o}return o!==e.length?(this.times=Pr(e,0,o),this.values=Pr(t,0,o*i)):(this.times=e,this.values=t),this}clone(){const e=Pr(this.times,0),t=Pr(this.values,0),r=new(0,this.constructor)(this.name,e,t);return r.createInterpolant=this.createInterpolant,r}}ss.prototype.TimeBufferType=Float32Array,ss.prototype.ValueBufferType=Float32Array,ss.prototype.DefaultInterpolation=sa;class ba extends ss{}ba.prototype.ValueTypeName="bool",ba.prototype.ValueBufferType=Array,ba.prototype.DefaultInterpolation=Bc,ba.prototype.InterpolantFactoryMethodLinear=void 0,ba.prototype.InterpolantFactoryMethodSmooth=void 0;class h0 extends ss{}h0.prototype.ValueTypeName="color";class yl extends ss{}yl.prototype.ValueTypeName="number";class LA extends gl{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e,t,i,r){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,c=(i-t)/(r-t);let l=e*a;for(let u=l+a;l!==u;l+=4)Li.slerpFlat(s,0,o,l-a,o,l,c);return s}}class Lo extends ss{InterpolantFactoryMethodLinear(e){return new LA(this.times,this.values,this.getValueSize(),e)}}Lo.prototype.ValueTypeName="quaternion",Lo.prototype.DefaultInterpolation=sa,Lo.prototype.InterpolantFactoryMethodSmooth=void 0;class wa extends ss{}wa.prototype.ValueTypeName="string",wa.prototype.ValueBufferType=Array,wa.prototype.DefaultInterpolation=Bc,wa.prototype.InterpolantFactoryMethodLinear=void 0,wa.prototype.InterpolantFactoryMethodSmooth=void 0;class _l extends ss{}_l.prototype.ValueTypeName="vector";class vl{constructor(e,t=-1,i,r=Gh){this.name=e,this.tracks=i,this.duration=t,this.blendMode=r,this.uuid=fr(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],i=e.tracks,r=1/(e.fps||1);for(let o=0,a=i.length;o!==a;++o)t.push(s5(i[o]).scale(r));const s=new this(e.name,e.duration,t,e.blendMode);return s.uuid=e.uuid,s}static toJSON(e){const t=[],i=e.tracks,r={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let s=0,o=i.length;s!==o;++s)t.push(ss.toJSON(i[s]));return r}static CreateFromMorphTargetSequence(e,t,i,r){const s=t.length,o=[];for(let a=0;a<s;a++){let c=[],l=[];c.push((a+s-1)%s,a,(a+1)%s),l.push(0,1,0);const u=IA(c);c=u0(c,1,u),l=u0(l,1,u),!r&&0===c[0]&&(c.push(s),l.push(l[0])),o.push(new yl(".morphTargetInfluences["+t[a].name+"]",c,l).scale(1/i))}return new this(e,-1,o)}static findByName(e,t){let i=e;Array.isArray(e)||(i=e.geometry&&e.geometry.animations||e.animations);for(let r=0;r<i.length;r++)if(i[r].name===t)return i[r];return null}static CreateClipsFromMorphTargetSequences(e,t,i){const r={},s=/^([\w-]*?)([\d]+)$/;for(let a=0,c=e.length;a<c;a++){const l=e[a],u=l.name.match(s);if(u&&u.length>1){const d=u[1];let f=r[d];f||(r[d]=f=[]),f.push(l)}}const o=[];for(const a in r)o.push(this.CreateFromMorphTargetSequence(a,r[a],t,i));return o}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const i=function(d,f,h,m,p){if(0!==h.length){const g=[],_=[];d0(h,g,_,m),0!==g.length&&p.push(new d(f,g,_))}},r=[],s=e.name||"default",o=e.fps||30,a=e.blendMode;let c=e.length||-1;const l=e.hierarchy||[];for(let d=0;d<l.length;d++){const f=l[d].keys;if(f&&0!==f.length)if(f[0].morphTargets){const h={};let m;for(m=0;m<f.length;m++)if(f[m].morphTargets)for(let p=0;p<f[m].morphTargets.length;p++)h[f[m].morphTargets[p]]=-1;for(const p in h){const g=[],_=[];for(let v=0;v!==f[m].morphTargets.length;++v){const y=f[m];g.push(y.time),_.push(y.morphTarget===p?1:0)}r.push(new yl(".morphTargetInfluence["+p+"]",g,_))}c=h.length*o}else{const h=".bones["+t[d].name+"]";i(_l,h+".position",f,"pos",r),i(Lo,h+".quaternion",f,"rot",r),i(_l,h+".scale",f,"scl",r)}}return 0===r.length?null:new this(s,c,r,a)}resetDuration(){let t=0;for(let i=0,r=this.tracks.length;i!==r;++i){const s=this.tracks[i];t=Math.max(t,s.times[s.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function s5(n){if(void 0===n.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=function r5(n){switch(n.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return yl;case"vector":case"vector2":case"vector3":case"vector4":return _l;case"color":return h0;case"quaternion":return Lo;case"bool":case"boolean":return ba;case"string":return wa}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+n)}(n.type);if(void 0===n.times){const t=[],i=[];d0(n.keys,t,i,"value"),n.times=t,n.values=i}return void 0!==e.parse?e.parse(n):new e(n.name,n.times,n.values,n.interpolation)}const Ma={enabled:!1,files:{},add:function(n,e){!1!==this.enabled&&(this.files[n]=e)},get:function(n){if(!1!==this.enabled)return this.files[n]},remove:function(n){delete this.files[n]},clear:function(){this.files={}}};class p0{constructor(e,t,i){const r=this;let c,s=!1,o=0,a=0;const l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(u){a++,!1===s&&void 0!==r.onStart&&r.onStart(u,o,a),s=!0},this.itemEnd=function(u){o++,void 0!==r.onProgress&&r.onProgress(u,o,a),o===a&&(s=!1,void 0!==r.onLoad&&r.onLoad())},this.itemError=function(u){void 0!==r.onError&&r.onError(u)},this.resolveURL=function(u){return c?c(u):u},this.setURLModifier=function(u){return c=u,this},this.addHandler=function(u,d){return l.push(u,d),this},this.removeHandler=function(u){const d=l.indexOf(u);return-1!==d&&l.splice(d,2),this},this.getHandler=function(u){for(let d=0,f=l.length;d<f;d+=2){const h=l[d],m=l[d+1];if(h.global&&(h.lastIndex=0),h.test(u))return m}return null}}}const NA=new p0;class rr{constructor(e){this.manager=void 0!==e?e:NA,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const i=this;return new Promise(function(r,s){i.load(e,r,t,s)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}const ro={};class o5 extends Error{constructor(e,t){super(e),this.response=t}}class os extends rr{constructor(e){super(e)}load(e,t,i,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const s=Ma.get(e);if(void 0!==s)return this.manager.itemStart(e),setTimeout(()=>{t&&t(s),this.manager.itemEnd(e)},0),s;if(void 0!==ro[e])return void ro[e].push({onLoad:t,onProgress:i,onError:r});ro[e]=[],ro[e].push({onLoad:t,onProgress:i,onError:r});const o=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,c=this.responseType;fetch(o).then(l=>{if(200===l.status||0===l.status){if(0===l.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||void 0===l.body||void 0===l.body.getReader)return l;const u=ro[e],d=l.body.getReader(),f=l.headers.get("Content-Length")||l.headers.get("X-File-Size"),h=f?parseInt(f):0,m=0!==h;let p=0;const g=new ReadableStream({start(_){!function v(){d.read().then(({done:y,value:x})=>{if(y)_.close();else{p+=x.byteLength;const w=new ProgressEvent("progress",{lengthComputable:m,loaded:p,total:h});for(let M=0,A=u.length;M<A;M++){const b=u[M];b.onProgress&&b.onProgress(w)}_.enqueue(x),v()}})}()}});return new Response(g)}throw new o5(`fetch for "${l.url}" responded with ${l.status}: ${l.statusText}`,l)}).then(l=>{switch(c){case"arraybuffer":return l.arrayBuffer();case"blob":return l.blob();case"document":return l.text().then(u=>(new DOMParser).parseFromString(u,a));case"json":return l.json();default:if(void 0===a)return l.text();{const d=/charset="?([^;"\s]*)"?/i.exec(a),f=d&&d[1]?d[1].toLowerCase():void 0,h=new TextDecoder(f);return l.arrayBuffer().then(m=>h.decode(m))}}}).then(l=>{Ma.add(e,l);const u=ro[e];delete ro[e];for(let d=0,f=u.length;d<f;d++){const h=u[d];h.onLoad&&h.onLoad(l)}}).catch(l=>{const u=ro[e];if(void 0===u)throw this.manager.itemError(e),l;delete ro[e];for(let d=0,f=u.length;d<f;d++){const h=u[d];h.onError&&h.onError(l)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class a5 extends rr{constructor(e){super(e)}load(e,t,i,r){const s=this,o=new os(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(a){try{t(s.parse(JSON.parse(a)))}catch(c){r?r(c):console.error(c),s.manager.itemError(e)}},i,r)}parse(e){const t=[];for(let i=0;i<e.length;i++){const r=vl.parse(e[i]);t.push(r)}return t}}class c5 extends rr{constructor(e){super(e)}load(e,t,i,r){const s=this,o=[],a=new Xv,c=new os(this.manager);c.setPath(this.path),c.setResponseType("arraybuffer"),c.setRequestHeader(this.requestHeader),c.setWithCredentials(s.withCredentials);let l=0;function u(d){c.load(e[d],function(f){const h=s.parse(f,!0);o[d]={width:h.width,height:h.height,format:h.format,mipmaps:h.mipmaps},l+=1,6===l&&(1===h.mipmapCount&&(a.minFilter=Fn),a.image=o,a.format=h.format,a.needsUpdate=!0,t&&t(a))},i,r)}if(Array.isArray(e))for(let d=0,f=e.length;d<f;++d)u(d);else c.load(e,function(d){const f=s.parse(d,!0);if(f.isCubemap){const h=f.mipmaps.length/f.mipmapCount;for(let m=0;m<h;m++){o[m]={mipmaps:[]};for(let p=0;p<f.mipmapCount;p++)o[m].mipmaps.push(f.mipmaps[m*f.mipmapCount+p]),o[m].format=f.format,o[m].width=f.width,o[m].height=f.height}a.image=o}else a.image.width=f.width,a.image.height=f.height,a.mipmaps=f.mipmaps;1===f.mipmapCount&&(a.minFilter=Fn),a.format=f.format,a.needsUpdate=!0,t&&t(a)},i,r);return a}}class Cd extends rr{constructor(e){super(e)}load(e,t,i,r){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,o=Ma.get(e);if(void 0!==o)return s.manager.itemStart(e),setTimeout(function(){t&&t(o),s.manager.itemEnd(e)},0),o;const a=$u("img");function c(){u(),Ma.add(e,this),t&&t(this),s.manager.itemEnd(e)}function l(d){u(),r&&r(d),s.manager.itemError(e),s.manager.itemEnd(e)}function u(){a.removeEventListener("load",c,!1),a.removeEventListener("error",l,!1)}return a.addEventListener("load",c,!1),a.addEventListener("error",l,!1),"data:"!==e.slice(0,5)&&void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),s.manager.itemStart(e),a.src=e,a}}class l5 extends rr{constructor(e){super(e)}load(e,t,i,r){const s=new td,o=new Cd(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);let a=0;function c(l){o.load(e[l],function(u){s.images[l]=u,a++,6===a&&(s.needsUpdate=!0,t&&t(s))},void 0,r)}for(let l=0;l<e.length;++l)c(l);return s}}class u5 extends rr{constructor(e){super(e)}load(e,t,i,r){const s=this,o=new ul,a=new os(this.manager);return a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setPath(this.path),a.setWithCredentials(s.withCredentials),a.load(e,function(c){const l=s.parse(c);l&&(void 0!==l.image?o.image=l.image:void 0!==l.data&&(o.image.width=l.width,o.image.height=l.height,o.image.data=l.data),o.wrapS=void 0!==l.wrapS?l.wrapS:Ei,o.wrapT=void 0!==l.wrapT?l.wrapT:Ei,o.magFilter=void 0!==l.magFilter?l.magFilter:Fn,o.minFilter=void 0!==l.minFilter?l.minFilter:Fn,o.anisotropy=void 0!==l.anisotropy?l.anisotropy:1,void 0!==l.encoding&&(o.encoding=l.encoding),void 0!==l.flipY&&(o.flipY=l.flipY),void 0!==l.format&&(o.format=l.format),void 0!==l.type&&(o.type=l.type),void 0!==l.mipmaps&&(o.mipmaps=l.mipmaps,o.minFilter=Ms),1===l.mipmapCount&&(o.minFilter=Fn),void 0!==l.generateMipmaps&&(o.generateMipmaps=l.generateMipmaps),o.needsUpdate=!0,t&&t(o,l))},i,r),o}}class OA extends rr{constructor(e){super(e)}load(e,t,i,r){const s=new Ti,o=new Cd(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,function(a){s.image=a,s.needsUpdate=!0,void 0!==t&&t(s)},i,r),s}}class No extends _n{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new De(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}class FA extends No{constructor(e,t,i){super(e,i),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(_n.DEFAULT_UP),this.updateMatrix(),this.groundColor=new De(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}}const m0=new pt,kA=new T,BA=new T;class g0{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new ce(512,512),this.map=null,this.mapPass=null,this.matrix=new pt,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new hp,this._frameExtents=new ce(1,1),this._viewportCount=1,this._viewports=[new dn(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,i=this.matrix;kA.setFromMatrixPosition(e.matrixWorld),t.position.copy(kA),BA.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(BA),t.updateMatrixWorld(),m0.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(m0),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(m0)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),(512!==this.mapSize.x||512!==this.mapSize.y)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class d5 extends g0{constructor(){super(new di(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const t=this.camera,i=2*Wu*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height,s=e.distance||t.far;(i!==t.fov||r!==t.aspect||s!==t.far)&&(t.fov=i,t.aspect=r,t.far=s,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class y0 extends No{constructor(e,t,i=0,r=Math.PI/3,s=0,o=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(_n.DEFAULT_UP),this.updateMatrix(),this.target=new _n,this.distance=i,this.angle=r,this.penumbra=s,this.decay=o,this.map=null,this.shadow=new d5}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const UA=new pt,Ad=new T,_0=new T;class f5 extends g0{constructor(){super(new di(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new ce(4,2),this._viewportCount=6,this._viewports=[new dn(2,1,1,1),new dn(0,1,1,1),new dn(3,1,1,1),new dn(1,1,1,1),new dn(3,0,1,1),new dn(1,0,1,1)],this._cubeDirections=[new T(1,0,0),new T(-1,0,0),new T(0,0,1),new T(0,0,-1),new T(0,1,0),new T(0,-1,0)],this._cubeUps=[new T(0,1,0),new T(0,1,0),new T(0,1,0),new T(0,1,0),new T(0,0,1),new T(0,0,-1)]}updateMatrices(e,t=0){const i=this.camera,r=this.matrix,s=e.distance||i.far;s!==i.far&&(i.far=s,i.updateProjectionMatrix()),Ad.setFromMatrixPosition(e.matrixWorld),i.position.copy(Ad),_0.copy(i.position),_0.add(this._cubeDirections[t]),i.up.copy(this._cubeUps[t]),i.lookAt(_0),i.updateMatrixWorld(),r.makeTranslation(-Ad.x,-Ad.y,-Ad.z),UA.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(UA)}}class v0 extends No{constructor(e,t,i=0,r=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=r,this.shadow=new f5}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class h5 extends g0{constructor(){super(new nl(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class x0 extends No{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(_n.DEFAULT_UP),this.updateMatrix(),this.target=new _n,this.shadow=new h5}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class VA extends No{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class zA extends No{constructor(e,t,i=10,r=10){super(e,t),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=i,this.height=r}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}class HA{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new T)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const i=e.x,r=e.y,s=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.282095),t.addScaledVector(o[1],.488603*r),t.addScaledVector(o[2],.488603*s),t.addScaledVector(o[3],.488603*i),t.addScaledVector(o[4],i*r*1.092548),t.addScaledVector(o[5],r*s*1.092548),t.addScaledVector(o[6],.315392*(3*s*s-1)),t.addScaledVector(o[7],i*s*1.092548),t.addScaledVector(o[8],.546274*(i*i-r*r)),t}getIrradianceAt(e,t){const i=e.x,r=e.y,s=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.886227),t.addScaledVector(o[1],1.023328*r),t.addScaledVector(o[2],1.023328*s),t.addScaledVector(o[3],1.023328*i),t.addScaledVector(o[4],.858086*i*r),t.addScaledVector(o[5],.858086*r*s),t.addScaledVector(o[6],.743125*s*s-.247708),t.addScaledVector(o[7],.858086*i*s),t.addScaledVector(o[8],.429043*(i*i-r*r)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let i=0;i<9;i++)this.coefficients[i].addScaledVector(e.coefficients[i],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let i=0;i<9;i++)this.coefficients[i].lerp(e.coefficients[i],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(e,t=0){const i=this.coefficients;for(let r=0;r<9;r++)i[r].fromArray(e,t+3*r);return this}toArray(e=[],t=0){const i=this.coefficients;for(let r=0;r<9;r++)i[r].toArray(e,t+3*r);return e}static getBasisAt(e,t){const i=e.x,r=e.y,s=e.z;t[0]=.282095,t[1]=.488603*r,t[2]=.488603*s,t[3]=.488603*i,t[4]=1.092548*i*r,t[5]=1.092548*r*s,t[6]=.315392*(3*s*s-1),t[7]=1.092548*i*s,t[8]=.546274*(i*i-r*r)}}class zp extends No{constructor(e=new HA,t=1){super(void 0,t),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}class Hp extends rr{constructor(e){super(e),this.textures={}}load(e,t,i,r){const s=this,o=new os(s.manager);o.setPath(s.path),o.setRequestHeader(s.requestHeader),o.setWithCredentials(s.withCredentials),o.load(e,function(a){try{t(s.parse(JSON.parse(a)))}catch(c){r?r(c):console.error(c),s.manager.itemError(e)}},i,r)}parse(e){const t=this.textures;function i(s){return void 0===t[s]&&console.warn("THREE.MaterialLoader: Undefined texture",s),t[s]}const r=Hp.createMaterialFromType(e.type);if(void 0!==e.uuid&&(r.uuid=e.uuid),void 0!==e.name&&(r.name=e.name),void 0!==e.color&&void 0!==r.color&&r.color.setHex(e.color),void 0!==e.roughness&&(r.roughness=e.roughness),void 0!==e.metalness&&(r.metalness=e.metalness),void 0!==e.sheen&&(r.sheen=e.sheen),void 0!==e.sheenColor&&(r.sheenColor=(new De).setHex(e.sheenColor)),void 0!==e.sheenRoughness&&(r.sheenRoughness=e.sheenRoughness),void 0!==e.emissive&&void 0!==r.emissive&&r.emissive.setHex(e.emissive),void 0!==e.specular&&void 0!==r.specular&&r.specular.setHex(e.specular),void 0!==e.specularIntensity&&(r.specularIntensity=e.specularIntensity),void 0!==e.specularColor&&void 0!==r.specularColor&&r.specularColor.setHex(e.specularColor),void 0!==e.shininess&&(r.shininess=e.shininess),void 0!==e.clearcoat&&(r.clearcoat=e.clearcoat),void 0!==e.clearcoatRoughness&&(r.clearcoatRoughness=e.clearcoatRoughness),void 0!==e.iridescence&&(r.iridescence=e.iridescence),void 0!==e.iridescenceIOR&&(r.iridescenceIOR=e.iridescenceIOR),void 0!==e.iridescenceThicknessRange&&(r.iridescenceThicknessRange=e.iridescenceThicknessRange),void 0!==e.transmission&&(r.transmission=e.transmission),void 0!==e.thickness&&(r.thickness=e.thickness),void 0!==e.attenuationDistance&&(r.attenuationDistance=e.attenuationDistance),void 0!==e.attenuationColor&&void 0!==r.attenuationColor&&r.attenuationColor.setHex(e.attenuationColor),void 0!==e.fog&&(r.fog=e.fog),void 0!==e.flatShading&&(r.flatShading=e.flatShading),void 0!==e.blending&&(r.blending=e.blending),void 0!==e.combine&&(r.combine=e.combine),void 0!==e.side&&(r.side=e.side),void 0!==e.shadowSide&&(r.shadowSide=e.shadowSide),void 0!==e.opacity&&(r.opacity=e.opacity),void 0!==e.transparent&&(r.transparent=e.transparent),void 0!==e.alphaTest&&(r.alphaTest=e.alphaTest),void 0!==e.depthTest&&(r.depthTest=e.depthTest),void 0!==e.depthWrite&&(r.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(r.colorWrite=e.colorWrite),void 0!==e.stencilWrite&&(r.stencilWrite=e.stencilWrite),void 0!==e.stencilWriteMask&&(r.stencilWriteMask=e.stencilWriteMask),void 0!==e.stencilFunc&&(r.stencilFunc=e.stencilFunc),void 0!==e.stencilRef&&(r.stencilRef=e.stencilRef),void 0!==e.stencilFuncMask&&(r.stencilFuncMask=e.stencilFuncMask),void 0!==e.stencilFail&&(r.stencilFail=e.stencilFail),void 0!==e.stencilZFail&&(r.stencilZFail=e.stencilZFail),void 0!==e.stencilZPass&&(r.stencilZPass=e.stencilZPass),void 0!==e.wireframe&&(r.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(r.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(r.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(r.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(r.rotation=e.rotation),1!==e.linewidth&&(r.linewidth=e.linewidth),void 0!==e.dashSize&&(r.dashSize=e.dashSize),void 0!==e.gapSize&&(r.gapSize=e.gapSize),void 0!==e.scale&&(r.scale=e.scale),void 0!==e.polygonOffset&&(r.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(r.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(r.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.dithering&&(r.dithering=e.dithering),void 0!==e.alphaToCoverage&&(r.alphaToCoverage=e.alphaToCoverage),void 0!==e.premultipliedAlpha&&(r.premultipliedAlpha=e.premultipliedAlpha),void 0!==e.forceSinglePass&&(r.forceSinglePass=e.forceSinglePass),void 0!==e.visible&&(r.visible=e.visible),void 0!==e.toneMapped&&(r.toneMapped=e.toneMapped),void 0!==e.userData&&(r.userData=e.userData),void 0!==e.vertexColors&&(r.vertexColors="number"==typeof e.vertexColors?e.vertexColors>0:e.vertexColors),void 0!==e.uniforms)for(const s in e.uniforms){const o=e.uniforms[s];switch(r.uniforms[s]={},o.type){case"t":r.uniforms[s].value=i(o.value);break;case"c":r.uniforms[s].value=(new De).setHex(o.value);break;case"v2":r.uniforms[s].value=(new ce).fromArray(o.value);break;case"v3":r.uniforms[s].value=(new T).fromArray(o.value);break;case"v4":r.uniforms[s].value=(new dn).fromArray(o.value);break;case"m3":r.uniforms[s].value=(new ji).fromArray(o.value);break;case"m4":r.uniforms[s].value=(new pt).fromArray(o.value);break;default:r.uniforms[s].value=o.value}}if(void 0!==e.defines&&(r.defines=e.defines),void 0!==e.vertexShader&&(r.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(r.fragmentShader=e.fragmentShader),void 0!==e.glslVersion&&(r.glslVersion=e.glslVersion),void 0!==e.extensions)for(const s in e.extensions)r.extensions[s]=e.extensions[s];if(void 0!==e.size&&(r.size=e.size),void 0!==e.sizeAttenuation&&(r.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(r.map=i(e.map)),void 0!==e.matcap&&(r.matcap=i(e.matcap)),void 0!==e.alphaMap&&(r.alphaMap=i(e.alphaMap)),void 0!==e.bumpMap&&(r.bumpMap=i(e.bumpMap)),void 0!==e.bumpScale&&(r.bumpScale=e.bumpScale),void 0!==e.normalMap&&(r.normalMap=i(e.normalMap)),void 0!==e.normalMapType&&(r.normalMapType=e.normalMapType),void 0!==e.normalScale){let s=e.normalScale;!1===Array.isArray(s)&&(s=[s,s]),r.normalScale=(new ce).fromArray(s)}return void 0!==e.displacementMap&&(r.displacementMap=i(e.displacementMap)),void 0!==e.displacementScale&&(r.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(r.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(r.roughnessMap=i(e.roughnessMap)),void 0!==e.metalnessMap&&(r.metalnessMap=i(e.metalnessMap)),void 0!==e.emissiveMap&&(r.emissiveMap=i(e.emissiveMap)),void 0!==e.emissiveIntensity&&(r.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(r.specularMap=i(e.specularMap)),void 0!==e.specularIntensityMap&&(r.specularIntensityMap=i(e.specularIntensityMap)),void 0!==e.specularColorMap&&(r.specularColorMap=i(e.specularColorMap)),void 0!==e.envMap&&(r.envMap=i(e.envMap)),void 0!==e.envMapIntensity&&(r.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(r.reflectivity=e.reflectivity),void 0!==e.refractionRatio&&(r.refractionRatio=e.refractionRatio),void 0!==e.lightMap&&(r.lightMap=i(e.lightMap)),void 0!==e.lightMapIntensity&&(r.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(r.aoMap=i(e.aoMap)),void 0!==e.aoMapIntensity&&(r.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(r.gradientMap=i(e.gradientMap)),void 0!==e.clearcoatMap&&(r.clearcoatMap=i(e.clearcoatMap)),void 0!==e.clearcoatRoughnessMap&&(r.clearcoatRoughnessMap=i(e.clearcoatRoughnessMap)),void 0!==e.clearcoatNormalMap&&(r.clearcoatNormalMap=i(e.clearcoatNormalMap)),void 0!==e.clearcoatNormalScale&&(r.clearcoatNormalScale=(new ce).fromArray(e.clearcoatNormalScale)),void 0!==e.iridescenceMap&&(r.iridescenceMap=i(e.iridescenceMap)),void 0!==e.iridescenceThicknessMap&&(r.iridescenceThicknessMap=i(e.iridescenceThicknessMap)),void 0!==e.transmissionMap&&(r.transmissionMap=i(e.transmissionMap)),void 0!==e.thicknessMap&&(r.thicknessMap=i(e.thicknessMap)),void 0!==e.sheenColorMap&&(r.sheenColorMap=i(e.sheenColorMap)),void 0!==e.sheenRoughnessMap&&(r.sheenRoughnessMap=i(e.sheenRoughnessMap)),r}setTextures(e){return this.textures=e,this}static createMaterialFromType(e){return new{ShadowMaterial:wA,SpriteMaterial:zv,RawShaderMaterial:MA,ShaderMaterial:Ss,PointsMaterial:Ap,MeshPhysicalMaterial:io,MeshStandardMaterial:Dd,MeshPhongMaterial:SA,MeshToonMaterial:EA,MeshNormalMaterial:TA,MeshLambertMaterial:DA,MeshDepthMaterial:Bv,MeshDistanceMaterial:Uv,MeshBasicMaterial:pr,MeshMatcapMaterial:CA,LineDashedMaterial:AA,LineBasicMaterial:Ni,Material:ui}[e]}}class xl{static decodeText(e){if(typeof TextDecoder<"u")return(new TextDecoder).decode(e);let t="";for(let i=0,r=e.length;i<r;i++)t+=String.fromCharCode(e[i]);try{return decodeURIComponent(escape(t))}catch{return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return-1===t?"./":e.slice(0,t+1)}static resolveURL(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class GA extends Pt{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){const e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class WA extends rr{constructor(e){super(e)}load(e,t,i,r){const s=this,o=new os(s.manager);o.setPath(s.path),o.setRequestHeader(s.requestHeader),o.setWithCredentials(s.withCredentials),o.load(e,function(a){try{t(s.parse(JSON.parse(a)))}catch(c){r?r(c):console.error(c),s.manager.itemError(e)}},i,r)}parse(e){const t={},i={};function r(h,m){if(void 0!==t[m])return t[m];const g=h.interleavedBuffers[m],_=function s(h,m){if(void 0!==i[m])return i[m];const _=new Uint32Array(h.arrayBuffers[m]).buffer;return i[m]=_,_}(h,g.buffer),v=Vc(g.type,_),y=new id(v,g.stride);return y.uuid=g.uuid,t[m]=y,y}const o=e.isInstancedBufferGeometry?new GA:new Pt,a=e.data.index;if(void 0!==a){const h=Vc(a.type,a.array);o.setIndex(new an(h,1))}const c=e.data.attributes;for(const h in c){const m=c[h];let p;if(m.isInterleavedBufferAttribute){const g=r(e.data,m.data);p=new Po(g,m.itemSize,m.offset,m.normalized)}else{const g=Vc(m.type,m.array);p=new(m.isInstancedBufferAttribute?dl:an)(g,m.itemSize,m.normalized)}void 0!==m.name&&(p.name=m.name),void 0!==m.usage&&p.setUsage(m.usage),void 0!==m.updateRange&&(p.updateRange.offset=m.updateRange.offset,p.updateRange.count=m.updateRange.count),o.setAttribute(h,p)}const l=e.data.morphAttributes;if(l)for(const h in l){const m=l[h],p=[];for(let g=0,_=m.length;g<_;g++){const v=m[g];let y;if(v.isInterleavedBufferAttribute){const x=r(e.data,v.data);y=new Po(x,v.itemSize,v.offset,v.normalized)}else{const x=Vc(v.type,v.array);y=new an(x,v.itemSize,v.normalized)}void 0!==v.name&&(y.name=v.name),p.push(y)}o.morphAttributes[h]=p}e.data.morphTargetsRelative&&(o.morphTargetsRelative=!0);const d=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==d)for(let h=0,m=d.length;h!==m;++h){const p=d[h];o.addGroup(p.start,p.count,p.materialIndex)}const f=e.data.boundingSphere;if(void 0!==f){const h=new T;void 0!==f.center&&h.fromArray(f.center),o.boundingSphere=new Do(h,f.radius)}return e.name&&(o.name=e.name),e.userData&&(o.userData=e.userData),o}}class p5 extends rr{constructor(e){super(e)}load(e,t,i,r){const s=this,o=""===this.path?xl.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||o;const a=new os(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(c){let l=null;try{l=JSON.parse(c)}catch(d){return void 0!==r&&r(d),void console.error("THREE:ObjectLoader: Can't parse "+e+".",d.message)}const u=l.metadata;if(void 0===u||void 0===u.type||"geometry"===u.type.toLowerCase())return void 0!==r&&r(new Error("THREE.ObjectLoader: Can't load "+e)),void console.error("THREE.ObjectLoader: Can't load "+e);s.parse(l,t)},i,r)}loadAsync(e,t){var i=this;return ku(function*(){const r=i,s=""===i.path?xl.extractUrlBase(e):i.path;i.resourcePath=i.resourcePath||s;const o=new os(i.manager);o.setPath(i.path),o.setRequestHeader(i.requestHeader),o.setWithCredentials(i.withCredentials);const a=yield o.loadAsync(e,t),c=JSON.parse(a),l=c.metadata;if(void 0===l||void 0===l.type||"geometry"===l.type.toLowerCase())throw new Error("THREE.ObjectLoader: Can't load "+e);return yield r.parseAsync(c)})()}parse(e,t){const i=this.parseAnimations(e.animations),r=this.parseShapes(e.shapes),s=this.parseGeometries(e.geometries,r),o=this.parseImages(e.images,function(){void 0!==t&&t(l)}),a=this.parseTextures(e.textures,o),c=this.parseMaterials(e.materials,a),l=this.parseObject(e.object,s,c,a,i),u=this.parseSkeletons(e.skeletons,l);if(this.bindSkeletons(l,u),void 0!==t){let d=!1;for(const f in o)if(o[f].data instanceof HTMLImageElement){d=!0;break}!1===d&&t(l)}return l}parseAsync(e){var t=this;return ku(function*(){const i=t.parseAnimations(e.animations),r=t.parseShapes(e.shapes),s=t.parseGeometries(e.geometries,r),o=yield t.parseImagesAsync(e.images),a=t.parseTextures(e.textures,o),c=t.parseMaterials(e.materials,a),l=t.parseObject(e.object,s,c,a,i),u=t.parseSkeletons(e.skeletons,l);return t.bindSkeletons(l,u),l})()}parseShapes(e){const t={};if(void 0!==e)for(let i=0,r=e.length;i<r;i++){const s=(new _a).fromJSON(e[i]);t[s.uuid]=s}return t}parseSkeletons(e,t){const i={},r={};if(t.traverse(function(s){s.isBone&&(r[s.uuid]=s)}),void 0!==e)for(let s=0,o=e.length;s<o;s++){const a=(new ad).fromJSON(e[s],r);i[a.uuid]=a}return i}parseGeometries(e,t){const i={};if(void 0!==e){const r=new WA;for(let s=0,o=e.length;s<o;s++){let a;const c=e[s];switch(c.type){case"BufferGeometry":case"InstancedBufferGeometry":a=r.parse(c);break;default:c.type in bA?a=bA[c.type].fromJSON(c,t):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${c.type}"`)}a.uuid=c.uuid,void 0!==c.name&&(a.name=c.name),!0===a.isBufferGeometry&&void 0!==c.userData&&(a.userData=c.userData),i[c.uuid]=a}}return i}parseMaterials(e,t){const i={},r={};if(void 0!==e){const s=new Hp;s.setTextures(t);for(let o=0,a=e.length;o<a;o++){const c=e[o];void 0===i[c.uuid]&&(i[c.uuid]=s.parse(c)),r[c.uuid]=i[c.uuid]}}return r}parseAnimations(e){const t={};if(void 0!==e)for(let i=0;i<e.length;i++){const s=vl.parse(e[i]);t[s.uuid]=s}return t}parseImages(e,t){const i=this,r={};let s;function a(c){if("string"==typeof c){const l=c;return function o(c){return i.manager.itemStart(c),s.load(c,function(){i.manager.itemEnd(c)},void 0,function(){i.manager.itemError(c),i.manager.itemEnd(c)})}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(l)?l:i.resourcePath+l)}return c.data?{data:Vc(c.type,c.data),width:c.width,height:c.height}:null}if(void 0!==e&&e.length>0){const c=new p0(t);s=new Cd(c),s.setCrossOrigin(this.crossOrigin);for(let l=0,u=e.length;l<u;l++){const d=e[l],f=d.url;if(Array.isArray(f)){const h=[];for(let m=0,p=f.length;m<p;m++){const _=a(f[m]);null!==_&&(_ instanceof HTMLImageElement?h.push(_):h.push(new ul(_.data,_.width,_.height)))}r[d.uuid]=new ua(h)}else{const h=a(d.url);r[d.uuid]=new ua(h)}}}return r}parseImagesAsync(e){var t=this;return ku(function*(){const i=t,r={};let s;function o(c){return a.apply(this,arguments)}function a(){return(a=ku(function*(c){if("string"==typeof c){const l=c,u=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(l)?l:i.resourcePath+l;return yield s.loadAsync(u)}return c.data?{data:Vc(c.type,c.data),width:c.width,height:c.height}:null})).apply(this,arguments)}if(void 0!==e&&e.length>0){s=new Cd(t.manager),s.setCrossOrigin(t.crossOrigin);for(let c=0,l=e.length;c<l;c++){const u=e[c],d=u.url;if(Array.isArray(d)){const f=[];for(let h=0,m=d.length;h<m;h++){const p=d[h],g=yield o(p);null!==g&&(g instanceof HTMLImageElement?f.push(g):f.push(new ul(g.data,g.width,g.height)))}r[u.uuid]=new ua(f)}else{const f=yield o(u.url);r[u.uuid]=new ua(f)}}}return r})()}parseTextures(e,t){function i(s,o){return"number"==typeof s?s:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",s),o[s])}const r={};if(void 0!==e)for(let s=0,o=e.length;s<o;s++){const a=e[s];void 0===a.image&&console.warn('THREE.ObjectLoader: No "image" specified for',a.uuid),void 0===t[a.image]&&console.warn("THREE.ObjectLoader: Undefined image",a.image);const c=t[a.image],l=c.data;let u;Array.isArray(l)?(u=new td,6===l.length&&(u.needsUpdate=!0)):(u=l&&l.data?new ul:new Ti,l&&(u.needsUpdate=!0)),u.source=c,u.uuid=a.uuid,void 0!==a.name&&(u.name=a.name),void 0!==a.mapping&&(u.mapping=i(a.mapping,m5)),void 0!==a.offset&&u.offset.fromArray(a.offset),void 0!==a.repeat&&u.repeat.fromArray(a.repeat),void 0!==a.center&&u.center.fromArray(a.center),void 0!==a.rotation&&(u.rotation=a.rotation),void 0!==a.wrap&&(u.wrapS=i(a.wrap[0],jA),u.wrapT=i(a.wrap[1],jA)),void 0!==a.format&&(u.format=a.format),void 0!==a.type&&(u.type=a.type),void 0!==a.encoding&&(u.encoding=a.encoding),void 0!==a.minFilter&&(u.minFilter=i(a.minFilter,$A)),void 0!==a.magFilter&&(u.magFilter=i(a.magFilter,$A)),void 0!==a.anisotropy&&(u.anisotropy=a.anisotropy),void 0!==a.flipY&&(u.flipY=a.flipY),void 0!==a.generateMipmaps&&(u.generateMipmaps=a.generateMipmaps),void 0!==a.premultiplyAlpha&&(u.premultiplyAlpha=a.premultiplyAlpha),void 0!==a.unpackAlignment&&(u.unpackAlignment=a.unpackAlignment),void 0!==a.userData&&(u.userData=a.userData),r[a.uuid]=u}return r}parseObject(e,t,i,r,s){let o,u,d;function a(f){return void 0===t[f]&&console.warn("THREE.ObjectLoader: Undefined geometry",f),t[f]}function c(f){if(void 0!==f){if(Array.isArray(f)){const h=[];for(let m=0,p=f.length;m<p;m++){const g=f[m];void 0===i[g]&&console.warn("THREE.ObjectLoader: Undefined material",g),h.push(i[g])}return h}return void 0===i[f]&&console.warn("THREE.ObjectLoader: Undefined material",f),i[f]}}function l(f){return void 0===r[f]&&console.warn("THREE.ObjectLoader: Undefined texture",f),r[f]}switch(e.type){case"Scene":o=new bp,void 0!==e.background&&(o.background=Number.isInteger(e.background)?new De(e.background):l(e.background)),void 0!==e.environment&&(o.environment=l(e.environment)),void 0!==e.fog&&("Fog"===e.fog.type?o.fog=new xp(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(o.fog=new vp(e.fog.color,e.fog.density))),void 0!==e.backgroundBlurriness&&(o.backgroundBlurriness=e.backgroundBlurriness),void 0!==e.backgroundIntensity&&(o.backgroundIntensity=e.backgroundIntensity);break;case"PerspectiveCamera":o=new di(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(o.focus=e.focus),void 0!==e.zoom&&(o.zoom=e.zoom),void 0!==e.filmGauge&&(o.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(o.filmOffset=e.filmOffset),void 0!==e.view&&(o.view=Object.assign({},e.view));break;case"OrthographicCamera":o=new nl(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(o.zoom=e.zoom),void 0!==e.view&&(o.view=Object.assign({},e.view));break;case"AmbientLight":o=new VA(e.color,e.intensity);break;case"DirectionalLight":o=new x0(e.color,e.intensity);break;case"PointLight":o=new v0(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":o=new zA(e.color,e.intensity,e.width,e.height);break;case"SpotLight":o=new y0(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":o=new FA(e.color,e.groundColor,e.intensity);break;case"LightProbe":o=(new zp).fromJSON(e);break;case"SkinnedMesh":u=a(e.geometry),d=c(e.material),o=new Gv(u,d),void 0!==e.bindMode&&(o.bindMode=e.bindMode),void 0!==e.bindMatrix&&o.bindMatrix.fromArray(e.bindMatrix),void 0!==e.skeleton&&(o.skeleton=e.skeleton);break;case"Mesh":u=a(e.geometry),d=c(e.material),o=new yi(u,d);break;case"InstancedMesh":u=a(e.geometry),d=c(e.material);const h=e.instanceMatrix,m=e.instanceColor;o=new Wv(u,d,e.count),o.instanceMatrix=new dl(new Float32Array(h.array),16),void 0!==m&&(o.instanceColor=new dl(new Float32Array(m.array),m.itemSize));break;case"LOD":o=new jC;break;case"Line":o=new to(a(e.geometry),c(e.material));break;case"LineLoop":o=new $v(a(e.geometry),c(e.material));break;case"LineSegments":o=new is(a(e.geometry),c(e.material));break;case"PointCloud":case"Points":o=new Zv(a(e.geometry),c(e.material));break;case"Sprite":o=new GC(c(e.material));break;case"Group":o=new eo;break;case"Bone":o=new Tp;break;default:o=new _n}if(o.uuid=e.uuid,void 0!==e.name&&(o.name=e.name),void 0!==e.matrix?(o.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(o.matrixAutoUpdate=e.matrixAutoUpdate),o.matrixAutoUpdate&&o.matrix.decompose(o.position,o.quaternion,o.scale)):(void 0!==e.position&&o.position.fromArray(e.position),void 0!==e.rotation&&o.rotation.fromArray(e.rotation),void 0!==e.quaternion&&o.quaternion.fromArray(e.quaternion),void 0!==e.scale&&o.scale.fromArray(e.scale)),void 0!==e.castShadow&&(o.castShadow=e.castShadow),void 0!==e.receiveShadow&&(o.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.bias&&(o.shadow.bias=e.shadow.bias),void 0!==e.shadow.normalBias&&(o.shadow.normalBias=e.shadow.normalBias),void 0!==e.shadow.radius&&(o.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&o.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(o.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(o.visible=e.visible),void 0!==e.frustumCulled&&(o.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(o.renderOrder=e.renderOrder),void 0!==e.userData&&(o.userData=e.userData),void 0!==e.layers&&(o.layers.mask=e.layers),void 0!==e.children){const f=e.children;for(let h=0;h<f.length;h++)o.add(this.parseObject(f[h],t,i,r,s))}if(void 0!==e.animations){const f=e.animations;for(let h=0;h<f.length;h++)o.animations.push(s[f[h]])}if("LOD"===e.type){void 0!==e.autoUpdate&&(o.autoUpdate=e.autoUpdate);const f=e.levels;for(let h=0;h<f.length;h++){const m=f[h],p=o.getObjectByProperty("uuid",m.object);void 0!==p&&o.addLevel(p,m.distance,m.hysteresis)}}return o}bindSkeletons(e,t){0!==Object.keys(t).length&&e.traverse(function(i){if(!0===i.isSkinnedMesh&&void 0!==i.skeleton){const r=t[i.skeleton];void 0===r?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",i.skeleton):i.bind(r,i.bindMatrix)}})}}const m5={UVMapping:Oh,CubeReflectionMapping:yo,CubeRefractionMapping:_o,EquirectangularReflectionMapping:Uu,EquirectangularRefractionMapping:Vu,CubeUVReflectionMapping:Nc},jA={RepeatWrapping:vo,ClampToEdgeWrapping:Ei,MirroredRepeatWrapping:Oc},$A={NearestFilter:Hn,NearestMipmapNearestFilter:zu,NearestMipmapLinearFilter:Fc,LinearFilter:Fn,LinearMipmapNearestFilter:Fh,LinearMipmapLinearFilter:Ms};class qA extends rr{constructor(e){super(e),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,i,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,o=Ma.get(e);if(void 0!==o)return s.manager.itemStart(e),setTimeout(function(){t&&t(o),s.manager.itemEnd(e)},0),o;const a={};a.credentials="anonymous"===this.crossOrigin?"same-origin":"include",a.headers=this.requestHeader,fetch(e,a).then(function(c){return c.blob()}).then(function(c){return createImageBitmap(c,Object.assign(s.options,{colorSpaceConversion:"none"}))}).then(function(c){Ma.add(e,c),t&&t(c),s.manager.itemEnd(e)}).catch(function(c){r&&r(c),s.manager.itemError(e),s.manager.itemEnd(e)}),s.manager.itemStart(e)}}let Gp;class b0{static getContext(){return void 0===Gp&&(Gp=new(window.AudioContext||window.webkitAudioContext)),Gp}static setContext(e){Gp=e}}class g5 extends rr{constructor(e){super(e)}load(e,t,i,r){const s=this,o=new os(this.manager);o.setResponseType("arraybuffer"),o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(a){try{const c=a.slice(0);b0.getContext().decodeAudioData(c,function(u){t(u)})}catch(c){r?r(c):console.error(c),s.manager.itemError(e)}},i,r)}}class y5 extends zp{constructor(e,t,i=1){super(void 0,i),this.isHemisphereLightProbe=!0;const r=(new De).set(e),s=(new De).set(t),o=new T(r.r,r.g,r.b),a=new T(s.r,s.g,s.b),c=Math.sqrt(Math.PI),l=c*Math.sqrt(.75);this.sh.coefficients[0].copy(o).add(a).multiplyScalar(c),this.sh.coefficients[1].copy(o).sub(a).multiplyScalar(l)}}class _5 extends zp{constructor(e,t=1){super(void 0,t),this.isAmbientLightProbe=!0;const i=(new De).set(e);this.sh.coefficients[0].set(i.r,i.g,i.b).multiplyScalar(2*Math.sqrt(Math.PI))}}const ZA=new pt,XA=new pt,Sa=new pt;class v5{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new di,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new di,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep,Sa.copy(e.projectionMatrix);const r=t.eyeSep/2,s=r*t.near/t.focus,o=t.near*Math.tan(ca*t.fov*.5)/t.zoom;let a,c;XA.elements[12]=-r,ZA.elements[12]=r,a=-o*t.aspect+s,c=o*t.aspect+s,Sa.elements[0]=2*t.near/(c-a),Sa.elements[8]=(c+a)/(c-a),this.cameraL.projectionMatrix.copy(Sa),a=-o*t.aspect-s,c=o*t.aspect-s,Sa.elements[0]=2*t.near/(c-a),Sa.elements[8]=(c+a)/(c-a),this.cameraR.projectionMatrix.copy(Sa)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(XA),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(ZA)}}class w0{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=YA(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=YA();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function YA(){return(typeof performance>"u"?Date:performance).now()}const Ea=new T,KA=new Li,x5=new T,Ta=new T;class b5 extends _n{constructor(){super(),this.type="AudioListener",this.context=b0.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new w0}getInput(){return this.gain}removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const t=this.context.listener,i=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Ea,KA,x5),Ta.set(0,0,-1).applyQuaternion(KA),t.positionX){const r=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(Ea.x,r),t.positionY.linearRampToValueAtTime(Ea.y,r),t.positionZ.linearRampToValueAtTime(Ea.z,r),t.forwardX.linearRampToValueAtTime(Ta.x,r),t.forwardY.linearRampToValueAtTime(Ta.y,r),t.forwardZ.linearRampToValueAtTime(Ta.z,r),t.upX.linearRampToValueAtTime(i.x,r),t.upY.linearRampToValueAtTime(i.y,r),t.upZ.linearRampToValueAtTime(i.z,r)}else t.setPosition(Ea.x,Ea.y,Ea.z),t.setOrientation(Ta.x,Ta.y,Ta.z,i.x,i.y,i.z)}}class JA extends _n{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(e){return e||(e=[]),!0===this._connected?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}const Da=new T,QA=new Li,w5=new T,Ca=new T;class M5 extends JA{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,i){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=i,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),!0===this.hasPlaybackControl&&!1===this.isPlaying)return;this.matrixWorld.decompose(Da,QA,w5),Ca.set(0,0,1).applyQuaternion(QA);const t=this.panner;if(t.positionX){const i=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(Da.x,i),t.positionY.linearRampToValueAtTime(Da.y,i),t.positionZ.linearRampToValueAtTime(Da.z,i),t.orientationX.linearRampToValueAtTime(Ca.x,i),t.orientationY.linearRampToValueAtTime(Ca.y,i),t.orientationZ.linearRampToValueAtTime(Ca.z,i)}else t.setPosition(Da.x,Da.y,Da.z),t.setOrientation(Ca.x,Ca.y,Ca.z)}}class S5{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const t=this.getFrequencyData();for(let i=0;i<t.length;i++)e+=t[i];return e/t.length}}class e1{constructor(e,t,i){let r,s,o;switch(this.binding=e,this.valueSize=i,t){case"quaternion":r=this._slerp,s=this._slerpAdditive,o=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*i),this._workIndex=5;break;case"string":case"bool":r=this._select,s=this._select,o=this._setAdditiveIdentityOther,this.buffer=new Array(5*i);break;default:r=this._lerp,s=this._lerpAdditive,o=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*i)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=s,this._setIdentity=o,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const i=this.buffer,r=this.valueSize,s=e*r+r;let o=this.cumulativeWeight;if(0===o){for(let a=0;a!==r;++a)i[s+a]=i[a];o=t}else o+=t,this._mixBufferRegion(i,s,0,t/o,r);this.cumulativeWeight=o}accumulateAdditive(e){const t=this.buffer,i=this.valueSize,r=i*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,r,0,e,i),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,i=this.buffer,r=e*t+t,s=this.cumulativeWeight,o=this.cumulativeWeightAdditive,a=this.binding;this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,s<1&&this._mixBufferRegion(i,r,t*this._origIndex,1-s,t),o>0&&this._mixBufferRegionAdditive(i,r,this._addIndex*t,1,t);for(let c=t,l=t+t;c!==l;++c)if(i[c]!==i[c+t]){a.setValue(i,r);break}}saveOriginalState(){const t=this.buffer,i=this.valueSize,r=i*this._origIndex;this.binding.getValue(t,r);for(let s=i,o=r;s!==o;++s)t[s]=t[r+s%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){this.binding.setValue(this.buffer,3*this.valueSize)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let i=e;i<t;i++)this.buffer[i]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[t+i]=this.buffer[e+i]}_select(e,t,i,r,s){if(r>=.5)for(let o=0;o!==s;++o)e[t+o]=e[i+o]}_slerp(e,t,i,r){Li.slerpFlat(e,t,e,t,e,i,r)}_slerpAdditive(e,t,i,r,s){const o=this._workIndex*s;Li.multiplyQuaternionsFlat(e,o,e,t,e,i),Li.slerpFlat(e,t,e,t,e,o,r)}_lerp(e,t,i,r,s){const o=1-r;for(let a=0;a!==s;++a){const c=t+a;e[c]=e[c]*o+e[i+a]*r}}_lerpAdditive(e,t,i,r,s){for(let o=0;o!==s;++o){const a=t+o;e[a]=e[a]+e[i+o]*r}}}const M0="\\[\\]\\.:\\/",E5=new RegExp("["+M0+"]","g"),S0="[^"+M0+"]",T5="[^"+M0.replace("\\.","")+"]",R5=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",S0)+/(WCOD+)?/.source.replace("WCOD",T5)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",S0)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",S0)+"$"),P5=["material","materials","bones","map"];class L5{constructor(e,t,i){const r=i||vn.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}getValue(e,t){this.bind();const r=this._bindings[this._targetGroup.nCachedObjects_];void 0!==r&&r.getValue(e,t)}setValue(e,t){const i=this._bindings;for(let r=this._targetGroup.nCachedObjects_,s=i.length;r!==s;++r)i[r].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}}let vn=(()=>{class n{constructor(t,i,r){this.path=i,this.parsedPath=r||n.parseTrackName(i),this.node=n.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,i,r){return t&&t.isAnimationObjectGroup?new n.Composite(t,i,r):new n(t,i,r)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(E5,"")}static parseTrackName(t){const i=R5.exec(t);if(null===i)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const r={nodeName:i[2],objectName:i[3],objectIndex:i[4],propertyName:i[5],propertyIndex:i[6]},s=r.nodeName&&r.nodeName.lastIndexOf(".");if(void 0!==s&&-1!==s){const o=r.nodeName.substring(s+1);-1!==P5.indexOf(o)&&(r.nodeName=r.nodeName.substring(0,s),r.objectName=o)}if(null===r.propertyName||0===r.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return r}static findNode(t,i){if(void 0===i||""===i||"."===i||-1===i||i===t.name||i===t.uuid)return t;if(t.skeleton){const r=t.skeleton.getBoneByName(i);if(void 0!==r)return r}if(t.children){const r=function(o){for(let a=0;a<o.length;a++){const c=o[a];if(c.name===i||c.uuid===i)return c;const l=r(c.children);if(l)return l}return null},s=r(t.children);if(s)return s}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,i){t[i]=this.targetObject[this.propertyName]}_getValue_array(t,i){const r=this.resolvedProperty;for(let s=0,o=r.length;s!==o;++s)t[i++]=r[s]}_getValue_arrayElement(t,i){t[i]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,i){this.resolvedProperty.toArray(t,i)}_setValue_direct(t,i){this.targetObject[this.propertyName]=t[i]}_setValue_direct_setNeedsUpdate(t,i){this.targetObject[this.propertyName]=t[i],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,i){this.targetObject[this.propertyName]=t[i],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,i){const r=this.resolvedProperty;for(let s=0,o=r.length;s!==o;++s)r[s]=t[i++]}_setValue_array_setNeedsUpdate(t,i){const r=this.resolvedProperty;for(let s=0,o=r.length;s!==o;++s)r[s]=t[i++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,i){const r=this.resolvedProperty;for(let s=0,o=r.length;s!==o;++s)r[s]=t[i++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,i){this.resolvedProperty[this.propertyIndex]=t[i]}_setValue_arrayElement_setNeedsUpdate(t,i){this.resolvedProperty[this.propertyIndex]=t[i],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,i){this.resolvedProperty[this.propertyIndex]=t[i],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,i){this.resolvedProperty.fromArray(t,i)}_setValue_fromArray_setNeedsUpdate(t,i){this.resolvedProperty.fromArray(t,i),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,i){this.resolvedProperty.fromArray(t,i),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,i){this.bind(),this.getValue(t,i)}_setValue_unbound(t,i){this.bind(),this.setValue(t,i)}bind(){let t=this.node;const i=this.parsedPath,r=i.objectName,s=i.propertyName;let o=i.propertyIndex;if(t||(t=n.findNode(this.rootNode,i.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(r){let u=i.objectIndex;switch(r){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(let d=0;d<t.length;d++)if(t[d].name===u){u=d;break}break;case"map":if("map"in t){t=t.map;break}if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);t=t.material.map;break;default:if(void 0===t[r])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[r]}if(void 0!==u){if(void 0===t[u])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[u]}}const a=t[s];if(void 0===a)return void console.error("THREE.PropertyBinding: Trying to update property for track: "+i.nodeName+"."+s+" but it wasn't found.",t);let c=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?c=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(c=this.Versioning.MatrixWorldNeedsUpdate);let l=this.BindingType.Direct;if(void 0!==o){if("morphTargetInfluences"===s){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[o]&&(o=t.morphTargetDictionary[o])}l=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=o}else void 0!==a.fromArray&&void 0!==a.toArray?(l=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(l=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=s;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][c]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}return n.Composite=L5,n})();vn.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},vn.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},vn.prototype.GetterByBindingType=[vn.prototype._getValue_direct,vn.prototype._getValue_array,vn.prototype._getValue_arrayElement,vn.prototype._getValue_toArray],vn.prototype.SetterByBindingTypeAndVersioning=[[vn.prototype._setValue_direct,vn.prototype._setValue_direct_setNeedsUpdate,vn.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[vn.prototype._setValue_array,vn.prototype._setValue_array_setNeedsUpdate,vn.prototype._setValue_array_setMatrixWorldNeedsUpdate],[vn.prototype._setValue_arrayElement,vn.prototype._setValue_arrayElement_setNeedsUpdate,vn.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[vn.prototype._setValue_fromArray,vn.prototype._setValue_fromArray_setNeedsUpdate,vn.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class N5{constructor(){this.isAnimationObjectGroup=!0,this.uuid=fr(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let i=0,r=arguments.length;i!==r;++i)e[arguments[i].uuid]=i;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){const e=this._objects,t=this._indicesByUUID,i=this._paths,r=this._parsedPaths,s=this._bindings,o=s.length;let a,c=e.length,l=this.nCachedObjects_;for(let u=0,d=arguments.length;u!==d;++u){const f=arguments[u],h=f.uuid;let m=t[h];if(void 0===m){m=c++,t[h]=m,e.push(f);for(let p=0,g=o;p!==g;++p)s[p].push(new vn(f,i[p],r[p]))}else if(m<l){a=e[m];const p=--l,g=e[p];t[g.uuid]=m,e[m]=g,t[h]=p,e[p]=f;for(let _=0,v=o;_!==v;++_){const y=s[_];let w=y[m];y[m]=y[p],void 0===w&&(w=new vn(f,i[_],r[_])),y[p]=w}}else e[m]!==a&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=l}remove(){const e=this._objects,t=this._indicesByUUID,i=this._bindings,r=i.length;let s=this.nCachedObjects_;for(let o=0,a=arguments.length;o!==a;++o){const c=arguments[o],l=c.uuid,u=t[l];if(void 0!==u&&u>=s){const d=s++,f=e[d];t[f.uuid]=u,e[u]=f,t[l]=d,e[d]=c;for(let h=0,m=r;h!==m;++h){const p=i[h],_=p[u];p[u]=p[d],p[d]=_}}}this.nCachedObjects_=s}uncache(){const e=this._objects,t=this._indicesByUUID,i=this._bindings,r=i.length;let s=this.nCachedObjects_,o=e.length;for(let a=0,c=arguments.length;a!==c;++a){const u=arguments[a].uuid,d=t[u];if(void 0!==d)if(delete t[u],d<s){const f=--s,h=e[f],m=--o,p=e[m];t[h.uuid]=d,e[d]=h,t[p.uuid]=f,e[f]=p,e.pop();for(let g=0,_=r;g!==_;++g){const v=i[g],x=v[m];v[d]=v[f],v[f]=x,v.pop()}}else{const f=--o,h=e[f];f>0&&(t[h.uuid]=d),e[d]=h,e.pop();for(let m=0,p=r;m!==p;++m){const g=i[m];g[d]=g[f],g.pop()}}}this.nCachedObjects_=s}subscribe_(e,t){const i=this._bindingsIndicesByPath;let r=i[e];const s=this._bindings;if(void 0!==r)return s[r];const o=this._paths,a=this._parsedPaths,c=this._objects,u=this.nCachedObjects_,d=new Array(c.length);r=s.length,i[e]=r,o.push(e),a.push(t),s.push(d);for(let f=u,h=c.length;f!==h;++f)d[f]=new vn(c[f],e,t);return d}unsubscribe_(e){const t=this._bindingsIndicesByPath,i=t[e];if(void 0!==i){const r=this._paths,s=this._parsedPaths,o=this._bindings,a=o.length-1,c=o[a];t[e[a]]=i,o[i]=c,o.pop(),s[i]=s[a],s.pop(),r[i]=r[a],r.pop()}}}class O5{constructor(e,t,i=null,r=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=i,this.blendMode=r;const s=t.tracks,o=s.length,a=new Array(o),c={endingStart:oa,endingEnd:oa};for(let l=0;l!==o;++l){const u=s[l].createInterpolant(null);a[l]=u,u.settings=c}this._interpolantSettings=c,this._interpolants=a,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=BD,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,i){if(e.fadeOut(t),this.fadeIn(t),i){const r=this._clip.duration,s=e._clip.duration,a=r/s;e.warp(1,s/r,t),this.warp(a,1,t)}return this}crossFadeTo(e,t,i){return e.crossFadeFrom(this,t,i)}stopFading(){const e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,i){const r=this._mixer,s=r.time,o=this.timeScale;let a=this._timeScaleInterpolant;null===a&&(a=r._lendControlInterpolant(),this._timeScaleInterpolant=a);const c=a.parameterPositions,l=a.sampleValues;return c[0]=s,c[1]=s+i,l[0]=e/o,l[1]=t/o,this}stopWarping(){const e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,i,r){if(!this.enabled)return void this._updateWeight(e);const s=this._startTime;if(null!==s){const c=(e-s)*i;c<0||0===i?t=0:(this._startTime=null,t=i*c)}t*=this._updateTimeScale(e);const o=this._updateTime(t),a=this._updateWeight(e);if(a>0){const c=this._interpolants,l=this._propertyBindings;if(this.blendMode===nv)for(let u=0,d=c.length;u!==d;++u)c[u].evaluate(o),l[u].accumulateAdditive(a);else for(let u=0,d=c.length;u!==d;++u)c[u].evaluate(o),l[u].accumulate(r,a)}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const i=this._weightInterpolant;if(null!==i){const r=i.evaluate(e)[0];t*=r,e>i.parameterPositions[1]&&(this.stopFading(),0===r&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const i=this._timeScaleInterpolant;null!==i&&(t*=i.evaluate(e)[0],e>i.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t))}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,i=this.loop;let r=this.time+e,s=this._loopCount;const o=i===UD;if(0===e)return-1===s?r:o&&1==(1&s)?t-r:r;if(i===kD){-1===s&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(r>=t)r=t;else{if(!(r<0)){this.time=r;break e}r=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===s&&(e>=0?(s=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),r>=t||r<0){const a=Math.floor(r/t);r-=t*a,s+=Math.abs(a);const c=this.repetitions-s;if(c<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=e>0?t:0,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===c){const l=e<0;this._setEndings(l,!l,o)}else this._setEndings(!1,!1,o);this._loopCount=s,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a})}}else this.time=r;if(o&&1==(1&s))return t-r}return r}_setEndings(e,t,i){const r=this._interpolantSettings;i?(r.endingStart=aa,r.endingEnd=aa):(r.endingStart=e?this.zeroSlopeAtStart?aa:oa:Hu,r.endingEnd=t?this.zeroSlopeAtEnd?aa:oa:Hu)}_scheduleFading(e,t,i){const r=this._mixer,s=r.time;let o=this._weightInterpolant;null===o&&(o=r._lendControlInterpolant(),this._weightInterpolant=o);const a=o.parameterPositions,c=o.sampleValues;return a[0]=s,c[0]=t,a[1]=s+e,c[1]=i,this}}const F5=new Float32Array(1);class k5 extends qs{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const i=e._localRoot||this._root,r=e._clip.tracks,s=r.length,o=e._propertyBindings,a=e._interpolants,c=i.uuid,l=this._bindingsByRootAndName;let u=l[c];void 0===u&&(u={},l[c]=u);for(let d=0;d!==s;++d){const f=r[d],h=f.name;let m=u[h];if(void 0!==m)++m.referenceCount,o[d]=m;else{if(m=o[d],void 0!==m){null===m._cacheIndex&&(++m.referenceCount,this._addInactiveBinding(m,c,h));continue}m=new e1(vn.create(i,h,t&&t._propertyBindings[d].binding.parsedPath),f.ValueTypeName,f.getValueSize()),++m.referenceCount,this._addInactiveBinding(m,c,h),o[d]=m}a[d].resultBuffer=m.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){const i=(e._localRoot||this._root).uuid,r=e._clip.uuid,s=this._actionsByClip[r];this._bindAction(e,s&&s.knownActions[0]),this._addInactiveAction(e,r,i)}const t=e._propertyBindings;for(let i=0,r=t.length;i!==r;++i){const s=t[i];0==s.useCount++&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let i=0,r=t.length;i!==r;++i){const s=t[i];0==--s.useCount&&(s.restoreOriginalState(),this._takeBackBinding(s))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return null!==t&&t<this._nActiveActions}_addInactiveAction(e,t,i){const r=this._actions,s=this._actionsByClip;let o=s[t];if(void 0===o)o={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,s[t]=o;else{const a=o.knownActions;e._byClipCacheIndex=a.length,a.push(e)}e._cacheIndex=r.length,r.push(e),o.actionByRoot[i]=e}_removeInactiveAction(e){const t=this._actions,i=t[t.length-1],r=e._cacheIndex;i._cacheIndex=r,t[r]=i,t.pop(),e._cacheIndex=null;const s=e._clip.uuid,o=this._actionsByClip,a=o[s],c=a.knownActions,l=c[c.length-1],u=e._byClipCacheIndex;l._byClipCacheIndex=u,c[u]=l,c.pop(),e._byClipCacheIndex=null,delete a.actionByRoot[(e._localRoot||this._root).uuid],0===c.length&&delete o[s],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let i=0,r=t.length;i!==r;++i){const s=t[i];0==--s.referenceCount&&this._removeInactiveBinding(s)}}_lendAction(e){const t=this._actions,i=e._cacheIndex,r=this._nActiveActions++,s=t[r];e._cacheIndex=r,t[r]=e,s._cacheIndex=i,t[i]=s}_takeBackAction(e){const t=this._actions,i=e._cacheIndex,r=--this._nActiveActions,s=t[r];e._cacheIndex=r,t[r]=e,s._cacheIndex=i,t[i]=s}_addInactiveBinding(e,t,i){const r=this._bindingsByRootAndName,s=this._bindings;let o=r[t];void 0===o&&(o={},r[t]=o),o[i]=e,e._cacheIndex=s.length,s.push(e)}_removeInactiveBinding(e){const t=this._bindings,i=e.binding,r=i.rootNode.uuid,s=i.path,o=this._bindingsByRootAndName,a=o[r],c=t[t.length-1],l=e._cacheIndex;c._cacheIndex=l,t[l]=c,t.pop(),delete a[s],0===Object.keys(a).length&&delete o[r]}_lendBinding(e){const t=this._bindings,i=e._cacheIndex,r=this._nActiveBindings++,s=t[r];e._cacheIndex=r,t[r]=e,s._cacheIndex=i,t[i]=s}_takeBackBinding(e){const t=this._bindings,i=e._cacheIndex,r=--this._nActiveBindings,s=t[r];e._cacheIndex=r,t[r]=e,s._cacheIndex=i,t[i]=s}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let i=e[t];return void 0===i&&(i=new f0(new Float32Array(2),new Float32Array(2),1,F5),i.__cacheIndex=t,e[t]=i),i}_takeBackControlInterpolant(e){const t=this._controlInterpolants,i=e.__cacheIndex,r=--this._nActiveControlInterpolants,s=t[r];e.__cacheIndex=r,t[r]=e,s.__cacheIndex=i,t[i]=s}clipAction(e,t,i){const r=t||this._root,s=r.uuid;let o="string"==typeof e?vl.findByName(r,e):e;const a=null!==o?o.uuid:e,c=this._actionsByClip[a];let l=null;if(void 0===i&&(i=null!==o?o.blendMode:Gh),void 0!==c){const d=c.actionByRoot[s];if(void 0!==d&&d.blendMode===i)return d;l=c.knownActions[0],null===o&&(o=l._clip)}if(null===o)return null;const u=new O5(this,o,t,i);return this._bindAction(u,l),this._addInactiveAction(u,a,s),u}existingAction(e,t){const i=t||this._root,r=i.uuid,s="string"==typeof e?vl.findByName(i,e):e,a=this._actionsByClip[s?s.uuid:e];return void 0!==a&&a.actionByRoot[r]||null}stopAllAction(){const e=this._actions;for(let i=this._nActiveActions-1;i>=0;--i)e[i].stop();return this}update(e){const t=this._actions,i=this._nActiveActions,r=this.time+=e*=this.timeScale,s=Math.sign(e),o=this._accuIndex^=1;for(let l=0;l!==i;++l)t[l]._update(r,e,s,o);const a=this._bindings,c=this._nActiveBindings;for(let l=0;l!==c;++l)a[l].apply(o);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,i=e.uuid,r=this._actionsByClip,s=r[i];if(void 0!==s){const o=s.knownActions;for(let a=0,c=o.length;a!==c;++a){const l=o[a];this._deactivateAction(l);const u=l._cacheIndex,d=t[t.length-1];l._cacheIndex=null,l._byClipCacheIndex=null,d._cacheIndex=u,t[u]=d,t.pop(),this._removeInactiveBindingsForAction(l)}delete r[i]}}uncacheRoot(e){const t=e.uuid,i=this._actionsByClip;for(const o in i){const c=i[o].actionByRoot[t];void 0!==c&&(this._deactivateAction(c),this._removeInactiveAction(c))}const s=this._bindingsByRootAndName[t];if(void 0!==s)for(const o in s){const a=s[o];a.restoreOriginalState(),this._removeInactiveBinding(a)}}uncacheAction(e,t){const i=this.existingAction(e,t);null!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}}class E0{constructor(e){this.value=e}clone(){return new E0(void 0===this.value.clone?this.value:this.value.clone())}}let B5=0;class U5 extends qs{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:B5++}),this.name="",this.usage=Gu,this.uniforms=[]}add(e){return this.uniforms.push(e),this}remove(e){const t=this.uniforms.indexOf(e);return-1!==t&&this.uniforms.splice(t,1),this}setName(e){return this.name=e,this}setUsage(e){return this.usage=e,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(e){this.name=e.name,this.usage=e.usage;const t=e.uniforms;this.uniforms.length=0;for(let i=0,r=t.length;i<r;i++)this.uniforms.push(t[i].clone());return this}clone(){return(new this.constructor).copy(this)}}class V5 extends id{constructor(e,t,i=1){super(e,t),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}class z5{constructor(e,t,i,r,s){this.isGLBufferAttribute=!0,this.name="",this.buffer=e,this.type=t,this.itemSize=i,this.elementSize=r,this.count=s,this.version=0}set needsUpdate(e){!0===e&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}class T0{constructor(e,t,i=0,r=1/0){this.ray=new Xu(e,t),this.near=i,this.far=r,this.camera=null,this.layers=new pa,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!0,i=[]){return D0(e,this,i,t),i.sort(t1),i}intersectObjects(e,t=!0,i=[]){for(let r=0,s=e.length;r<s;r++)D0(e[r],this,i,t);return i.sort(t1),i}}function t1(n,e){return n.distance-e.distance}function D0(n,e,t,i){if(n.layers.test(e.layers)&&n.raycast(e,t),!0===i){const r=n.children;for(let s=0,o=r.length;s<o;s++)D0(r[s],e,t,!0)}}class H5{constructor(e=1,t=0,i=0){return this.radius=e,this.phi=t,this.theta=i,this}set(e,t,i){return this.radius=e,this.phi=t,this.theta=i,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+t*t+i*i),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,i),this.phi=Math.acos(Zn(t/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}}class G5{constructor(e=1,t=0,i=0){return this.radius=e,this.theta=t,this.y=i,this}set(e,t,i){return this.radius=e,this.theta=t,this.y=i,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+i*i),this.theta=Math.atan2(e,i),this.y=t,this}clone(){return(new this.constructor).copy(this)}}const n1=new ce;class W5{constructor(e=new ce(1/0,1/0),t=new ce(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=n1.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return n1.copy(e).clamp(this.min,this.max).sub(e).length()}intersect(e){return this.min.max(e.min),this.max.min(e.max),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const i1=new T,Wp=new T;class j5{constructor(e=new T,t=new T){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){i1.subVectors(e,this.start),Wp.subVectors(this.end,this.start);const i=Wp.dot(Wp);let s=Wp.dot(i1)/i;return t&&(s=Zn(s,0,1)),s}closestPointToPoint(e,t,i){const r=this.closestPointToPointParameter(e,t);return this.delta(i).multiplyScalar(r).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}}const r1=new T;class $5 extends _n{constructor(e,t){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t,this.type="SpotLightHelper";const i=new Pt,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let o=0,a=1,c=32;o<c;o++,a++){const l=o/c*Math.PI*2,u=a/c*Math.PI*2;r.push(Math.cos(l),Math.sin(l),1,Math.cos(u),Math.sin(u),1)}i.setAttribute("position",new Ve(r,3));const s=new Ni({fog:!1,toneMapped:!1});this.cone=new is(i,s),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1);const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),r1.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(r1),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const Oo=new T,jp=new pt,C0=new pt;class q5 extends is{constructor(e){const t=s1(e),i=new Pt,r=[],s=[],o=new De(0,0,1),a=new De(0,1,0);for(let l=0;l<t.length;l++){const u=t[l];u.parent&&u.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),s.push(o.r,o.g,o.b),s.push(a.r,a.g,a.b))}i.setAttribute("position",new Ve(r,3)),i.setAttribute("color",new Ve(s,3)),super(i,new Ni({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const t=this.bones,i=this.geometry,r=i.getAttribute("position");C0.copy(this.root.matrixWorld).invert();for(let s=0,o=0;s<t.length;s++){const a=t[s];a.parent&&a.parent.isBone&&(jp.multiplyMatrices(C0,a.matrixWorld),Oo.setFromMatrixPosition(jp),r.setXYZ(o,Oo.x,Oo.y,Oo.z),jp.multiplyMatrices(C0,a.parent.matrixWorld),Oo.setFromMatrixPosition(jp),r.setXYZ(o+1,Oo.x,Oo.y,Oo.z),o+=2)}i.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose()}}function s1(n){const e=[];!0===n.isBone&&e.push(n);for(let t=0;t<n.children.length;t++)e.push.apply(e,s1(n.children[t]));return e}class Z5 extends yi{constructor(e,t,i){super(new ml(t,4,2),new pr({wireframe:!0,fog:!1,toneMapped:!1})),this.light=e,this.color=i,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const X5=new T,o1=new De,a1=new De;class Y5 extends _n{constructor(e,t,i){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,this.type="HemisphereLightHelper";const r=new pl(t);r.rotateY(.5*Math.PI),this.material=new pr({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);const s=r.getAttribute("position"),o=new Float32Array(3*s.count);r.setAttribute("color",new an(o,3)),this.add(new yi(r,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{const t=e.geometry.getAttribute("color");o1.copy(this.light.color),a1.copy(this.light.groundColor);for(let i=0,r=t.count;i<r;i++){const s=i<r/2?o1:a1;t.setXYZ(i,s.r,s.g,s.b)}t.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),e.lookAt(X5.setFromMatrixPosition(this.light.matrixWorld).negate())}}class K5 extends is{constructor(e=10,t=10,i=4473924,r=8947848){i=new De(i),r=new De(r);const s=t/2,o=e/t,a=e/2,c=[],l=[];for(let f=0,h=0,m=-a;f<=t;f++,m+=o){c.push(-a,0,m,a,0,m),c.push(m,0,-a,m,0,a);const p=f===s?i:r;p.toArray(l,h),h+=3,p.toArray(l,h),h+=3,p.toArray(l,h),h+=3,p.toArray(l,h),h+=3}const u=new Pt;u.setAttribute("position",new Ve(c,3)),u.setAttribute("color",new Ve(l,3)),super(u,new Ni({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class J5 extends is{constructor(e=10,t=16,i=8,r=64,s=4473924,o=8947848){s=new De(s),o=new De(o);const a=[],c=[];if(t>1)for(let d=0;d<t;d++){const f=d/t*(2*Math.PI),h=Math.sin(f)*e,m=Math.cos(f)*e;a.push(0,0,0),a.push(h,0,m);const p=1&d?s:o;c.push(p.r,p.g,p.b),c.push(p.r,p.g,p.b)}for(let d=0;d<i;d++){const f=1&d?s:o,h=e-e/i*d;for(let m=0;m<r;m++){let p=m/r*(2*Math.PI),g=Math.sin(p)*h,_=Math.cos(p)*h;a.push(g,0,_),c.push(f.r,f.g,f.b),p=(m+1)/r*(2*Math.PI),g=Math.sin(p)*h,_=Math.cos(p)*h,a.push(g,0,_),c.push(f.r,f.g,f.b)}}const l=new Pt;l.setAttribute("position",new Ve(a,3)),l.setAttribute("color",new Ve(c,3)),super(l,new Ni({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const c1=new T,$p=new T,l1=new T;class Q5 extends _n{constructor(e,t,i){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,this.type="DirectionalLightHelper",void 0===t&&(t=1);let r=new Pt;r.setAttribute("position",new Ve([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const s=new Ni({fog:!1,toneMapped:!1});this.lightPlane=new to(r,s),this.add(this.lightPlane),r=new Pt,r.setAttribute("position",new Ve([0,0,0,0,0,1],3)),this.targetLine=new to(r,s),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),c1.setFromMatrixPosition(this.light.matrixWorld),$p.setFromMatrixPosition(this.light.target.matrixWorld),l1.subVectors($p,c1),this.lightPlane.lookAt($p),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt($p),this.targetLine.scale.z=l1.length()}}const qp=new T,Gn=new dp;class eW extends is{constructor(e){const t=new Pt,i=new Ni({color:16777215,vertexColors:!0,toneMapped:!1}),r=[],s=[],o={};function a(m,p){c(m),c(p)}function c(m){r.push(0,0,0),s.push(0,0,0),void 0===o[m]&&(o[m]=[]),o[m].push(r.length/3-1)}a("n1","n2"),a("n2","n4"),a("n4","n3"),a("n3","n1"),a("f1","f2"),a("f2","f4"),a("f4","f3"),a("f3","f1"),a("n1","f1"),a("n2","f2"),a("n3","f3"),a("n4","f4"),a("p","n1"),a("p","n2"),a("p","n3"),a("p","n4"),a("u1","u2"),a("u2","u3"),a("u3","u1"),a("c","t"),a("p","c"),a("cn1","cn2"),a("cn3","cn4"),a("cf1","cf2"),a("cf3","cf4"),t.setAttribute("position",new Ve(r,3)),t.setAttribute("color",new Ve(s,3)),super(t,i),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update();const l=new De(16755200),u=new De(16711680),d=new De(43775),f=new De(16777215),h=new De(3355443);this.setColors(l,u,d,f,h)}setColors(e,t,i,r,s){const a=this.geometry.getAttribute("color");a.setXYZ(0,e.r,e.g,e.b),a.setXYZ(1,e.r,e.g,e.b),a.setXYZ(2,e.r,e.g,e.b),a.setXYZ(3,e.r,e.g,e.b),a.setXYZ(4,e.r,e.g,e.b),a.setXYZ(5,e.r,e.g,e.b),a.setXYZ(6,e.r,e.g,e.b),a.setXYZ(7,e.r,e.g,e.b),a.setXYZ(8,e.r,e.g,e.b),a.setXYZ(9,e.r,e.g,e.b),a.setXYZ(10,e.r,e.g,e.b),a.setXYZ(11,e.r,e.g,e.b),a.setXYZ(12,e.r,e.g,e.b),a.setXYZ(13,e.r,e.g,e.b),a.setXYZ(14,e.r,e.g,e.b),a.setXYZ(15,e.r,e.g,e.b),a.setXYZ(16,e.r,e.g,e.b),a.setXYZ(17,e.r,e.g,e.b),a.setXYZ(18,e.r,e.g,e.b),a.setXYZ(19,e.r,e.g,e.b),a.setXYZ(20,e.r,e.g,e.b),a.setXYZ(21,e.r,e.g,e.b),a.setXYZ(22,e.r,e.g,e.b),a.setXYZ(23,e.r,e.g,e.b),a.setXYZ(24,t.r,t.g,t.b),a.setXYZ(25,t.r,t.g,t.b),a.setXYZ(26,t.r,t.g,t.b),a.setXYZ(27,t.r,t.g,t.b),a.setXYZ(28,t.r,t.g,t.b),a.setXYZ(29,t.r,t.g,t.b),a.setXYZ(30,t.r,t.g,t.b),a.setXYZ(31,t.r,t.g,t.b),a.setXYZ(32,i.r,i.g,i.b),a.setXYZ(33,i.r,i.g,i.b),a.setXYZ(34,i.r,i.g,i.b),a.setXYZ(35,i.r,i.g,i.b),a.setXYZ(36,i.r,i.g,i.b),a.setXYZ(37,i.r,i.g,i.b),a.setXYZ(38,r.r,r.g,r.b),a.setXYZ(39,r.r,r.g,r.b),a.setXYZ(40,s.r,s.g,s.b),a.setXYZ(41,s.r,s.g,s.b),a.setXYZ(42,s.r,s.g,s.b),a.setXYZ(43,s.r,s.g,s.b),a.setXYZ(44,s.r,s.g,s.b),a.setXYZ(45,s.r,s.g,s.b),a.setXYZ(46,s.r,s.g,s.b),a.setXYZ(47,s.r,s.g,s.b),a.setXYZ(48,s.r,s.g,s.b),a.setXYZ(49,s.r,s.g,s.b),a.needsUpdate=!0}update(){const e=this.geometry,t=this.pointMap;Gn.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Xn("c",t,e,Gn,0,0,-1),Xn("t",t,e,Gn,0,0,1),Xn("n1",t,e,Gn,-1,-1,-1),Xn("n2",t,e,Gn,1,-1,-1),Xn("n3",t,e,Gn,-1,1,-1),Xn("n4",t,e,Gn,1,1,-1),Xn("f1",t,e,Gn,-1,-1,1),Xn("f2",t,e,Gn,1,-1,1),Xn("f3",t,e,Gn,-1,1,1),Xn("f4",t,e,Gn,1,1,1),Xn("u1",t,e,Gn,.7,1.1,-1),Xn("u2",t,e,Gn,-.7,1.1,-1),Xn("u3",t,e,Gn,0,2,-1),Xn("cf1",t,e,Gn,-1,0,1),Xn("cf2",t,e,Gn,1,0,1),Xn("cf3",t,e,Gn,0,-1,1),Xn("cf4",t,e,Gn,0,1,1),Xn("cn1",t,e,Gn,-1,0,-1),Xn("cn2",t,e,Gn,1,0,-1),Xn("cn3",t,e,Gn,0,-1,-1),Xn("cn4",t,e,Gn,0,1,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function Xn(n,e,t,i,r,s,o){qp.set(r,s,o).unproject(i);const a=e[n];if(void 0!==a){const c=t.getAttribute("position");for(let l=0,u=a.length;l<u;l++)c.setXYZ(a[l],qp.x,qp.y,qp.z)}}const Zp=new So;class tW extends is{constructor(e,t=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Float32Array(24),s=new Pt;s.setIndex(new an(i,1)),s.setAttribute("position",new an(r,3)),super(s,new Ni({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(e){if(void 0!==e&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&Zp.setFromObject(this.object),Zp.isEmpty())return;const t=Zp.min,i=Zp.max,r=this.geometry.attributes.position,s=r.array;s[0]=i.x,s[1]=i.y,s[2]=i.z,s[3]=t.x,s[4]=i.y,s[5]=i.z,s[6]=t.x,s[7]=t.y,s[8]=i.z,s[9]=i.x,s[10]=t.y,s[11]=i.z,s[12]=i.x,s[13]=i.y,s[14]=t.z,s[15]=t.x,s[16]=i.y,s[17]=t.z,s[18]=t.x,s[19]=t.y,s[20]=t.z,s[21]=i.x,s[22]=t.y,s[23]=t.z,r.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e,t){return super.copy(e,t),this.object=e.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class nW extends is{constructor(e,t=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),s=new Pt;s.setIndex(new an(i,1)),s.setAttribute("position",new Ve([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(s,new Ni({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}}class iW extends to{constructor(e,t=1,i=16776960){const r=i,o=new Pt;o.setAttribute("position",new Ve([1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),o.computeBoundingSphere(),super(o,new Ni({color:r,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;const c=new Pt;c.setAttribute("position",new Ve([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),c.computeBoundingSphere(),this.add(new yi(c,new pr({color:r,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const u1=new T;let Xp,A0;class rW extends _n{constructor(e=new T(0,0,1),t=new T(0,0,0),i=1,r=16776960,s=.2*i,o=.2*s){super(),this.type="ArrowHelper",void 0===Xp&&(Xp=new Pt,Xp.setAttribute("position",new Ve([0,0,0,0,1,0],3)),A0=new ya(0,.5,1,5,1),A0.translate(0,-.5,0)),this.position.copy(t),this.line=new to(Xp,new Ni({color:r,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new yi(A0,new pr({color:r,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(i,s,o)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{u1.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(u1,t)}}setLength(e,t=.2*e,i=.2*t){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(i,t,i),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class sW extends is{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],r=new Pt;r.setAttribute("position",new Ve(t,3)),r.setAttribute("color",new Ve([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3)),super(r,new Ni({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(e,t,i){const r=new De,s=this.geometry.attributes.color.array;return r.set(e),r.toArray(s,0),r.toArray(s,3),r.set(t),r.toArray(s,6),r.toArray(s,9),r.set(i),r.toArray(s,12),r.toArray(s,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class oW{constructor(){this.type="ShapePath",this.color=new De,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new dd,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,i,r){return this.currentPath.quadraticCurveTo(e,t,i,r),this}bezierCurveTo(e,t,i,r,s,o){return this.currentPath.bezierCurveTo(e,t,i,r,s,o),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){function i(_,v){const y=v.length;let x=!1;for(let w=y-1,M=0;M<y;w=M++){let A=v[w],b=v[M],S=b.x-A.x,R=b.y-A.y;if(Math.abs(R)>Number.EPSILON){if(R<0&&(A=v[M],S=-S,b=v[w],R=-R),_.y<A.y||_.y>b.y)continue;if(_.y===A.y){if(_.x===A.x)return!0}else{const B=R*(_.x-A.x)-S*(_.y-A.y);if(0===B)return!0;if(B<0)continue;x=!x}}else{if(_.y!==A.y)continue;if(b.x<=_.x&&_.x<=A.x||A.x<=_.x&&_.x<=b.x)return!0}}return x}const r=Es.isClockWise,s=this.subPaths;if(0===s.length)return[];let o,a,c;const l=[];if(1===s.length)return a=s[0],c=new _a,c.curves=a.curves,l.push(c),l;let u=!r(s[0].getPoints());u=e?!u:u;const d=[],f=[];let p,g,h=[],m=0;f[m]=void 0,h[m]=[];for(let _=0,v=s.length;_<v;_++)a=s[_],p=a.getPoints(),o=r(p),o=e?!o:o,o?(!u&&f[m]&&m++,f[m]={s:new _a,p},f[m].s.curves=a.curves,u&&m++,h[m]=[]):h[m].push({h:a,p:p[0]});if(!f[0])return function t(_){const v=[];for(let y=0,x=_.length;y<x;y++){const w=_[y],M=new _a;M.curves=w.curves,v.push(M)}return v}(s);if(f.length>1){let _=!1,v=0;for(let y=0,x=f.length;y<x;y++)d[y]=[];for(let y=0,x=f.length;y<x;y++){const w=h[y];for(let M=0;M<w.length;M++){const A=w[M];let b=!0;for(let S=0;S<f.length;S++)i(A.p,f[S].p)&&(y!==S&&v++,b?(b=!1,d[S].push(A)):_=!0);b&&d[y].push(A)}}v>0&&!1===_&&(h=d)}for(let _=0,v=f.length;_<v;_++){c=f[_].s,l.push(c),g=h[_];for(let y=0,x=g.length;y<x;y++)c.holes.push(g[y].h)}return l}}const so=aW();function aW(){const n=new ArrayBuffer(4),e=new Float32Array(n),t=new Uint32Array(n),i=new Uint32Array(512),r=new Uint32Array(512);for(let c=0;c<256;++c){const l=c-127;l<-27?(i[c]=0,i[256|c]=32768,r[c]=24,r[256|c]=24):l<-14?(i[c]=1024>>-l-14,i[256|c]=1024>>-l-14|32768,r[c]=-l-1,r[256|c]=-l-1):l<=15?(i[c]=l+15<<10,i[256|c]=l+15<<10|32768,r[c]=13,r[256|c]=13):l<128?(i[c]=31744,i[256|c]=64512,r[c]=24,r[256|c]=24):(i[c]=31744,i[256|c]=64512,r[c]=13,r[256|c]=13)}const s=new Uint32Array(2048),o=new Uint32Array(64),a=new Uint32Array(64);for(let c=1;c<1024;++c){let l=c<<13,u=0;for(;!(8388608&l);)l<<=1,u-=8388608;l&=-8388609,u+=947912704,s[c]=l|u}for(let c=1024;c<2048;++c)s[c]=939524096+(c-1024<<13);for(let c=1;c<31;++c)o[c]=c<<23;o[31]=1199570944,o[32]=2147483648;for(let c=33;c<63;++c)o[c]=2147483648+(c-32<<23);o[63]=3347054592;for(let c=1;c<64;++c)32!==c&&(a[c]=1024);return{floatView:e,uint32View:t,baseTable:i,shiftTable:r,mantissaTable:s,exponentTable:o,offsetTable:a}}var uW=Object.freeze({__proto__:null,fromHalfFloat:function lW(n){const e=n>>10;return so.uint32View[0]=so.mantissaTable[so.offsetTable[e]+(1023&n)]+so.exponentTable[e],so.floatView[0]},toHalfFloat:function cW(n){Math.abs(n)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),n=Zn(n,-65504,65504),so.floatView[0]=n;const e=so.uint32View[0],t=e>>23&511;return so.baseTable[t]+((8388607&e)>>so.shiftTable[t])}});class dW extends Io{constructor(e,t,i,r,s,o){console.warn("THREE.BoxBufferGeometry has been renamed to THREE.BoxGeometry."),super(e,t,i,r,s,o)}}class fW extends fd{constructor(e,t,i,r){console.warn("THREE.CapsuleBufferGeometry has been renamed to THREE.CapsuleGeometry."),super(e,t,i,r)}}class hW extends hd{constructor(e,t,i,r){console.warn("THREE.CircleBufferGeometry has been renamed to THREE.CircleGeometry."),super(e,t,i,r)}}class pW extends pd{constructor(e,t,i,r,s,o,a){console.warn("THREE.ConeBufferGeometry has been renamed to THREE.ConeGeometry."),super(e,t,i,r,s,o,a)}}class mW extends ya{constructor(e,t,i,r,s,o,a,c){console.warn("THREE.CylinderBufferGeometry has been renamed to THREE.CylinderGeometry."),super(e,t,i,r,s,o,a,c)}}class gW extends md{constructor(e,t){console.warn("THREE.DodecahedronBufferGeometry has been renamed to THREE.DodecahedronGeometry."),super(e,t)}}class yW extends vd{constructor(e,t){console.warn("THREE.ExtrudeBufferGeometry has been renamed to THREE.ExtrudeGeometry."),super(e,t)}}class _W extends xd{constructor(e,t){console.warn("THREE.IcosahedronBufferGeometry has been renamed to THREE.IcosahedronGeometry."),super(e,t)}}class vW extends fl{constructor(e,t,i,r){console.warn("THREE.LatheBufferGeometry has been renamed to THREE.LatheGeometry."),super(e,t,i,r)}}class xW extends pl{constructor(e,t){console.warn("THREE.OctahedronBufferGeometry has been renamed to THREE.OctahedronGeometry."),super(e,t)}}class bW extends tl{constructor(e,t,i,r){console.warn("THREE.PlaneBufferGeometry has been renamed to THREE.PlaneGeometry."),super(e,t,i,r)}}class wW extends no{constructor(e,t,i,r){console.warn("THREE.PolyhedronBufferGeometry has been renamed to THREE.PolyhedronGeometry."),super(e,t,i,r)}}class MW extends bd{constructor(e,t,i,r,s,o){console.warn("THREE.RingBufferGeometry has been renamed to THREE.RingGeometry."),super(e,t,i,r,s,o)}}class SW extends wd{constructor(e,t){console.warn("THREE.ShapeBufferGeometry has been renamed to THREE.ShapeGeometry."),super(e,t)}}class EW extends ml{constructor(e,t,i,r,s,o,a){console.warn("THREE.SphereBufferGeometry has been renamed to THREE.SphereGeometry."),super(e,t,i,r,s,o,a)}}class TW extends Md{constructor(e,t){console.warn("THREE.TetrahedronBufferGeometry has been renamed to THREE.TetrahedronGeometry."),super(e,t)}}class DW extends Sd{constructor(e,t,i,r,s){console.warn("THREE.TorusBufferGeometry has been renamed to THREE.TorusGeometry."),super(e,t,i,r,s)}}class CW extends Ed{constructor(e,t,i,r,s,o){console.warn("THREE.TorusKnotBufferGeometry has been renamed to THREE.TorusKnotGeometry."),super(e,t,i,r,s,o)}}class AW extends Td{constructor(e,t,i,r,s){console.warn("THREE.TubeBufferGeometry has been renamed to THREE.TubeGeometry."),super(e,t,i,r,s)}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Lh}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Lh);const Yp=new class RW extends NT{}(class IW extends LT{constructor(e,t){super(e,t),this.scheduler=e,this.work=t}schedule(e,t=0){return t>0?super.schedule(e,t):(this.delay=t,this.state=e,this.scheduler.flush(this),this)}execute(e,t){return t>0||this.closed?super.execute(e,t):this._execute(e,t)}requestAsyncId(e,t,i=0){return null!=i&&i>0||null==i&&this.delay>0?super.requestAsyncId(e,t,i):(e.flush(this),0)}});class FW extends hn{constructor(e,t){super(),this.source=e,this.subjectFactory=t,this._subject=null,this._refCount=0,this._connection=null,$d(e)&&(this.lift=e.lift)}_subscribe(e){return this.getSubject().subscribe(e)}getSubject(){const e=this._subject;return(!e||e.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:e}=this;this._subject=this._connection=null,e?.unsubscribe()}connect(){let e=this._connection;if(!e){e=this._connection=new Rn;const t=this.getSubject();e.add(this.source.subscribe(mn(t,void 0,()=>{this._teardown(),t.complete()},i=>{this._teardown(),t.error(i)},()=>this._teardown()))),e.closed&&(this._connection=null,e=Rn.EMPTY)}return e}refCount(){return function OW(){return xn((n,e)=>{let t=null;n._refCount++;const i=mn(e,void 0,void 0,void 0,()=>{if(!n||n._refCount<=0||0<--n._refCount)return void(t=null);const r=n._connection,s=t;t=null,r&&(!s||r===s)&&r.unsubscribe(),e.unsubscribe()});n.subscribe(i),i.closed||(t=n.connect())})}()(this)}}const BW={connector:()=>new Yi};function d1(n,e=BW){const{connector:t}=e;return xn((i,r)=>{const s=t();pi(n(function kW(n){return new hn(e=>n.subscribe(e))}(s))).subscribe(r),r.add(i.subscribe(s))})}function f1(n,e){const t=bt(n)?n:()=>n;return bt(e)?d1(e,{connector:t}):i=>new FW(i,t)}const GW=(n,e)=>Object.assign(Object.assign({},n),e);function WW(n=new Yi,e=new Yi,t=new Ph(GW)){const i=Dt(n.pipe(Rc(),Te(),wt(Yp)),e.pipe(wt(Yp))).pipe(function PW(...n){const e=Dn(n);return xn((t,i)=>{const r=n.length,s=new Array(r);let o=n.map(()=>!1),a=!1;for(let c=0;c<r;c++)pi(n[c]).subscribe(mn(i,l=>{s[c]=l,!a&&!o[c]&&(o[c]=!0,(a=o.every(kr))&&(o=null))},Fi));t.subscribe(mn(i,c=>{if(a){const l=[c,...s];i.next(e?e(...l):l)}}))})}(t.pipe(wt(Yp))),function NW(n,e){return xn(function LW(n,e,t,i,r){return(s,o)=>{let a=t,c=e,l=0;s.subscribe(mn(o,u=>{const d=l++;c=a?n(c,u,d):(a=!0,u),i&&o.next(c)},r&&(()=>{a&&o.next(c),o.complete()})))}}(n,e,arguments.length>=2,!0))}((u,[d,f])=>f(u,d),{}),Fu(u=>s.state=u,u=>console.error(u)),Rh(u=>Ue),function UW(n){return n?e=>d1(n)(e):e=>f1(new Yi)(e)}()),r=i.pipe(function VW(n,e,t,i){t&&!bt(t)&&(i=t);const r=bt(t)?t:void 0;return s=>f1(new Ic(n,e,i),r)(s)}(1)),s={state:{},signal$:i,state$:r,nextSlice:function a(u){e.next(u)},nextSliceObservable:function c(u){n.next(u)},nextAccumulator:function o(u){t.next(u)},subscribe:function l(){const u=s.signal$.connect();return u.add(s.state$.connect()),u.add(()=>{t.complete(),n.complete(),e.complete()}),u}};return s}function h1(n){return!!Array.isArray(n)&&n.length>0&&n.every(e=>"function"==typeof e)}function p1(n){return!!Array.isArray(n)&&n.length>0&&n.every(e=>"string"==typeof e)}function Id(n){return null!=n&&["string","symbol","number"].includes(typeof n)}function m1(n){return null!=n&&"object"==typeof n&&!Array.isArray(n)}function g1(n){return null!=n}function y1(n){return n?1===n.length?n[0]:function(t){return n.reduce((i,r)=>r(i),t)}:Fi}function Rd(...n){return e=>e.pipe(Rc(),t=>h1(n)?t.pipe(y1(n)):t,Pc(t=>void 0!==t),Rc(),function zW(n,e,t){let i,r=!1;return n&&"object"==typeof n?({bufferSize:i=1/0,windowTime:e=1/0,refCount:r=!1,scheduler:t}=n):i=n??1/0,nt({connector:()=>new Ic(i,e,t),resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:r})}({bufferSize:1,refCount:!0}))}function Pd(n,e){if(!g1(n))return n;if(!g1(e))return;const t=(Array.isArray(e)?e:[e]).filter(r=>Id(r));if(0===t.length||!m1(n)||0===Object.keys(n).length)return;let i=n[t.shift()];return t.forEach(r=>{m1(i)&&Id(r)&&(i=i[r])}),i}function _1(n,e){return n===e}function v1(n,e){return t=>t.pipe(Pc(i=>void 0!==i),bn(i=>{if(null===i)return null;const r=n.filter(s=>i.hasOwnProperty(s)&&void 0!==i[s]);return r.length<n.length?void 0:r.reduce((s,o)=>(s[o]=i[o],s),{})}),Pc(i=>void 0!==i),function qW(n,e){let t=(i,r)=>n.some(s=>!_1(Pd(i,[s]),Pd(r,[s])));if(void 0!==e){const i=r=>e.hasOwnProperty(r)&&void 0!==e[r]?e[r]:_1;t=(r,s)=>n.some(o=>!i(o)(Pd(r,[o]),Pd(s,[o])))}return Rc((i,r)=>!t(i,r))}(n,e))}let YW=(()=>{class n{constructor(){this.subscription=new Rn,this.accumulator=WW(),this.effectObservable=function XW(n=new Yi){const e=Dt(n.pipe(Te(),wt(Yp)));return{effects$:e,nextEffectObservable:function t(r){n.next(r)},subscribe:function i(){return e.subscribe()}}}(),this.$=this.accumulator.signal$,this.subscription.add(this.subscribe())}ngOnDestroy(){this.subscription.unsubscribe()}setAccumulator(t){this.accumulator.nextAccumulator(t)}get(...t){const i=Object.keys(this.accumulator.state).length>0;return t&&t.length?Pd(this.accumulator.state,t):i?this.accumulator.state:void 0}set(t,i){if("object"!=typeof t||void 0!==i){if("function"!=typeof t||void 0!==i){if(Id(t)&&"function"==typeof i){const r={};return r[t]=i(this.accumulator.state),void this.accumulator.nextSlice(r)}throw new Error("wrong params passed to set")}this.accumulator.nextSlice(t(this.accumulator.state))}else this.accumulator.nextSlice(t)}connect(t,i,r){if(void 0===r&&void 0===i&&ea(t))this.accumulator.nextSliceObservable(t);else if(void 0!==r||"function"!=typeof i||!ea(t)||ea(i))if(void 0===r&&Id(t)&&ea(i)){const s=t,o=i.pipe(bn(a=>Object.assign({},{[s]:a})));this.accumulator.nextSliceObservable(o)}else{if("function"!=typeof r||!Id(t)||!ea(i))throw new Error("wrong params passed to connect");{const s=t,o=i.pipe(bn(a=>Object.assign({},{[s]:r(this.get(),a)})));this.accumulator.nextSliceObservable(o)}}else{const s=i,o=t.pipe(bn(a=>s(this.get(),a)));this.accumulator.nextSliceObservable(o)}}select(...t){return this.accumulator.state$.pipe(function ZW(...n){return e=>{if(!n||0===n.length)return e.pipe(Rd());if(function jW(n){return"string"==typeof n[0]&&"function"==typeof n[1]}(n))return e.pipe(Rd(bn(t=>n[1](t[n[0]]))));if(function $W(n){return p1(n[0])&&"function"==typeof n[1]&&(void 0===n[2]||"object"==typeof n[2])}(n))return e.pipe(v1(n[0],n[2]),Rd(bn(n[1])));if(p1(n))return e.pipe(Rd(function HW(...n){const e=n.length;if(0===e)throw new Error("list of properties cannot be empty.");return bn(t=>{let i=t;for(let r=0;r<e;r++){const s=i?.[n[r]];if(!(typeof s<"u"))return;i=s}return i})}(...n)));if(h1(n))return e.pipe(Rd(y1(n)));throw new Error("wrong params passed to select")}}(...t))}hold(t,i){const r=t.pipe(Rh(s=>Ue));this.effectObservable.nextEffectObservable("function"!=typeof i?r:r.pipe(Fu(i)))}subscribe(){const t=new Rn;return t.add(this.accumulator.subscribe()),t.add(this.effectObservable.subscribe()),t}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Wt({token:n,factory:n.\u0275fac}),n})();const b1=["glCanvas"],JW=["portalContentAnchor"];function QW(n,e){if(1&n){const t=ey();bc(0,"ngt-portal-before-render",2),mu("beforeRender",function(r){return Am(t),Im(Jf().onBeforeRender(r))}),wc()}if(2&n){const t=Jf();Us("renderPriority",t.autoRenderPriority)("parentScene",t.parentScene)("parentCamera",t.parentCamera)}}const w1={};function Ld(n){if(n)return(n.eventObject||n.object).uuid+"/"+n.index+n.instanceId;const e=av.generateUUID();return w1[e]?Ld():(w1[e]=!0,e)}function R0(n,e){const t=e?.devicePixelRatio||1;return Array.isArray(n)?Math.min(Math.max(n[0],t),n[1]):n}const Kp=new Map;function Jp(n,e,t,i){const r=ea(e)?e:x_(e),s=Un(Hs);return r.pipe(bn(o=>{const c=new(n(o));return t&&t(c),[(Array.isArray(o)?o:"string"==typeof o?[o]:Object.values(o)).map(u=>(Kp.has(u)||Kp.set(u,Xe(c.loadAsync(u,i)).pipe(Fu(d=>{d.scene&&Object.assign(d,function n6(n){const e={nodes:{},materials:{}};return n&&n.traverse(t=>{t.name&&(e.nodes[t.name]=t),"material"in t&&!e.materials[t.material.name]&&(e.materials[t.material.name]=t.material)}),e}(d.scene))}),function KB(n=1/0){let e;e=n&&"object"==typeof n?n:{count:n};const{count:t=1/0,delay:i,resetOnSuccess:r=!1}=e;return t<=0?kr:xn((s,o)=>{let c,a=0;const l=()=>{let u=!1;c=s.subscribe(mn(o,d=>{r&&(a=0),o.next(d)},void 0,d=>{if(a++<t){const f=()=>{c?(c.unsubscribe(),c=null,l()):u=!0};if(null!=i){const h="number"==typeof i?function YB(n=0,e,t=FB){let i=-1;return null!=e&&(mt(e)?t=e:i=e),new hn(r=>{let s=function XB(n){return n instanceof Date&&!isNaN(n)}(n)?+n-t.now():n;s<0&&(s=0);let o=0;return t.schedule(function(){r.closed||(r.next(o++),0<=i?this.schedule(void 0,i):r.complete())},s)})}(i):pi(i(d,a)),m=mn(o,()=>{m.unsubscribe(),f()},()=>{o.complete()});h.subscribe(m)}else f()}else o.error(d)})),u&&(c.unsubscribe(),c=null,l())};l()})}(2),Rh(d=>(console.error(`[NGT] Error loading ${u}: ${d.message}`),x_([]))),nt({connector:()=>new Ic(1)}))),Kp.get(u))),o]}),HT(([o,a])=>function iU(...n){const e=Dn(n),{args:t,keys:i}=GT(n),r=new hn(s=>{const{length:o}=t;if(!o)return void s.complete();const a=new Array(o);let c=o,l=o;for(let u=0;u<o;u++){let d=!1;pi(t[u]).subscribe(mn(s,f=>{d||(d=!0,l--),a[u]=f},()=>c--,void 0,()=>{(!c||!d)&&(l||s.next(i?WT(i,a):a),s.complete())}))}});return e?r.pipe(__(e)):r}(o).pipe(bn(c=>{if(Array.isArray(a))return c;if("string"==typeof a)return c[0];const l=Object.keys(a);return l.reduce((u,d)=>(u[d]=c[l.indexOf(d)],u),{})}),Fu(()=>{requestAnimationFrame(()=>s.detectChanges())}))))}Jp.destroy=()=>{Kp.clear()},Jp.preLoad=(n,e,t)=>{Jp(n,e,t).pipe(function rU(n){return n<=0?()=>Ue:xn((e,t)=>{let i=0;e.subscribe(mn(t,r=>{++i<=n&&(t.next(r),n<=i&&t.complete())}))})}(1)).subscribe()};const M1=Jp,S1=new Set,E1=new Set,T1=new Set;function L0(n,e){if(n.size)for(const{callback:t}of n.values())t(e)}function Nd(n,e){switch(n){case"before":return L0(S1,e);case"after":return L0(E1,e);case"tail":return L0(T1,e)}}function N0(n,e,t){const i=e.get();let r=i.clock.getDelta();"never"===i.frameloop&&"number"==typeof n&&(r=n-i.clock.elapsedTime,i.clock.oldTime=i.clock.elapsedTime,i.clock.elapsedTime=n);for(let s=0;s<i.internal.subscribers.length;s++)i.internal.subscribers[s].callback({...i,delta:r,frame:t});return!i.internal.priority&&i.gl.render&&i.gl.render(i.scene,i.camera),i.internal.frames=Math.max(0,i.internal.frames-1),"always"===i.frameloop?1:i.internal.frames}const $t={obj:n=>n===Object(n)&&!Array.isArray(n)&&"function"!=typeof n,material:n=>!!n&&n.isMaterial,geometry:n=>!!n&&n.isBufferGeometry,orthographicCamera:n=>!!n&&n.isOrthographicCamera,perspectiveCamera:n=>!!n&&n.isPerspectiveCamera,camera:n=>!!n&&n.isCamera,renderer:n=>!!n&&n instanceof _p,scene:n=>!!n&&n.isScene,object3D:n=>!!n&&n.isObject3D,instance:n=>!!n&&!!n.__ngt__,ref:n=>n instanceof gs,equ(n,e,{arrays:t="shallow",objects:i="reference",strict:r=!0}={}){if(typeof n!=typeof e||!!n!=!!e)return!1;if("string"==typeof n||"number"==typeof n)return n===e;const s=$t.obj(n);if(s&&"reference"===i)return n===e;const o=Array.isArray(n);if(o&&"reference"===t)return n===e;if((o||s)&&n===e)return!0;let a;for(a in n)if(!(a in e))return!1;for(a in r?e:n)if(n[a]!==e[a])return!1;if(void 0===a){if(o&&0===n.length&&0===e.length||s&&0===Object.keys(n).length&&0===Object.keys(e).length)return!0;if(n!==e)return!1}return!0}};function D1(n){null!==n&&$t.obj(n)&&"needsUpdate"in n&&(n.needsUpdate=!0,"uniformsNeedUpdate"in n&&(n.uniformsNeedUpdate=!0))}function C1(n){$t.object3D(n)&&n.updateMatrix(),$t.camera(n)&&(($t.perspectiveCamera(n)||$t.orthographicCamera(n))&&n.updateProjectionMatrix(),n.updateMatrixWorld()),D1(n)}function O0(n,e){n.manual||($t.orthographicCamera(n)?(n.left=e.width/-2,n.right=e.width/2,n.top=e.height/2,n.bottom=e.height/-2):n.aspect=e.width/e.height,n.updateProjectionMatrix(),n.updateMatrixWorld())}function qt(n){return n&&n.__ngt__||{}}function Od(n){const e=qt(n).store?.get();e&&0===e.internal.frames&&e.invalidate(),C1(n)}function Fd(n,e){const t="function"==typeof n?n():n;if(e?.primitive||!t.__ngt__){const{objects:i=new Ph([]),nonObjects:r=new Ph([]),...s}=e||{};t.__ngt__={previousAttach:null,store:null,parent:null,memoized:{},eventCount:0,handlers:{},objects:i,nonObjects:r,add:(o,a)=>{const c=t.__ngt__[a].value,l=c.indexOf(u=>u===o);l>-1?(c.splice(l,1,o),t.__ngt__[a].next(c)):t.__ngt__[a].next([...t.__ngt__[a].value,o]),F0(t.__ngt__.parent)},remove:(o,a)=>{t.__ngt__[a].next(t.__ngt__[a].value.filter(c=>c!==o)),F0(t.__ngt__.parent)},...s}}return t}function F0(n){if(!n)return;const e=qt(n);e.objects&&e.objects.next(e.objects.value),e.nonObjects&&e.nonObjects.next(e.nonObjects.value),F0(e.parent)}function Aa(n,e){if(!Object.keys(e).length)return n;const t=qt(n),i=t.store?.get(),r=function r6(n,e){const t=Object.entries(e),i=[];for(const[r,s]of t)$t.equ(s,n[r])||i.push([r,s]);return i}(n,e);for(let o=0;o<r.length;o++){const a=r[o][0],c=n,l=c[a],u=r[o][1];if(l&&l.set&&(l.copy||l instanceof pa)){const d=l instanceof De;if(Array.isArray(u))l.fromArray?l.fromArray(u):l.set(...u);else if(l.copy&&u&&u.constructor&&l.constructor.name===u.constructor.name)l.copy(u),!ei&&!i.linear&&d&&l.convertSRGBToLinear();else if(void 0!==u){const f=l instanceof De;!f&&l.setScalar?l.setScalar(u):l instanceof pa&&u instanceof pa?l.mask=u.mask:l.set(u),!ei&&!i?.linear&&f&&l.convertSRGBToLinear()}}else c[a]=u,!i?.linear&&c[a]instanceof Ti&&(c[a].encoding=Qt);C1(l),Od(n)}return t.parent&&i.internal&&n.raycast&&t.eventCount!=t.eventCount&&(i.removeInteraction(n.uuid),t.eventCount&&i.addInteraction(n)),t.parent&&t.afterUpdate&&t.afterUpdate.observed&&r.length&&t.afterUpdate.emit(n),n}let k0=(()=>{class n extends YW{constructor(){super(),this.cache={},this.set({__ngt_dummy__:"__ngt_dummy__"}),this.initialize();const t=this.set.bind(this);Object.defineProperty(this,"set",{get:()=>(...i)=>{const r=i[0];if($t.obj(r)){const s=Object.entries(r).reduce((o,[a,c])=>(o[a]=void 0===c?this.get(a):c,o),{});return t(s)}return t(...i)}})}initialize(){}effect(t,i){return this.hold(t.pipe(function s6(n){let i,e=()=>{},t=!1;const r=s=>()=>{e&&e({prev:i,complete:!0,error:s})};return Fu({next:s=>{e&&t&&e({prev:i,complete:!1,error:!1});const o=n(s);o&&(e=o),i=s,t||(t=!0)},complete:r(!1),unsubscribe:r(!1),error:r(!0)})}(i)))}triggerChangeDetection(t,i=[]){let r=this.$;i.length&&(r=function sU(...n){const e=zt(n),t=Dn(n),{args:i,keys:r}=GT(n);if(0===i.length)return Xe([],e);const s=new hn(function oU(n,e,t=kr){return i=>{jT(e,()=>{const{length:r}=n,s=new Array(r);let o=r,a=r;for(let c=0;c<r;c++)jT(e,()=>{const l=Xe(n[c],e);let u=!1;l.subscribe(mn(i,d=>{s[c]=d,u||(u=!0,a--),a||i.next(t(s.slice()))},()=>{--o||i.complete()}))},i)},i)}}(i,e,r?o=>WT(r,o):kr));return t?s.pipe(__(t)):s}(i.map(s=>this.select(s).pipe(qT(this.get(s)??void 0))))),this.hold(r,()=>{requestAnimationFrame(()=>{t.detectChanges()})})}key$(...t){const i=t.join(".");return this.cache[i]||(this.cache[i]=this.select(...t).pipe(qT(this.get(...t)??void 0),Rc())),this.cache[i]}ngOnDestroy(){this.cache={},super.ngOnDestroy()}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Wt({token:n,factory:n.\u0275fac}),n})();const B0=new Map,{invalidate:U0,advance:A1}=function i6(n){let t,i,e=!1;function r(a){i=requestAnimationFrame(r),e=!0,t=0,Nd("before",a);for(const c of n.values()){const l=c.get();l.internal.active&&("always"===l.frameloop||l.internal.frames>0)&&!l.gl.xr?.isPresenting&&(t+=N0(a,c))}if(Nd("after",a),0===t)return Nd("tail",a),e=!1,cancelAnimationFrame(i)}return{loop:r,invalidate:function s(a,c=1){const l=a?.get();if(!l)return n.forEach(u=>s(u,c));l.gl.xr?.isPresenting||!l.internal.active||"never"===l.frameloop||(l.internal.frames=Math.min(60,l.internal.frames+c),e||(e=!0,requestAnimationFrame(r)))},advance:function o(a,c=!0,l,u){const d=l?.get();if(c&&Nd("before",a),d)N0(a,l,u);else for(const f of n.values())N0(a,f);c&&Nd("after",a)}}}(B0),bl={objects:"shallow",strict:!1};let as=(()=>{class n extends k0{constructor(){super(...arguments),this.parentStore=Un(n,{optional:!0,skipSelf:!0}),this.window=Un(Dr).defaultView,this.isInit=!1}init(){if(!this.isInit){const t=new T,i=new T,r=new T,s=(l=this.get("camera"),u=i,d=this.get("size"))=>{const{width:f,height:h,top:m,left:p}=d,g=f/h;u instanceof T?r.copy(u):r.set(...u);const _=l.getWorldPosition(t).distanceTo(r);if($t.orthographicCamera(l))return{width:f/l.zoom,height:h/l.zoom,top:m,left:p,factor:1,distance:_,aspect:g};const v=l.fov*Math.PI/180,y=2*Math.tan(v/2)*_,x=y*g;return{width:x,height:y,top:m,left:p,factor:f/x,distance:_,aspect:g}},o=new ce;let a;const c=l=>{this.set(u=>({performance:{...u.performance,current:l}}))};this.set({get:this.get.bind(this),set:this.set.bind(this),select:this.select.bind(this),ready:!1,scene:Fd(new bp,{store:this}),events:{priority:1,enabled:!0,connected:!1},invalidate:(l=1)=>U0(this,l),advance:(l,u)=>A1(l,u,this),legacy:!1,linear:!1,flat:!1,controls:null,clock:new w0,pointer:o,frameloop:"always",performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const l=this.get();a&&clearTimeout(a),l.performance.current!==l.performance.min&&c(l.performance.min),a=setTimeout(()=>c(this.get("performance","max")||1),l.performance.debounce)}},size:{width:0,height:0,top:0,left:0},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:s},previousStore:this.parentStore,internal:{active:!1,priority:0,frames:0,lastEvent:null,interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(l,u=0,d=this)=>{const f=this.get("internal");return f.priority=f.priority+(u>0?1:0),f.subscribers.push({priority:u,store:d,callback:l}),f.subscribers.sort((h,m)=>(h.priority||0)-(m.priority||0)),()=>{const h=this.get("internal");h?.subscribers&&(h.priority=h.priority-(u>0?1:0),h.subscribers=h.subscribers.filter(m=>m.callback!==l))}}},setEvents:l=>{this.set(u=>({events:{...u.events,...l}}))},setSize:(l,u,d,f)=>{const h=this.get("camera"),m={width:l,height:u,top:d||0,left:f||0};this.set(p=>({size:m,viewport:{...p.viewport,...s(h,i,m)}}))},setDpr:l=>{const u=R0(l,this.window);this.set(d=>({viewport:{...d.viewport,dpr:u,initialDpr:d.viewport.initialDpr||u}}))},setFrameloop:(l="always")=>{const u=this.get("clock");u.stop(),u.elapsedTime=0,"never"!==l&&(u.start(),u.elapsedTime=0),this.set({frameloop:l})},addInteraction:l=>{this.set(u=>({internal:{...u.internal,interaction:[...u.internal.interaction,l]}}))},removeInteraction:l=>{this.set(u=>({internal:{...u.internal,interaction:u.internal.interaction.filter(d=>d.uuid!==l)}}))}}),this.isInit=!0,this.resize()}}configure(t,i){const{gl:r,size:s,camera:o,raycaster:a,events:c,orthographic:l,lookAt:u,shadows:d,linear:f,legacy:h,flat:m,dpr:p,frameloop:g,performance:_}=t,v=this.get(),y={};let x=v.gl;v.gl||(y.gl=x=function t6(n,e){const t="function"==typeof n?n(e):n;return null!=t?.render?t:new _p({powerPreference:"high-performance",canvas:e,antialias:!0,alpha:!0,...n||{}})}(r,i));let w=v.raycaster;w||(y.raycaster=w=new T0);const{params:M,...A}=a||{};if($t.equ(A,w,bl)||Aa(w,{...A}),$t.equ(M,w.params,bl)||Aa(w,{params:{...w.params,...M||{}}}),!v.camera){const B=$t.camera(o);let G=B?o:function e6(n,e){return n?new nl(0,0,0,0,.1,1e3):new di(75,e.width/e.height,.1,1e3)}(l||!1,v.size);B||(o&&Aa(G,o),o?.position||(G.position.z=5),o?.rotation||(Array.isArray(u)?G.lookAt(u[0],u[1],u[2]):u instanceof T?G.lookAt(u):G.lookAt(0,0,0)),G.updateProjectionMatrix()),$t.instance(G)||(G=Fd(G,{store:this})),y.camera=G}if(!v.xr){const B=(N,q)=>{"never"!==this.get().frameloop&&A1(N,!0,this,q)},G=()=>{const N=this.get();N.gl.xr.enabled=N.gl.xr.isPresenting,N.gl.xr.setAnimationLoop(N.gl.xr.isPresenting?B:null),N.gl.xr.isPresenting||U0(this)},k={connect:()=>{x.xr.addEventListener("sessionstart",G),x.xr.addEventListener("sessionend",G)},disconnect:()=>{x.xr.removeEventListener("sessionstart",G),x.xr.removeEventListener("sessionend",G)}};x.xr&&k.connect(),y.xr=k}if(x.shadowMap){const B="boolean"==typeof d;if(B&&x.shadowMap.enabled!==d||!$t.equ(d,x.shadowMap,bl)){const G=x.shadowMap.enabled;x.shadowMap.enabled=!!d,B?x.shadowMap.type=M_:Object.assign(x.shadowMap,d),G!==x.shadowMap.enabled&&D1(x.shadowMap)}}ei&&(ei.legacyMode=h??!0);const b=f?$s:Qt,S=m?Yr:R_;x.outputEncoding!==b&&(x.outputEncoding=b),x.toneMapping!==S&&(x.toneMapping=S),v.legacy!==h&&(y.legacy=h),v.linear!==f&&(y.linear=f),v.flat!==m&&(y.flat=m),x.setClearAlpha(0),x.setPixelRatio(R0(v.viewport.dpr)),x.setSize(v.size.width,v.size.height),$t.obj(r)&&"function"!=typeof r&&!$t.renderer(r)&&!$t.equ(r,x,bl)&&Aa(x,r),c&&!v.events.handlers&&(y.events=c(this)),_&&!$t.equ(_,v.performance,bl)&&(y.performance={...v.performance,..._}),this.set(y),p&&v.viewport.dpr!==R0(p)&&v.setDpr(p);const R=function o6(n,e){if(e)return e;if(n instanceof HTMLCanvasElement&&n.parentElement){const{width:t,height:i,top:r,left:s}=n.parentElement.getBoundingClientRect();return{width:t,height:i,top:r,left:s}}return{width:0,height:0,top:0,left:0}}(i,s);$t.equ(R,v.size,bl)||v.setSize(R.width,R.height,R.top,R.left),v.frameloop!==g&&v.setFrameloop(g),this.get("ready")||this.set({ready:!0}),this.invalidate()}destroy(t){this.set(i=>({internal:{...i.internal,active:!1}})),setTimeout(()=>{const{gl:i,xr:r,events:s}=this.get();i&&(s.disconnect&&s.disconnect(),i.renderLists.dispose(),i.forceContextLoss(),i.xr&&i.xr.enabled&&(i.xr.setAnimationLoop(null),r.disconnect()),function a6(n){n.dispose&&!$t.scene(n)&&n.dispose();for(const e in n)e.dispose?.(),delete n[e]}(this.get()),B0.delete(t))},500)}resize(){const t=this.get();let i=t.size,r=t.viewport.dpr,s=t.camera;this.hold(this.select(v1(["camera","size","viewport","gl"])),()=>{const{camera:o,size:a,viewport:c,gl:l,set:u}=this.get();(a!==i||c.dpr!==r)&&(i=a,r=c.dpr,O0(o,a),l.setPixelRatio(c.dpr),l.setSize(a.width,a.height)),o!==s&&(O0(o,a),s=o,u(d=>({viewport:{...d.viewport,...d.viewport.getCurrentViewport(o)}})))})}invalidate(){this.hold(this.select(),()=>U0(this))}}return n.\u0275fac=function(){let e;return function(i){return(e||(e=Kl(n)))(i||n)}}(),n.\u0275prov=Wt({token:n,factory:n.\u0275fac}),n})();const I1=new Mt("NgtCompoundPrefixes"),R1={},l6=new Mt("THREE Constructors Catalogue",{factory:()=>R1});let u6=(()=>{class n{constructor(){this.vcr=Un(Gi),this.template=Un($r),this.injected=!1,this.shouldCreateView=!0;const t=this.vcr.element.nativeElement;t.__ngt_renderer_add_comment__&&(t.__ngt_renderer_add_comment__(),delete t.__ngt_renderer_add_comment__)}createView(){this.shouldCreateView&&(this.view&&!this.view.destroyed&&this.view.destroy(),this.view=this.vcr.createEmbeddedView(this.template),this.view.detectChanges())}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275dir=bi({type:n}),n})(),P1=(()=>{class n extends u6{constructor(){super(...arguments),this.injectedArgs=[]}set args(t){null==t||!Array.isArray(t)||1===t.length&&null===t[0]||(this.injected=!1,this.injectedArgs=t,this.createView())}get args(){return this.validate()?(this.injected=!0,this.injectedArgs):null}validate(){return!this.injected&&!!this.injectedArgs.length}}return n.\u0275fac=function(){let e;return function(i){return(e||(e=Kl(n)))(i||n)}}(),n.\u0275dir=bi({type:n,selectors:[["","args",""]],inputs:{args:"args"},standalone:!0,features:[fu]}),n})();function L1(n,e,t,i){const r=t.get(e);r&&(t.delete(e),0===t.size&&(n.delete(i),r.target.releasePointerCapture(i)))}function N1(n,e){const t=n.get("internal");t.interaction=t.interaction.filter(i=>i!==e),t.initialHits=t.initialHits.filter(i=>i!==e),t.hovered.forEach((i,r)=>{(i.eventObject===e||i.object===e)&&t.hovered.delete(r)}),t.capturedMap.forEach((i,r)=>{L1(t.capturedMap,e,i,r)}),n.get("previousStore")&&N1(n.get("previousStore"),e)}function Qp(n,e,t=[]){const[i,...r]=t;i&&(0===r.length?Aa(n,{[i]:e}):(function h6(n,e){(!Object.hasOwn(n,e)&&Reflect&&Reflect.has&&!Reflect.has(n,e)||void 0===n[e])&&(n[e]={})}(n,i),Qp(n[i],e,r)))}const z0_BEFORE_RENDER="beforeRender",z0_AFTER_UPDATE="afterUpdate",z0_AFTER_ATTACH="afterAttach";function H0(n,e){const t=qt(n),i=qt(e);if(!t||!i)throw new Error("[NGT] THREE instances need to be prepared with local state.");let r=!1;if((!i.store||i.store===t.store.get("previousStore"))&&(i.store=t.store),i.attach){const s=i.attach;if("function"==typeof s){const o=s(n,e,i.store);o&&(i.previousAttach=o)}else{if("none"===s[0])return void Od(e);if("material"===s[0]&&s[1]&&"number"==typeof Number(s[1])&&$t.material(e)&&!Array.isArray(n.material)&&(n.material=[]),i.isRaw){if(i.parent=n,void 0===e.__ngt_renderer__[10])return;Qp(n,e.__ngt_renderer__[10],s)}else Qp(n,e,s);i.previousAttach=s.reduce((o,a)=>o[a],n)}}else $t.object3D(n)&&$t.object3D(e)&&(n.add(e),r=!0);t.add(e,r?"objects":"nonObjects"),i.parent=n,i.afterAttach&&i.afterAttach.emit({parent:n,node:e}),Od(e),Od(n)}function G0(n,e,t){const i=qt(n),r=qt(e);r.parent=null,i.objects&&i.remove(e,"objects"),i.nonObjects&&i.remove(e,"nonObjects"),r.attach?function f6(n,e,t){const i=qt(e);Array.isArray(t)?Qp(n,i.previousAttach,t):i.previousAttach()}(n,e,r.attach):$t.object3D(n)&&$t.object3D(e)&&(n.remove(e),N1(r.store||i.store,e));const s=r.primitive;s||(O1(r.objects?.value||[],e,!!t),O1(e.childre,e,!!t)),!s&&e.dispose&&!$t.scene(e)&&queueMicrotask(()=>e.dispose()),Od(n)}function O1(n,e,t){n&&[...n].forEach(i=>G0(e,i,t))}function m6(n,e,t){return i=>{n(i),t&&t.detectChanges(),e.detectChanges()}}class y6{constructor(e){this.root=e,this.comments=[]}createNode(e,t){const i=[e,null,[],!1,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0],r=Object.assign(t,{__ngt_renderer__:i});return r.ownerDocument||(r.ownerDocument=this.root.document),"three"!==i[0]&&(i[13]=()=>Ac(r).injector),"comment"===i[0]?(r.__ngt_renderer_add_comment__=s=>{s&&"portal"===s.__ngt_renderer__[0]?this.portals.push(s):this.comments.push(r)},r):("compound"===i[0]&&(i[7]=new Set,i[8]={},i[9]={}),r)}setParent(e,t){e.__ngt_renderer__[1]||(e.__ngt_renderer__[1]=t)}addChild(e,t){e.__ngt_renderer__[2].includes(t)||e.__ngt_renderer__[2].push(t)}removeChild(e,t){const i=e.__ngt_renderer__[2].findIndex(r=>t===r);i>=0&&e.__ngt_renderer__[2].splice(i,1)}setCompound(e,t){const i=e.__ngt_renderer__;i[6]=t;const r=Object.keys(i[8]),s=Object.keys(i[9]);if(r.length)for(const o of r)this.applyAttribute(t,o,i[8][o]);if(s.length)for(const o of s)this.applyProperty(t,o,i[9][o]);this.executeOperation(e)}queueOperation(e,t){e.__ngt_renderer__[7].add(t)}executeOperation(e,t="op"){const i=e.__ngt_renderer__;i[7]?.size&&i[7].forEach(r=>{r[0]===t&&(r[1](),i[7].delete(r))})}processPortalContainer(e){const i=(0,e.__ngt_renderer__[13])?.();if(!i)return;const r=i.get(as,null);if(!r)return;const s=r.get("scene");s&&(e.__ngt_renderer__[12]=this.createNode("three",s))}applyAttribute(e,t,i){const r=e.__ngt_renderer__;if(!r[3]){if("priority"===t){let s=Number(i);isNaN(s)&&(s=0,console.warn('[NGT] "priority" is an invalid number, default to 0')),qt(e).priority=s}if("ngtCompound"===t)return void(r[4]=[""===i||"first"===i,{}]);if("attach"===t){const s=i.split(".");return void(s.length&&(qt(e).attach=s))}if("rawValue"===t){let s=i;return""===s||"true"===s||"false"===s?s="true"===s||""===s:isNaN(Number(s))||(s=Number(s)),void(r[10]=s)}Aa(e,{[t]:i})}}applyProperty(e,t,i){const r=e.__ngt_renderer__;if(r[3])return;if("ref"===t&&$t.ref(i))return r[11]=i,void(i.nativeElement=e);const s=qt(e).parent||r[1];if(qt(e).isRaw&&"rawValue"===t)return r[10]=i,void(s&&H0(s,e));if("attach"===t)return qt(e).attach=Array.isArray(i)?i.map(a=>a.toString()):i,void(s&&H0(s,e));const o=r[4];o?.[1]&&t in o[1]&&!o[0]&&(i=o[1][t]),Aa(e,{[t]:i})}isCompound(e){return this.root.compoundPrefixes.some(t=>e.startsWith(t))}isDOM(e){const t=e.__ngt_renderer__;return!t||"compound"!==t[0]&&(e instanceof Element||e instanceof Document||e instanceof Window)}get rootScene(){return this.root.store.get("scene")}get rootCdr(){return this.root.cdr}get portals(){return this.root.portals}getClosestParentWithInstance(e){let t=e.__ngt_renderer__[1];for(;t&&"three"!==t.__ngt_renderer__[0];)t=t.__ngt_renderer__[12]?t.__ngt_renderer__[12]:t.__ngt_renderer__[1];return t}getClosestParentWithCompound(e){if(e.__ngt_renderer__[5])return e.__ngt_renderer__[5];let t=e.__ngt_renderer__[1];if(t&&"compound"===t.__ngt_renderer__[0]&&!t.__ngt_renderer__[6])return t;for(;t&&("three"===t.__ngt_renderer__[0]||!t.__ngt_renderer__[5]||"compound"!==t.__ngt_renderer__[0]);)t=t.__ngt_renderer__[1];return t?"three"===t.__ngt_renderer__[0]&&t.__ngt_renderer__[5]?t.__ngt_renderer__[5]:t.__ngt_renderer__[6]?null:t:void 0}getCreationState(){return{injectedArgs:this.firstNonInjectedDirective(P1)?.args||[],store:this.tryGetPortalStore()}}destroy(e,t){const i=e.__ngt_renderer__;if(!i[3]){if("three"===i[0]){i[4]=void 0,i[5]=void 0;const r=qt(e);r.objects&&(r.objects.value.forEach(s=>this.destroy(s,t)),r.objects.complete()),r.nonObjects&&(r.nonObjects.value.forEach(s=>this.destroy(s,t)),r.nonObjects.complete()),r.afterUpdate&&r.afterUpdate.complete(),r.afterAttach&&r.afterAttach.complete(),delete r.objects,delete r.nonObjects,delete r.add,delete r.remove,delete r.afterUpdate,delete r.afterAttach,delete r.store,delete r.handlers,r.primitive||delete e.__ngt__}if("comment"===i[0]){i[13]=null,delete e.__ngt_renderer_add_comment__;const r=this.comments.findIndex(s=>s===e);r>-1&&this.comments.splice(r,1)}if("portal"===i[0]){i[13]=null;const r=this.portals.findIndex(s=>s===e);r>-1&&this.portals.splice(r,1)}"compound"===i[0]&&(i[6]=void 0,i[8]=null,i[9]=null,this.executeOperation(e,"cleanUp"),i[7].clear(),i[7]=null),i[11]&&(i[11].nativeElement=null,i[11]=void 0),i[1]=null;for(const r of i[2]||[])"three"===r.__ngt_renderer__[0]&&t&&G0(t,r,!0),this.destroy(r,t);i[2]=[],i[3]=!0,t&&this.removeChild(t,e)}}firstNonInjectedDirective(e){let t,i=this.comments.length-1;for(;i>=0;){const r=this.comments[i];if(r.__ngt_renderer__[3]){i--;continue}const s=r.__ngt_renderer__[13]();if(!s){i--;continue}const o=s.get(e,null);if(o&&o.validate()){t=o;break}i--}return t}tryGetPortalStore(){let e,t=this.portals.length-1;for(;t>=0;){const i=this.portals[t];if(i.__ngt_renderer__[3]){t--;continue}const r=i.__ngt_renderer__[13]();if(!r){t--;continue}const s=r.get(as,null);if(s&&s.get("previousStore")){e=s;break}t--}return e||this.root.store}}let _6=(()=>{class n{constructor(){this.delegateRendererFactory=Un(Bf,{skipSelf:!0}),this.cdr=Un(Hs),this.store=Un(as),this.catalogue=Un(l6),this.compoundPrefixes=Un(I1),this.document=Un(Dr),this.rendererMap=new Map,this.portals=[],this.rendererStore=new y6({store:this.store,cdr:this.cdr,portals:this.portals,compoundPrefixes:this.compoundPrefixes,document:this.document})}createRenderer(t,i){const r=this.delegateRendererFactory.createRenderer(t,i);if(!i)return r;let s=this.rendererMap.get(i.id);return s||(s=new v6(r,this.rendererStore,this.catalogue,!t),this.rendererMap.set(i.id,s)),s}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Wt({token:n,factory:n.\u0275fac}),n})();class v6{constructor(e,t,i,r=!0){this.delegate=e,this.store=t,this.catalogue=i,this.root=r,this.createText=this.delegate.createText.bind(this.delegate),this.destroy=this.delegate.destroy.bind(this.delegate),this.destroyNode=null,this.selectRootElement=this.delegate.selectRootElement.bind(this.delegate),this.nextSibling=this.delegate.nextSibling.bind(this.delegate),this.removeAttribute=this.delegate.removeAttribute.bind(this.delegate),this.addClass=this.delegate.addClass.bind(this.delegate),this.removeClass=this.delegate.removeClass.bind(this.delegate),this.setStyle=this.delegate.setStyle.bind(this.delegate),this.removeStyle=this.delegate.removeStyle.bind(this.delegate),this.setValue=this.delegate.setValue.bind(this.delegate)}createElement(e,t){const i=this.delegate.createElement(e,t);if(this.root){this.root=!1;const l=this.store.createNode("three",this.store.rootScene);return l.__ngt_renderer__[13]=()=>Ac(i).injector,l}if(this.store.isCompound(e))return this.store.createNode("compound",i);if("ngt-portal"===e)return this.store.createNode("portal",i);if("ngt-value"===e)return this.store.createNode("three",Object.assign({__ngt_renderer__:{rawValue:void 0}},{__ngt__:{isRaw:!0}}));const{injectedArgs:r,store:s}=this.store.getCreationState();if("ngt-primitive"===e){if(!r[0])throw new Error("[NGT] ngt-primitive without args is invalid");const l=r[0];let u=qt(l);return Object.keys(u).length||(Fd(l,{store:s,args:r,primitive:!0}),u=qt(l)),u.store||(u.store=s),this.store.createNode("three",l)}const a=function g6(n){return n.split("-").map(i=>i.charAt(0).toUpperCase()+i.slice(1)).join("")}(e.startsWith("ngt")?e.slice(4):e),c=this.catalogue[a];if(c){const l=Fd(new c(...r),{store:s,args:r}),u=this.store.createNode("three",l),d=qt(l);return $t.geometry(l)?d.attach=["geometry"]:$t.material(l)&&(d.attach=["material"]),u}return this.store.createNode("dom",i)}createComment(e){return this.store.createNode("comment",this.delegate.createComment(e))}appendChild(e,t){if(t instanceof Text)return;const i=t.__ngt_renderer__,r=e.__ngt_renderer__;if("comment"!==i[0]){if(this.store.setParent(t,e),this.store.addChild(e,t),"portal"===i[0])return this.store.processPortalContainer(t),void(i[12]&&this.appendChild(e,i[12]));if("portal"===r[0])return this.store.processPortalContainer(e),void(r[12]&&this.appendChild(r[12],t));if("three"!==r[0]||"three"!==i[0]){if("three"===r[0])for(const o of i[2])this.appendChild(e,o);if("compound"===r[0]&&(!r[6]&&"three"===i[0]&&(i[4]?this.store.setCompound(e,t):i[5]||(i[5]=e)),r[6]&&"three"===i[0]&&i[4]&&r[6]!==t&&this.store.setCompound(e,t)),"three"===i[0]&&!qt(t).parent||("dom"===r[0]||"compound"===r[0]&&!r[6])&&("dom"===i[0]||"compound"===i[0]&&!i[6])){const o=this.store.getClosestParentWithInstance(e);o&&this.appendChild(o,t)}}else{if(qt(t).parent||(H0(e,t),!i[4]))return;const o=this.store.getClosestParentWithCompound(e);if(!o)return;this.appendChild(o,t)}}else this.store.setParent(t,e)}insertBefore(e,t){!e.__ngt_renderer__||e===t||this.appendChild(e,t)}removeChild(e,t,i){const r=e.__ngt_renderer__;if("three"===r[0]&&"three"===t.__ngt_renderer__[0])return G0(e,t,!0),void this.store.destroy(t,e);if("compound"===r[0]&&r[1])return void this.removeChild(r[1],t,i);if("three"===r[0])return void this.store.destroy(t,e);const o=this.store.getClosestParentWithInstance(e);o&&this.removeChild(o,t,i),this.store.destroy(t,o)}parentNode(e){const t=e.__ngt_renderer__;return t?.[1]?t[1]:this.delegate.parentNode(e)}setAttribute(e,t,i,r){const s=e.__ngt_renderer__;if("compound"===s[0])return s[8][t]=i,s[6]?void this.setAttribute(s[6],t,i,r):void this.store.queueOperation(e,["op",()=>this.setAttribute(e,t,i,r)]);"three"===s[0]&&this.store.applyAttribute(e,t,i)}setProperty(e,t,i){const r=e.__ngt_renderer__;if("compound"===r[0])return r[9][t]=i,r[6]?(r[6].__ngt_renderer__[4]&&Object.assign(r[6].__ngt_renderer__[4],{props:{...r[6].__ngt_renderer__[4],[t]:i}}),void this.setProperty(r[6],t,i)):void this.store.queueOperation(e,["op",()=>this.setProperty(e,t,i)]);"three"===r[0]&&this.store.applyProperty(e,t,i)}listen(e,t,i){const r=e.__ngt_renderer__,s=r?.[13]?.().get(Hs,null),o=a=>{const c=i(a);return s&&s.detectChanges(),this.store.rootCdr.detectChanges(),c};if(this.store.isDOM(e))return this.delegate.listen(e,t,o);if(e===this.store.rootScene){let[a,c]=t.split(":");return null==c&&(c=a,a=""),this.delegate.listen("window"===a?e.ownerDocument.defaultView:e.ownerDocument,c,o)}return"three"===r[0]||"compound"===r[0]&&r[6]?function p6(n,e,t,i,r,s){const o=qt(n);if(t===z0_BEFORE_RENDER)return o.store.get("internal").subscribe(l=>i({state:l,object:n}),e||o.priority||0);if(t===z0_AFTER_UPDATE||t===z0_AFTER_ATTACH){o[t]||(o[t]=new Hi);const l=o[t]?.subscribe(i);return l.unsubscribe.bind(l)}o.handlers||(o.handlers={});const a=o.handlers[t];return o.handlers={...o.handlers,[t]:m6(l=>{a&&a(l),i(l)},r,s)},o.eventCount+=1,1===o.eventCount&&n.raycast&&o.store.get("addInteraction")(n),()=>{const l=qt(n);l&&l.eventCount&&l.store.get("removeInteraction")(n.uuid)}}(r[6]||e,qt(e).priority||0,t,i,this.store.rootCdr,s):("compound"===r[0]&&!r[6]&&this.store.queueOperation(e,["op",()=>this.store.queueOperation(e,["cleanUp",this.listen(e,t,i)])]),()=>{})}get data(){return this.delegate.data}}function x6({store:n,changeDetectorRef:e,compoundPrefixes:t=[]}){return t.includes("ngts")||t.push("ngts"),t.includes("ngtp")||t.push("ngtp"),function TP(n){return{\u0275providers:n}}([{provide:Bf,useClass:_6},{provide:as,useValue:n},{provide:Hs,useValue:e},{provide:I1,useValue:t}])}const F1={click:!1,contextmenu:!1,dblclick:!1,wheel:!1,pointerdown:!0,pointerup:!0,pointerleave:!0,pointermove:!0,pointercancel:!0,lostpointercapture:!0};function b6(n){const{handlePointer:e}=function d6(n){function t(c){return c.filter(l=>["move","over","enter","out","leave"].some(u=>{const d=`pointer${u}`;return qt(l).handlers?.[d]}))}function s(c){const{internal:l}=n.get();for(const u of l.hovered.values())if(!c.length||!c.find(d=>d.object===u.object&&d.index===u.index&&d.instanceId===u.instanceId)){const f=qt(u.eventObject),h=f?.handlers;if(l.hovered.delete(Ld(u)),f?.eventCount){const m={...u,intersections:c};h?.pointerout?.(m),h?.pointerleave?.(m)}}}function o(c,l){for(let u=0;u<l.length;u++)qt(l[u])?.handlers.pointermissed?.(c)}return{handlePointer:function a(c){switch(c){case"pointerleave":case"pointercancel":return()=>s([]);case"lostpointercapture":return l=>{const{internal:u}=n.get();"pointerId"in l&&u.capturedMap.has(l.pointerId)&&(u.capturedMap.delete(l.pointerId),s([]))}}return function(u){const{onPointerMissed:d,internal:f}=n.get();f.lastEvent=u;const h="pointermove"===c,m="click"===c||"contextmenu"===c||"dblclick"===c,g=function i(c,l){const u=n.get(),d=new Set,f=[],h=l?l(u.internal.interaction):u.internal.interaction;for(let g=0;g<h.length;g++){const _=qt(h[g]).store?.get();_&&(_.raycaster.camera=void 0)}u.previousStore||u.events.compute?.(c,n);let p=h.flatMap(function m(g){const v=qt(g).store,y=v?.get();return y&&y.events.enabled&&null!==y.raycaster.camera?(void 0===y.raycaster.camera&&(y.events.compute?.(c,v,y.previousStore),void 0===y.raycaster.camera&&(y.raycaster.camera=null)),y.raycaster.camera?y.raycaster.intersectObject(g,!0):[]):[]}).sort((g,_)=>{const v=qt(g.object).store.get(),y=qt(_.object).store.get();return v&&y&&y.events.priority-v.events.priority||g.distance-_.distance}).filter(g=>{const _=Ld(g);return!d.has(_)&&(d.add(_),!0)});u.events.filter&&(p=u.events.filter(p,n));for(const g of p){let _=g.object;for(;_;)qt(_).eventCount&&f.push({...g,eventObject:_}),_=_.parent}if("pointerId"in c&&u.internal.capturedMap.has(c.pointerId))for(const g of u.internal.capturedMap.get(c.pointerId).values())d.has(Ld(g.intersection))||f.push(g.intersection);return f}(u,h?t:void 0),_=m?function e(c){const l=n.get("internal"),u=c.offsetX-l.initialClick[0],d=c.offsetY-l.initialClick[1];return Math.round(Math.sqrt(u*u+d*d))}(u):0;"pointerdown"===c&&(f.initialClick=[u.offsetX,u.offsetY],f.initialHits=g.map(y=>y.eventObject)),m&&!g.length&&_<=2&&(o(u,f.interaction),d&&d(u)),h&&s(g),function r(c,l,u,d){const f=n.get();if(c.length){const h={stopped:!1};for(const m of c){const p=qt(m.object).store?.get()||f,{raycaster:g,pointer:_,camera:v,internal:y}=p,x=new T(_.x,_.y,0).unproject(v),w=R=>y.capturedMap.get(R)?.has(m.eventObject)??!1,M=R=>{const B={intersection:m,target:l.target};y.capturedMap.has(R)?y.capturedMap.get(R).set(m.eventObject,B):y.capturedMap.set(R,new Map([[m.eventObject,B]])),l.target.setPointerCapture(R)},A=R=>{const B=y.capturedMap.get(R);B&&L1(y.capturedMap,m.eventObject,B,R)},b={};for(const R in l){const B=l[R];"function"!=typeof B&&(b[R]=B)}const S={...m,...b,pointer:_,intersections:c,stopped:h.stopped,delta:u,unprojectedPoint:x,ray:g.ray,camera:v,stopPropagation(){const R="pointerId"in l&&y.capturedMap.get(l.pointerId);(!R||R.has(m.eventObject))&&(S.stopped=h.stopped=!0,y.hovered.size&&Array.from(y.hovered.values()).find(B=>B.eventObject===m.eventObject))&&s([...c.slice(0,c.indexOf(m)),m])},target:{hasPointerCapture:w,setPointerCapture:M,releasePointerCapture:A},currentTarget:{hasPointerCapture:w,setPointerCapture:M,releasePointerCapture:A},nativeEvent:l};if(d(S),!0===h.stopped)break}}}(g,u,_,function v(y){const x=y.eventObject,w=qt(x),M=w?.handlers;if(w?.eventCount)if(h){if(M?.pointerover||M?.pointerenter||M?.pointerout||M?.pointerleave){const A=Ld(y),b=f.hovered.get(A);b?b.stopped&&y.stopPropagation():(f.hovered.set(A,y),M.pointerover?.(y),M.pointerenter?.(y))}M?.pointermove?.(y)}else{const A=M?.[c];A?(!m||f.initialHits.includes(x))&&(o(u,f.interaction.filter(b=>!f.initialHits.includes(b))),A(y)):m&&f.initialHits.includes(x)&&o(u,f.interaction.filter(b=>!f.initialHits.includes(b)))}})}}}}(n);return{priority:1,enabled:!0,compute:(t,i)=>{const r=i.get();r.pointer.set(t.offsetX/r.size.width*2-1,-t.offsetY/r.size.height*2+1),r.raycaster.setFromCamera(r.pointer,r.camera)},connected:void 0,handlers:Object.keys(F1).reduce((t,i)=>(t[i]=e(i),t),{}),connect:t=>{const i=n.get();i.events.disconnect?.(),i.setEvents({connected:t}),Object.entries(i.events.handlers??{}).forEach(([r,s])=>{t.addEventListener(r,s,{passive:F1[r]})})},disconnect:()=>{const{events:t,setEvents:i}=n.get();t.connected&&(Object.entries(t.handlers??{}).forEach(([r,s])=>{t.connected instanceof HTMLElement&&t.connected.removeEventListener(r,s)}),i({connected:void 0}))}}}let w6=(()=>{class n extends k0{constructor(){super(...arguments),this.cdr=Un(Hs),this.envInjector=Un(Zo),this.host=Un(gs),this.store=Un(as),this.hostClass=!0,this.sceneGraphInputs={},this.compoundPrefixes=[],this.created=new Hi,this.pointerMissed=new Hi}initialize(){super.initialize(),this.set({shadows:!1,linear:!1,flat:!1,legacy:!1,orthographic:!1,frameloop:"always",dpr:[1,2],events:b6})}get pointerEvents(){return this.get("eventSource")!==this.host.nativeElement?"none":"auto"}set linear(t){this.set({linear:t})}set legacy(t){this.set({legacy:t})}set flat(t){this.set({flat:t})}set orthographic(t){this.set({orthographic:t})}set frameloop(t){this.set({frameloop:t})}set dpr(t){this.set({dpr:t})}set raycaster(t){this.set({raycaster:t})}set shadows(t){this.set({shadows:t})}set camera(t){this.set({camera:t})}set gl(t){this.set({gl:t})}set eventSource(t){this.set({eventSource:t})}set eventPrefix(t){this.set({eventPrefix:t})}set lookAt(t){this.set({lookAt:t})}set performance(t){this.set({performance:t})}ngOnChanges(t){t.sceneGraphInputs&&this.glRef&&this.setSceneGraphInputs()}ngOnInit(){this.get("eventSource")||(this.eventSource=this.host.nativeElement),this.pointerMissed.observed&&this.store.set({onPointerMissed:t=>{this.pointerMissed.emit(t),this.cdr.detectChanges()}}),this.store.init(),B0.set(this.glCanvas.nativeElement,this.store),this.hold(this.store.select("ready").pipe(Pc(t=>t)),()=>this.storeReady())}onResize({width:t,height:i}){t>0&&i>0&&(this.store.isInit||this.store.init(),this.store.configure(this.get(),this.glCanvas.nativeElement))}storeReady(){this.store.set(r=>({internal:{...r.internal,active:!0}}));const t=this.get(),i=this.store.get();i.events.connect?.($t.ref(t.eventSource)?t.eventSource.nativeElement:t.eventSource),t.eventPrefix&&i.setEvents({compute:(r,s)=>{const o=s.get();o.pointer.set(r[t.eventPrefix+"X"]/o.size.width*2-1,-r[t.eventPrefix+"Y"]/o.size.height*2+1),o.raycaster.setFromCamera(o.pointer,o.camera)}}),this.created.observed&&(this.created.emit(this.store.get()),this.cdr.detectChanges()),this.glRef&&this.glRef.destroy(),requestAnimationFrame(()=>{this.glEnvInjector=_y([x6({store:this.store,changeDetectorRef:this.cdr,compoundPrefixes:this.compoundPrefixes})],this.envInjector),this.glRef=this.glAnchor.createComponent(this.sceneGraph,{environmentInjector:this.glEnvInjector}),this.glRef.changeDetectorRef.detach(),this.setSceneGraphInputs(),this.overrideDetectChanges(),this.cdr.detectChanges()})}ngOnDestroy(){this.glRef&&this.glRef.destroy(),this.glEnvInjector&&this.glEnvInjector.destroy(),M1.destroy(),this.store.destroy(this.glCanvas.nativeElement),super.ngOnDestroy()}overrideDetectChanges(){const t=this.cdr.detectChanges.bind(this.cdr);this.cdr.detectChanges=()=>{t(),this.glRef?.changeDetectorRef.detectChanges()}}setSceneGraphInputs(){for(const t of Object.keys(this.sceneGraphInputs))this.glRef?.setInput(t,this.sceneGraphInputs[t]);this.cdr.detectChanges()}}return n.\u0275fac=function(){let e;return function(i){return(e||(e=Kl(n)))(i||n)}}(),n.\u0275cmp=zl({type:n,selectors:[["ngt-canvas"]],viewQuery:function(t,i){if(1&t&&(oh(b1,7),oh(b1,7,Gi)),2&t){let r;Eu(r=Tu())&&(i.glCanvas=r.first),Eu(r=Tu())&&(i.glAnchor=r.first)}},hostVars:4,hostBindings:function(t,i){2&t&&(oy("pointer-events",i.pointerEvents),ay("ngt-canvas",i.hostClass))},inputs:{sceneGraph:"sceneGraph",sceneGraphInputs:"sceneGraphInputs",compoundPrefixes:"compoundPrefixes",linear:"linear",legacy:"legacy",flat:"flat",orthographic:"orthographic",frameloop:"frameloop",dpr:"dpr",raycaster:"raycaster",shadows:"shadows",camera:"camera",gl:"gl",eventSource:"eventSource",eventPrefix:"eventPrefix",lookAt:"lookAt",performance:"performance"},outputs:{created:"created",pointerMissed:"pointerMissed"},standalone:!0,features:[gy([as,jB({emitInZone:!1})]),fu,ql,wu],decls:3,vars:0,consts:[[2,"height","100%","width","100%",3,"ngxResize"],[2,"display","block"],["glCanvas",""]],template:function(t,i){1&t&&(bc(0,"div",0),mu("ngxResize",function(s){return i.onResize(s)}),pu(1,"canvas",1,2),wc())},dependencies:[$B],styles:["[_nghost-%COMP%]{display:block;position:relative;width:100%;height:100%;overflow:hidden}"]}),n})();function M6(n){if(n)try{n.context&&n.detectChanges()}catch{n.markForCheck()}}function S6(n=null){const e=$t.ref(n)?n:new gs(n);let t=e.nativeElement;const i=[],r=new Ph(t),{destroy$:s,cdr:o}=function k1(n){try{const e=Un(Hs),t=new Ic;return queueMicrotask(()=>{e.onDestroy(()=>{t.next(),t.complete(),n?.()})}),{destroy$:t,cdr:e}}catch{throw new Error("[NGT] injectNgtDestroy is being called outside of Constructor Context")}}(()=>{r.complete()});i.push(o);const a=r.asObservable().pipe(Rc(),Ih(s)),l=a.pipe(Pc((d,f)=>f>0||null!=d),Ih(s));return Object.defineProperty(e,"nativeElement",{set:d=>{if(e.nativeElement!==d){r.next(d),t=e.nativeElement,e.nativeElement=d;const f=[...i];for(let h=0;h<f.length;h++){const m=f[h];m.destroyed?i.splice(h,1):M6(m)}}},get:()=>r.value}),Object.assign(e,{subscribe:d=>a.subscribe(f=>{d(f,t),t=f}),$:l,children$:(d="objects")=>l.pipe(HT(f=>{const h=qt(f);return h.objects&&h.nonObjects?Dt(h.objects,h.nonObjects).pipe(bn(()=>{try{return"both"===d?[...h.objects.value,...h.nonObjects.value]:h[d].value}catch{return console.error(`[NGT] Exception in accessing children of ${f}`),[]}})):x_([])}),Pc((f,h)=>h>0||f.length>0),Ih(s)),useCDR:d=>{i.push(d)}})}let T6=(()=>{class n{constructor(){this.cdr=Un(Hs),this.parentCdr=Un(Hs,{skipSelf:!0,optional:!0})}transform(t,i=null){if(this.obj===t)return this.latestValue;if(this.obj=t,this.latestValue=i,this.sub&&this.sub.unsubscribe(),ea(this.obj))this.sub=this.obj.subscribe(this.updateValue.bind(this));else{if(!function E6(n){return(n instanceof Promise||"[object Promise]"===Object.prototype.toString.call(n))&&"function"==typeof n.then}(this.obj))throw new Error("[NGT] Invalid value passed to ngtPush pipe");this.obj.then(this.updateValue.bind(this))}return this.latestValue}updateValue(t){this.latestValue=t,this.cdr.detectChanges(),this.parentCdr&&this.parentCdr.detectChanges()}ngOnDestroy(){this.sub&&this.sub.unsubscribe(),this.latestValue=void 0,this.obj=void 0}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275pipe=ki({name:"ngtPush",type:n,pure:!1,standalone:!0}),n})();var em,W0;const D6=["get","set","select","setSize","setDpr","setFrameloop","events","invalidate","advance","size","viewport","addInteraction","removeInteraction"];let C6=(()=>{class n{constructor(){this.portalStore=Un(as),this.renderPriority=1,this.beforeRender=new Hi}ngOnInit(){let t;this.subscription=this.portalStore.get("internal").subscribe(({delta:i,frame:r})=>{this.beforeRender.emit({...this.portalStore.get(),delta:i,frame:r});const{gl:s,scene:o,camera:a}=this.portalStore.get();t=s.autoClear,1===this.renderPriority&&(s.autoClear=!0,s.render(this.parentScene,this.parentCamera)),s.autoClear=!1,s.clearDepth(),s.render(o,a),s.autoClear=t},this.renderPriority,this.portalStore)}ngOnDestroy(){this.subscription?.()}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275dir=bi({type:n,selectors:[["ngt-portal-before-render"]],inputs:{renderPriority:"renderPriority",parentScene:"parentScene",parentCamera:"parentCamera"},outputs:{beforeRender:"beforeRender"},standalone:!0}),n})(),A6=(()=>{class n{constructor(t,i){const r=t.element.nativeElement;r.__ngt_renderer_add_comment__&&(r.__ngt_renderer_add_comment__(i.element.nativeElement),delete r.__ngt_renderer_add_comment__)}}return n.\u0275fac=function(t){return new(t||n)(yt(Gi),yt(Gi,4))},n.\u0275dir=bi({type:n,selectors:[["ng-template","ngtPortalContent",""]],standalone:!0}),n})();class kd extends k0{constructor(){super(...arguments),em.add(this),this.autoRender=!0,this.autoRenderPriority=1,this.beforeRender=new Hi,this.parentStore=Un(as,{skipSelf:!0}),this.parentScene=this.parentStore.get("scene"),this.parentCamera=this.parentStore.get("camera"),this.portalStore=Un(as,{self:!0}),this.raycaster=new T0,this.pointer=new ce,this.portalContentRendered=!1}set container(e){this.set({container:e})}set state(e){this.set({state:e})}initialize(){super.initialize(),this.set({container:S6(Fd(new bp))})}ngOnInit(){const e=this.parentStore.get(),t=this.get();!t.state&&this.autoRender&&(t.state={events:{priority:this.autoRenderPriority+1}});const{events:i,size:r,...s}=t.state||{},o=t.container,a=$t.ref(o)?o.nativeElement:o,c=qt(a);c.store||(c.store=this.portalStore),this.portalStore.set({...e,scene:a,raycaster:this.raycaster,pointer:this.pointer,previousStore:this.parentStore,events:{...e.events,...i||{}},size:{...e.size,...r||{}},...s,get:this.portalStore.get.bind(this.portalStore),set:this.portalStore.set.bind(this.portalStore),select:this.portalStore.select.bind(this.portalStore),setEvents:l=>this.portalStore.set(u=>({...u,events:{...u.events,...l}}))}),this.hold(this.parentStore.select(),l=>this.portalStore.set(u=>Xd(this,em,"m",W0).call(this,l,u))),requestAnimationFrame(()=>{this.portalStore.set(l=>Xd(this,em,"m",W0).call(this,this.parentStore.get(),l))}),this.portalContentView=this.portalContentAnchor.createEmbeddedView(this.portalContentTemplate),this.portalContentView.detectChanges(),this.portalContentRendered=!0}onBeforeRender(e){this.beforeRender.emit({root:{...this.parentStore.get(),delta:e.delta,frame:e.frame},portal:e})}ngOnDestroy(){this.portalContentView&&!this.portalContentView.destroyed&&this.portalContentView.destroy(),super.ngOnDestroy()}}function U1(n,e){if(e===VD)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),n;if(e===Wh||e===iv){let t=n.getIndex();if(null===t){const o=[],a=n.getAttribute("position");if(void 0===a)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),n;for(let c=0;c<a.count;c++)o.push(c);n.setIndex(o),t=n.getIndex()}const i=t.count-2,r=[];if(e===Wh)for(let o=1;o<=i;o++)r.push(t.getX(0)),r.push(t.getX(o)),r.push(t.getX(o+1));else for(let o=0;o<i;o++)o%2==0?(r.push(t.getX(o)),r.push(t.getX(o+1)),r.push(t.getX(o+2))):(r.push(t.getX(o+2)),r.push(t.getX(o+1)),r.push(t.getX(o)));r.length/3!==i&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const s=n.clone();return s.setIndex(r),s.clearGroups(),s}return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),n}em=new WeakSet,W0=function(e,t){const i={...e};Object.keys(i).forEach(l=>{(D6.includes(l)||e[l]!==t[l])&&delete i[l]});const r=this.get(),{size:s,events:o,...a}=r.state||{};let c;if(t&&s){const l=t.camera;c=e.viewport.getCurrentViewport(l,new T,s),l!==e.camera&&O0(l,s)}return{...i,scene:$t.ref(r.container)?r.container.nativeElement:r.container,raycaster:this.raycaster,pointer:this.pointer,previousStore:this.parentStore,events:{...e.events,...t?.events||{},...o},size:{...e.size,...s},viewport:{...e.viewport,...c||{}},...a}},kd.\u0275fac=function(){let n;return function(t){return(n||(n=Kl(kd)))(t||kd)}}(),kd.\u0275cmp=zl({type:kd,selectors:[["ngt-portal"]],contentQueries:function(e,t,i){if(1&e&&function QS(n,e,t,i){const r=jt();if(r.firstCreatePass){const s=Mi();tE(r,new KS(e,t,i),s.index),function aF(n,e){const t=n.contentQueries||(n.contentQueries=[]);e!==(t.length?t[t.length-1]:-1)&&t.push(n.queries.length-1,e)}(r,n),2==(2&t)&&(r.staticContentQueries=!0)}eE(r,le(),t)}(i,A6,7,$r),2&e){let r;Eu(r=Tu())&&(t.portalContentTemplate=r.first)}},viewQuery:function(e,t){if(1&e&&oh(JW,7,Gi),2&e){let i;Eu(i=Tu())&&(t.portalContentAnchor=i.first)}},inputs:{container:"container",state:"state",autoRender:"autoRender",autoRenderPriority:"autoRenderPriority"},outputs:{beforeRender:"beforeRender"},standalone:!0,features:[gy([as]),fu,wu],decls:3,vars:1,consts:[["portalContentAnchor",""],[3,"renderPriority","parentScene","parentCamera","beforeRender",4,"ngIf"],[3,"renderPriority","parentScene","parentCamera","beforeRender"]],template:function(e,t){1&e&&(Yf(0,null,0),Jg(2,QW,1,3,"ngt-portal-before-render",1),Kf()),2&e&&(Uf(2),Us("ngIf",t.autoRender&&t.portalContentRendered))},dependencies:[cT,C6],encapsulation:2});class I6 extends rr{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new O6(t)}),this.register(function(t){return new H6(t)}),this.register(function(t){return new G6(t)}),this.register(function(t){return new k6(t)}),this.register(function(t){return new B6(t)}),this.register(function(t){return new U6(t)}),this.register(function(t){return new V6(t)}),this.register(function(t){return new N6(t)}),this.register(function(t){return new z6(t)}),this.register(function(t){return new F6(t)}),this.register(function(t){return new P6(t)}),this.register(function(t){return new W6(t)}),this.register(function(t){return new j6(t)})}load(e,t,i,r){const s=this;let o;o=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:xl.extractUrlBase(e),this.manager.itemStart(e);const a=function(l){r?r(l):console.error(l),s.manager.itemError(e),s.manager.itemEnd(e)},c=new os(this.manager);c.setPath(this.path),c.setResponseType("arraybuffer"),c.setRequestHeader(this.requestHeader),c.setWithCredentials(this.withCredentials),c.load(e,function(l){try{s.parse(l,o,function(u){t(u),s.manager.itemEnd(e)},a)}catch(u){a(u)}},i,a)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,i,r){let s;const o={},a={},c=new TextDecoder;if("string"==typeof e)s=JSON.parse(e);else if(e instanceof ArrayBuffer)if(c.decode(new Uint8Array(e,0,4))===V1){try{o[en.KHR_BINARY_GLTF]=new $6(e)}catch(d){return void(r&&r(d))}s=JSON.parse(o[en.KHR_BINARY_GLTF].content)}else s=JSON.parse(c.decode(e));else s=e;if(void 0===s.asset||s.asset.version[0]<2)return void(r&&r(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const l=new s8(s,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let u=0;u<this.pluginCallbacks.length;u++){const d=this.pluginCallbacks[u](l);a[d.name]=d,o[d.name]=!0}if(s.extensionsUsed)for(let u=0;u<s.extensionsUsed.length;++u){const d=s.extensionsUsed[u],f=s.extensionsRequired||[];switch(d){case en.KHR_MATERIALS_UNLIT:o[d]=new L6;break;case en.KHR_DRACO_MESH_COMPRESSION:o[d]=new q6(s,this.dracoLoader);break;case en.KHR_TEXTURE_TRANSFORM:o[d]=new Z6;break;case en.KHR_MESH_QUANTIZATION:o[d]=new X6;break;default:f.indexOf(d)>=0&&void 0===a[d]&&console.warn('THREE.GLTFLoader: Unknown extension "'+d+'".')}}l.setExtensions(o),l.setPlugins(a),l.parse(i,r)}parseAsync(e,t){const i=this;return new Promise(function(r,s){i.parse(e,t,r,s)})}}function R6(){let n={};return{get:function(e){return n[e]},add:function(e,t){n[e]=t},remove:function(e){delete n[e]},removeAll:function(){n={}}}}const en={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class P6{constructor(e){this.parser=e,this.name=en.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let i=0,r=t.length;i<r;i++){const s=t[i];s.extensions&&s.extensions[this.name]&&void 0!==s.extensions[this.name].light&&e._addNodeRef(this.cache,s.extensions[this.name].light)}}_loadLight(e){const t=this.parser,i="light:"+e;let r=t.cache.get(i);if(r)return r;const s=t.json,c=((s.extensions&&s.extensions[this.name]||{}).lights||[])[e];let l;const u=new De(16777215);void 0!==c.color&&u.fromArray(c.color);const d=void 0!==c.range?c.range:0;switch(c.type){case"directional":l=new x0(u),l.target.position.set(0,0,-1),l.add(l.target);break;case"point":l=new v0(u),l.distance=d;break;case"spot":l=new y0(u),l.distance=d,c.spot=c.spot||{},c.spot.innerConeAngle=void 0!==c.spot.innerConeAngle?c.spot.innerConeAngle:0,c.spot.outerConeAngle=void 0!==c.spot.outerConeAngle?c.spot.outerConeAngle:Math.PI/4,l.angle=c.spot.outerConeAngle,l.penumbra=1-c.spot.innerConeAngle/c.spot.outerConeAngle,l.target.position.set(0,0,-1),l.add(l.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+c.type)}return l.position.set(0,0,0),l.decay=2,ko(l,c),void 0!==c.intensity&&(l.intensity=c.intensity),l.name=t.createUniqueName(c.name||"light_"+e),r=Promise.resolve(l),t.cache.add(i,r),r}getDependency(e,t){if("light"===e)return this._loadLight(t)}createNodeAttachment(e){const t=this,i=this.parser,s=i.json.nodes[e],a=(s.extensions&&s.extensions[this.name]||{}).light;return void 0===a?null:this._loadLight(a).then(function(c){return i._getNodeRef(t.cache,a,c)})}}class L6{constructor(){this.name=en.KHR_MATERIALS_UNLIT}getMaterialType(){return pr}extendParams(e,t,i){const r=[];e.color=new De(1,1,1),e.opacity=1;const s=t.pbrMetallicRoughness;if(s){if(Array.isArray(s.baseColorFactor)){const o=s.baseColorFactor;e.color.fromArray(o),e.opacity=o[3]}void 0!==s.baseColorTexture&&r.push(i.assignTexture(e,"map",s.baseColorTexture,Qt))}return Promise.all(r)}}class N6{constructor(e){this.parser=e,this.name=en.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=r.extensions[this.name].emissiveStrength;return void 0!==s&&(t.emissiveIntensity=s),Promise.resolve()}}class O6{constructor(e){this.parser=e,this.name=en.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?io:null}extendMaterialParams(e,t){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];if(void 0!==o.clearcoatFactor&&(t.clearcoat=o.clearcoatFactor),void 0!==o.clearcoatTexture&&s.push(i.assignTexture(t,"clearcoatMap",o.clearcoatTexture)),void 0!==o.clearcoatRoughnessFactor&&(t.clearcoatRoughness=o.clearcoatRoughnessFactor),void 0!==o.clearcoatRoughnessTexture&&s.push(i.assignTexture(t,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),void 0!==o.clearcoatNormalTexture&&(s.push(i.assignTexture(t,"clearcoatNormalMap",o.clearcoatNormalTexture)),void 0!==o.clearcoatNormalTexture.scale)){const a=o.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new ce(a,a)}return Promise.all(s)}}class F6{constructor(e){this.parser=e,this.name=en.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?io:null}extendMaterialParams(e,t){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];return void 0!==o.iridescenceFactor&&(t.iridescence=o.iridescenceFactor),void 0!==o.iridescenceTexture&&s.push(i.assignTexture(t,"iridescenceMap",o.iridescenceTexture)),void 0!==o.iridescenceIor&&(t.iridescenceIOR=o.iridescenceIor),void 0===t.iridescenceThicknessRange&&(t.iridescenceThicknessRange=[100,400]),void 0!==o.iridescenceThicknessMinimum&&(t.iridescenceThicknessRange[0]=o.iridescenceThicknessMinimum),void 0!==o.iridescenceThicknessMaximum&&(t.iridescenceThicknessRange[1]=o.iridescenceThicknessMaximum),void 0!==o.iridescenceThicknessTexture&&s.push(i.assignTexture(t,"iridescenceThicknessMap",o.iridescenceThicknessTexture)),Promise.all(s)}}class k6{constructor(e){this.parser=e,this.name=en.KHR_MATERIALS_SHEEN}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?io:null}extendMaterialParams(e,t){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[];t.sheenColor=new De(0,0,0),t.sheenRoughness=0,t.sheen=1;const o=r.extensions[this.name];return void 0!==o.sheenColorFactor&&t.sheenColor.fromArray(o.sheenColorFactor),void 0!==o.sheenRoughnessFactor&&(t.sheenRoughness=o.sheenRoughnessFactor),void 0!==o.sheenColorTexture&&s.push(i.assignTexture(t,"sheenColorMap",o.sheenColorTexture,Qt)),void 0!==o.sheenRoughnessTexture&&s.push(i.assignTexture(t,"sheenRoughnessMap",o.sheenRoughnessTexture)),Promise.all(s)}}class B6{constructor(e){this.parser=e,this.name=en.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?io:null}extendMaterialParams(e,t){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];return void 0!==o.transmissionFactor&&(t.transmission=o.transmissionFactor),void 0!==o.transmissionTexture&&s.push(i.assignTexture(t,"transmissionMap",o.transmissionTexture)),Promise.all(s)}}class U6{constructor(e){this.parser=e,this.name=en.KHR_MATERIALS_VOLUME}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?io:null}extendMaterialParams(e,t){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];t.thickness=void 0!==o.thicknessFactor?o.thicknessFactor:0,void 0!==o.thicknessTexture&&s.push(i.assignTexture(t,"thicknessMap",o.thicknessTexture)),t.attenuationDistance=o.attenuationDistance||1/0;const a=o.attenuationColor||[1,1,1];return t.attenuationColor=new De(a[0],a[1],a[2]),Promise.all(s)}}class V6{constructor(e){this.parser=e,this.name=en.KHR_MATERIALS_IOR}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?io:null}extendMaterialParams(e,t){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=r.extensions[this.name];return t.ior=void 0!==s.ior?s.ior:1.5,Promise.resolve()}}class z6{constructor(e){this.parser=e,this.name=en.KHR_MATERIALS_SPECULAR}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?io:null}extendMaterialParams(e,t){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];t.specularIntensity=void 0!==o.specularFactor?o.specularFactor:1,void 0!==o.specularTexture&&s.push(i.assignTexture(t,"specularIntensityMap",o.specularTexture));const a=o.specularColorFactor||[1,1,1];return t.specularColor=new De(a[0],a[1],a[2]),void 0!==o.specularColorTexture&&s.push(i.assignTexture(t,"specularColorMap",o.specularColorTexture,Qt)),Promise.all(s)}}class H6{constructor(e){this.parser=e,this.name=en.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,i=t.json,r=i.textures[e];if(!r.extensions||!r.extensions[this.name])return null;const s=r.extensions[this.name],o=t.options.ktx2Loader;if(!o){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,s.source,o)}}class G6{constructor(e){this.parser=e,this.name=en.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,i=this.parser,r=i.json,s=r.textures[e];if(!s.extensions||!s.extensions[t])return null;const o=s.extensions[t],a=r.images[o.source];let c=i.textureLoader;if(a.uri){const l=i.options.manager.getHandler(a.uri);null!==l&&(c=l)}return this.detectSupport().then(function(l){if(l)return i.loadTextureImage(e,o.source,c);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}})),this.isSupported}}class W6{constructor(e){this.name=en.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,i=t.bufferViews[e];if(i.extensions&&i.extensions[this.name]){const r=i.extensions[this.name],s=this.parser.getDependency("buffer",r.buffer),o=this.parser.options.meshoptDecoder;if(!o||!o.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return s.then(function(a){const u=r.count,d=r.byteStride,f=new Uint8Array(a,r.byteOffset||0,r.byteLength||0);return o.decodeGltfBufferAsync?o.decodeGltfBufferAsync(u,d,f,r.mode,r.filter).then(function(h){return h.buffer}):o.ready.then(function(){const h=new ArrayBuffer(u*d);return o.decodeGltfBuffer(new Uint8Array(h),u,d,f,r.mode,r.filter),h})})}return null}}class j6{constructor(e){this.name=en.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,i=t.nodes[e];if(!i.extensions||!i.extensions[this.name]||void 0===i.mesh)return null;const r=t.meshes[i.mesh];for(const l of r.primitives)if(l.mode!==Lr.TRIANGLES&&l.mode!==Lr.TRIANGLE_STRIP&&l.mode!==Lr.TRIANGLE_FAN&&void 0!==l.mode)return null;const o=i.extensions[this.name].attributes,a=[],c={};for(const l in o)a.push(this.parser.getDependency("accessor",o[l]).then(u=>(c[l]=u,c[l])));return a.length<1?null:(a.push(this.parser.createNodeMesh(e)),Promise.all(a).then(l=>{const u=l.pop(),d=u.isGroup?u.children:[u],f=l[0].count,h=[];for(const m of d){const p=new pt,g=new T,_=new Li,v=new T(1,1,1),y=new Wv(m.geometry,m.material,f);for(let x=0;x<f;x++)c.TRANSLATION&&g.fromBufferAttribute(c.TRANSLATION,x),c.ROTATION&&_.fromBufferAttribute(c.ROTATION,x),c.SCALE&&v.fromBufferAttribute(c.SCALE,x),y.setMatrixAt(x,p.compose(g,_,v));for(const x in c)"TRANSLATION"!==x&&"ROTATION"!==x&&"SCALE"!==x&&m.geometry.setAttribute(x,c[x]);_n.prototype.copy.call(y,m),y.frustumCulled=!1,this.parser.assignFinalMaterial(y),h.push(y)}return u.isGroup?(u.clear(),u.add(...h),u):h[0]}))}}const V1="glTF";class $6{constructor(e){this.name=en.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,12),i=new TextDecoder;if(this.header={magic:i.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==V1)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const r=this.header.length-12,s=new DataView(e,12);let o=0;for(;o<r;){const a=s.getUint32(o,!0);o+=4;const c=s.getUint32(o,!0);if(o+=4,1313821514===c){const l=new Uint8Array(e,12+o,a);this.content=i.decode(l)}else if(5130562===c){const l=12+o;this.body=e.slice(l,l+a)}o+=a}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class q6{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=en.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const i=this.json,r=this.dracoLoader,s=e.extensions[this.name].bufferView,o=e.extensions[this.name].attributes,a={},c={},l={};for(const u in o){const d=q0[u]||u.toLowerCase();a[d]=o[u]}for(const u in e.attributes){const d=q0[u]||u.toLowerCase();if(void 0!==o[u]){const f=i.accessors[e.attributes[u]];l[d]=wl[f.componentType].name,c[d]=!0===f.normalized}}return t.getDependency("bufferView",s).then(function(u){return new Promise(function(d){r.decodeDracoFile(u,function(f){for(const h in f.attributes){const p=c[h];void 0!==p&&(f.attributes[h].normalized=p)}d(f)},a,l)})})}}class Z6{constructor(){this.name=en.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return void 0!==t.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),void 0===t.offset&&void 0===t.rotation&&void 0===t.scale||(e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class X6{constructor(){this.name=en.KHR_MESH_QUANTIZATION}}class H1 extends gl{constructor(e,t,i,r){super(e,t,i,r)}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,r=this.valueSize,s=e*r*3+r;for(let o=0;o!==r;o++)t[o]=i[s+o];return t}interpolate_(e,t,i,r){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,c=2*a,l=3*a,u=r-t,d=(i-t)/u,f=d*d,h=f*d,m=e*l,p=m-l,g=-2*h+3*f,_=h-f,v=1-g,y=_-f+d;for(let x=0;x!==a;x++)s[x]=v*o[p+x+a]+y*(o[p+x+c]*u)+g*o[m+x+a]+_*(o[m+x]*u);return s}}const Y6=new Li;class K6 extends H1{interpolate_(e,t,i,r){const s=super.interpolate_(e,t,i,r);return Y6.fromArray(s).normalize().toArray(s),s}}const Lr={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},wl={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},G1={9728:Hn,9729:Fn,9984:zu,9985:Fh,9986:Fc,9987:Ms},W1={33071:Ei,33648:Oc,10497:vo},$0={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},q0={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Fo={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},J6={CUBICSPLINE:void 0,LINEAR:sa,STEP:Bc};function Ud(n,e,t){for(const i in t.extensions)void 0===n[i]&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[i]=t.extensions[i])}function ko(n,e){void 0!==e.extras&&("object"==typeof e.extras?Object.assign(n.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function t8(n,e){if(n.updateMorphTargets(),void 0!==e.weights)for(let t=0,i=e.weights.length;t<i;t++)n.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(n.morphTargetInfluences.length===t.length){n.morphTargetDictionary={};for(let i=0,r=t.length;i<r;i++)n.morphTargetDictionary[t[i]]=i}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function n8(n){const e=n.extensions&&n.extensions[en.KHR_DRACO_MESH_COMPRESSION];let t;return t=e?"draco:"+e.bufferView+":"+e.indices+":"+j1(e.attributes):n.indices+":"+j1(n.attributes)+":"+n.mode,t}function j1(n){let e="";const t=Object.keys(n).sort();for(let i=0,r=t.length;i<r;i++)e+=t[i]+":"+n[t[i]]+";";return e}function X0(n){switch(n){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}const r8=new pt;class s8{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new R6,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let i=!1,r=!1,s=-1;typeof navigator<"u"&&(i=!0===/^((?!chrome|android).)*safari/i.test(navigator.userAgent),r=navigator.userAgent.indexOf("Firefox")>-1,s=r?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),this.textureLoader=typeof createImageBitmap>"u"||i||r&&s<98?new OA(this.options.manager):new qA(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new os(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const i=this,r=this.json,s=this.extensions;this.cache.removeAll(),this._invokeAll(function(o){return o._markDefs&&o._markDefs()}),Promise.all(this._invokeAll(function(o){return o.beforeRoot&&o.beforeRoot()})).then(function(){return Promise.all([i.getDependencies("scene"),i.getDependencies("animation"),i.getDependencies("camera")])}).then(function(o){const a={scene:o[0][r.scene||0],scenes:o[0],animations:o[1],cameras:o[2],asset:r.asset,parser:i,userData:{}};Ud(s,a,r),ko(a,r),Promise.all(i._invokeAll(function(c){return c.afterRoot&&c.afterRoot(a)})).then(function(){e(a)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],i=this.json.meshes||[];for(let r=0,s=t.length;r<s;r++){const o=t[r].joints;for(let a=0,c=o.length;a<c;a++)e[o[a]].isBone=!0}for(let r=0,s=e.length;r<s;r++){const o=e[r];void 0!==o.mesh&&(this._addNodeRef(this.meshCache,o.mesh),void 0!==o.skin&&(i[o.mesh].isSkinnedMesh=!0)),void 0!==o.camera&&this._addNodeRef(this.cameraCache,o.camera)}}_addNodeRef(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,i){if(e.refs[t]<=1)return i;const r=i.clone(),s=(o,a)=>{const c=this.associations.get(o);null!=c&&this.associations.set(a,c);for(const[l,u]of o.children.entries())s(u,a.children[l])};return s(i,r),r.name+="_instance_"+e.uses[t]++,r}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let i=0;i<t.length;i++){const r=e(t[i]);if(r)return r}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const i=[];for(let r=0;r<t.length;r++){const s=e(t[r]);s&&i.push(s)}return i}getDependency(e,t){const i=e+":"+t;let r=this.cache.get(i);if(!r){switch(e){case"scene":r=this.loadScene(t);break;case"node":r=this._invokeOne(function(s){return s.loadNode&&s.loadNode(t)});break;case"mesh":r=this._invokeOne(function(s){return s.loadMesh&&s.loadMesh(t)});break;case"accessor":r=this.loadAccessor(t);break;case"bufferView":r=this._invokeOne(function(s){return s.loadBufferView&&s.loadBufferView(t)});break;case"buffer":r=this.loadBuffer(t);break;case"material":r=this._invokeOne(function(s){return s.loadMaterial&&s.loadMaterial(t)});break;case"texture":r=this._invokeOne(function(s){return s.loadTexture&&s.loadTexture(t)});break;case"skin":r=this.loadSkin(t);break;case"animation":r=this._invokeOne(function(s){return s.loadAnimation&&s.loadAnimation(t)});break;case"camera":r=this.loadCamera(t);break;default:if(r=this._invokeOne(function(s){return s!=this&&s.getDependency&&s.getDependency(e,t)}),!r)throw new Error("Unknown type: "+e)}this.cache.add(i,r)}return r}getDependencies(e){let t=this.cache.get(e);if(!t){const i=this;t=Promise.all((this.json[e+("mesh"===e?"es":"s")]||[]).map(function(s,o){return i.getDependency(e,o)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],i=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[en.KHR_BINARY_GLTF].body);const r=this.options;return new Promise(function(s,o){i.load(xl.resolveURL(t.uri,r.path),s,void 0,function(){o(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(i){const s=t.byteOffset||0;return i.slice(s,s+(t.byteLength||0))})}loadAccessor(e){const t=this,i=this.json,r=this.json.accessors[e];if(void 0===r.bufferView&&void 0===r.sparse){const o=$0[r.type],c=!0===r.normalized,l=new(0,wl[r.componentType])(r.count*o);return Promise.resolve(new an(l,o,c))}const s=[];return s.push(void 0!==r.bufferView?this.getDependency("bufferView",r.bufferView):null),void 0!==r.sparse&&(s.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),s.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(s).then(function(o){const a=o[0],c=$0[r.type],l=wl[r.componentType],u=l.BYTES_PER_ELEMENT,f=r.byteOffset||0,h=void 0!==r.bufferView?i.bufferViews[r.bufferView].byteStride:void 0,m=!0===r.normalized;let p,g;if(h&&h!==u*c){const _=Math.floor(f/h),v="InterleavedBuffer:"+r.bufferView+":"+r.componentType+":"+_+":"+r.count;let y=t.cache.get(v);y||(p=new l(a,_*h,r.count*h/u),y=new id(p,h/u),t.cache.add(v,y)),g=new Po(y,c,f%h/u,m)}else p=null===a?new l(r.count*c):new l(a,f,r.count*c),g=new an(p,c,m);if(void 0!==r.sparse){const x=r.sparse.values.byteOffset||0,w=new(0,wl[r.sparse.indices.componentType])(o[1],r.sparse.indices.byteOffset||0,r.sparse.count*$0.SCALAR),M=new l(o[2],x,r.sparse.count*c);null!==a&&(g=new an(g.array.slice(),g.itemSize,g.normalized));for(let A=0,b=w.length;A<b;A++){const S=w[A];if(g.setX(S,M[A*c]),c>=2&&g.setY(S,M[A*c+1]),c>=3&&g.setZ(S,M[A*c+2]),c>=4&&g.setW(S,M[A*c+3]),c>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return g})}loadTexture(e){const t=this.json,s=t.textures[e].source,o=t.images[s];let a=this.textureLoader;if(o.uri){const c=this.options.manager.getHandler(o.uri);null!==c&&(a=c)}return this.loadTextureImage(e,s,a)}loadTextureImage(e,t,i){const r=this,s=this.json,o=s.textures[e],a=s.images[t],c=(a.uri||a.bufferView)+":"+o.sampler;if(this.textureCache[c])return this.textureCache[c];const l=this.loadImageSource(t,i).then(function(u){u.flipY=!1,u.name=o.name||a.name||"";const f=(s.samplers||{})[o.sampler]||{};return u.magFilter=G1[f.magFilter]||Fn,u.minFilter=G1[f.minFilter]||Ms,u.wrapS=W1[f.wrapS]||vo,u.wrapT=W1[f.wrapT]||vo,r.associations.set(u,{textures:e}),u}).catch(function(){return null});return this.textureCache[c]=l,l}loadImageSource(e,t){const r=this.json,s=this.options;if(void 0!==this.sourceCache[e])return this.sourceCache[e].then(d=>d.clone());const o=r.images[e],a=self.URL||self.webkitURL;let c=o.uri||"",l=!1;if(void 0!==o.bufferView)c=this.getDependency("bufferView",o.bufferView).then(function(d){l=!0;const f=new Blob([d],{type:o.mimeType});return c=a.createObjectURL(f),c});else if(void 0===o.uri)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const u=Promise.resolve(c).then(function(d){return new Promise(function(f,h){let m=f;!0===t.isImageBitmapLoader&&(m=function(p){const g=new Ti(p);g.needsUpdate=!0,f(g)}),t.load(xl.resolveURL(d,s.path),m,void 0,h)})}).then(function(d){return!0===l&&a.revokeObjectURL(c),d.userData.mimeType=o.mimeType||function i8(n){return n.search(/\.jpe?g($|\?)/i)>0||0===n.search(/^data\:image\/jpeg/)?"image/jpeg":n.search(/\.webp($|\?)/i)>0||0===n.search(/^data\:image\/webp/)?"image/webp":"image/png"}(o.uri),d}).catch(function(d){throw console.error("THREE.GLTFLoader: Couldn't load texture",c),d});return this.sourceCache[e]=u,u}assignTexture(e,t,i,r){const s=this;return this.getDependency("texture",i.index).then(function(o){if(!o)return null;if(void 0!==i.texCoord&&0!=i.texCoord&&!("aoMap"===t&&1==i.texCoord)&&console.warn("THREE.GLTFLoader: Custom UV set "+i.texCoord+" for texture "+t+" not yet supported."),s.extensions[en.KHR_TEXTURE_TRANSFORM]){const a=void 0!==i.extensions?i.extensions[en.KHR_TEXTURE_TRANSFORM]:void 0;if(a){const c=s.associations.get(o);o=s.extensions[en.KHR_TEXTURE_TRANSFORM].extendTexture(o,a),s.associations.set(o,c)}}return void 0!==r&&(o.encoding=r),e[t]=o,o})}assignFinalMaterial(e){const t=e.geometry;let i=e.material;const r=void 0===t.attributes.tangent,s=void 0!==t.attributes.color,o=void 0===t.attributes.normal;if(e.isPoints){const a="PointsMaterial:"+i.uuid;let c=this.cache.get(a);c||(c=new Ap,ui.prototype.copy.call(c,i),c.color.copy(i.color),c.map=i.map,c.sizeAttenuation=!1,this.cache.add(a,c)),i=c}else if(e.isLine){const a="LineBasicMaterial:"+i.uuid;let c=this.cache.get(a);c||(c=new Ni,ui.prototype.copy.call(c,i),c.color.copy(i.color),this.cache.add(a,c)),i=c}if(r||s||o){let a="ClonedMaterial:"+i.uuid+":";r&&(a+="derivative-tangents:"),s&&(a+="vertex-colors:"),o&&(a+="flat-shading:");let c=this.cache.get(a);c||(c=i.clone(),s&&(c.vertexColors=!0),o&&(c.flatShading=!0),r&&(c.normalScale&&(c.normalScale.y*=-1),c.clearcoatNormalScale&&(c.clearcoatNormalScale.y*=-1)),this.cache.add(a,c),this.associations.set(c,this.associations.get(i))),i=c}i.aoMap&&void 0===t.attributes.uv2&&void 0!==t.attributes.uv&&t.setAttribute("uv2",t.attributes.uv),e.material=i}getMaterialType(){return Dd}loadMaterial(e){const t=this,r=this.extensions,s=this.json.materials[e];let o;const a={},l=[];if((s.extensions||{})[en.KHR_MATERIALS_UNLIT]){const d=r[en.KHR_MATERIALS_UNLIT];o=d.getMaterialType(),l.push(d.extendParams(a,s,t))}else{const d=s.pbrMetallicRoughness||{};if(a.color=new De(1,1,1),a.opacity=1,Array.isArray(d.baseColorFactor)){const f=d.baseColorFactor;a.color.fromArray(f),a.opacity=f[3]}void 0!==d.baseColorTexture&&l.push(t.assignTexture(a,"map",d.baseColorTexture,Qt)),a.metalness=void 0!==d.metallicFactor?d.metallicFactor:1,a.roughness=void 0!==d.roughnessFactor?d.roughnessFactor:1,void 0!==d.metallicRoughnessTexture&&(l.push(t.assignTexture(a,"metalnessMap",d.metallicRoughnessTexture)),l.push(t.assignTexture(a,"roughnessMap",d.metallicRoughnessTexture))),o=this._invokeOne(function(f){return f.getMaterialType&&f.getMaterialType(e)}),l.push(Promise.all(this._invokeAll(function(f){return f.extendMaterialParams&&f.extendMaterialParams(e,a)})))}!0===s.doubleSided&&(a.side=ws);const u=s.alphaMode||"OPAQUE";if("BLEND"===u?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,"MASK"===u&&(a.alphaTest=void 0!==s.alphaCutoff?s.alphaCutoff:.5)),void 0!==s.normalTexture&&o!==pr&&(l.push(t.assignTexture(a,"normalMap",s.normalTexture)),a.normalScale=new ce(1,1),void 0!==s.normalTexture.scale)){const d=s.normalTexture.scale;a.normalScale.set(d,d)}return void 0!==s.occlusionTexture&&o!==pr&&(l.push(t.assignTexture(a,"aoMap",s.occlusionTexture)),void 0!==s.occlusionTexture.strength&&(a.aoMapIntensity=s.occlusionTexture.strength)),void 0!==s.emissiveFactor&&o!==pr&&(a.emissive=(new De).fromArray(s.emissiveFactor)),void 0!==s.emissiveTexture&&o!==pr&&l.push(t.assignTexture(a,"emissiveMap",s.emissiveTexture,Qt)),Promise.all(l).then(function(){const d=new o(a);return s.name&&(d.name=s.name),ko(d,s),t.associations.set(d,{materials:e}),s.extensions&&Ud(r,d,s),d})}createUniqueName(e){const t=vn.sanitizeNodeName(e||"");let i=t;for(let r=1;this.nodeNamesUsed[i];++r)i=t+"_"+r;return this.nodeNamesUsed[i]=!0,i}loadGeometries(e){const t=this,i=this.extensions,r=this.primitiveCache;function s(a){return i[en.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(a,t).then(function(c){return $1(c,a,t)})}const o=[];for(let a=0,c=e.length;a<c;a++){const l=e[a],u=n8(l),d=r[u];if(d)o.push(d.promise);else{let f;f=l.extensions&&l.extensions[en.KHR_DRACO_MESH_COMPRESSION]?s(l):$1(new Pt,l,t),r[u]={primitive:l,promise:f},o.push(f)}}return Promise.all(o)}loadMesh(e){const t=this,r=this.extensions,s=this.json.meshes[e],o=s.primitives,a=[];for(let c=0,l=o.length;c<l;c++){const u=void 0===o[c].material?(void 0===(n=this.cache).DefaultMaterial&&(n.DefaultMaterial=new Dd({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:bs})),n.DefaultMaterial):this.getDependency("material",o[c].material);a.push(u)}var n;return a.push(t.loadGeometries(o)),Promise.all(a).then(function(c){const l=c.slice(0,c.length-1),u=c[c.length-1],d=[];for(let h=0,m=u.length;h<m;h++){const p=u[h],g=o[h];let _;const v=l[h];if(g.mode===Lr.TRIANGLES||g.mode===Lr.TRIANGLE_STRIP||g.mode===Lr.TRIANGLE_FAN||void 0===g.mode)_=!0===s.isSkinnedMesh?new Gv(p,v):new yi(p,v),!0===_.isSkinnedMesh&&!_.geometry.attributes.skinWeight.normalized&&_.normalizeSkinWeights(),g.mode===Lr.TRIANGLE_STRIP?_.geometry=U1(_.geometry,iv):g.mode===Lr.TRIANGLE_FAN&&(_.geometry=U1(_.geometry,Wh));else if(g.mode===Lr.LINES)_=new is(p,v);else if(g.mode===Lr.LINE_STRIP)_=new to(p,v);else if(g.mode===Lr.LINE_LOOP)_=new $v(p,v);else{if(g.mode!==Lr.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+g.mode);_=new Zv(p,v)}Object.keys(_.geometry.morphAttributes).length>0&&t8(_,s),_.name=t.createUniqueName(s.name||"mesh_"+e),ko(_,s),g.extensions&&Ud(r,_,g),t.assignFinalMaterial(_),d.push(_)}for(let h=0,m=d.length;h<m;h++)t.associations.set(d[h],{meshes:e,primitives:h});if(1===d.length)return d[0];const f=new eo;t.associations.set(f,{meshes:e});for(let h=0,m=d.length;h<m;h++)f.add(d[h]);return f})}loadCamera(e){let t;const i=this.json.cameras[e],r=i[i.type];if(r)return"perspective"===i.type?t=new di(av.radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):"orthographic"===i.type&&(t=new nl(-r.xmag,r.xmag,r.ymag,-r.ymag,r.znear,r.zfar)),i.name&&(t.name=this.createUniqueName(i.name)),ko(t,i),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(e){const t=this.json.skins[e],i=[];for(let r=0,s=t.joints.length;r<s;r++)i.push(this.getDependency("node",t.joints[r]));return i.push(void 0!==t.inverseBindMatrices?this.getDependency("accessor",t.inverseBindMatrices):null),Promise.all(i).then(function(r){const s=r.pop(),o=r,a=[],c=[];for(let l=0,u=o.length;l<u;l++){const d=o[l];if(d){a.push(d);const f=new pt;null!==s&&f.fromArray(s.array,16*l),c.push(f)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[l])}return new ad(a,c)})}loadAnimation(e){const i=this.json.animations[e],r=[],s=[],o=[],a=[],c=[];for(let l=0,u=i.channels.length;l<u;l++){const d=i.channels[l],f=i.samplers[d.sampler],h=d.target,p=void 0!==i.parameters?i.parameters[f.input]:f.input,g=void 0!==i.parameters?i.parameters[f.output]:f.output;r.push(this.getDependency("node",h.node)),s.push(this.getDependency("accessor",p)),o.push(this.getDependency("accessor",g)),a.push(f),c.push(h)}return Promise.all([Promise.all(r),Promise.all(s),Promise.all(o),Promise.all(a),Promise.all(c)]).then(function(l){const u=l[0],d=l[1],f=l[2],h=l[3],m=l[4],p=[];for(let _=0,v=u.length;_<v;_++){const y=u[_],x=d[_],w=f[_],M=h[_],A=m[_];if(void 0===y)continue;let b;switch(y.updateMatrix(),Fo[A.path]){case Fo.weights:b=yl;break;case Fo.rotation:b=Lo;break;default:b=_l}const S=y.name?y.name:y.uuid,R=void 0!==M.interpolation?J6[M.interpolation]:sa,B=[];Fo[A.path]===Fo.weights?y.traverse(function(k){k.morphTargetInfluences&&B.push(k.name?k.name:k.uuid)}):B.push(S);let G=w.array;if(w.normalized){const k=X0(G.constructor),N=new Float32Array(G.length);for(let q=0,ne=G.length;q<ne;q++)N[q]=G[q]*k;G=N}for(let k=0,N=B.length;k<N;k++){const q=new b(B[k]+"."+Fo[A.path],x.array,G,R);"CUBICSPLINE"===M.interpolation&&(q.createInterpolant=function(pe){return new(this instanceof Lo?K6:H1)(this.times,this.values,this.getValueSize()/3,pe)},q.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),p.push(q)}}return new vl(i.name?i.name:"animation_"+e,void 0,p)})}createNodeMesh(e){const i=this,r=this.json.nodes[e];return void 0===r.mesh?null:i.getDependency("mesh",r.mesh).then(function(s){const o=i._getNodeRef(i.meshCache,r.mesh,s);return void 0!==r.weights&&o.traverse(function(a){if(a.isMesh)for(let c=0,l=r.weights.length;c<l;c++)a.morphTargetInfluences[c]=r.weights[c]}),o})}loadNode(e){const i=this.extensions,r=this,s=this.json.nodes[e],o=s.name?r.createUniqueName(s.name):"";return function(){const a=[],c=r._invokeOne(function(f){return f.createNodeMesh&&f.createNodeMesh(e)});c&&a.push(c),void 0!==s.camera&&a.push(r.getDependency("camera",s.camera).then(function(f){return r._getNodeRef(r.cameraCache,s.camera,f)})),r._invokeAll(function(f){return f.createNodeAttachment&&f.createNodeAttachment(e)}).forEach(function(f){a.push(f)});const l=[],u=s.children||[];for(let f=0,h=u.length;f<h;f++)l.push(r.getDependency("node",u[f]));const d=void 0===s.skin?Promise.resolve(null):r.getDependency("skin",s.skin);return Promise.all([Promise.all(a),Promise.all(l),d])}().then(function(a){const c=a[0],l=a[1],u=a[2];let d;if(d=!0===s.isBone?new Tp:c.length>1?new eo:1===c.length?c[0]:new _n,d!==c[0])for(let f=0,h=c.length;f<h;f++)d.add(c[f]);if(s.name&&(d.userData.name=s.name,d.name=o),ko(d,s),s.extensions&&Ud(i,d,s),void 0!==s.matrix){const f=new pt;f.fromArray(s.matrix),d.applyMatrix4(f)}else void 0!==s.translation&&d.position.fromArray(s.translation),void 0!==s.rotation&&d.quaternion.fromArray(s.rotation),void 0!==s.scale&&d.scale.fromArray(s.scale);r.associations.has(d)||r.associations.set(d,{}),r.associations.get(d).nodes=e,null!==u&&d.traverse(function(f){f.isSkinnedMesh&&f.bind(u,r8)});for(let f=0,h=l.length;f<h;f++)d.add(l[f]);return d})}loadScene(e){const t=this.extensions,i=this.json.scenes[e],r=this,s=new eo;i.name&&(s.name=r.createUniqueName(i.name)),ko(s,i),i.extensions&&Ud(t,s,i);const o=i.nodes||[],a=[];for(let c=0,l=o.length;c<l;c++)a.push(r.getDependency("node",o[c]));return Promise.all(a).then(function(c){for(let u=0,d=c.length;u<d;u++)s.add(c[u]);return r.associations=(u=>{const d=new Map;for(const[f,h]of r.associations)(f instanceof ui||f instanceof Ti)&&d.set(f,h);return u.traverse(f=>{const h=r.associations.get(f);null!=h&&d.set(f,h)}),d})(s),s})}}function $1(n,e,t){const i=e.attributes,r=[];function s(o,a){return t.getDependency("accessor",o).then(function(c){n.setAttribute(a,c)})}for(const o in i){const a=q0[o]||o.toLowerCase();a in n.attributes||r.push(s(i[o],a))}if(void 0!==e.indices&&!n.index){const o=t.getDependency("accessor",e.indices).then(function(a){n.setIndex(a)});r.push(o)}return ko(n,e),function o8(n,e,t){const i=e.attributes,r=new So;if(void 0===i.POSITION)return;{const a=t.json.accessors[i.POSITION],c=a.min,l=a.max;if(void 0===c||void 0===l)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(r.set(new T(c[0],c[1],c[2]),new T(l[0],l[1],l[2])),a.normalized){const u=X0(wl[a.componentType]);r.min.multiplyScalar(u),r.max.multiplyScalar(u)}}const s=e.targets;if(void 0!==s){const a=new T,c=new T;for(let l=0,u=s.length;l<u;l++){const d=s[l];if(void 0!==d.POSITION){const f=t.json.accessors[d.POSITION],h=f.min,m=f.max;if(void 0!==h&&void 0!==m){if(c.setX(Math.max(Math.abs(h[0]),Math.abs(m[0]))),c.setY(Math.max(Math.abs(h[1]),Math.abs(m[1]))),c.setZ(Math.max(Math.abs(h[2]),Math.abs(m[2]))),f.normalized){const p=X0(wl[f.componentType]);c.multiplyScalar(p)}a.max(c)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}r.expandByVector(a)}n.boundingBox=r;const o=new Do;r.getCenter(o.center),o.radius=r.min.distanceTo(r.max)/2,n.boundingSphere=o}(n,e,t),Promise.all(r).then(function(){return void 0!==e.targets?function e8(n,e,t){let i=!1,r=!1,s=!1;for(let l=0,u=e.length;l<u;l++){const d=e[l];if(void 0!==d.POSITION&&(i=!0),void 0!==d.NORMAL&&(r=!0),void 0!==d.COLOR_0&&(s=!0),i&&r&&s)break}if(!i&&!r&&!s)return Promise.resolve(n);const o=[],a=[],c=[];for(let l=0,u=e.length;l<u;l++){const d=e[l];if(i){const f=void 0!==d.POSITION?t.getDependency("accessor",d.POSITION):n.attributes.position;o.push(f)}if(r){const f=void 0!==d.NORMAL?t.getDependency("accessor",d.NORMAL):n.attributes.normal;a.push(f)}if(s){const f=void 0!==d.COLOR_0?t.getDependency("accessor",d.COLOR_0):n.attributes.color;c.push(f)}}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(c)]).then(function(l){const d=l[1],f=l[2];return i&&(n.morphAttributes.position=l[0]),r&&(n.morphAttributes.normal=d),s&&(n.morphAttributes.color=f),n.morphTargetsRelative=!0,n})}(n,e.targets,t):n})}function a8(n,e){if(1&n){const t=ey();bc(0,"ngt-primitive",3),mu("beforeRender",function(r){return Am(t),Im(Jf().onBeforeRender(r))}),wc()}2&n&&Us("scale",1)}const c8=function(n){return[n]};!function c6(n){Object.assign(R1,n)}(cs);let l8=(()=>{class n{constructor(){this.model$=M1(()=>I6,"../assets/vitesse_sphere_2.glb").pipe(bn(t=>t.scene))}onBeforeRender(t){throw t.object.rotation.x+=.01,new Error("Method not implemented.")}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=zl({type:n,selectors:[["ng-component"]],standalone:!0,features:[wu],decls:4,vars:7,consts:[["angle","0.15","penumbra","1","color","red",3,"position"],[3,"position"],[3,"scale","beforeRender",4,"args"],[3,"scale","beforeRender"]],template:function(t,i){1&t&&(pu(0,"ngt-spot-light",0)(1,"ngt-point-light",1),Jg(2,a8,1,1,"ngt-primitive",2),function $S(n,e){const t=jt();let i;const r=n+An;t.firstCreatePass?(i=function W2(n,e){if(e)for(let t=e.length-1;t>=0;t--){const i=e[t];if(n===i.name)return i}}(e,t.pipeRegistry),t.data[r]=i,i.onDestroy&&(t.destroyHooks??(t.destroyHooks=[])).push(r,i.onDestroy)):i=t.data[r];const s=i.factory||(i.factory=Ho(i.type)),o=Mr(yt);try{const a=xf(!1),c=s();return xf(a),function CN(n,e,t,i){t>=n.data.length&&(n.data[t]=null,n.blueprint[t]=null),e[t]=i}(t,le(),r,c),c}finally{Mr(o)}}(3,"ngtPush")),2&t&&(Us("position",10),Uf(1),Us("position",10),Uf(1),Us("args",function VS(n,e,t,i){return zS(le(),Ui(),n,e,t,i)}(5,c8,qS(3,3,i.model$))))},dependencies:[P1,T6],encapsulation:2}),n})();(function xB(n,e){return jF({rootComponent:n,...IT(e)})})((()=>{class n{constructor(){this.Scene=l8}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=zl({type:n,selectors:[["my-app"]],standalone:!0,features:[wu],decls:1,vars:1,consts:[[3,"sceneGraph"]],template:function(t,i){1&t&&pu(0,"ngt-canvas",0),2&t&&Us("sceneGraph",i.Scene)},dependencies:[w6],encapsulation:2}),n})()).then(n=>{}).catch(n=>console.error(n))},609:function(Oa,Ml,Fa){var cs,zd,bt=this&&this.__spreadArray||function(_r,sr,ls){if(ls||2===arguments.length)for(var vr,Rn=0,ka=sr.length;Rn<ka;Rn++)(vr||!(Rn in sr))&&(vr||(vr=Array.prototype.slice.call(sr,0,Rn)),vr[Rn]=sr[Rn]);return _r.concat(vr||Array.prototype.slice.call(sr))};cs=function(){!function(D){var P=D.performance;function O(ve){P&&P.mark&&P.mark(ve)}function V(ve,U){P&&P.measure&&P.measure(ve,U)}O("Zone");var Y=D.__Zone_symbol_prefix||"__zone_symbol__";function J(ve){return Y+ve}var fe=!0===D[J("forceDuplicateZoneCheck")];if(D.Zone){if(fe||"function"!=typeof D.Zone.__symbol__)throw new Error("Zone already loaded.");return D.Zone}var ye=function(){function ve(U,L){this._parent=U,this._name=L?L.name||"unnamed":"<root>",this._properties=L&&L.properties||{},this._zoneDelegate=new Be(this,this._parent&&this._parent._zoneDelegate,L)}return ve.assertZonePatched=function(){if(D.Promise!==nt.ZoneAwarePromise)throw new Error("Zone.js has detected that ZoneAwarePromise `(window|global).Promise` has been overwritten.\nMost likely cause is that a Promise polyfill has been loaded after Zone.js (Polyfilling Promise api is not necessary when zone.js is loaded. If you must load one, do so before loading zone.js.)")},Object.defineProperty(ve,"root",{get:function(){for(var U=ve.current;U.parent;)U=U.parent;return U},enumerable:!1,configurable:!0}),Object.defineProperty(ve,"current",{get:function(){return Ye.zone},enumerable:!1,configurable:!0}),Object.defineProperty(ve,"currentTask",{get:function(){return mi},enumerable:!1,configurable:!0}),ve.__load_patch=function(U,L,Z){if(void 0===Z&&(Z=!1),nt.hasOwnProperty(U)){if(!Z&&fe)throw Error("Already loaded patch: "+U)}else if(!D["__Zone_disable_"+U]){var Ke="Zone:"+U;O(Ke),nt[U]=L(D,ve,ln),V(Ke,Ke)}},Object.defineProperty(ve.prototype,"parent",{get:function(){return this._parent},enumerable:!1,configurable:!0}),Object.defineProperty(ve.prototype,"name",{get:function(){return this._name},enumerable:!1,configurable:!0}),ve.prototype.get=function(U){var L=this.getZoneWith(U);if(L)return L._properties[U]},ve.prototype.getZoneWith=function(U){for(var L=this;L;){if(L._properties.hasOwnProperty(U))return L;L=L._parent}return null},ve.prototype.fork=function(U){if(!U)throw new Error("ZoneSpec required!");return this._zoneDelegate.fork(this,U)},ve.prototype.wrap=function(U,L){if("function"!=typeof U)throw new Error("Expecting function got: "+U);var Z=this._zoneDelegate.intercept(this,U,L),Ke=this;return function(){return Ke.runGuarded(Z,this,arguments,L)}},ve.prototype.run=function(U,L,Z,Ke){Ye={parent:Ye,zone:this};try{return this._zoneDelegate.invoke(this,U,L,Z,Ke)}finally{Ye=Ye.parent}},ve.prototype.runGuarded=function(U,L,Z,Ke){void 0===L&&(L=null),Ye={parent:Ye,zone:this};try{try{return this._zoneDelegate.invoke(this,U,L,Z,Ke)}catch(Mn){if(this._zoneDelegate.handleError(this,Mn))throw Mn}}finally{Ye=Ye.parent}},ve.prototype.runTask=function(U,L,Z){if(U.zone!=this)throw new Error("A task can only be run in the zone of creation! (Creation: "+(U.zone||ze).name+"; Execution: "+this.name+")");if(U.state!==pn||U.type!==Dt&&U.type!==Xe){var Ke=U.state!=Gt;Ke&&U._transitionTo(Gt,Ht),U.runCount++;var Mn=mi;mi=U,Ye={parent:Ye,zone:this};try{U.type==Xe&&U.data&&!U.data.isPeriodic&&(U.cancelFn=void 0);try{return this._zoneDelegate.invokeTask(this,U,L,Z)}catch(Ki){if(this._zoneDelegate.handleError(this,Ki))throw Ki}}finally{U.state!==pn&&U.state!==gn&&(U.type==Dt||U.data&&U.data.isPeriodic?Ke&&U._transitionTo(Ht,Gt):(U.runCount=0,this._updateTaskCount(U,-1),Ke&&U._transitionTo(pn,Gt,pn))),Ye=Ye.parent,mi=Mn}}},ve.prototype.scheduleTask=function(U){if(U.zone&&U.zone!==this)for(var L=this;L;){if(L===U.zone)throw Error("can not reschedule task to ".concat(this.name," which is descendants of the original zone ").concat(U.zone.name));L=L.parent}U._transitionTo(Bt,pn);var Z=[];U._zoneDelegates=Z,U._zone=this;try{U=this._zoneDelegate.scheduleTask(this,U)}catch(Ke){throw U._transitionTo(gn,Bt,pn),this._zoneDelegate.handleError(this,Ke),Ke}return U._zoneDelegates===Z&&this._updateTaskCount(U,1),U.state==Bt&&U._transitionTo(Ht,Bt),U},ve.prototype.scheduleMicroTask=function(U,L,Z,Ke){return this.scheduleTask(new Te(Tt,U,L,Z,Ke,void 0))},ve.prototype.scheduleMacroTask=function(U,L,Z,Ke,Mn){return this.scheduleTask(new Te(Xe,U,L,Z,Ke,Mn))},ve.prototype.scheduleEventTask=function(U,L,Z,Ke,Mn){return this.scheduleTask(new Te(Dt,U,L,Z,Ke,Mn))},ve.prototype.cancelTask=function(U){if(U.zone!=this)throw new Error("A task can only be cancelled in the zone of creation! (Creation: "+(U.zone||ze).name+"; Execution: "+this.name+")");if(U.state===Ht||U.state===Gt){U._transitionTo(Ze,Ht,Gt);try{this._zoneDelegate.cancelTask(this,U)}catch(L){throw U._transitionTo(gn,Ze),this._zoneDelegate.handleError(this,L),L}return this._updateTaskCount(U,-1),U._transitionTo(pn,Ze),U.runCount=0,U}},ve.prototype._updateTaskCount=function(U,L){var Z=U._zoneDelegates;-1==L&&(U._zoneDelegates=null);for(var Ke=0;Ke<Z.length;Ke++)Z[Ke]._updateTaskCount(U.type,L)},ve}();ye.__symbol__=J;var Dn,Ie={name:"",onHasTask:function(ve,U,L,Z){return ve.hasTask(L,Z)},onScheduleTask:function(ve,U,L,Z){return ve.scheduleTask(L,Z)},onInvokeTask:function(ve,U,L,Z,Ke,Mn){return ve.invokeTask(L,Z,Ke,Mn)},onCancelTask:function(ve,U,L,Z){return ve.cancelTask(L,Z)}},Be=function(){function ve(U,L,Z){this._taskCounts={microTask:0,macroTask:0,eventTask:0},this.zone=U,this._parentDelegate=L,this._forkZS=Z&&(Z&&Z.onFork?Z:L._forkZS),this._forkDlgt=Z&&(Z.onFork?L:L._forkDlgt),this._forkCurrZone=Z&&(Z.onFork?this.zone:L._forkCurrZone),this._interceptZS=Z&&(Z.onIntercept?Z:L._interceptZS),this._interceptDlgt=Z&&(Z.onIntercept?L:L._interceptDlgt),this._interceptCurrZone=Z&&(Z.onIntercept?this.zone:L._interceptCurrZone),this._invokeZS=Z&&(Z.onInvoke?Z:L._invokeZS),this._invokeDlgt=Z&&(Z.onInvoke?L:L._invokeDlgt),this._invokeCurrZone=Z&&(Z.onInvoke?this.zone:L._invokeCurrZone),this._handleErrorZS=Z&&(Z.onHandleError?Z:L._handleErrorZS),this._handleErrorDlgt=Z&&(Z.onHandleError?L:L._handleErrorDlgt),this._handleErrorCurrZone=Z&&(Z.onHandleError?this.zone:L._handleErrorCurrZone),this._scheduleTaskZS=Z&&(Z.onScheduleTask?Z:L._scheduleTaskZS),this._scheduleTaskDlgt=Z&&(Z.onScheduleTask?L:L._scheduleTaskDlgt),this._scheduleTaskCurrZone=Z&&(Z.onScheduleTask?this.zone:L._scheduleTaskCurrZone),this._invokeTaskZS=Z&&(Z.onInvokeTask?Z:L._invokeTaskZS),this._invokeTaskDlgt=Z&&(Z.onInvokeTask?L:L._invokeTaskDlgt),this._invokeTaskCurrZone=Z&&(Z.onInvokeTask?this.zone:L._invokeTaskCurrZone),this._cancelTaskZS=Z&&(Z.onCancelTask?Z:L._cancelTaskZS),this._cancelTaskDlgt=Z&&(Z.onCancelTask?L:L._cancelTaskDlgt),this._cancelTaskCurrZone=Z&&(Z.onCancelTask?this.zone:L._cancelTaskCurrZone),this._hasTaskZS=null,this._hasTaskDlgt=null,this._hasTaskDlgtOwner=null,this._hasTaskCurrZone=null;var Ke=Z&&Z.onHasTask;(Ke||L&&L._hasTaskZS)&&(this._hasTaskZS=Ke?Z:Ie,this._hasTaskDlgt=L,this._hasTaskDlgtOwner=this,this._hasTaskCurrZone=U,Z.onScheduleTask||(this._scheduleTaskZS=Ie,this._scheduleTaskDlgt=L,this._scheduleTaskCurrZone=this.zone),Z.onInvokeTask||(this._invokeTaskZS=Ie,this._invokeTaskDlgt=L,this._invokeTaskCurrZone=this.zone),Z.onCancelTask||(this._cancelTaskZS=Ie,this._cancelTaskDlgt=L,this._cancelTaskCurrZone=this.zone))}return ve.prototype.fork=function(U,L){return this._forkZS?this._forkZS.onFork(this._forkDlgt,this.zone,U,L):new ye(U,L)},ve.prototype.intercept=function(U,L,Z){return this._interceptZS?this._interceptZS.onIntercept(this._interceptDlgt,this._interceptCurrZone,U,L,Z):L},ve.prototype.invoke=function(U,L,Z,Ke,Mn){return this._invokeZS?this._invokeZS.onInvoke(this._invokeDlgt,this._invokeCurrZone,U,L,Z,Ke,Mn):L.apply(Z,Ke)},ve.prototype.handleError=function(U,L){return!this._handleErrorZS||this._handleErrorZS.onHandleError(this._handleErrorDlgt,this._handleErrorCurrZone,U,L)},ve.prototype.scheduleTask=function(U,L){var Z=L;if(this._scheduleTaskZS)this._hasTaskZS&&Z._zoneDelegates.push(this._hasTaskDlgtOwner),(Z=this._scheduleTaskZS.onScheduleTask(this._scheduleTaskDlgt,this._scheduleTaskCurrZone,U,L))||(Z=L);else if(L.scheduleFn)L.scheduleFn(L);else{if(L.type!=Tt)throw new Error("Task is missing scheduleFn.");wn(L)}return Z},ve.prototype.invokeTask=function(U,L,Z,Ke){return this._invokeTaskZS?this._invokeTaskZS.onInvokeTask(this._invokeTaskDlgt,this._invokeTaskCurrZone,U,L,Z,Ke):L.callback.apply(Z,Ke)},ve.prototype.cancelTask=function(U,L){var Z;if(this._cancelTaskZS)Z=this._cancelTaskZS.onCancelTask(this._cancelTaskDlgt,this._cancelTaskCurrZone,U,L);else{if(!L.cancelFn)throw Error("Task is not cancelable");Z=L.cancelFn(L)}return Z},ve.prototype.hasTask=function(U,L){try{this._hasTaskZS&&this._hasTaskZS.onHasTask(this._hasTaskDlgt,this._hasTaskCurrZone,U,L)}catch(Z){this.handleError(U,Z)}},ve.prototype._updateTaskCount=function(U,L){var Z=this._taskCounts,Ke=Z[U],Mn=Z[U]=Ke+L;if(Mn<0)throw new Error("More tasks executed then were scheduled.");0!=Ke&&0!=Mn||this.hasTask(this.zone,{microTask:Z.microTask>0,macroTask:Z.macroTask>0,eventTask:Z.eventTask>0,change:U})},ve}(),Te=function(){function ve(U,L,Z,Ke,Mn,Ki){if(this._zone=null,this.runCount=0,this._zoneDelegates=null,this._state="notScheduled",this.type=U,this.source=L,this.data=Ke,this.scheduleFn=Mn,this.cancelFn=Ki,!Z)throw new Error("callback is not defined");this.callback=Z;var z=this;this.invoke=U===Dt&&Ke&&Ke.useG?ve.invokeTask:function(){return ve.invokeTask.call(D,z,this,arguments)}}return ve.invokeTask=function(U,L,Z){U||(U=this),it++;try{return U.runCount++,U.zone.runTask(U,L,Z)}finally{1==it&&wt(),it--}},Object.defineProperty(ve.prototype,"zone",{get:function(){return this._zone},enumerable:!1,configurable:!0}),Object.defineProperty(ve.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),ve.prototype.cancelScheduleRequest=function(){this._transitionTo(pn,Bt)},ve.prototype._transitionTo=function(U,L,Z){if(this._state!==L&&this._state!==Z)throw new Error("".concat(this.type," '").concat(this.source,"': can not transition to '").concat(U,"', expecting state '").concat(L,"'").concat(Z?" or '"+Z+"'":"",", was '").concat(this._state,"'."));this._state=U,U==pn&&(this._zoneDelegates=null)},ve.prototype.toString=function(){return this.data&&typeof this.data.handleId<"u"?this.data.handleId.toString():Object.prototype.toString.call(this)},ve.prototype.toJSON=function(){return{type:this.type,state:this.state,source:this.source,zone:this.zone.name,runCount:this.runCount}},ve}(),Ue=J("setTimeout"),He=J("Promise"),dt=J("then"),mt=[],Ot=!1;function zt(ve){if(Dn||D[He]&&(Dn=D[He].resolve(0)),Dn){var U=Dn[dt];U||(U=Dn.then),U.call(Dn,ve)}else D[Ue](ve,0)}function wn(ve){0===it&&0===mt.length&&zt(wt),ve&&mt.push(ve)}function wt(){if(!Ot){for(Ot=!0;mt.length;){var ve=mt;mt=[];for(var U=0;U<ve.length;U++){var L=ve[U];try{L.zone.runTask(L,null,null)}catch(Z){ln.onUnhandledError(Z)}}}ln.microtaskDrainDone(),Ot=!1}}var ze={name:"NO ZONE"},pn="notScheduled",Bt="scheduling",Ht="scheduled",Gt="running",Ze="canceling",gn="unknown",Tt="microTask",Xe="macroTask",Dt="eventTask",nt={},ln={symbol:J,currentZoneFrame:function(){return Ye},onUnhandledError:un,microtaskDrainDone:un,scheduleMicroTask:wn,showUncaughtError:function(){return!ye[J("ignoreConsoleErrorUncaughtError")]},patchEventTarget:function(){return[]},patchOnProperties:un,patchMethod:function(){return un},bindArguments:function(){return[]},patchThen:function(){return un},patchMacroTask:function(){return un},patchEventPrototype:function(){return un},isIEOrEdge:function(){return!1},getGlobalObjects:function(){},ObjectDefineProperty:function(){return un},ObjectGetOwnPropertyDescriptor:function(){},ObjectCreate:function(){},ArraySlice:function(){return[]},patchClass:function(){return un},wrapWithCurrentZone:function(){return un},filterProperties:function(){return[]},attachOriginToPatched:function(){return un},_redefineProperty:function(){return un},patchCallbacks:function(){return un},nativeScheduleMicroTask:zt},Ye={parent:null,zone:new ye(null,null)},mi=null,it=0;function un(){}V("Zone","Zone"),D.Zone=ye}(typeof window<"u"&&window||typeof self<"u"&&self||global);var _r=Object.getOwnPropertyDescriptor,sr=Object.defineProperty,ls=Object.getPrototypeOf,Rn=Object.create,ka=Array.prototype.slice,vr="addEventListener",Ba="removeEventListener",Or=Zone.__symbol__(vr),co=Zone.__symbol__(Ba),xr="true",Fi="false",Bo=Zone.__symbol__("");function Sl(D,P){return Zone.current.wrap(D,P)}function El(D,P,O,V,Y){return Zone.current.scheduleMacroTask(D,P,O,V,Y)}var Kt=Zone.__symbol__,br=typeof window<"u",Fr=br?window:void 0,Yn=br&&Fr||"object"==typeof self&&self||global,Tl="removeAttribute";function Dl(D,P){for(var O=D.length-1;O>=0;O--)"function"==typeof D[O]&&(D[O]=Sl(D[O],P+"_"+O));return D}function Hd(D){return!D||!1!==D.writable&&!("function"==typeof D.get&&typeof D.set>"u")}var lo=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,Ts=!("nw"in Yn)&&typeof Yn.process<"u"&&"[object process]"==={}.toString.call(Yn.process),Al=!Ts&&!lo&&!(!br||!Fr.HTMLElement),Ua=typeof Yn.process<"u"&&"[object process]"==={}.toString.call(Yn.process)&&!lo&&!(!br||!Fr.HTMLElement),Va={},za=function(D){if(D=D||Yn.event){var P=Va[D.type];P||(P=Va[D.type]=Kt("ON_PROPERTY"+D.type));var Y,O=this||D.target||Yn,V=O[P];return Al&&O===Fr&&"error"===D.type?!0===(Y=V&&V.call(this,D.message,D.filename,D.lineno,D.colno,D.error))&&D.preventDefault():null!=(Y=V&&V.apply(this,arguments))&&!Y&&D.preventDefault(),Y}};function kr(D,P,O){var V=_r(D,P);if(!V&&O&&_r(O,P)&&(V={enumerable:!0,configurable:!0}),V&&V.configurable){var J=Kt("on"+P+"patched");if(!D.hasOwnProperty(J)||!D[J]){delete V.writable,delete V.value;var fe=V.get,ye=V.set,Ie=P.slice(2),Be=Va[Ie];Be||(Be=Va[Ie]=Kt("ON_PROPERTY"+Ie)),V.set=function(Te){var Ue=this;!Ue&&D===Yn&&(Ue=Yn),Ue&&("function"==typeof Ue[Be]&&Ue.removeEventListener(Ie,za),ye&&ye.call(Ue,null),Ue[Be]=Te,"function"==typeof Te&&Ue.addEventListener(Ie,za,!1))},V.get=function(){var Te=this;if(!Te&&D===Yn&&(Te=Yn),!Te)return null;var Ue=Te[Be];if(Ue)return Ue;if(fe){var He=fe.call(this);if(He)return V.set.call(this,He),"function"==typeof Te[Tl]&&Te.removeAttribute(P),He}return null},sr(D,P,V),D[J]=!0}}}function Gd(D,P,O){if(P)for(var V=0;V<P.length;V++)kr(D,"on"+P[V],O);else{var Y=[];for(var J in D)"on"==J.slice(0,2)&&Y.push(J);for(var fe=0;fe<Y.length;fe++)kr(D,Y[fe],O)}}var Xi=Kt("originalInstance");function hn(D){var P=Yn[D];if(P){Yn[Kt(D)]=P,Yn[D]=function(){var Y=Dl(arguments,D);switch(Y.length){case 0:this[Xi]=new P;break;case 1:this[Xi]=new P(Y[0]);break;case 2:this[Xi]=new P(Y[0],Y[1]);break;case 3:this[Xi]=new P(Y[0],Y[1],Y[2]);break;case 4:this[Xi]=new P(Y[0],Y[1],Y[2],Y[3]);break;default:throw new Error("Arg list too long.")}},Br(Yn[D],P);var V,O=new P(function(){});for(V in O)"XMLHttpRequest"===D&&"responseBlob"===V||function(Y){"function"==typeof O[Y]?Yn[D].prototype[Y]=function(){return this[Xi][Y].apply(this[Xi],arguments)}:sr(Yn[D].prototype,Y,{set:function(J){"function"==typeof J?(this[Xi][Y]=Sl(J,D+"."+Y),Br(this[Xi][Y],J)):this[Xi][Y]=J},get:function(){return this[Xi][Y]}})}(V);for(V in P)"prototype"!==V&&P.hasOwnProperty(V)&&(Yn[D][V]=P[V])}}function wr(D,P,O){for(var V=D;V&&!V.hasOwnProperty(P);)V=ls(V);!V&&D[P]&&(V=D);var Y=Kt(P),J=null;if(V&&(!(J=V[Y])||!V.hasOwnProperty(Y))&&(J=V[Y]=V[P],Hd(V&&_r(V,P)))){var ye=O(J,Y,P);V[P]=function(){return ye(this,arguments)},Br(V[P],J)}return J}function tm(D,P,O){var V=null;function Y(J){var fe=J.data;return fe.args[fe.cbIdx]=function(){J.invoke.apply(this,arguments)},V.apply(fe.target,fe.args),J}V=wr(D,P,function(J){return function(fe,ye){var Ie=O(fe,ye);return Ie.cbIdx>=0&&"function"==typeof ye[Ie.cbIdx]?El(Ie.name,ye[Ie.cbIdx],Ie,Y):J.apply(fe,ye)}})}function Br(D,P){D[Kt("OriginalDelegate")]=P}var Wd=!1,Yi=!1;function $d(){if(Wd)return Yi;Wd=!0;try{var D=Fr.navigator.userAgent;(-1!==D.indexOf("MSIE ")||-1!==D.indexOf("Trident/")||-1!==D.indexOf("Edge/"))&&(Yi=!0)}catch{}return Yi}Zone.__load_patch("ZoneAwarePromise",function(D,P,O){var V=Object.getOwnPropertyDescriptor,Y=Object.defineProperty;var fe=O.symbol,ye=[],Ie=!0===D[fe("DISABLE_WRAPPING_UNCAUGHT_PROMISE_REJECTION")],Be=fe("Promise"),Te=fe("then"),Ue="__creationTrace__";O.onUnhandledError=function(z){if(O.showUncaughtError()){var Me=z&&z.rejection;Me?console.error("Unhandled Promise rejection:",Me instanceof Error?Me.message:Me,"; Zone:",z.zone.name,"; Task:",z.task&&z.task.source,"; Value:",Me,Me instanceof Error?Me.stack:void 0):console.error(z)}},O.microtaskDrainDone=function(){for(var z=function(){var Me=ye.shift();try{Me.zone.runGuarded(function(){throw Me.throwOriginal?Me.rejection:Me})}catch(Q){!function dt(z){O.onUnhandledError(z);try{var Me=P[He];"function"==typeof Me&&Me.call(this,z)}catch{}}(Q)}};ye.length;)z()};var He=fe("unhandledPromiseRejectionHandler");function mt(z){return z&&z.then}function Ot(z){return z}function Dn(z){return L.reject(z)}var zt=fe("state"),wn=fe("value"),wt=fe("finally"),ze=fe("parentPromiseValue"),pn=fe("parentPromiseState"),Bt="Promise.then",Ht=null,Gt=!0,Ze=!1,gn=0;function Tt(z,Me){return function(Q){try{ln(z,Me,Q)}catch(X){ln(z,!1,X)}}}var Xe=function(){var z=!1;return function(Q){return function(){z||(z=!0,Q.apply(null,arguments))}}},Dt="Promise resolved with itself",nt=fe("currentTaskTrace");function ln(z,Me,Q){var X=Xe();if(z===Q)throw new TypeError(Dt);if(z[zt]===Ht){var Fe=null;try{("object"==typeof Q||"function"==typeof Q)&&(Fe=Q&&Q.then)}catch(It){return X(function(){ln(z,!1,It)})(),z}if(Me!==Ze&&Q instanceof L&&Q.hasOwnProperty(zt)&&Q.hasOwnProperty(wn)&&Q[zt]!==Ht)mi(Q),ln(z,Q[zt],Q[wn]);else if(Me!==Ze&&"function"==typeof Fe)try{Fe.call(Q,X(Tt(z,Me)),X(Tt(z,!1)))}catch(It){X(function(){ln(z,!1,It)})()}else{z[zt]=Me;var ft=z[wn];if(z[wn]=Q,z[wt]===wt&&Me===Gt&&(z[zt]=z[pn],z[wn]=z[ze]),Me===Ze&&Q instanceof Error){var ot=P.currentTask&&P.currentTask.data&&P.currentTask.data[Ue];ot&&Y(Q,nt,{configurable:!0,enumerable:!1,writable:!0,value:ot})}for(var gt=0;gt<ft.length;)it(z,ft[gt++],ft[gt++],ft[gt++],ft[gt++]);if(0==ft.length&&Me==Ze){z[zt]=gn;var Je=Q;try{throw new Error("Uncaught (in promise): "+function J(z){return z&&z.toString===Object.prototype.toString?(z.constructor&&z.constructor.name||"")+": "+JSON.stringify(z):z?z.toString():Object.prototype.toString.call(z)}(Q)+(Q&&Q.stack?"\n"+Q.stack:""))}catch(It){Je=It}Ie&&(Je.throwOriginal=!0),Je.rejection=Q,Je.promise=z,Je.zone=P.current,Je.task=P.currentTask,ye.push(Je),O.scheduleMicroTask()}}}return z}var Ye=fe("rejectionHandledHandler");function mi(z){if(z[zt]===gn){try{var Me=P[Ye];Me&&"function"==typeof Me&&Me.call(this,{rejection:z[wn],promise:z})}catch{}z[zt]=Ze;for(var Q=0;Q<ye.length;Q++)z===ye[Q].promise&&ye.splice(Q,1)}}function it(z,Me,Q,X,Fe){mi(z);var ft=z[zt],ot=ft?"function"==typeof X?X:Ot:"function"==typeof Fe?Fe:Dn;Me.scheduleMicroTask(Bt,function(){try{var gt=z[wn],Je=!!Q&&wt===Q[wt];Je&&(Q[ze]=gt,Q[pn]=ft);var It=Me.run(ot,void 0,Je&&ot!==Dn&&ot!==Ot?[]:[gt]);ln(Q,!0,It)}catch(Ft){ln(Q,!1,Ft)}},Q)}var ve=function(){},U=D.AggregateError,L=function(){function z(Me){var Q=this;if(!(Q instanceof z))throw new Error("Must be an instanceof Promise.");Q[zt]=Ht,Q[wn]=[];try{var X=Xe();Me&&Me(X(Tt(Q,Gt)),X(Tt(Q,Ze)))}catch(Fe){ln(Q,!1,Fe)}}return z.toString=function(){return"function ZoneAwarePromise() { [native code] }"},z.resolve=function(Me){return ln(new this(null),Gt,Me)},z.reject=function(Me){return ln(new this(null),Ze,Me)},z.any=function(Me){if(!Me||"function"!=typeof Me[Symbol.iterator])return Promise.reject(new U([],"All promises were rejected"));var Q=[],X=0;try{for(var Fe=0,ft=Me;Fe<ft.length;Fe++)X++,Q.push(z.resolve(ft[Fe]))}catch{return Promise.reject(new U([],"All promises were rejected"))}if(0===X)return Promise.reject(new U([],"All promises were rejected"));var gt=!1,Je=[];return new z(function(It,Ft){for(var Sn=0;Sn<Q.length;Sn++)Q[Sn].then(function(En){gt||(gt=!0,It(En))},function(En){Je.push(En),0==--X&&(gt=!0,Ft(new U(Je,"All promises were rejected")))})})},z.race=function(Me){var Q,X,Fe=new this(function(Ft,Sn){Q=Ft,X=Sn});function ft(Ft){Q(Ft)}function ot(Ft){X(Ft)}for(var gt=0,Je=Me;gt<Je.length;gt++){var It=Je[gt];mt(It)||(It=this.resolve(It)),It.then(ft,ot)}return Fe},z.all=function(Me){return z.allWithCallback(Me)},z.allSettled=function(Me){return(this&&this.prototype instanceof z?this:z).allWithCallback(Me,{thenCallback:function(X){return{status:"fulfilled",value:X}},errorCallback:function(X){return{status:"rejected",reason:X}}})},z.allWithCallback=function(Me,Q){for(var X,Fe,ft=new this(function(Wn,ri){X=Wn,Fe=ri}),ot=2,gt=0,Je=[],It=function(Wn){mt(Wn)||(Wn=Ft.resolve(Wn));var ri=gt;try{Wn.then(function(Bn){Je[ri]=Q?Q.thenCallback(Bn):Bn,0==--ot&&X(Je)},function(Bn){Q?(Je[ri]=Q.errorCallback(Bn),0==--ot&&X(Je)):Fe(Bn)})}catch(Bn){Fe(Bn)}ot++,gt++},Ft=this,Sn=0,En=Me;Sn<En.length;Sn++)It(En[Sn]);return 0==(ot-=2)&&X(Je),ft},Object.defineProperty(z.prototype,Symbol.toStringTag,{get:function(){return"Promise"},enumerable:!1,configurable:!0}),Object.defineProperty(z.prototype,Symbol.species,{get:function(){return z},enumerable:!1,configurable:!0}),z.prototype.then=function(Me,Q){var X,Fe=null===(X=this.constructor)||void 0===X?void 0:X[Symbol.species];(!Fe||"function"!=typeof Fe)&&(Fe=this.constructor||z);var ft=new Fe(ve),ot=P.current;return this[zt]==Ht?this[wn].push(ot,ft,Me,Q):it(this,ot,ft,Me,Q),ft},z.prototype.catch=function(Me){return this.then(null,Me)},z.prototype.finally=function(Me){var Q,X=null===(Q=this.constructor)||void 0===Q?void 0:Q[Symbol.species];(!X||"function"!=typeof X)&&(X=z);var Fe=new X(ve);Fe[wt]=wt;var ft=P.current;return this[zt]==Ht?this[wn].push(ft,Fe,Me,Me):it(this,ft,Fe,Me,Me),Fe},z}();L.resolve=L.resolve,L.reject=L.reject,L.race=L.race,L.all=L.all;var Z=D[Be]=D.Promise;D.Promise=L;var Ke=fe("thenPatched");function Mn(z){var Me=z.prototype,Q=V(Me,"then");if(!Q||!1!==Q.writable&&Q.configurable){var X=Me.then;Me[Te]=X,z.prototype.then=function(Fe,ft){var ot=this;return new L(function(Je,It){X.call(ot,Je,It)}).then(Fe,ft)},z[Ke]=!0}}return O.patchThen=Mn,Z&&(Mn(Z),wr(D,"fetch",function(z){return function Ki(z){return function(Me,Q){var X=z.apply(Me,Q);if(X instanceof L)return X;var Fe=X.constructor;return Fe[Ke]||Mn(Fe),X}}(z)})),Promise[P.__symbol__("uncaughtPromiseErrors")]=ye,L}),Zone.__load_patch("toString",function(D){var P=Function.prototype.toString,O=Kt("OriginalDelegate"),V=Kt("Promise"),Y=Kt("Error"),J=function(){if("function"==typeof this){var Be=this[O];if(Be)return"function"==typeof Be?P.call(Be):Object.prototype.toString.call(Be);if(this===Promise){var Te=D[V];if(Te)return P.call(Te)}if(this===Error){var Ue=D[Y];if(Ue)return P.call(Ue)}}return P.call(this)};J[O]=P,Function.prototype.toString=J;var fe=Object.prototype.toString;Object.prototype.toString=function(){return"function"==typeof Promise&&this instanceof Promise?"[object Promise]":fe.call(this)}});var xn=!1;if(typeof window<"u")try{var mn=Object.defineProperty({},"passive",{get:function(){xn=!0}});window.addEventListener("test",mn,mn),window.removeEventListener("test",mn,mn)}catch{xn=!1}var Rl,Uo,lm,Pl,Ds,nm={useG:!0},bn={},Ha={},im=new RegExp("^"+Bo+"(\\w+)(true|false)$"),Il=Kt("propagationStopped");function rm(D,P){var O=(P?P(D):D)+Fi,V=(P?P(D):D)+xr,Y=Bo+O,J=Bo+V;bn[D]={},bn[D][Fi]=Y,bn[D][xr]=J}function ex(D,P,O,V){var Y=V&&V.add||vr,J=V&&V.rm||Ba,fe=V&&V.listeners||"eventListeners",ye=V&&V.rmAll||"removeAllListeners",Ie=Kt(Y),Be="."+Y+":",Te="prependListener",Ue="."+Te+":",He=function(wt,ze,pn){if(!wt.isRemoved){var Ht,Bt=wt.callback;"object"==typeof Bt&&Bt.handleEvent&&(wt.callback=function(gn){return Bt.handleEvent(gn)},wt.originalDelegate=Bt);try{wt.invoke(wt,ze,[pn])}catch(gn){Ht=gn}var Gt=wt.options;return Gt&&"object"==typeof Gt&&Gt.once&&ze[J].call(ze,pn.type,wt.originalDelegate?wt.originalDelegate:wt.callback,Gt),Ht}};function dt(wt,ze,pn){if(ze=ze||D.event){var Bt=wt||ze.target||D,Ht=Bt[bn[ze.type][pn?xr:Fi]];if(Ht){var Gt=[];if(1===Ht.length)(Ze=He(Ht[0],Bt,ze))&&Gt.push(Ze);else for(var gn=Ht.slice(),Tt=0;Tt<gn.length&&(!ze||!0!==ze[Il]);Tt++){var Ze;(Ze=He(gn[Tt],Bt,ze))&&Gt.push(Ze)}if(1===Gt.length)throw Gt[0];var Xe=function(Dt){var nt=Gt[Dt];P.nativeScheduleMicroTask(function(){throw nt})};for(Tt=0;Tt<Gt.length;Tt++)Xe(Tt)}}}var mt=function(wt){return dt(this,wt,!1)},Ot=function(wt){return dt(this,wt,!0)};function Dn(wt,ze){if(!wt)return!1;var pn=!0;ze&&void 0!==ze.useG&&(pn=ze.useG);var Bt=ze&&ze.vh,Ht=!0;ze&&void 0!==ze.chkDup&&(Ht=ze.chkDup);var Gt=!1;ze&&void 0!==ze.rt&&(Gt=ze.rt);for(var Ze=wt;Ze&&!Ze.hasOwnProperty(Y);)Ze=ls(Ze);if(!Ze&&wt[Y]&&(Ze=wt),!Ze||Ze[Ie])return!1;var Ye,gn=ze&&ze.eventNameToString,Tt={},Xe=Ze[Ie]=Ze[Y],Dt=Ze[Kt(J)]=Ze[J],nt=Ze[Kt(fe)]=Ze[fe],ln=Ze[Kt(ye)]=Ze[ye];ze&&ze.prepend&&(Ye=Ze[Kt(ze.prepend)]=Ze[ze.prepend]);var Z=pn?function(X){if(!Tt.isExisting)return Xe.call(Tt.target,Tt.eventName,Tt.capture?Ot:mt,Tt.options)}:function(X){return Xe.call(Tt.target,Tt.eventName,X.invoke,Tt.options)},Ke=pn?function(X){if(!X.isRemoved){var Fe=bn[X.eventName],ft=void 0;Fe&&(ft=Fe[X.capture?xr:Fi]);var ot=ft&&X.target[ft];if(ot)for(var gt=0;gt<ot.length;gt++)if(ot[gt]===X){ot.splice(gt,1),X.isRemoved=!0,0===ot.length&&(X.allRemoved=!0,X.target[ft]=null);break}}if(X.allRemoved)return Dt.call(X.target,X.eventName,X.capture?Ot:mt,X.options)}:function(X){return Dt.call(X.target,X.eventName,X.invoke,X.options)},Ki=ze&&ze.diff?ze.diff:function(X,Fe){var ft=typeof Fe;return"function"===ft&&X.callback===Fe||"object"===ft&&X.originalDelegate===Fe},z=Zone[Kt("UNPATCHED_EVENTS")],Me=D[Kt("PASSIVE_EVENTS")],Q=function(X,Fe,ft,ot,gt,Je){return void 0===gt&&(gt=!1),void 0===Je&&(Je=!1),function(){var It=this||D,Ft=arguments[0];ze&&ze.transferEventName&&(Ft=ze.transferEventName(Ft));var Sn=arguments[1];if(!Sn)return X.apply(this,arguments);if(Ts&&"uncaughtException"===Ft)return X.apply(this,arguments);var En=!1;if("function"!=typeof Sn){if(!Sn.handleEvent)return X.apply(this,arguments);En=!0}if(!Bt||Bt(X,Sn,It,arguments)){var us=xn&&!!Me&&-1!==Me.indexOf(Ft),Wn=function mi(X,Fe){return!xn&&"object"==typeof X&&X?!!X.capture:xn&&Fe?"boolean"==typeof X?{capture:X,passive:!0}:X?"object"==typeof X&&!1!==X.passive?Object.assign(Object.assign({},X),{passive:!0}):X:{passive:!0}:X}(arguments[2],us);if(z)for(var ri=0;ri<z.length;ri++)if(Ft===z[ri])return us?X.call(It,Ft,Sn,Wn):X.apply(this,arguments);var Bn=!!Wn&&("boolean"==typeof Wn||Wn.capture),uo=!(!Wn||"object"!=typeof Wn)&&Wn.once,dx=Zone.current,Ol=bn[Ft];Ol||(rm(Ft,gn),Ol=bn[Ft]);var pm=Ol[Bn?xr:Fi],si=It[pm],Jt=!1;if(si){if(Jt=!0,Ht)for(ri=0;ri<si.length;ri++)if(Ki(si[ri],Sn))return}else si=It[pm]=[];var Fl,mm=It.constructor.name,gm=Ha[mm];gm&&(Fl=gm[Ft]),Fl||(Fl=mm+Fe+(gn?gn(Ft):Ft)),Tt.options=Wn,uo&&(Tt.options.once=!1),Tt.target=It,Tt.capture=Bn,Tt.eventName=Ft,Tt.isExisting=Jt;var Wt=pn?nm:void 0;Wt&&(Wt.taskData=Tt);var As=dx.scheduleEventTask(Fl,Sn,Wt,ft,ot);if(Tt.target=null,Wt&&(Wt.taskData=null),uo&&(Wn.once=!0),!xn&&"boolean"==typeof As.options||(As.options=Wn),As.target=It,As.capture=Bn,As.eventName=Ft,En&&(As.originalDelegate=Sn),Je?si.unshift(As):si.push(As),gt)return It}}};return Ze[Y]=Q(Xe,Be,Z,Ke,Gt),Ye&&(Ze[Te]=Q(Ye,Ue,function(X){return Ye.call(Tt.target,Tt.eventName,X.invoke,Tt.options)},Ke,Gt,!0)),Ze[J]=function(){var X=this||D,Fe=arguments[0];ze&&ze.transferEventName&&(Fe=ze.transferEventName(Fe));var ft=arguments[2],ot=!!ft&&("boolean"==typeof ft||ft.capture),gt=arguments[1];if(!gt)return Dt.apply(this,arguments);if(!Bt||Bt(Dt,gt,X,arguments)){var It,Je=bn[Fe];Je&&(It=Je[ot?xr:Fi]);var Ft=It&&X[It];if(Ft)for(var Sn=0;Sn<Ft.length;Sn++){var En=Ft[Sn];if(Ki(En,gt))return Ft.splice(Sn,1),En.isRemoved=!0,0===Ft.length&&(En.allRemoved=!0,X[It]=null,"string"==typeof Fe)&&(X[Bo+"ON_PROPERTY"+Fe]=null),En.zone.cancelTask(En),Gt?X:void 0}return Dt.apply(this,arguments)}},Ze[fe]=function(){var X=this||D,Fe=arguments[0];ze&&ze.transferEventName&&(Fe=ze.transferEventName(Fe));for(var ft=[],ot=sm(X,gn?gn(Fe):Fe),gt=0;gt<ot.length;gt++){var Je=ot[gt];ft.push(Je.originalDelegate?Je.originalDelegate:Je.callback)}return ft},Ze[ye]=function(){var X=this||D,Fe=arguments[0];if(Fe){ze&&ze.transferEventName&&(Fe=ze.transferEventName(Fe));var Ft=bn[Fe];if(Ft){var us=X[Ft[Fi]],Wn=X[Ft[xr]];if(us)for(var ri=us.slice(),ot=0;ot<ri.length;ot++)this[J].call(this,Fe,(Bn=ri[ot]).originalDelegate?Bn.originalDelegate:Bn.callback,Bn.options);if(Wn)for(ri=Wn.slice(),ot=0;ot<ri.length;ot++){var Bn;this[J].call(this,Fe,(Bn=ri[ot]).originalDelegate?Bn.originalDelegate:Bn.callback,Bn.options)}}}else{var ft=Object.keys(X);for(ot=0;ot<ft.length;ot++){var Je=im.exec(ft[ot]),It=Je&&Je[1];It&&"removeListener"!==It&&this[ye].call(this,It)}this[ye].call(this,"removeListener")}if(Gt)return this},Br(Ze[Y],Xe),Br(Ze[J],Dt),ln&&Br(Ze[ye],ln),nt&&Br(Ze[fe],nt),!0}for(var zt=[],wn=0;wn<O.length;wn++)zt[wn]=Dn(O[wn],V);return zt}function sm(D,P){if(!P){var O=[];for(var V in D){var Y=im.exec(V),J=Y&&Y[1];if(J&&(!P||J===P)){var fe=D[V];if(fe)for(var ye=0;ye<fe.length;ye++)O.push(fe[ye])}}return O}var Ie=bn[P];Ie||(rm(P),Ie=bn[P]);var Be=D[Ie[Fi]],Te=D[Ie[xr]];return Be?Te?Be.concat(Te):Be.slice():Te?Te.slice():[]}function tx(D,P){var O=D.Event;O&&O.prototype&&P.patchMethod(O.prototype,"stopImmediatePropagation",function(V){return function(Y,J){Y[Il]=!0,V&&V.apply(Y,J)}})}function nx(D,P,O,V,Y){var J=Zone.__symbol__(V);if(!P[J]){var fe=P[J]=P[V];P[V]=function(ye,Ie,Be){return Ie&&Ie.prototype&&Y.forEach(function(Te){var Ue="".concat(O,".").concat(V,"::")+Te,He=Ie.prototype;try{if(He.hasOwnProperty(Te)){var dt=D.ObjectGetOwnPropertyDescriptor(He,Te);dt&&dt.value?(dt.value=D.wrapWithCurrentZone(dt.value,Ue),D._redefineProperty(Ie.prototype,Te,dt)):He[Te]&&(He[Te]=D.wrapWithCurrentZone(He[Te],Ue))}else He[Te]&&(He[Te]=D.wrapWithCurrentZone(He[Te],Ue))}catch{}}),fe.call(P,ye,Ie,Be)},D.attachOriginToPatched(P[V],fe)}}function om(D,P,O){if(!O||0===O.length)return P;var V=O.filter(function(J){return J.target===D});if(!V||0===V.length)return P;var Y=V[0].ignoreProperties;return P.filter(function(J){return-1===Y.indexOf(J)})}function am(D,P,O,V){D&&Gd(D,om(D,P,O),V)}function qd(D){return Object.getOwnPropertyNames(D).filter(function(P){return P.startsWith("on")&&P.length>2}).map(function(P){return P.substring(2)})}function cm(D,P){if((!Ts||Ua)&&!Zone[D.symbol("patchEvents")]){var O=P.__Zone_ignore_on_properties,V=[];if(Al){var Y=window;V=V.concat(["Document","SVGElement","Element","HTMLElement","HTMLBodyElement","HTMLMediaElement","HTMLFrameSetElement","HTMLFrameElement","HTMLIFrameElement","HTMLMarqueeElement","Worker"]);var J=function jd(){try{var D=Fr.navigator.userAgent;if(-1!==D.indexOf("MSIE ")||-1!==D.indexOf("Trident/"))return!0}catch{}return!1}()?[{target:Y,ignoreProperties:["error"]}]:[];am(Y,qd(Y),O&&O.concat(J),ls(Y))}V=V.concat(["XMLHttpRequest","XMLHttpRequestEventTarget","IDBIndex","IDBRequest","IDBOpenDBRequest","IDBDatabase","IDBTransaction","IDBCursor","WebSocket"]);for(var fe=0;fe<V.length;fe++){var ye=P[V[fe]];ye&&ye.prototype&&am(ye.prototype,qd(ye.prototype),O)}}}function rx(D,P,O){var V=O.configurable;return Zd(D,P,O=Ur(D,P,O),V)}function um(D,P){return D&&D[Ds]&&D[Ds][P]}function Ur(D,P,O){return Object.isFrozen(O)||(O.configurable=!0),O.configurable||(!D[Ds]&&!Object.isFrozen(D)&&Uo(D,Ds,{writable:!0,value:{}}),D[Ds]&&(D[Ds][P]=!0)),O}function Zd(D,P,O,V){try{return Uo(D,P,O)}catch(fe){if(!O.configurable)throw fe;typeof V>"u"?delete O.configurable:O.configurable=V;try{return Uo(D,P,O)}catch(ye){var Y=!1;if(("createdCallback"===P||"attachedCallback"===P||"detachedCallback"===P||"attributeChangedCallback"===P)&&(Y=!0),!Y)throw ye;var J=null;try{J=JSON.stringify(O)}catch{J=O.toString()}console.log("Attempting to configure '".concat(P,"' with descriptor '").concat(J,"' on object '").concat(D,"' and got error, giving up: ").concat(ye))}}}function ox(D,P){var O=D.getGlobalObjects();if((!O.isNode||O.isMix)&&!function fm(D,P){var O=D.getGlobalObjects();if((O.isBrowser||O.isMix)&&!D.ObjectGetOwnPropertyDescriptor(HTMLElement.prototype,"onclick")&&typeof Element<"u"){var J=D.ObjectGetOwnPropertyDescriptor(Element.prototype,"onclick");if(J&&!J.configurable)return!1;if(J){D.ObjectDefineProperty(Element.prototype,"onclick",{enumerable:!0,configurable:!0,get:function(){return!0}});var ye=!!document.createElement("div").onclick;return D.ObjectDefineProperty(Element.prototype,"onclick",J),ye}}var Ie=P.XMLHttpRequest;if(!Ie)return!1;var Be="onreadystatechange",Te=Ie.prototype,Ue=D.ObjectGetOwnPropertyDescriptor(Te,Be);if(Ue)return D.ObjectDefineProperty(Te,Be,{enumerable:!0,configurable:!0,get:function(){return!0}}),ye=!!(He=new Ie).onreadystatechange,D.ObjectDefineProperty(Te,Be,Ue||{}),ye;var dt=D.symbol("fake");D.ObjectDefineProperty(Te,Be,{enumerable:!0,configurable:!0,get:function(){return this[dt]},set:function(zt){this[dt]=zt}});var He,mt=function(){};return(He=new Ie).onreadystatechange=mt,ye=He[dt]===mt,He.onreadystatechange=null,ye}(D,P)){var J=typeof WebSocket<"u";(function Jd(D){for(var P=D.symbol("unbound"),O=function(Y){var J=Nl[Y],fe="on"+J;self.addEventListener(J,function(ye){var Be,Te,Ie=ye.target;for(Te=Ie?Ie.constructor.name+"."+fe:"unknown."+fe;Ie;)Ie[fe]&&!Ie[fe][P]&&((Be=D.wrapWithCurrentZone(Ie[fe],Te))[P]=Ie[fe],Ie[fe]=Be),Ie=Ie.parentElement},!0)},V=0;V<Nl.length;V++)O(V)})(D),D.patchClass("XMLHttpRequest"),J&&function dm(D,P){var O=D.getGlobalObjects(),V=O.ADD_EVENT_LISTENER_STR,Y=O.REMOVE_EVENT_LISTENER_STR,J=P.WebSocket;P.EventTarget||D.patchEventTarget(P,D,[J.prototype]),P.WebSocket=function(Ie,Be){var Ue,He,Te=arguments.length>1?new J(Ie,Be):new J(Ie),dt=D.ObjectGetOwnPropertyDescriptor(Te,"onmessage");return dt&&!1===dt.configurable?(Ue=D.ObjectCreate(Te),He=Te,[V,Y,"send","close"].forEach(function(mt){Ue[mt]=function(){var Ot=D.ArraySlice.call(arguments);if(mt===V||mt===Y){var Dn=Ot.length>0?Ot[0]:void 0;if(Dn){var zt=Zone.__symbol__("ON_PROPERTY"+Dn);Te[zt]=Ue[zt]}}return Te[mt].apply(Te,Ot)}})):Ue=Te,D.patchOnProperties(Ue,["close","error","message","open"],He),Ue};var fe=P.WebSocket;for(var ye in J)fe[ye]=J[ye]}(D,P),Zone[D.symbol("patchEvents")]=!0}}Zone.__load_patch("util",function(D,P,O){var V=qd(D);O.patchOnProperties=Gd,O.patchMethod=wr,O.bindArguments=Dl,O.patchMacroTask=tm;var Y=P.__symbol__("BLACK_LISTED_EVENTS"),J=P.__symbol__("UNPATCHED_EVENTS");D[J]&&(D[Y]=D[J]),D[Y]&&(P[Y]=P[J]=D[Y]),O.patchEventPrototype=tx,O.patchEventTarget=ex,O.isIEOrEdge=$d,O.ObjectDefineProperty=sr,O.ObjectGetOwnPropertyDescriptor=_r,O.ObjectCreate=Rn,O.ArraySlice=ka,O.patchClass=hn,O.wrapWithCurrentZone=Sl,O.filterProperties=om,O.attachOriginToPatched=Br,O._redefineProperty=Object.defineProperty,O.patchCallbacks=nx,O.getGlobalObjects=function(){return{globalSources:Ha,zoneSymbolEventNames:bn,eventNames:V,isBrowser:Al,isMix:Ua,isNode:Ts,TRUE_STR:xr,FALSE_STR:Fi,ZONE_SYMBOL_PREFIX:Bo,ADD_EVENT_LISTENER_STR:vr,REMOVE_EVENT_LISTENER_STR:Ba}}});var D,P,Nl=bt(bt(bt(bt(bt(bt(bt(bt([],["abort","animationcancel","animationend","animationiteration","auxclick","beforeinput","blur","cancel","canplay","canplaythrough","change","compositionstart","compositionupdate","compositionend","cuechange","click","close","contextmenu","curechange","dblclick","drag","dragend","dragenter","dragexit","dragleave","dragover","drop","durationchange","emptied","ended","error","focus","focusin","focusout","gotpointercapture","input","invalid","keydown","keypress","keyup","load","loadstart","loadeddata","loadedmetadata","lostpointercapture","mousedown","mouseenter","mouseleave","mousemove","mouseout","mouseover","mouseup","mousewheel","orientationchange","pause","play","playing","pointercancel","pointerdown","pointerenter","pointerleave","pointerlockchange","mozpointerlockchange","webkitpointerlockerchange","pointerlockerror","mozpointerlockerror","webkitpointerlockerror","pointermove","pointout","pointerover","pointerup","progress","ratechange","reset","resize","scroll","seeked","seeking","select","selectionchange","selectstart","show","sort","stalled","submit","suspend","timeupdate","volumechange","touchcancel","touchmove","touchstart","touchend","transitioncancel","transitionend","waiting","wheel"],!0),["webglcontextrestored","webglcontextlost","webglcontextcreationerror"],!0),["autocomplete","autocompleteerror"],!0),["toggle"],!0),["afterscriptexecute","beforescriptexecute","DOMContentLoaded","freeze","fullscreenchange","mozfullscreenchange","webkitfullscreenchange","msfullscreenchange","fullscreenerror","mozfullscreenerror","webkitfullscreenerror","msfullscreenerror","readystatechange","visibilitychange","resume"],!0),["absolutedeviceorientation","afterinput","afterprint","appinstalled","beforeinstallprompt","beforeprint","beforeunload","devicelight","devicemotion","deviceorientation","deviceorientationabsolute","deviceproximity","hashchange","languagechange","message","mozbeforepaint","offline","online","paint","pageshow","pagehide","popstate","rejectionhandled","storage","unhandledrejection","unload","userproximity","vrdisplayconnected","vrdisplaydisconnected","vrdisplaypresentchange"],!0),["beforecopy","beforecut","beforepaste","copy","cut","paste","dragstart","loadend","animationstart","search","transitionrun","transitionstart","webkitanimationend","webkitanimationiteration","webkitanimationstart","webkittransitionend"],!0),["activate","afterupdate","ariarequest","beforeactivate","beforedeactivate","beforeeditfocus","beforeupdate","cellchange","controlselect","dataavailable","datasetchanged","datasetcomplete","errorupdate","filterchange","layoutcomplete","losecapture","move","moveend","movestart","propertychange","resizeend","resizestart","rowenter","rowexit","rowsdelete","rowsinserted","command","compassneedscalibration","deactivate","help","mscontentzoom","msmanipulationstatechanged","msgesturechange","msgesturedoubletap","msgestureend","msgesturehold","msgesturestart","msgesturetap","msgotpointercapture","msinertiastart","mslostpointercapture","mspointercancel","mspointerdown","mspointerenter","mspointerhover","mspointerleave","mspointermove","mspointerout","mspointerover","mspointerup","pointerout","mssitemodejumplistitemremoved","msthumbnailclick","stop","storagecommit"],!0);D=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},P=D.__Zone_symbol_prefix||"__zone_symbol__",D[function O(V){return P+V}("legacyPatch")]=function(){var V=D.Zone;V.__load_patch("defineProperty",function(Y,J,fe){fe._redefineProperty=rx,function ix(){Rl=Zone.__symbol__,Uo=Object[Rl("defineProperty")]=Object.defineProperty,lm=Object[Rl("getOwnPropertyDescriptor")]=Object.getOwnPropertyDescriptor,Pl=Object.create,Ds=Rl("unconfigurables"),Object.defineProperty=function(D,P,O){if(um(D,P))throw new TypeError("Cannot assign to read only property '"+P+"' of "+D);var V=O.configurable;return"prototype"!==P&&(O=Ur(D,P,O)),Zd(D,P,O,V)},Object.defineProperties=function(D,P){Object.keys(P).forEach(function(fe){Object.defineProperty(D,fe,P[fe])});for(var O=0,V=Object.getOwnPropertySymbols(P);O<V.length;O++){var Y=V[O];Object.getOwnPropertyDescriptor(P,Y)?.enumerable&&Object.defineProperty(D,Y,P[Y])}return D},Object.create=function(D,P){return"object"==typeof P&&!Object.isFrozen(P)&&Object.keys(P).forEach(function(O){P[O]=Ur(D,O,P[O])}),Pl(D,P)},Object.getOwnPropertyDescriptor=function(D,P){var O=lm(D,P);return O&&um(D,P)&&(O.configurable=!1),O}}()}),V.__load_patch("registerElement",function(Y,J,fe){!function hm(D,P){var O=P.getGlobalObjects();(O.isBrowser||O.isMix)&&"registerElement"in D.document&&P.patchCallbacks(P,document,"Document","registerElement",["createdCallback","attachedCallback","detachedCallback","attributeChangedCallback"])}(Y,fe)}),V.__load_patch("EventTargetLegacy",function(Y,J,fe){(function sx(D,P){var O=P.getGlobalObjects(),V=O.eventNames,Y=O.globalSources,J=O.zoneSymbolEventNames,fe=O.TRUE_STR,ye=O.FALSE_STR,Ie=O.ZONE_SYMBOL_PREFIX,Te="ApplicationCache,EventSource,FileReader,InputMethodContext,MediaController,MessagePort,Node,Performance,SVGElementInstance,SharedWorker,TextTrack,TextTrackCue,TextTrackList,WebKitNamedFlow,Window,Worker,WorkerGlobalScope,XMLHttpRequest,XMLHttpRequestEventTarget,XMLHttpRequestUpload,IDBRequest,IDBOpenDBRequest,IDBDatabase,IDBTransaction,IDBCursor,DBIndex,WebSocket".split(","),Ue="EventTarget",He=[],dt=D.wtf,mt="Anchor,Area,Audio,BR,Base,BaseFont,Body,Button,Canvas,Content,DList,Directory,Div,Embed,FieldSet,Font,Form,Frame,FrameSet,HR,Head,Heading,Html,IFrame,Image,Input,Keygen,LI,Label,Legend,Link,Map,Marquee,Media,Menu,Meta,Meter,Mod,OList,Object,OptGroup,Option,Output,Paragraph,Pre,Progress,Quote,Script,Select,Source,Span,Style,TableCaption,TableCell,TableCol,Table,TableRow,TableSection,TextArea,Title,Track,UList,Unknown,Video".split(",");dt?He=mt.map(function(it){return"HTML"+it+"Element"}).concat(Te):D[Ue]?He.push(Ue):He=Te;for(var Ot=D.__Zone_disable_IE_check||!1,Dn=D.__Zone_enable_cross_context_check||!1,zt=P.isIEOrEdge(),wt="[object FunctionWrapper]",ze="function __BROWSERTOOLS_CONSOLE_SAFEFUNC() { [native code] }",pn={MSPointerCancel:"pointercancel",MSPointerDown:"pointerdown",MSPointerEnter:"pointerenter",MSPointerHover:"pointerhover",MSPointerLeave:"pointerleave",MSPointerMove:"pointermove",MSPointerOut:"pointerout",MSPointerOver:"pointerover",MSPointerUp:"pointerup"},Bt=0;Bt<V.length;Bt++){var gn=Ie+((Ht=V[Bt])+ye),Tt=Ie+(Ht+fe);J[Ht]={},J[Ht][ye]=gn,J[Ht][fe]=Tt}for(Bt=0;Bt<mt.length;Bt++)for(var Xe=mt[Bt],Dt=Y[Xe]={},nt=0;nt<V.length;nt++){var Ht;Dt[Ht=V[nt]]=Xe+".addEventListener:"+Ht}var Ye=[];for(Bt=0;Bt<He.length;Bt++){var mi=D[He[Bt]];Ye.push(mi&&mi.prototype)}return P.patchEventTarget(D,P,Ye,{vh:function(it,un,ve,U){if(!Ot&&zt)if(Dn)try{if((L=un.toString())===wt||L==ze)return it.apply(ve,U),!1}catch{return it.apply(ve,U),!1}else{var L;if((L=un.toString())===wt||L==ze)return it.apply(ve,U),!1}else if(Dn)try{un.toString()}catch{return it.apply(ve,U),!1}return!0},transferEventName:function(it){return pn[it]||it}}),Zone[P.symbol("patchEventTarget")]=!!D[Ue],!0})(Y,fe),ox(fe,Y)})};var Vo=Kt("zoneTask");function Cs(D,P,O,V){var Y=null,J=null;O+=V;var fe={};function ye(Be){var Te=Be.data;return Te.args[0]=function(){return Be.invoke.apply(this,arguments)},Te.handleId=Y.apply(D,Te.args),Be}function Ie(Be){return J.call(D,Be.data.handleId)}Y=wr(D,P+=V,function(Be){return function(Te,Ue){if("function"==typeof Ue[0]){var He={isPeriodic:"Interval"===V,delay:"Timeout"===V||"Interval"===V?Ue[1]||0:void 0,args:Ue},dt=Ue[0];Ue[0]=function(){try{return dt.apply(this,arguments)}finally{He.isPeriodic||("number"==typeof He.handleId?delete fe[He.handleId]:He.handleId&&(He.handleId[Vo]=null))}};var mt=El(P,Ue[0],He,ye,Ie);if(!mt)return mt;var Ot=mt.data.handleId;return"number"==typeof Ot?fe[Ot]=mt:Ot&&(Ot[Vo]=mt),Ot&&Ot.ref&&Ot.unref&&"function"==typeof Ot.ref&&"function"==typeof Ot.unref&&(mt.ref=Ot.ref.bind(Ot),mt.unref=Ot.unref.bind(Ot)),"number"==typeof Ot||Ot?Ot:mt}return Be.apply(D,Ue)}}),J=wr(D,O,function(Be){return function(Te,Ue){var dt,He=Ue[0];"number"==typeof He?dt=fe[He]:(dt=He&&He[Vo])||(dt=He),dt&&"string"==typeof dt.type?"notScheduled"!==dt.state&&(dt.cancelFn&&dt.data.isPeriodic||0===dt.runCount)&&("number"==typeof He?delete fe[He]:He&&(He[Vo]=null),dt.zone.cancelTask(dt)):Be.apply(D,Ue)}})}Zone.__load_patch("legacy",function(D){var P=D[Zone.__symbol__("legacyPatch")];P&&P()}),Zone.__load_patch("queueMicrotask",function(D,P,O){O.patchMethod(D,"queueMicrotask",function(V){return function(Y,J){P.current.scheduleMicroTask("queueMicrotask",J[0])}})}),Zone.__load_patch("timers",function(D){var P="set",O="clear";Cs(D,P,O,"Timeout"),Cs(D,P,O,"Interval"),Cs(D,P,O,"Immediate")}),Zone.__load_patch("requestAnimationFrame",function(D){Cs(D,"request","cancel","AnimationFrame"),Cs(D,"mozRequest","mozCancel","AnimationFrame"),Cs(D,"webkitRequest","webkitCancel","AnimationFrame")}),Zone.__load_patch("blocking",function(D,P){for(var O=["alert","prompt","confirm"],V=0;V<O.length;V++)wr(D,O[V],function(J,fe,ye){return function(Ie,Be){return P.current.run(J,D,Be,ye)}})}),Zone.__load_patch("EventTarget",function(D,P,O){(function pi(D,P){P.patchEventPrototype(D,P)})(D,O),function ef(D,P){if(!Zone[P.symbol("patchEventTarget")]){for(var O=P.getGlobalObjects(),V=O.eventNames,Y=O.zoneSymbolEventNames,J=O.TRUE_STR,fe=O.FALSE_STR,ye=O.ZONE_SYMBOL_PREFIX,Ie=0;Ie<V.length;Ie++){var Be=V[Ie],He=ye+(Be+fe),dt=ye+(Be+J);Y[Be]={},Y[Be][fe]=He,Y[Be][J]=dt}var mt=D.EventTarget;if(mt&&mt.prototype)return P.patchEventTarget(D,P,[mt&&mt.prototype]),!0}}(D,O);var V=D.XMLHttpRequestEventTarget;V&&V.prototype&&O.patchEventTarget(D,O,[V.prototype])}),Zone.__load_patch("MutationObserver",function(D,P,O){hn("MutationObserver"),hn("WebKitMutationObserver")}),Zone.__load_patch("IntersectionObserver",function(D,P,O){hn("IntersectionObserver")}),Zone.__load_patch("FileReader",function(D,P,O){hn("FileReader")}),Zone.__load_patch("on_property",function(D,P,O){cm(O,D)}),Zone.__load_patch("customElements",function(D,P,O){!function Qd(D,P){var O=P.getGlobalObjects();(O.isBrowser||O.isMix)&&D.customElements&&"customElements"in D&&P.patchCallbacks(P,D.customElements,"customElements","define",["connectedCallback","disconnectedCallback","adoptedCallback","attributeChangedCallback"])}(D,O)}),Zone.__load_patch("XHR",function(D,P){!function Ie(Be){var Te=Be.XMLHttpRequest;if(Te){var Ue=Te.prototype,dt=Ue[Or],mt=Ue[co];if(!dt){var Ot=Be.XMLHttpRequestEventTarget;if(Ot){var Dn=Ot.prototype;dt=Dn[Or],mt=Dn[co]}}var zt="readystatechange",wn="scheduled",Bt=wr(Ue,"open",function(){return function(Xe,Dt){return Xe[V]=0==Dt[2],Xe[fe]=Dt[1],Bt.apply(Xe,Dt)}}),Gt=Kt("fetchTaskAborting"),Ze=Kt("fetchTaskScheduling"),gn=wr(Ue,"send",function(){return function(Xe,Dt){if(!0===P.current[Ze]||Xe[V])return gn.apply(Xe,Dt);var nt={target:Xe,url:Xe[fe],isPeriodic:!1,args:Dt,aborted:!1},ln=El("XMLHttpRequest.send",ze,nt,wt,pn);Xe&&!0===Xe[ye]&&!nt.aborted&&ln.state===wn&&ln.invoke()}}),Tt=wr(Ue,"abort",function(){return function(Xe,Dt){var nt=function He(Xe){return Xe[O]}(Xe);if(nt&&"string"==typeof nt.type){if(null==nt.cancelFn||nt.data&&nt.data.aborted)return;nt.zone.cancelTask(nt)}else if(!0===P.current[Gt])return Tt.apply(Xe,Dt)}})}function wt(Xe){var Dt=Xe.data,nt=Dt.target;nt[J]=!1,nt[ye]=!1;var ln=nt[Y];dt||(dt=nt[Or],mt=nt[co]),ln&&mt.call(nt,zt,ln);var Ye=nt[Y]=function(){if(nt.readyState===nt.DONE)if(!Dt.aborted&&nt[J]&&Xe.state===wn){var it=nt[P.__symbol__("loadfalse")];if(0!==nt.status&&it&&it.length>0){var un=Xe.invoke;Xe.invoke=function(){for(var ve=nt[P.__symbol__("loadfalse")],U=0;U<ve.length;U++)ve[U]===Xe&&ve.splice(U,1);!Dt.aborted&&Xe.state===wn&&un.call(Xe)},it.push(Xe)}else Xe.invoke()}else!Dt.aborted&&!1===nt[J]&&(nt[ye]=!0)};return dt.call(nt,zt,Ye),nt[O]||(nt[O]=Xe),gn.apply(nt,Dt.args),nt[J]=!0,Xe}function ze(){}function pn(Xe){var Dt=Xe.data;return Dt.aborted=!0,Tt.apply(Dt.target,Dt.args)}}(D);var O=Kt("xhrTask"),V=Kt("xhrSync"),Y=Kt("xhrListener"),J=Kt("xhrScheduled"),fe=Kt("xhrURL"),ye=Kt("xhrErrorBeforeScheduled")}),Zone.__load_patch("geolocation",function(D){D.navigator&&D.navigator.geolocation&&function Cl(D,P){for(var O=D.constructor.name,V=function(J){var Be,Te,fe=P[J],ye=D[fe];if(ye){if(!Hd(_r(D,fe)))return"continue";D[fe]=(Te=function(){return Be.apply(this,Dl(arguments,O+"."+fe))},Br(Te,Be=ye),Te)}},Y=0;Y<P.length;Y++)V(Y)}(D.navigator.geolocation,["getCurrentPosition","watchPosition"])}),Zone.__load_patch("PromiseRejectionEvent",function(D,P){function O(V){return function(Y){sm(D,V).forEach(function(fe){var ye=D.PromiseRejectionEvent;if(ye){var Ie=new ye(V,{promise:Y.promise,reason:Y.rejection});fe.invoke(Ie)}})}}D.PromiseRejectionEvent&&(P[Kt("unhandledPromiseRejectionHandler")]=O("unhandledrejection"),P[Kt("rejectionHandledHandler")]=O("rejectionhandled"))})},void 0!==(zd=cs.call(Ml,Fa,Ml,Oa))&&(Oa.exports=zd)}},Oa=>{Oa(Oa.s=646)}]);